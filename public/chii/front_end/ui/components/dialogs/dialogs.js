import*as t from"../../../core/platform/platform.js";import*as e from"../../../services/window_bounds/window_bounds.js";import*as o from"../helpers/helpers.js";import*as i from"../render_coordinator/render_coordinator.js";import*as n from"../../lit-html/lit-html.js";import*as s from"../../../core/i18n/i18n.js";import*as r from"../icon_button/icon_button.js";import*as a from"../buttons/buttons.js";const l=new CSSStyleSheet;l.replaceSync(":host{--override-transparent:rgb(0 0 0/0%);display:var(--dialog-display)}dialog::backdrop{background:var(--override-transparent)}dialog{background:var(--override-transparent);border:none;border-radius:4px;top:var(--dialog-top);padding:var(--dialog-padding);left:var(--dialog-left);right:var(--dialog-right);margin:var(--dialog-margin);margin-left:var(--dialog-margin-left,0);margin-bottom:var(--dialog-margin-bottom);animation-name:slideIn;animation-duration:100ms;animation-timing-function:cubic-bezier(0,0,0.3,1);overflow:hidden}dialog:focus,\ndialog:focus-visible{outline:none}#content{min-width:var(--content-min-width);background:var(--color-background-elevation-dark-only);border-radius:4px;padding-top:var(--content-padding-top);padding-bottom:var(--content-padding-bottom);box-shadow:var(--override-content-box-shadow);max-height:var(--dialog-max-height);max-width:var(--dialog-max-width);overflow:auto;outline:none;clip-path:polygon(var(--content-clip-path))}#content-wrap{filter:drop-shadow(0 1px 2px rgb(60 64 67/30%)) drop-shadow(0 2px 0 rgb(60 64 67/15%))}@keyframes slideIn{from{transform:translateY(var(--dialog-offset-y));opacity:0%}to{opacity:100%}}\n/*# sourceURL=dialog.css */\n");const d=i.RenderCoordinator.RenderCoordinator.instance(),h="HTMLDialogElement"in globalThis,c=10,g=30,p="MODAL";class u extends HTMLElement{static litTagName=n.literal`devtools-dialog`;#t=this.attachShadow({mode:"open"});#e=this.#o.bind(this);#i=this.#n.bind(this);#s=this.#r.bind(this);#a={origin:p,position:"bottom",horizontalAlignment:"center",showConnector:!1,getConnectorCustomXPosition:null,dialogShownCallback:null,windowBoundsService:e.WindowBoundsService.WindowBoundsServiceImpl.instance(),closeOnESC:!0,closeOnScroll:!0};#l=null;#d=!1;#h=!1;#c=new DOMRect(0,0,0,0);#g=new DOMRect(0,0,0,0);#p=null;#u=null;#S=new MutationObserver(this.#i);#m=new ResizeObserver(this.#w.bind(this));#b=this.windowBoundsService.getDevToolsBoundingElement();#v=this.#C.bind(this);get showConnector(){return this.#a.showConnector}set showConnector(t){this.#a.showConnector=t,this.#y()}get origin(){return this.#a.origin}set origin(t){this.#a.origin=t,this.#y()}get position(){return this.#a.position}set position(t){this.#a.position=t,this.#y()}get horizontalAlignment(){return this.#a.horizontalAlignment}set horizontalAlignment(t){this.#a.horizontalAlignment=t,this.#y()}get windowBoundsService(){return this.#a.windowBoundsService}set windowBoundsService(t){this.#a.windowBoundsService=t,this.#b=this.windowBoundsService.getDevToolsBoundingElement(),this.#y()}get bestVerticalPosition(){return this.#p}get bestHorizontalAlignment(){return this.#u}get getConnectorCustomXPosition(){return this.#a.getConnectorCustomXPosition}set getConnectorCustomXPosition(t){this.#a.getConnectorCustomXPosition=t,this.#y()}get dialogShownCallback(){return this.#a.dialogShownCallback}set dialogShownCallback(t){this.#a.dialogShownCallback=t,this.#y()}set closeOnESC(t){this.#a.closeOnESC=t,this.#y()}set closeOnScroll(t){this.#a.closeOnScroll=t,this.#y()}#w(){this.#g=this.#D().getBoundingClientRect()}#y(){o.ScheduledRender.scheduleRender(this,this.#e)}connectedCallback(){this.#t.adoptedStyleSheets=[l],window.addEventListener("resize",this.#i),document.body.addEventListener("keydown",this.#v),this.#S.observe(this.#b,{childList:!0,subtree:!0}),this.#b.addEventListener("wheel",this.#s),o.SetCSSProperty.set(this,"--dialog-padding","0"),o.SetCSSProperty.set(this,"--override-content-box-shadow","none"),o.SetCSSProperty.set(this,"--dialog-display",h?"block":"none"),o.SetCSSProperty.set(this,"--override-dialog-content-border","10px solid transparent"),o.SetCSSProperty.set(this,"--dialog-padding","3px 5px")}disconnectedCallback(){window.removeEventListener("resize",this.#i),document.body.removeEventListener("keydown",this.#v),this.#b.removeEventListener("wheel",this.#s),this.#S.disconnect(),this.#m.disconnect()}#D(){if(!this.#l){if(this.#l=this.#t.querySelector("dialog"),!this.#l)throw new Error("Dialog not found");this.#m.observe(this.#l)}return this.#l}getHitArea(){return this.#c}async setDialogVisible(t){t?await this.#x():this.#f()}async#P(t){if(t.stopPropagation(),t instanceof PointerEvent&&""===t.pointerType)return;const e=this.#E(t),o=this.#$(t);if(!e)if("pointermove"!==t.type)this.dispatchEvent(new m);else{if(o)return;this.dispatchEvent(new S)}}#E(t){const e=this.#g,o="bottom"===this.bestVerticalPosition?20:-20,i=t.pageX>=e.left&&t.pageX<=e.left+e.width,n=t.pageY>=e.top+o&&t.pageY<=e.top+e.height+o;return i&&n}#$(t){const e=this.#c,o=t.pageX>=e.left&&t.pageX<=e.left+e.width,i=t.pageY>=e.top&&t.pageY<=e.top+e.height;return o&&i}#k(t){if(!t||t===p)throw new Error("Dialog origin is null");const e=t instanceof Function?t():t;return e instanceof DOMPoint?{top:e.y,bottom:e.y,left:e.x,right:e.x}:e instanceof HTMLElement?e.getBoundingClientRect():e}#B(t,e){return e.right-t.left>t.right-e.left?"left":"right"}#A(t,e,o){const{bottom:i}=t;return i+e>o?"top":"bottom"}#R(){this.#a.origin&&(this.#d=!0,d.read((()=>{const e=this.#b.getBoundingClientRect(),i=e.width,n=e.height,s=e.left,r=e.top,a=e.right;if(this.#a.origin===p)return void d.write((()=>{o.SetCSSProperty.set(this,"--dialog-top",`${r}px`),o.SetCSSProperty.set(this,"--dialog-left",`${s}px`),o.SetCSSProperty.set(this,"--dialog-margin","auto"),o.SetCSSProperty.set(this,"--dialog-margin-left","auto"),o.SetCSSProperty.set(this,"--dialog-margin-bottom","auto"),o.SetCSSProperty.set(this,"--dialog-max-height",n-g+"px"),o.SetCSSProperty.set(this,"--dialog-max-width",i-g+"px"),o.SetCSSProperty.set(this,"--dialog-right",document.body.clientWidth-a+"px")}));const l=this.#a.origin,h=this.#k(l),{top:u,right:S,bottom:m,left:w}=h,b=(w+S)/2,v=S-w+c,C=document.body.clientWidth,y=this.#a.getConnectorCustomXPosition?this.#a.getConnectorCustomXPosition():b;d.write((()=>{o.SetCSSProperty.set(this,"--dialog-top","0");const l=this.#D();l.style.visibility="hidden",this.#d&&!l.hasAttribute("open")&&(l.showModal(),this.setAttribute("open",""),this.#d=!1);const{width:d,height:p}=l.getBoundingClientRect();if(this.#u="auto"===this.#a.horizontalAlignment?this.#B(h,e):this.#a.horizontalAlignment,this.#p="auto"===this.#a.position?this.#A(h,p,n):this.#a.position,"auto"===this.#u||"auto"===this.#p)return;this.#c.height=m-u+c*(this.showConnector?2:1),this.#c.width=v;let D=0;o.SetCSSProperty.set(this,"--content-min-width",y-w+20+10+"px"),o.SetCSSProperty.set(this,"--dialog-left","auto"),o.SetCSSProperty.set(this,"--dialog-right","auto"),o.SetCSSProperty.set(this,"--dialog-margin","0");const x=this.showConnector?15:0;switch(this.#u){case"left":{const t=Math.max(w-x,s),e=a-t-g;D=y-t-5,o.SetCSSProperty.set(this,"--dialog-left",`${t}px`),this.#c.x=w,o.SetCSSProperty.set(this,"--dialog-max-width",`${e}px`);break}case"right":{const t=C-S,e=C-a,i=Math.max(t-x,e),n=C-i,r=n-s-g,l=Math.min(r,d);D=y-(n-l),this.#c.x=C-i-v,o.SetCSSProperty.set(this,"--dialog-right",`${i}px`),o.SetCSSProperty.set(this,"--dialog-max-width",`${r}px`);break}case"center":{const t=Math.min(i-g,d);let e=Math.max(b-.5*t,s);e=Math.min(e,a-t),D=y-e-5,o.SetCSSProperty.set(this,"--dialog-left",`${e}px`),this.#c.x=b-.5*v,o.SetCSSProperty.set(this,"--dialog-max-width",i-g+"px");break}default:t.assertNever(this.#u,`Unknown alignment type: ${this.#u}`)}const f=this.showConnector?c:0,P=D-10,E=D+10;let[$,k,B,A,R,I,T,O,N]=["","","","","","","","","",""];switch(this.#p){case"top":{const t="calc(100% - 10px)";this.#a.showConnector&&($="0 0",k="100% 0",B=`100% calc(${t} - 2px)`,A=`calc(100% - 2px) ${t}`,R=`${P}px ${t}`,I=`${D}px 100%`,T=`${E}px ${t}`,O=`2px ${t}`,N=`0 calc(${t} - 2px)`),o.SetCSSProperty.set(this,"--content-padding-bottom",`${c+(this.#a.showConnector?c:0)}px`),o.SetCSSProperty.set(this,"--content-padding-top","10px"),o.SetCSSProperty.set(this,"--dialog-top","0"),o.SetCSSProperty.set(this,"--dialog-margin","auto"),o.SetCSSProperty.set(this,"--dialog-margin-bottom",innerHeight-u+"px"),this.#c.y=u-20,o.SetCSSProperty.set(this,"--dialog-offset-y","20px"),o.SetCSSProperty.set(this,"--dialog-max-height",n-(innerHeight-u)-g-f+"px");break}case"bottom":this.#a.showConnector&&($="0 12px",k="2px 10px",B=`${P}px 10px`,A=`${D}px 0`,R=`${E}px 10px`,I="calc(100% - 2px) 10px",T="100% 12px",O="100% 100%",N="0 100%"),o.SetCSSProperty.set(this,"--content-padding-top",`${c+(this.#a.showConnector?c:0)}px`),o.SetCSSProperty.set(this,"--content-padding-bottom","10px"),o.SetCSSProperty.set(this,"--dialog-top",`${m}px`),this.#c.y=u,o.SetCSSProperty.set(this,"--dialog-offset-y","-20px"),o.SetCSSProperty.set(this,"--dialog-max-height",n-(m-r)-g-f+"px");break;default:t.assertNever(this.#p,`Unknown position type: ${this.#p}`)}const z=[$,k,B,A,R,I,T,O,N].join();o.SetCSSProperty.set(this,"--content-clip-path",z),l.close(),l.style.visibility=""}))})))}async#x(){if(!h)return;if(this.#d||this.hasAttribute("open"))return;this.#d=!0,this.#R(),await d.done(),this.#d=!1;const t=this.#D();t.hasAttribute("open")||t.showModal(),this.#a.dialogShownCallback&&await this.#a.dialogShownCallback(),this.#w()}#r(t){!this.#E(t)&&this.#a.closeOnScroll&&this.#D().hasAttribute("open")&&(this.#f(),this.dispatchEvent(new w))}#C(e){this.#D().hasAttribute("open")&&this.#a.closeOnESC&&e.key===t.KeyboardUtilities.ESCAPE_KEY&&(e.stopPropagation(),e.preventDefault(),this.#f(),this.dispatchEvent(new w))}#I(t){t.stopPropagation(),t.preventDefault(),this.#D().hasAttribute("open")&&this.#a.closeOnESC&&this.dispatchEvent(new w)}#n(){this.#l?.hasAttribute("open")&&this.#b!==document.body&&(this.#f(),this.dispatchEvent(new w))}#f(){!this.#h&&this.#D().hasAttribute("open")&&(this.#h=!0,d.write((()=>{this.#c.width=0,this.removeAttribute("open"),this.#D().close(),this.#h=!1})))}getDialogBounds(){return this.#g}#o(){if(!o.ScheduledRender.isScheduledRender(this))throw new Error("Dialog render was not scheduled");h?n.render(n.html`
      <dialog @click=${this.#P} @pointermove=${this.#P} @cancel=${this.#I}>
        <div id="content-wrap">
          <div id="content">
            <slot></slot>
          </div>
        </div>
      </dialog>
    `,this.#t,{host:this}):n.render(n.html`
        <slot></slot>
      `,this.#t,{host:this})}}o.CustomElements.defineComponent("devtools-dialog",u);class S extends Event{static eventName="pointerleftdialog";constructor(){super(S.eventName,{bubbles:!0,composed:!0})}}class m extends Event{static eventName="clickoutsidedialog";constructor(){super(m.eventName,{bubbles:!0,composed:!0})}}class w extends Event{static eventName="forceddialogclose";constructor(){super(w.eventName,{bubbles:!0,composed:!0})}}var b=Object.freeze({__proto__:null,CONNECTOR_HEIGHT:c,DIALOG_SIDE_PADDING:5,DIALOG_VERTICAL_PADDING:3,DIALOG_PADDING_FROM_WINDOW:g,MODAL:p,Dialog:u,PointerLeftDialogEvent:S,ClickOutsideDialogEvent:m,ForcedDialogClose:w});const v=new CSSStyleSheet;v.replaceSync("#close-button-container{height:0;width:100%}#close-button-container #close-button-right-aligner{position:relative;z-index:1;width:fit-content;left:100%;transform:translateX(-100%);padding-right:12px}#slot-container{margin-top:-14px;padding:0 12px}\n/*# sourceURL=iconDialog.css */\n");const C={close:"Close"},y=s.i18n.registerUIStrings("ui/components/dialogs/IconDialog.ts",C),D=s.i18n.getLocalizedString.bind(void 0,y);class x extends Event{static eventName="showdialog";constructor(){super(x.eventName)}}class f extends HTMLElement{static litTagName=n.literal`devtools-icon-dialog`;#t=this.attachShadow({mode:"open"});#e=this.#o.bind(this);#T=null;#l=null;#O=null;connectedCallback(){this.#t.adoptedStyleSheets=[v]}set data(t){this.#T=t,o.ScheduledRender.scheduleRender(this,this.#e)}#x(){if(!this.#l)throw new Error("Dialog not found");this.#l.setDialogVisible(!0),o.ScheduledRender.scheduleRender(this,this.#e),this.dispatchEvent(new x)}#f(){if(!this.#l)throw new Error("Dialog not found");this.#l.setDialogVisible(!1),o.ScheduledRender.scheduleRender(this,this.#e)}#o(){if(null===this.#T)throw new Error("IconDialog.data is not set");if(!o.ScheduledRender.isScheduledRender(this))throw new Error("IconDialog render was not scheduled");let t=n.nothing;this.#T.closeButton&&(t=n.html`
        <div id='close-button-container'>
          <div id='close-button-right-aligner'>
            <${r.Icon.Icon.litTagName}
              @click=${this.#f}
              .data=${{iconName:"cross",color:"var(--icon-default-hover)",width:"16px",height:"16px"}}
              title=${D(C.close)}
            ></${r.Icon.Icon.litTagName}>
          </div>
        </div>
      `),n.render(n.html`
      <${r.Icon.Icon.litTagName}
        @click=${this.#x}
        on-render=${o.Directives.nodeRenderedCallback((t=>{this.#O=t}))}
        .data=${this.#T.iconData}
      ></${r.Icon.Icon.litTagName}>
      <${u.litTagName}
        @clickoutsidedialog=${this.#f}
        .showConnector=${!0}
        .origin=${()=>{if(!this.#O)throw new Error("Icon not found");return this.#O}}
        .position=${this.#T.position}
        .horizontalAlignment=${this.#T.horizontalAlignment}
        .closeOnESC=${this.#T.closeOnESC}
        .closeOnScroll=${this.#T.closeOnScroll}
        on-render=${o.Directives.nodeRenderedCallback((t=>{this.#l=t}))}
      >
        ${t}
        <div id='slot-container'>
          <slot></slot>
        </div>
      </${u.litTagName}>
    `,this.#t,{host:this})}}o.CustomElements.defineComponent("devtools-icon-dialog",f);var P=Object.freeze({__proto__:null,ShowDialog:x,IconDialog:f});const E=new CSSStyleSheet;E.replaceSync(".keybinds-category-header{white-space:nowrap;padding:0 10px 20px;display:flex}.keybinds-category-header-text{line-height:24px;flex:auto;font-weight:bold}.keybinds-key{padding:0.1em 0.6em;border:1px solid var(--sys-color-neutral-outline);font-size:11px;background-color:var(--sys-color-neutral-container);color:var(--sys-color-on-surface);border-radius:3px;display:inline-block;margin:0 0.1em;text-shadow:0 1px 0 var(--sys-color-cdt-base-container);line-height:1.5;white-space:nowrap}.keybinds-list{list-style:none;margin:0;padding:0}.keybinds-list-item{line-height:30px;display:flex;padding:0 10px}.keybinds-list-text{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;user-select:none;color:var(--sys-color-on-surface);text-align:start;position:relative;margin-right:0}.keybinds-shortcut-separator{white-space:pre-wrap}.keybinds-action-name{flex:auto;padding-right:30px}.keybinds-shortcut{flex:none}.close-icon{width:12px;height:12px;padding-top:2px}\n/*# sourceURL=shortcutDialog.css */\n");const $={showShortcutTitle:"Show shortcuts",dialogTitle:"Keyboard shortcuts",close:"Close"},k=s.i18n.registerUIStrings("ui/components/dialogs/ShortcutDialog.ts",$),B=s.i18n.getLocalizedString.bind(void 0,k);class A extends Event{static eventName="showdialog";constructor(){super(A.eventName)}}class R extends HTMLElement{static litTagName=n.literal`devtools-shortcut-dialog`;#t=this.attachShadow({mode:"open"});#e=this.#o.bind(this);#l=null;#N=null;#z=[];#_=!1;connectedCallback(){this.#t.adoptedStyleSheets=[E]}set data(t){this.#z=t.shortcuts,t.open&&(this.#_=t.open),o.ScheduledRender.scheduleRender(this,this.#e)}#x(){if(!this.#l)throw new Error("Dialog not found");this.#l.setDialogVisible(!0),o.ScheduledRender.scheduleRender(this,this.#e),this.dispatchEvent(new A)}#f(t){if(!this.#l)throw new Error("Dialog not found");this.#l.setDialogVisible(!1),t&&t.stopImmediatePropagation(),o.ScheduledRender.scheduleRender(this,this.#e)}#o(){if(!o.ScheduledRender.isScheduledRender(this))throw new Error("Shortcut dialog render was not scheduled");n.render(n.html`
      <${a.Button.Button.litTagName}
        @click=${this.#x}
        on-render=${o.Directives.nodeRenderedCallback((t=>{this.#N=t}))}
        .data=${{variant:"toolbar",iconName:"help",title:B($.showShortcutTitle)}}
      ></${a.Button.Button.litTagName}>
      <${u.litTagName}
        @clickoutsidedialog=${this.#f}
        .showConnector=${!0}
        .origin=${()=>{if(!this.#N)throw new Error("Button not found");return this.#N}}
        .position=${"bottom"}
        .horizontalAlignment=${"right"}
        on-render=${o.Directives.nodeRenderedCallback((t=>{this.#l=t}))}
      >
        <div class="keybinds-category-header">
          <span class="keybinds-category-header-text">${B($.dialogTitle)}</span>
          <${a.Button.Button.litTagName}
            @click=${this.#f}
            class='close-icon'
            .data=${{variant:"toolbar",iconName:"cross",title:B($.close)}}
          ></${a.Button.Button.litTagName}>
        </div>
        <ul class="keybinds-list">
          ${this.#z.map((t=>n.html`
              <li class="keybinds-list-item">
                <div class="keybinds-action-name keybinds-list-text">${t.title}</div>
                ${t.bindings.map(((e,o)=>n.html`
                    <div class="keybinds-shortcut keybinds-list-text">
                      <span class="keybinds-key">${e}</span>
                    </div>
                    ${t.bindings.at(o+1)?n.html`<span class="keybinds-shortcut-separator"> - </span>`:n.nothing}
                `))}
              </li>`))}
        </ul>
      </${u.litTagName}>
      `,this.#t,{host:this}),this.#_&&(this.#x(),this.#_=!1)}}o.CustomElements.defineComponent("devtools-shortcut-dialog",R);var I=Object.freeze({__proto__:null,ShowDialog:A,ShortcutDialog:R});export{b as Dialog,P as IconDialog,I as ShortcutDialog};
