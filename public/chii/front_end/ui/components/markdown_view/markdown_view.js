import*as e from"../../../core/host/host.js";import*as t from"../../../core/i18n/i18n.js";import*as o from"../helpers/helpers.js";import*as s from"../icon_button/icon_button.js";import*as r from"../../lit-html/lit-html.js";import"../../legacy/legacy.js";import*as n from"../../visual_logging/visual_logging.js";const i=new CSSStyleSheet;i.replaceSync("*{margin:0;padding:0;box-sizing:border-box}code{color:var(--sys-color-on-surface);font-size:12px;user-select:text;cursor:text;background:var(--sys-color-surface1)}.codeblock{margin-bottom:8px;box-sizing:border-box;border-radius:4px;background-color:var(--sys-color-surface5);color:var(--sys-color-on-surface)}.codeblock .toolbar{box-sizing:border-box;display:flex;height:28px;flex-direction:row;padding:0 11px;font-size:11px;font-style:normal;font-weight:400;line-height:16px}.codeblock code{box-sizing:border-box;width:100%;padding:10px;display:block;overflow:auto;white-space:pre}.codeblock .lang{padding:6px 0;flex:1}.codeblock .copy{padding:4px 0;align-items:center;display:flex}.codeblock .copy-button{margin:0;padding:0;background:transparent;border:none;font-size:11px;line-height:16px;display:flex;flex-direction:row;align-items:center;gap:4px}.codeblock .copy-button.copied{color:var(--sys-color-primary);--copy-icon-color:var(--sys-color-primary)}\n/*# sourceURL=codeBlock.css */\n");const a={copy:"Copy code",copied:"Copied to clipboard"},c=t.i18n.registerUIStrings("ui/components/markdown_view/CodeBlock.ts",a),d=t.i18n.getLocalizedString.bind(void 0,c);class l extends HTMLElement{static litTagName=r.literal`devtools-code-block`;#e=this.attachShadow({mode:"open"});#t="";#o="";#s=1e3;#r;#n=!1;connectedCallback(){this.#e.adoptedStyleSheets=[i],this.#i()}set code(e){this.#t=e,this.#i()}get code(){return this.#t}set codeLang(e){this.#o=e,this.#i()}set timeout(e){this.#s=e,this.#i()}#a(){e.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(this.#t),this.#n=!0,this.#i(),clearTimeout(this.#r),this.#r=setTimeout((()=>{this.#n=!1,this.#i()}),this.#s)}#i(){const e=r.Directives.classMap({copied:this.#n,"copy-button":!0});r.render(r.html`<div class="codeblock">
      <div class="toolbar">
        <div class="lang">${this.#o}</div>
        <div class="copy">
          <button class=${e}
            title=${d(a.copy)}
            @click=${this.#a}>
            <${s.Icon.Icon.litTagName}
              .data=${{iconName:"copy",width:"16px",height:"16px",color:"var(--copy-icon-color, var(--icon-default))"}}
            >
            </${s.Icon.Icon.litTagName}>
            <span>${this.#n?d(a.copied):d(a.copy)}</span>
          </button>
        </div>
      </div>
      <code>${this.#t}</code>
    </div>`,this.#e,{host:this})}}o.CustomElements.defineComponent("devtools-code-block",l);var h=Object.freeze({__proto__:null,CodeBlock:l});const p=new CSSStyleSheet;p.replaceSync(".markdown-image{display:block}\n/*# sourceURL=markdownImage.css */\n");const m=new Map([]),g=e=>{const t=m.get(e);if(!t)throw new Error(`Markdown image with key '${e}' is not available, please check MarkdownImagesMap.ts`);return t};var u=Object.freeze({__proto__:null,markdownImages:m,getMarkdownImage:g});class w extends HTMLElement{static litTagName=r.literal`devtools-markdown-image`;#e=this.attachShadow({mode:"open"});#c;#d;connectedCallback(){this.#e.adoptedStyleSheets=[p]}set data(e){const{key:t,title:o}=e,s=g(t);this.#c=s,this.#d=o,this.#i()}#l(){if(!this.#c)return r.html``;const{src:e,color:t,width:o="100%",height:n="100%"}=this.#c;return r.html`
      <${s.Icon.Icon.litTagName} .data=${{iconPath:e,color:t,width:o,height:n}}></${s.Icon.Icon.litTagName}>
    `}#h(){if(!this.#c)return r.html``;const{src:e,width:t="100%",height:o="100%"}=this.#c;return r.html`
      <img class="markdown-image" src=${e} alt=${this.#d} width=${t} height=${o}/>
    `}#i(){if(!this.#c)return;const{isIcon:e}=this.#c,t=e?this.#l():this.#h();r.render(t,this.#e,{host:this})}}o.CustomElements.defineComponent("devtools-markdown-image",w);var k=Object.freeze({__proto__:null,MarkdownImage:w});const b=new CSSStyleSheet;b.replaceSync(".devtools-link{color:var(--sys-color-primary);outline-offset:2px;text-decoration:none}.devtools-link:hover{text-decoration:underline}\n/*# sourceURL=markdownLink.css */\n");const x=new Map([["issuesContrastWCAG21AA","https://www.w3.org/TR/WCAG21/#contrast-minimum"],["issuesContrastWCAG21AAA","https://www.w3.org/TR/WCAG21/#contrast-enhanced"],["issuesContrastSuggestColor","https://developers.google.com/web/updates/2020/08/devtools#accessible-color"],["issuesCSPSetStrict","https://web.dev/strict-csp"],["issuesCSPWhyStrictOverAllowlist","https://web.dev/strict-csp/#why-a-strict-csp-is-recommended-over-allowlist-csps"],["issueCorsPreflightRequest","https://web.dev/cross-origin-resource-sharing/#preflight-requests-for-complex-http-calls"],["issueQuirksModeDoctype","https://web.dev/doctype/"],["sameSiteAndSameOrigin","https://web.dev/same-site-same-origin/"],["punycodeReference","https://wikipedia.org/wiki/Punycode"],["https://xhr.spec.whatwg.org/","https://xhr.spec.whatwg.org/"],["https://goo.gle/chrome-insecure-origins","https://goo.gle/chrome-insecure-origins"],["https://webrtc.org/web-apis/chrome/unified-plan/","https://webrtc.org/web-apis/chrome/unified-plan/"],["https://developer.chrome.com/blog/enabling-shared-array-buffer/","https://developer.chrome.com/blog/enabling-shared-array-buffer/"],["https://developer.chrome.com/docs/extensions/mv3/","https://developer.chrome.com/docs/extensions/mv3/"],["https://developer.chrome.com/blog/immutable-document-domain/","https://developer.chrome.com/blog/immutable-document-domain/"],["https://github.com/WICG/shared-element-transitions/blob/main/debugging_overflow_on_images.md","https://github.com/WICG/shared-element-transitions/blob/main/debugging_overflow_on_images.md"],["https://developer.chrome.com/docs/extensions/reference/privacy/#property-websites-privacySandboxEnabled","https://developer.chrome.com/docs/extensions/reference/privacy/#property-websites-privacySandboxEnabled"],["PNASecureContextRestrictionFeatureStatus","https://chromestatus.com/feature/5954091755241472"],["https://w3c.github.io/uievents/#legacy-event-types","https://w3c.github.io/uievents/#legacy-event-types"],["https://support.google.com/chrome/answer/95647","https://support.google.com/chrome/answer/95647"]]),v=e=>{if(/^https:\/\/www.chromestatus.com\/feature\/\d+$/.test(e))return e;const t=x.get(e);if(!t)throw new Error(`Markdown link with key '${e}' is not available, please check MarkdownLinksMap.ts`);return t};var y=Object.freeze({__proto__:null,markdownLinks:x,getMarkdownLink:v});class f extends HTMLElement{static litTagName=r.literal`devtools-markdown-link`;#e=this.attachShadow({mode:"open"});#p="";#m="";connectedCallback(){this.#e.adoptedStyleSheets=[b]}set data(e){const{key:t,title:o}=e,s=v(t);this.#p=o,this.#m=s,this.#i()}#i(){const e=r.html`
      <x-link class="devtools-link" href=${this.#m} jslog=${n.link().track({click:!0})}>${this.#p}</x-link>
    `;r.render(e,this.#e,{host:this})}}o.CustomElements.defineComponent("devtools-markdown-link",f);var T=Object.freeze({__proto__:null,MarkdownLink:f});const $=new CSSStyleSheet;$.replaceSync('.message{line-height:20px;font-size:14px;color:var(--override-markdown-view-message-color,--sys-color-token-subtle);margin-bottom:4px;user-select:text}.message p{margin-bottom:16px;margin-block-start:2px}.message ul{list-style-type:none;list-style-position:inside;padding-inline-start:0}.message li{margin-top:8px;display:list-item}.message li::before{content:"â†’";-webkit-mask-image:none;padding-right:5px;position:relative;top:-1px}.message code{color:var(--sys-color-on-surface);font-size:12px;user-select:text;cursor:text;background:var(--sys-color-surface1)}.devtools-link{color:var(--sys-color-primary);outline-offset:2px;text-decoration:none}.devtools-link:hover{text-decoration:underline}\n/*# sourceURL=markdownView.css */\n');const C=r.html,S=r.render;class _ extends HTMLElement{static litTagName=r.literal`devtools-markdown-view`;#e=this.attachShadow({mode:"open"});#g=[];#u=new I;connectedCallback(){this.#e.adoptedStyleSheets=[$]}set data(e){this.#g=e.tokens,e.renderer&&(this.#u=e.renderer),this.#w()}#w(){this.#i()}#i(){S(C`
      <div class='message'>
        ${this.#g.map((e=>this.#u.renderToken(e)))}
      </div>
    `,this.#e,{host:this})}}o.CustomElements.defineComponent("devtools-markdown-view",_);class I{renderChildTokens(e){if("tokens"in e&&e.tokens)return e.tokens.map((e=>this.renderToken(e)));throw new Error("Tokens not found")}unescape(e){const t=new Map([["&amp;","&"],["&lt;","<"],["&gt;",">"],["&quot;",'"'],["&#39;","'"]]);return e.replace(/&(amp|lt|gt|quot|#39);/g,(e=>{const o=t.get(e);return o||e}))}renderText(e){return"tokens"in e&&e.tokens?C`${this.renderChildTokens(e)}`:C`${this.unescape("text"in e?e.text:"")}`}renderHeading(e){switch(e.depth){case 1:return C`<h1>${this.renderText(e)}</h1>`;case 2:return C`<h2>${this.renderText(e)}</h2>`;case 3:return C`<h3>${this.renderText(e)}</h3>`;case 4:return C`<h4>${this.renderText(e)}</h4>`;case 5:return C`<h5>${this.renderText(e)}</h5>`;default:return C`<h6>${this.renderText(e)}</h6>`}}renderCodeBlock(e){return C`<${l.litTagName}
      .code=${this.unescape(e.text)}
      .codeLang=${e.lang}>
    </${l.litTagName}>`}templateForToken(e){switch(e.type){case"paragraph":return C`<p>${this.renderChildTokens(e)}`;case"list":return C`<ul>${e.items.map((e=>this.renderToken(e)))}</ul>`;case"list_item":return C`<li>${this.renderChildTokens(e)}`;case"text":return this.renderText(e);case"codespan":return C`<code>${this.unescape(e.text)}</code>`;case"code":return this.renderCodeBlock(e);case"space":return C``;case"link":return C`<${f.litTagName} .data=${{key:e.href,title:e.text}}></${f.litTagName}>`;case"image":return C`<${w.litTagName} .data=${{key:e.href,title:e.text}}></${w.litTagName}>`;case"heading":return this.renderHeading(e);case"strong":return C`<strong>${this.renderText(e)}</strong>`;case"em":return C`<em>${this.renderText(e)}</em>`;default:return null}}renderToken(e){const t=this.templateForToken(e);if(null===t)throw new Error(`Markdown token type '${e.type}' not supported.`);return t}}var M=Object.freeze({__proto__:null,MarkdownView:_,MarkdownLitRenderer:I});export{h as CodeBlock,k as MarkdownImage,u as MarkdownImagesMap,T as MarkdownLink,y as MarkdownLinksMap,M as MarkdownView};
