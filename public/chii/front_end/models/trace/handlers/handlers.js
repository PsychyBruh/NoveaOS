import*as e from"../helpers/helpers.js";import*as t from"../types/types.js";import*as n from"../../../core/platform/platform.js";import*as r from"../../cpu_profile/cpu_profile.js";const a=[],i=[];let s=1;var o=Object.freeze({__proto__:null,reset:function(){a.length=0,i.length=0},handleEvent:function(e){t.TraceEvents.isTraceEventAnimation(e)&&a.push(e)},finalize:async function(){const t=e.Trace.createMatchedSortedSyntheticEvents(a);i.push(...t),s=3},data:function(){if(3!==s)throw new Error("Animation handler is not finalized");return{animations:Array.from(i)}}});const c=new Map,d=new Map,l=new Map,m=new Map,u=new Map;function T(e){switch(e){case"seller":return"seller";case"bidder":return"bidder";default:return"unknown"}}function f(e){return{name:"SyntheticAuctionWorkletEvent",s:"t",cat:e.cat,tid:e.tid,ts:e.ts,ph:"I",pid:e.args.data.pid,host:e.args.data.host,target:e.args.data.target,type:T(e.args.data.type)}}function g(){return{worklets:new Map(l)}}var h=Object.freeze({__proto__:null,reset:function(){c.clear(),d.clear(),l.clear(),m.clear(),u.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventAuctionWorkletRunningInProcess(e))c.set(e.args.data.pid,e);else if(t.TraceEvents.isTraceEventAuctionWorkletDoneWithProcess(e))d.set(e.args.data.pid,e);else if(t.TraceEvents.isThreadName(e)){if("auction_worklet.CrUtilityMain"===e.args.name)return void m.set(e.pid,e);"AuctionV8HelperThread"===e.args.name&&u.set(e.pid,e)}},finalize:async function(){for(const[e,t]of m){const n=u.get(e);if(!n)continue;const r=c.get(e),a=d.get(e);let i=null;r?(i={...f(r),args:{data:{runningInProcessEvent:r,utilityThread:t,v8HelperThread:n}}},a&&(i.args.data.doneWithProcessEvent=a)):a&&(i={...f(a),args:{data:{doneWithProcessEvent:a,utilityThread:t,v8HelperThread:n}}},r&&(i.args.data.runningInProcessEvent=r)),null!==i&&l.set(e,i)}},data:g});const v=new Map;let p="",E="";const w=new Map;let M=t.TraceEvents.ProcessID(-1),I=t.TraceEvents.ThreadID(-1),S=t.TraceEvents.ProcessID(-1),y=t.TraceEvents.ThreadID(-1),F=null;const P=new Map,_=new Set,D={min:t.Timing.MicroSeconds(Number.POSITIVE_INFINITY),max:t.Timing.MicroSeconds(Number.NEGATIVE_INFINITY),range:t.Timing.MicroSeconds(Number.POSITIVE_INFINITY)},k=new Map,C=new Map,L=[],R=new Map;let N=t.Timing.MicroSeconds(-1);const b=new Set(["B","E","X","I"]);let W=1,z=!0;const O=new Set(["TracingStartedInPage","TracingSessionIdForWorker","TracingStartedInBrowser"]);function B(e,r){n.MapUtilities.getWithDefault(w,r.processId,(()=>new Map)).set(r.frame,r);const a=n.MapUtilities.getWithDefault(v,r.frame,(()=>new Map)),i=n.MapUtilities.getWithDefault(a,r.processId,(()=>[])),s=i.at(-1);s&&s.frame.url===r.url||i.push({frame:r,window:{min:e.ts,max:t.Timing.MicroSeconds(0),range:t.Timing.MicroSeconds(0)}})}function A(){if(3!==W)throw new Error("Meta Handler is not finalized");return{traceBounds:{...D},browserProcessId:M,browserThreadId:I,processNames:new Map(P),gpuProcessId:S,gpuThreadId:y===t.TraceEvents.ThreadID(-1)?void 0:y,viewportRect:F||void 0,mainFrameId:p,mainFrameURL:E,navigationsByFrameId:new Map(k),navigationsByNavigationId:new Map(C),threadsInProcess:new Map(R),rendererProcessesByFrame:new Map(v),topLevelRendererIds:new Set(_),frameByProcessId:new Map(w),mainFrameNavigations:[...L],traceIsGeneric:z}}var q=Object.freeze({__proto__:null,reset:function(){k.clear(),C.clear(),P.clear(),L.length=0,M=t.TraceEvents.ProcessID(-1),I=t.TraceEvents.ThreadID(-1),S=t.TraceEvents.ProcessID(-1),y=t.TraceEvents.ThreadID(-1),F=null,_.clear(),R.clear(),v.clear(),w.clear(),D.min=t.Timing.MicroSeconds(Number.POSITIVE_INFINITY),D.max=t.Timing.MicroSeconds(Number.NEGATIVE_INFINITY),D.range=t.Timing.MicroSeconds(Number.POSITIVE_INFINITY),N=t.Timing.MicroSeconds(-1),z=!0,W=1},initialize:function(){if(1!==W)throw new Error("Meta Handler was not reset");W=2},handleEvent:function(e){if(2!==W)throw new Error("Meta Handler is not initialized");if(z&&O.has(e.name)&&(z=!1),t.TraceEvents.isProcessName(e)&&P.set(e.pid,e),0!==e.ts&&!e.name.endsWith("::UMA")&&b.has(e.ph)){D.min=t.Timing.MicroSeconds(Math.min(e.ts,D.min));const n=e.dur||t.Timing.MicroSeconds(0);D.max=t.Timing.MicroSeconds(Math.max(e.ts+n,D.max))}if(!t.TraceEvents.isProcessName(e)||"Browser"!==e.args.name&&"HeadlessBrowser"!==e.args.name)if(!t.TraceEvents.isProcessName(e)||"Gpu"!==e.args.name&&"GPU Process"!==e.args.name)if(t.TraceEvents.isThreadName(e)&&"CrGpuMain"===e.args.name)y=e.tid;else{if(t.TraceEvents.isThreadName(e)&&"CrBrowserMain"===e.args.name&&(I=e.tid),t.TraceEvents.isTraceEventMainFrameViewport(e)&&null===F){const t=e.args.data.viewport_rect,n=t[0],r=t[1],a=t[2],i=t[5];F=new DOMRect(n,r,a,i)}if(t.TraceEvents.isTraceEventTracingStartedInBrowser(e)){if(N=e.ts,!e.args.data)throw new Error("No frames found in trace data");for(const t of e.args.data.frames??[])B(e,t),t.parent||(p=t.frame,E=t.url,_.add(t.processId))}else if(t.TraceEvents.isTraceEventFrameCommittedInBrowser(e)){const t=e.args.data;if(!t)return;if(B(e,t),t.parent)return;_.add(t.processId)}else if(t.TraceEvents.isTraceEventCommitLoad(e)){const t=e.args.data;if(!t)return;const{frame:n,name:r,url:a}=t;B(e,{processId:e.pid,frame:n,name:r,url:a})}else if(t.TraceEvents.isThreadName(e)){n.MapUtilities.getWithDefault(R,e.pid,(()=>new Map)).set(e.tid,e)}else if(t.TraceEvents.isTraceEventNavigationStartWithURL(e)&&e.args.data){const t=e.args.data.navigationId;if(C.has(t))return;C.set(t,e);const n=e.args.frame,r=k.get(n)||[];return r.push(e),k.set(n,r),void(n===p&&L.push(e))}}else S=e.pid;else M=e.pid},finalize:async function(){if(2!==W)throw new Error("Handler is not initialized");N>=0&&(D.min=N),D.range=t.Timing.MicroSeconds(D.max-D.min);for(const[,e]of v){const n=[...e.values()].flat();for(let e=0;e<n.length;e++){const r=n[e],a=n[e+1];a?(r.window.max=t.Timing.MicroSeconds(a.window.min-1),r.window.range=t.Timing.MicroSeconds(r.window.max-r.window.min)):(r.window.max=t.Timing.MicroSeconds(D.max),r.window.range=t.Timing.MicroSeconds(D.max-r.window.min))}}for(const[e,t]of k)if(!v.has(e)){k.delete(e);for(const e of t)e.args.data&&C.delete(e.args.data.navigationId)}const n=L.at(0),r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(.5));if(n){const e=n.ts-D.min<r;n.args.data?.isOutermostMainFrame&&n.args.data?.documentLoaderURL&&e&&(E=n.args.data.documentLoaderURL)}W=3},data:A});let U=1;const H=[],x=[],j=new Map;let G={},Y=null;const V=[],$=[];function K(){return{paints:Array.from(H),snapshots:Array.from(x),paintsToSnapshots:new Map(j)}}var Q=Object.freeze({__proto__:null,reset:function(){U=1,H.length=0,x.length=0,j.clear(),G={},Y=null,V.length=0,$.length=0},initialize:function(){if(1!==U)throw new Error("LayerTree Handler was not reset before being initialized");U=2},handleEvent:function(e){(t.TraceEvents.isTraceEventPaint(e)||t.TraceEvents.isTraceEventDisplayListItemListSnapshot(e)||t.TraceEvents.isTraceEventUpdateLayer(e)||t.TraceEvents.isTraceEventSetLayerId(e))&&$.push(e)},finalize:async function(){if(2!==U)throw new Error("LayerTree Handler is not initialized");const n=A();e.Trace.sortTraceEventsInPlace($);for(const e of $)if(t.TraceEvents.isTraceEventSetLayerId(e)){if(n.mainFrameId!==e.args.data.frame)continue;Y=e.args.data.layerTreeId}else if(t.TraceEvents.isTraceEventUpdateLayer(e))V.push(e);else{if(t.TraceEvents.isTraceEventPaint(e)){if(!e.args.data.layerId)continue;H.push(e),G[e.args.data.layerId]=e;continue}if(t.TraceEvents.isTraceEventDisplayListItemListSnapshot(e)){let t=null;for(let n=V.length-1;n>-1;n--){const r=V[n];if(r.pid===e.pid&&r.tid===e.tid){t=r;break}}if(!t)continue;if(t.args.layerTreeId!==Y)continue;const n=G[t.args.layerId];if(!n)continue;x.push(e),j.set(n,e)}}U=3},data:K,deps:function(){return["Meta"]}});const X=new Map,Z=new Map,J=new Map,ee=new Map;let te=1;function ne(){if(3!==te)throw new Error("Samples Handler is not finalized");return{profilesInProcess:new Map(Z),entryToNode:new Map(J)}}function re(e,t){const r=n.MapUtilities.getWithDefault(ee,e,(()=>new Map));return n.MapUtilities.getWithDefault(r,t,(()=>({rawProfile:{startTime:0,endTime:0,nodes:[],samples:[],timeDeltas:[],lines:[]},profileId:t})))}var ae=Object.freeze({__proto__:null,reset:function(){X.clear(),ee.clear(),Z.clear(),J.clear(),te=1},initialize:function(){if(1!==te)throw new Error("Samples Handler was not reset");te=2},handleEvent:function(e){if(2!==te)throw new Error("Samples Handler is not initialized");if(t.TraceEvents.isSyntheticTraceEventCpuProfile(e)){const t=e.pid,n=e.tid,r=re(t,"0x1");return r.rawProfile=e.args.data.cpuProfile,void(r.threadId=n)}if(t.TraceEvents.isTraceEventProfile(e)){const t=re(e.pid,e.id);return t.rawProfile.startTime=e.ts,void(t.threadId=e.tid)}if(t.TraceEvents.isTraceEventProfileChunk(e)){const t=re(e.pid,e.id).rawProfile,n=e.args?.data?.cpuProfile||{samples:[]},r=n?.samples||[],a=[];for(const e of n?.nodes||[]){const t=void 0===e.callFrame.lineNumber?-1:e.callFrame.lineNumber,n=void 0===e.callFrame.columnNumber?-1:e.callFrame.columnNumber,r=String(e.callFrame.scriptId),i=e.callFrame.url||"",s={...e,callFrame:{...e.callFrame,url:i,lineNumber:t,columnNumber:n,scriptId:r}};a.push(s)}const i=e.args.data?.timeDeltas||[],s=e.args.data?.lines||Array(r.length).fill(0);if(t.nodes.push(...a),t.samples?.push(...r),t.timeDeltas?.push(...i),t.lines?.push(...s),t.samples&&t.timeDeltas&&t.samples.length!==t.timeDeltas.length)return void console.error("Failed to parse CPU profile.");if(!t.endTime&&t.timeDeltas){const e=t.timeDeltas;t.endTime=e.reduce(((e,t)=>e+t),t.startTime)}}else;},finalize:async function(){if(2!==te)throw new Error("Samples Handler is not initialized");!function(){for(const[s,o]of ee)for(const[c,d]of o){const l=d.threadId;if(!d.rawProfile.nodes.length||void 0===l)continue;const m=[],u=new r.CPUProfileDataModel.CPUProfileDataModel(d.rawProfile),T=e.TreeHelpers.makeEmptyTraceEntryTree();T.maxDepth=u.maxDepth;const f={rawProfile:d.rawProfile,parsedProfile:u,profileCalls:[],profileTree:T},g=n.MapUtilities.getWithDefault(Z,s,(()=>new Map));function a(n,r,a){if(void 0===l)return;const i=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(a)),o=r.id,c=e.Trace.makeProfileCall(r,i,s,l);f.profileCalls.push(c),m.push(f.profileCalls.length-1);const d=e.TreeHelpers.makeEmptyTraceEntryNode(c,o);J.set(c,d),d.depth=n,1===m.length&&f.profileTree?.roots.add(d)}function i(n,r,a,i,s){const o=m.pop(),d=void 0!==o&&f.profileCalls[o];if(!d)return;const{callFrame:l,ts:u,pid:T,tid:g}=d,h=J.get(d);if(void 0===l||void 0===u||void 0===T||void 0===c||void 0===g||void 0===h)return;const v=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(i)),p=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(s));d.dur=v,d.selfTime=p;const E=m.at(-1),w=void 0!==E&&f.profileCalls.at(E),M=w&&J.get(w);M&&(h.parent=M,M.children.push(h))}u.forEachFrame(a,i),g.set(l,f)}}(),te=3},data:ne,getProfileCallFunctionName:function(e,t){const n=e.profilesInProcess.get(t.pid)?.get(t.tid),r=n?.parsedProfile.nodeById(t.nodeId);return r?.functionName?r.functionName:t.callFrame.functionName}});const ie=new Map,se=Array(),oe=new Map;let ce=[];const de=[];let le=1,me=t.Configuration.DEFAULT;const ue=()=>({url:null,isOnMainFrame:!1,threads:new Map}),Te=()=>({name:null,entries:[]}),fe=(e,t)=>n.MapUtilities.getWithDefault(e,t,ue),ge=(e,t)=>n.MapUtilities.getWithDefault(e.threads,t,Te);function he(){if(3!==le)throw new Error("Renderer Handler is not finalized");return{processes:new Map(ie),compositorTileWorkers:new Map(ve()),entryToNode:new Map(oe),allTraceEntries:[...ce]}}function ve(){const e=new Map;for(const t of se){const n=e.get(t.pid)||[];n.push(t.tid),e.set(t.pid,n)}return e}function pe(e,t,n,r){Ee(e,n),we(e,t,n),Me(e,n,r)}function Ee(e,t){for(const n of t.values())for(const[t,r]of n)for(const n of r.flat()){const r=fe(e,t);if(null===r.url||"about:blank"===r.url)try{new URL(n.frame.url),r.url=n.frame.url}catch(e){r.url=null}}}function we(e,t,n){for(const[r,a]of n)for(const[n]of a){const a=fe(e,n);r===t&&(a.isOnMainFrame=!0)}}function Me(e,t,n){for(const[t,r]of e)for(const[e,a]of n.get(t)??[]){ge(r,e).name=a?.args.name??`${e}`}}function Ie(e){const t=g().worklets;if(!A().traceIsGeneric)for(const[n,r]of e)if(null!==r.url);else{const a=t.get(n);a?r.url=a.host:e.delete(n)}}function Se(e){for(const[,t]of e)for(const[e,n]of t.threads)n.tree?.roots.size||t.threads.delete(e)}function ye(t,n){for(const[r,a]of t)for(const[t,i]of a.threads){if(!i.entries.length){i.tree=e.TreeHelpers.makeEmptyTraceEntryTree();continue}e.Trace.sortTraceEventsInPlace(i.entries);const a=ne().profilesInProcess.get(r)?.get(t)?.parsedProfile,s=a&&new e.SamplesIntegrator.SamplesIntegrator(a,r,t,me),o=s?.buildProfileCalls(i.entries);o&&(ce=[...ce,...o],i.entries=e.Trace.mergeEventsInOrder(i.entries,o));const c=e.TreeHelpers.treify(i.entries,n);i.tree=c.tree;for(const[e,t]of c.entryToNode)oe.set(e,t)}}function Fe(e){if(t.TraceEvents.isTraceEventEnd(e)){const n=de.pop();return n?n.name!==e.name||n.cat!==e.cat?(console.error("Begin/End events mismatch at "+n.ts+" ("+n.name+") vs. "+e.ts+" ("+e.name+")"),null):(n.dur=t.Timing.MicroSeconds(e.ts-n.ts),null):null}const n={...e,ph:"X",dur:t.Timing.MicroSeconds(0)};return de.push(n),n}var Pe=Object.freeze({__proto__:null,handleUserConfig:function(e){me=e},reset:function(){ie.clear(),oe.clear(),ce.length=0,de.length=0,se.length=0,le=1},initialize:function(){if(1!==le)throw new Error("Renderer Handler was not reset");le=2},handleEvent:function(e){if(2!==le)throw new Error("Renderer Handler is not initialized");if(t.TraceEvents.isThreadName(e)&&e.args.name?.startsWith("CompositorTileWorker")&&se.push({pid:e.pid,tid:e.tid}),t.TraceEvents.isTraceEventBegin(e)||t.TraceEvents.isTraceEventEnd(e)){const t=fe(ie,e.pid),n=ge(t,e.tid),r=Fe(e);if(!r)return;return n.entries.push(r),void ce.push(r)}if(t.TraceEvents.isTraceEventInstant(e)||t.TraceEvents.isTraceEventComplete(e)){const t=fe(ie,e.pid);ge(t,e.tid).entries.push(e),ce.push(e)}},finalize:async function(){if(2!==le)throw new Error("Renderer Handler is not initialized");const{mainFrameId:t,rendererProcessesByFrame:n,threadsInProcess:r}=A();pe(ie,t,n,r),Ie(ie),ye(ie),Se(ie),e.Trace.sortTraceEventsInPlace(ce),le=3},data:he,assignMeta:pe,assignOrigin:Ee,assignIsMainFrame:we,assignThreadName:Me,sanitizeProcesses:Ie,sanitizeThreads:Se,buildHierarchy:ye,makeCompleteEvent:Fe,deps:function(){return["Meta","Samples","AuctionWorklets"]}});function _e(e,t,n){let r="OTHER";return"CrRendererMain"===n.name?r="MAIN_THREAD":"DedicatedWorker thread"===n.name?r="WORKER":n.name?.startsWith("CompositorTileWorker")?r="RASTERIZER":e.worklets.has(t)?r="AUCTION_WORKLET":n.name?.startsWith("ThreadPool")&&(r="THREAD_POOL"),r}function De(e,t){const n=[];if(e.processes.size)for(const[r,a]of e.processes)for(const[i,s]of a.threads){if(!s.tree)continue;const o=_e(t,r,s);n.push({name:s.name,pid:r,tid:i,processIsOnMainFrame:a.isOnMainFrame,entries:s.entries,tree:s.tree,type:o,entryToNode:e.entryToNode})}return n}var ke=Object.freeze({__proto__:null,threadsInRenderer:De,threadsInTrace:function(e){const t=De(e.Renderer,e.AuctionWorklets);if(t.length)return t;const n=[];if(e.Samples.profilesInProcess.size)for(const[t,r]of e.Samples.profilesInProcess)for(const[a,i]of r)i.profileTree&&n.push({pid:t,tid:a,name:null,entries:i.profileCalls,processIsOnMainFrame:!1,tree:i.profileTree,type:"CPU_PROFILE",entryToNode:e.Samples.entryToNode});return n}});let Ce=1;const Le=[];let Re=null;class Ne{#e=[];#t={};#n=new Ae;#r=null;#a=!1;#i=!1;#s=null;#o=null;#c=null;#d=null;#l=null;#m=null;#u=null;#T=null;#f=null;#g;constructor(e,t,n,r,a){const i=De(t,n).filter((e=>"MAIN_THREAD"===e.type&&e.processIsOnMainFrame)).map((e=>({tid:e.tid,pid:e.pid,startTime:e.entries[0].ts})));this.#g=a,this.#h(e,i,r.mainFrameId)}framesById(){return this.#t}frames(){return this.#e}#v(e,t){this.#r||this.#p(e,t),this.#d=e,this.#n.addFrameIfNotExists(t,e,!1,!1)}#E(e,t,n){this.#r||this.#p(e,t),this.#n.addFrameIfNotExists(t,e,!0,n),this.#n.setDropped(t,!0),this.#n.setPartial(t,n)}#w(e,t){if(this.#r){if(this.#a||!this.#i){if(this.#l){(this.#o?this.#o.triggerTime:this.#d||this.#l)>this.#r.startTime&&(this.#r.idle=!0,this.#d=null),this.#l=null}const e=this.#n.processPendingBeginFramesOnDrawFrame(t);for(const n of e){const e=this.#r.idle;this.#p(n.startTime,t),e&&this.#o&&this.#M(),n.isDropped&&(this.#r.dropped=!0),n.isPartial&&(this.#r.isPartial=!0)}}this.#a=!1}else this.#p(e,t)}#I(){this.#r&&this.#o&&!this.#l&&this.#M()}#S(){this.#r&&(this.#i=!0)}#y(){this.#c&&(this.#o=this.#c,this.#c=null,this.#i=!1,this.#a=!0)}#F(e){this.#s=e}#P(e,t){t&&(this.#l=e)}#p(e,n){this.#r&&this.#_(this.#r,e),this.#r=new We(n,e,t.Timing.MicroSeconds(e-A().traceBounds.min))}#_(e,t){e.setLayerTree(this.#s),e.setEndTime(t),this.#s&&(this.#s.paints=e.paints);const n=this.#e[this.#e.length-1];this.#e.length&&n&&(e.startTime!==n.endTime||e.startTime>e.endTime)&&console.assert(!1,`Inconsistent frame time for frame ${this.#e.length} (${e.startTime} - ${e.endTime})`),this.#e.push(e),"number"==typeof e.mainFrameId&&(this.#t[e.mainFrameId]=e)}#M(){this.#o&&this.#r&&(this.#r.paints=this.#o.paints,this.#r.mainFrameId=this.#o.mainFrameId,this.#o=null)}#h(e,t,n){let r=0;this.#f=t.length&&t[0].tid||null,this.#T=t.length&&t[0].pid||null;for(let a=0;a<e.length;++a){for(;r+1<t.length&&t[r+1].startTime<=e[a].ts;)this.#f=t[++r].tid,this.#T=t[r].pid;this.#D(e[a],n)}this.#f=null,this.#T=null}#D(e,n){t.TraceEvents.isTraceEventSetLayerId(e)&&e.args.data.frame===n?this.#u=e.args.data.layerTreeId:t.TraceEvents.isTraceEventLayerTreeHostImplSnapshot(e)&&Number(e.id)===this.#u?this.#F({entry:e,paints:[]}):(function(e){return t.TraceEvents.isTraceEventSetLayerId(e)||t.TraceEvents.isTraceEventBeginFrame(e)||t.TraceEvents.isTraceEventDroppedFrame(e)||t.TraceEvents.isTraceEventRequestMainThreadFrame(e)||t.TraceEvents.isTraceEventBeginMainThreadFrame(e)||t.TraceEvents.isTraceEventNeedsBeginFrameChanged(e)||t.TraceEvents.isTraceEventCommit(e)||t.TraceEvents.isTraceEventCompositeLayers(e)||t.TraceEvents.isTraceEventActivateLayerTree(e)||t.TraceEvents.isTraceEventDrawFrame(e)}(e)&&this.#k(e),e.tid===this.#f&&e.pid===this.#T&&this.#C(e))}#k(e){e.args.layerTreeId===this.#u&&(t.TraceEvents.isTraceEventBeginFrame(e)?this.#v(e.ts,e.args.frameSeqId):t.TraceEvents.isTraceEventDrawFrame(e)?this.#w(e.ts,e.args.frameSeqId):t.TraceEvents.isTraceEventActivateLayerTree(e)?this.#I():t.TraceEvents.isTraceEventRequestMainThreadFrame(e)?this.#S():t.TraceEvents.isTraceEventNeedsBeginFrameChanged(e)?this.#P(e.ts,e.args.data&&Boolean(e.args.data.needsBeginFrame)):t.TraceEvents.isTraceEventDroppedFrame(e)&&this.#E(e.ts,e.args.frameSeqId,Boolean(e.args.hasPartialUpdate)))}#C(e){if(function(e){return"RunTask"===e.name&&e.cat.includes("disabled-by-default-devtools.timeline")}(e)&&(this.#m=e.ts),!this.#c&&be.has(e.name)&&(this.#c=new Oe(this.#m||e.ts)),this.#c){if(t.TraceEvents.isTraceEventBeginMainThreadFrame(e)&&e.args.data.frameId&&(this.#c.mainFrameId=e.args.data.frameId),t.TraceEvents.isTraceEventPaint(e)){const t=this.#g.paintsToSnapshots.get(e);t&&this.#c.paints.push(new ze(e,t))}(t.TraceEvents.isTraceEventCompositeLayers(e)||t.TraceEvents.isTraceEventCommit(e))&&e.args.layerTreeId===this.#u&&this.#y()}}}const be=new Set(["ScheduleStyleRecalculation","InvalidateLayout","BeginMainThreadFrame","ScrollLayer"]);class We{startTime;startTimeOffset;endTime;duration;idle;dropped;isPartial;layerTree;paints;mainFrameId;seqId;constructor(e,n,r){this.seqId=e,this.startTime=n,this.startTimeOffset=r,this.endTime=this.startTime,this.duration=t.Timing.MicroSeconds(0),this.idle=!1,this.dropped=!1,this.isPartial=!1,this.layerTree=null,this.paints=[],this.mainFrameId=void 0}setEndTime(e){this.endTime=e,this.duration=t.Timing.MicroSeconds(this.endTime-this.startTime)}setLayerTree(e){this.layerTree=e}}class ze{#L;#R;constructor(e,t){this.#L=e,this.#R=t}layerId(){return this.#L.args.data.layerId}event(){return this.#L}picture(){const e=this.#R.args.snapshot.params?.layer_rect,t=this.#R.args.snapshot.skp64;return e&&t?{rect:e,serializedPicture:t}:null}}class Oe{paints;mainFrameId;triggerTime;constructor(e){this.paints=[],this.mainFrameId=void 0,this.triggerTime=e}}class Be{seqId;startTime;isDropped;isPartial;constructor(e,t,n,r){this.seqId=e,this.startTime=t,this.isDropped=n,this.isPartial=r}}class Ae{queueFrames=[];mapFrames={};addFrameIfNotExists(e,t,n,r){e in this.mapFrames||(this.mapFrames[e]=new Be(e,t,n,r),this.queueFrames.push(e))}setDropped(e,t){e in this.mapFrames&&(this.mapFrames[e].isDropped=t)}setPartial(e,t){e in this.mapFrames&&(this.mapFrames[e].isPartial=t)}processPendingBeginFramesOnDrawFrame(e){const t=[];if(e in this.mapFrames){for(;this.queueFrames[0]!==e;){const e=this.queueFrames[0];this.mapFrames[e].isDropped&&t.push(this.mapFrames[e]),delete this.mapFrames[e],this.queueFrames.shift()}t.push(this.mapFrames[e]),delete this.mapFrames[e],this.queueFrames.shift()}return t}}var qe=Object.freeze({__proto__:null,reset:function(){Ce=1,Le.length=0},initialize:function(){if(1!==Ce)throw new Error("FramesHandler was not reset before being initialized");Ce=2},handleEvent:function(e){Le.push(e)},finalize:async function(){if(2!==Ce)throw new Error("FramesHandler is not initialized");e.Trace.sortTraceEventsInPlace(Le);const t=new Ne(Le,he(),g(),A(),K());Re=t},data:function(){return{frames:Re?Array.from(Re.frames()):[],framesById:Re?{...Re.framesById()}:{}}},deps:function(){return["Meta","Renderer","AuctionWorklets","LayerTree"]},TimelineFrameModel:Ne,TimelineFrame:We,LayerPaintEvent:ze,PendingFrame:Oe,TimelineFrameBeginFrameQueue:Ae,framesWithinWindow:function(e,t,r){const a=n.ArrayUtilities.lowerBound(e,t||0,((e,t)=>e-t.endTime)),i=n.ArrayUtilities.lowerBound(e,r||1/0,((e,t)=>e-t.startTime));return e.slice(a,i)}});let Ue=1;const He=new Map;let xe=[];var je=Object.freeze({__proto__:null,reset:function(){He.clear(),xe=[],Ue=1},initialize:function(){if(1!==Ue)throw new Error("GPU Handler was not reset before being initialized");Ue=2},handleEvent:function(n){if(2!==Ue)throw new Error("GPU Handler is not initialized");t.TraceEvents.isTraceEventGPUTask(n)&&e.Trace.addEventToProcessThread(n,He)},finalize:async function(){if(2!==Ue)throw new Error("GPU Handler is not initialized");const{gpuProcessId:e,gpuThreadId:t}=A(),n=He.get(e);n&&t&&(xe=n.get(t)||[]),Ue=3},data:function(){if(3!==Ue)throw new Error("GPU Handler is not finalized");return{mainGPUThreadTasks:[...xe]}},deps:function(){return["Meta"]}});let Ge=1;const Ye=new Map,Ve=new Map,$e=new Map,Ke=new Map,Qe=new Map,Xe=new Map,Ze=new Map,Je=new Map,et=new Map;function tt(e){Ke.set(e.event,e.initiator);const t=Qe.get(e.initiator)||[];t.push(e.event),Qe.set(e.initiator,t)}var nt=Object.freeze({__proto__:null,reset:function(){Ye.clear(),Ve.clear(),$e.clear(),Ze.clear(),Ke.clear(),Qe.clear(),Xe.clear(),Je.clear(),et.clear(),Ge=1},initialize:function(){if(1!==Ge)throw new Error("InitiatorsHandler was not reset before being initialized");Ge=2},handleEvent:function(n){if(t.TraceEvents.isTraceEventScheduleStyleRecalculation(n))Ye.set(n.args.data.frame,n);else if(t.TraceEvents.isTraceEventUpdateLayoutTree(n)){if(n.args.beginData){$e.set(n.args.beginData.frame,n);const e=Ye.get(n.args.beginData.frame);e&&tt({event:n,initiator:e})}}else if(t.TraceEvents.isTraceEventInvalidateLayout(n)){let t=n;if(!Ve.has(n.args.data.frame)){const r=$e.get(n.args.data.frame);if(r){const{endTime:a}=e.Timing.eventTimingsMicroSeconds(r),i=Ke.get(r);i&&a&&a>n.ts&&(t=i)}}Ve.set(n.args.data.frame,t)}else if(t.TraceEvents.isTraceEventLayout(n)){const e=Ve.get(n.args.beginData.frame);e&&tt({event:n,initiator:e}),Ve.delete(n.args.beginData.frame)}else if(t.TraceEvents.isTraceEventRequestAnimationFrame(n))Xe.set(n.args.data.id,n);else if(t.TraceEvents.isTraceEventFireAnimationFrame(n)){const e=Xe.get(n.args.data.id);e&&tt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventTimerInstall(n))Ze.set(n.args.data.timerId,n);else if(t.TraceEvents.isTraceEventTimerFire(n)){const e=Ze.get(n.args.data.timerId);e&&tt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventRequestIdleCallback(n))Je.set(n.args.data.id,n);else if(t.TraceEvents.isTraceEventFireIdleCallback(n)){const e=Je.get(n.args.data.id);e&&tt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventWebSocketCreate(n))et.set(n.args.data.identifier,n);else if(t.TraceEvents.isTraceEventWebSocketSendHandshakeRequest(n)){const e=et.get(n.args.data.identifier);e&&tt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventWebSocketSendHandshakeRequest(n)||t.TraceEvents.isTraceEventWebSocketReceiveHandshakeResponse(n)||t.TraceEvents.isTraceEventWebSocketDestroy(n)){const e=et.get(n.args.data.identifier);e&&tt({event:n,initiator:e})}},finalize:async function(){if(2!==Ge)throw new Error("InitiatorsHandler is not initialized");Ge=3},data:function(){return{eventToInitiator:new Map(Ke),initiatorToEvents:new Map(Qe)}}});let rt=1;const at=new Map;let it=null,st=!1;const ot=[];function ct(e,t){const n=at.get(e)||[],r={...t,name:"SyntheticInvalidation",frame:t.args.data.frame,nodeId:t.args.data.nodeId,rawEvent:t};t.args.data.nodeName&&(r.nodeName=t.args.data.nodeName),t.args.data.reason&&(r.reason=t.args.data.reason),t.args.data.stackTrace&&(r.stackTrace=t.args.data.stackTrace),n.push(r),at.set(e,n)}var dt=Object.freeze({__proto__:null,reset:function(){rt=1,at.clear(),it=null,ot.length=0,st=!1},initialize:function(){if(1!==rt)throw new Error("InvalidationsHandler was not reset before being initialized");rt=2},handleEvent:function(e){if(t.TraceEvents.isTraceEventUpdateLayoutTree(e)){it=e;for(const n of ot){if(t.TraceEvents.isTraceEventLayoutInvalidationTracking(n))continue;const r=it.args.beginData?.frame;r&&n.args.data.frame===r&&ct(e,n)}}else if(t.TraceEvents.isTraceEventScheduleStyleInvalidationTracking(e)||t.TraceEvents.isTraceEventStyleRecalcInvalidationTracking(e)||t.TraceEvents.isTraceEventStyleInvalidatorInvalidationTracking(e)||t.TraceEvents.isTraceEventLayoutInvalidationTracking(e)){if(st&&(ot.length=0,it=null,st=!1),it&&(t.TraceEvents.isTraceEventScheduleStyleInvalidationTracking(e)||t.TraceEvents.isTraceEventStyleRecalcInvalidationTracking(e)||t.TraceEvents.isTraceEventStyleInvalidatorInvalidationTracking(e))){const t=it.ts+(it.dur||0);e.ts>=it.ts&&e.ts<=t&&it.args.beginData?.frame===e.args.data.frame&&ct(it,e)}ot.push(e)}else if(t.TraceEvents.isTraceEventPaint(e))st=!0;else if(t.TraceEvents.isTraceEventLayout(e)){const n=e.args.beginData.frame;for(const r of ot)t.TraceEvents.isTraceEventLayoutInvalidationTracking(r)&&r.args.data.frame===n&&ct(e,r)}},finalize:async function(){if(2!==rt)throw new Error("InvalidationsHandler is not initialized");rt=3},data:function(){return{invalidationsForEvent:new Map(at)}}});const lt=new Map;var mt=Object.freeze({__proto__:null,reset:function(){lt.clear()},handleEvent:function(e){t.TraceEvents.isTraceEventLargestImagePaintCandidate(e)&&e.args.data&&lt.set(e.args.data.DOMNodeId,e)},data:function(){return new Map(lt)}});const ut=new Map;var Tt=Object.freeze({__proto__:null,reset:function(){ut.clear()},handleEvent:function(e){t.TraceEvents.isTraceEventLargestTextPaintCandidate(e)&&e.args.data&&ut.set(e.args.data.DOMNodeId,e)},data:function(){return new Map(ut)}});const ft=new Map;let gt=[];function ht(){return[...gt]}var vt=Object.freeze({__proto__:null,reset:function(){ft.clear(),gt.length=0},handleEvent:function(t){"Screenshot"===t.name&&e.Trace.addEventToProcessThread(t,ft)},finalize:async function(){const{browserProcessId:e,browserThreadId:t}=A(),n=ft.get(e);n&&(gt=n.get(t)||[])},data:ht,deps:function(){return["Meta"]}});const pt=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(5e3)),Et=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(1e3)),wt=[],Mt=[],It=[],St=[],yt=new Set,Ft=[];let Pt=0,_t=-1;const Dt=[],kt=[];let Ct=1;function Lt(e){return{min:e,max:e,range:t.Timing.MicroSeconds(0)}}function Rt(e,n){e.max=n,e.range=t.Timing.MicroSeconds(e.max-e.min)}function Nt(e){const t=ht(),n=bt(t,e);if(n)return`data:img/png;base64,${t[n].args.snapshot}`}function bt(e,t){return n.ArrayUtilities.nearestIndexFromBeginning(e,(e=>e.ts>t))}var Wt=Object.freeze({__proto__:null,MAX_CLUSTER_DURATION:pt,MAX_SHIFT_TIME_DELTA:Et,initialize:function(){if(1!==Ct)throw new Error("LayoutShifts Handler was not reset");Ct=2},reset:function(){Ct=1,wt.length=0,Mt.length=0,It.length=0,St.length=0,Ft.length=0,yt.clear(),Dt.length=0,Pt=0,kt.length=0,_t=-1},handleEvent:function(e){if(2!==Ct)throw new Error("Handler is not initialized");!t.TraceEvents.isTraceEventLayoutShift(e)||e.args.data?.had_recent_input?t.TraceEvents.isTraceEventLayoutInvalidationTracking(e)?Mt.push(e):(t.TraceEvents.isTraceEventScheduleStyleInvalidationTracking(e)&&It.push(e),t.TraceEvents.isTraceEventStyleRecalcInvalidationTracking(e)&&St.push(e),t.TraceEvents.isTraceEventPrePaint(e)&&Ft.push(e)):wt.push(e)},findNextScreenshotEventIndex:bt,finalize:async function(){wt.sort(((e,t)=>e.ts-t.ts)),Ft.sort(((e,t)=>e.ts-t.ts)),Mt.sort(((e,t)=>e.ts-t.ts)),await async function(){const{navigationsByFrameId:e,mainFrameId:r,traceBounds:a}=A(),i=e.get(r)||[];if(0===wt.length)return;let s=wt[0].ts,o=wt[0].ts,c=null;for(const e of wt){const r=e.ts-s>pt,a=e.ts-o>Et,d=n.ArrayUtilities.nearestIndexFromEnd(i,(t=>t.ts<e.ts)),l=c!==d&&null!==d;if(r||a||l||!Dt.length){const n=e.ts,c=r?s+pt:1/0,m=a?o+Et:1/0,u=l?i[d].ts:1/0,T=Math.min(c,m,u);if(Dt.length>0){Rt(Dt[Dt.length-1].clusterWindow,t.Timing.MicroSeconds(T))}Dt.push({events:[],clusterWindow:Lt(n),clusterCumulativeScore:0,scoreWindows:{good:Lt(n),needsImprovement:null,bad:null}}),s=n}const m=Dt[Dt.length-1],u=null!==d?t.Timing.MicroSeconds(e.ts-i[d].ts):void 0;if(m.clusterCumulativeScore+=e.args.data?e.args.data.weighted_score_delta:0,!e.args.data)continue;const T={...e,args:{frame:e.args.frame,data:{...e.args.data,rawEvent:e}},parsedData:{screenshotSource:Nt(e.ts),timeFromNavigation:u,cumulativeWeightedScoreInWindow:m.clusterCumulativeScore,sessionWindowData:{cumulativeWindowScore:0,id:Dt.length}}};m.events.push(T),Rt(m.clusterWindow,e.ts),o=e.ts,c=d}for(const e of Dt){let r=0,s=-1;if(e===Dt[Dt.length-1]){const r=pt+e.clusterWindow.min,s=e.clusterWindow.max+Et,o=n.ArrayUtilities.nearestIndexFromBeginning(i,(t=>t.ts>e.clusterWindow.max)),c=o?i[o].ts:1/0,d=Math.min(r,s,a.max,c);Rt(e.clusterWindow,t.Timing.MicroSeconds(d))}for(const n of e.events){r+=n.args.data?n.args.data.weighted_score_delta:0,s=n.parsedData.sessionWindowData.id;const a=n.ts;n.parsedData.sessionWindowData.cumulativeWindowScore=e.clusterCumulativeScore,r<.1?Rt(e.scoreWindows.good,a):r>=.1&&r<.25?(e.scoreWindows.needsImprovement||(Rt(e.scoreWindows.good,t.Timing.MicroSeconds(a-1)),e.scoreWindows.needsImprovement=Lt(a)),Rt(e.scoreWindows.needsImprovement,a)):r>=.25&&(e.scoreWindows.bad||(e.scoreWindows.needsImprovement?Rt(e.scoreWindows.needsImprovement,t.Timing.MicroSeconds(a-1)):Rt(e.scoreWindows.good,t.Timing.MicroSeconds(a-1)),e.scoreWindows.bad=Lt(n.ts)),Rt(e.scoreWindows.bad,a)),e.scoreWindows.bad?Rt(e.scoreWindows.bad,e.clusterWindow.max):e.scoreWindows.needsImprovement?Rt(e.scoreWindows.needsImprovement,e.clusterWindow.max):Rt(e.scoreWindows.good,e.clusterWindow.max)}r>Pt&&(_t=s,Pt=r)}}(),function(){const{traceBounds:e}=A();kt.push({ts:e.min,score:0});for(const e of Dt){let t=0;e.events[0].args.data&&kt.push({ts:e.clusterWindow.min,score:e.events[0].args.data.weighted_score_delta});for(let n=0;n<e.events.length;n++){const r=e.events[n];r.args.data&&(t+=r.args.data.weighted_score_delta,kt.push({ts:r.ts,score:t}))}kt.push({ts:e.clusterWindow.max,score:0})}}(),function(){yt.clear();for(const e of wt)if(e.args.data?.impacted_nodes)for(const t of e.args.data.impacted_nodes)yt.add(t.node_id);for(const e of Mt)e.args.data?.nodeId&&yt.add(e.args.data.nodeId);for(const e of It)e.args.data?.nodeId&&yt.add(e.args.data.nodeId)}(),Ct=3},data:function(){if(3!==Ct)throw new Error("Layout Shifts Handler is not finalized");return{clusters:[...Dt],sessionMaxScore:Pt,clsWindowID:_t,prePaintEvents:[...Ft],layoutInvalidationEvents:[...Mt],scheduleStyleInvalidationEvents:[...It],styleRecalcInvalidationEvents:[],scoreRecords:[...kt],backendNodeIds:[...yt]}},deps:function(){return["Screenshots","Meta"]},stateForLayoutShiftScore:function(e){let t="good";return e>=.1&&(t="ok"),e>=.25&&(t="bad"),t}});const zt=new Map;var Ot=Object.freeze({__proto__:null,reset:function(){zt.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventUpdateCounters(e)){const t=n.MapUtilities.getWithDefault(zt,e.pid,(()=>[]));t.push(e),zt.set(e.pid,t)}},data:function(){return{updateCountersByProcess:new Map(zt)}}});const Bt=1e3,At=1e6,qt=new Map,Ut=new Map,Ht=[];function xt(e,t,n){qt.has(e)||qt.set(e,{});const r=qt.get(e);if(!r)throw new Error(`Unable to locate trace events for request ID ${e}`);if(Array.isArray(r[t])){const e=n;r[t].push(...e)}else r[t]=n}function jt(e){for(const t of e)if(t>0)return t;return 0}let Gt=1;var Yt=Object.freeze({__proto__:null,reset:function(){Ut.clear(),qt.clear(),Ht.length=0,Gt=1},initialize:function(){Gt=2},handleEvent:function(e){if(2!==Gt)throw new Error("Network Request handler is not initialized");t.TraceEvents.isTraceEventResourceChangePriority(e)?xt(e.args.data.requestId,"changePriority",e):t.TraceEvents.isTraceEventResourceWillSendRequest(e)?xt(e.args.data.requestId,"willSendRequests",[e]):t.TraceEvents.isTraceEventResourceSendRequest(e)?xt(e.args.data.requestId,"sendRequests",[e]):t.TraceEvents.isTraceEventResourceReceiveResponse(e)?xt(e.args.data.requestId,"receiveResponse",e):t.TraceEvents.isTraceEventResourceReceivedData(e)?xt(e.args.data.requestId,"receivedData",[e]):t.TraceEvents.isTraceEventResourceFinish(e)?xt(e.args.data.requestId,"resourceFinish",e):t.TraceEvents.isTraceEventResourceMarkAsCached(e)&&xt(e.args.data.requestId,"resourceMarkAsCached",e)},finalize:async function(){if(2!==Gt)throw new Error("Network Request handler is not initialized");const{rendererProcessesByFrame:r}=A();for(const[a,i]of qt.entries()){if(!i.sendRequests||!i.receiveResponse)continue;const s=[];for(let e=0;e<i.sendRequests.length-1;e++){const n=i.sendRequests[e],r=i.sendRequests[e+1];let a=n.ts,o=t.Timing.MicroSeconds(r.ts-n.ts);if(i.willSendRequests&&i.willSendRequests[e]&&i.willSendRequests[e+1]){const n=i.willSendRequests[e],r=i.willSendRequests[e+1];a=n.ts,o=t.Timing.MicroSeconds(r.ts-n.ts)}s.push({url:n.args.data.url,priority:n.args.data.priority,requestMethod:n.args.data.requestMethod,ts:a,dur:o})}const o=0!==i.resourceFinish?.args.data.encodedDataLength,c=i.receiveResponse.args.data.fromCache&&!i.receiveResponse.args.data.fromServiceWorker&&!o,d=void 0!==i.resourceMarkAsCached,l=d||c,m=i.receiveResponse.args.data.timing;if(!m&&!l)continue;const u=i.sendRequests[0],T=i.sendRequests[i.sendRequests.length-1],f=T.args.data.priority;let g=f;i.changePriority&&(g=i.changePriority.args.data.priority);const h=i.willSendRequests&&i.willSendRequests.length?t.Timing.MicroSeconds(i.willSendRequests[0].ts):t.Timing.MicroSeconds(u.ts),v=i.willSendRequests&&i.willSendRequests.length?t.Timing.MicroSeconds(i.willSendRequests[i.willSendRequests.length-1].ts):t.Timing.MicroSeconds(T.ts),p=i.resourceFinish?i.resourceFinish.ts:v,E=i.resourceFinish?.args.data.finishTime?t.Timing.MicroSeconds(i.resourceFinish.args.data.finishTime*At):t.Timing.MicroSeconds(p),w=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((E||v)-v),M=t.Timing.MicroSeconds(p-(E||p)),I=t.Timing.MicroSeconds(v-h),S=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds(n.NumberUtilities.clamp(m.requestTime*At-v,0,Number.MAX_VALUE)),y=l?t.Timing.MicroSeconds(i.receiveResponse.ts-h):t.Timing.MicroSeconds(jt([m.dnsStart*Bt,m.connectStart*Bt,m.sendStart*Bt,i.receiveResponse.ts-v])),F=l?h:t.Timing.MicroSeconds(m.requestTime*At+m.sendStart*Bt),P=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.receiveHeadersEnd-m.sendEnd)*Bt),_=l?h:t.Timing.MicroSeconds(m.requestTime*At+m.receiveHeadersEnd*Bt),D=l?t.Timing.MicroSeconds(p-i.receiveResponse.ts):t.Timing.MicroSeconds((E||_)-_),k=t.Timing.MicroSeconds(w+M),C=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.dnsEnd-m.dnsStart)*Bt),L=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.sslEnd-m.sslStart)*Bt),R=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.proxyEnd-m.proxyStart)*Bt),N=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.sendEnd-m.sendStart)*Bt),b=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((m.connectEnd-m.connectStart)*Bt),{frame:W,url:z,renderBlocking:O}=T.args.data,{encodedDataLength:B,decodedBodyLength:A}=i.resourceFinish?i.resourceFinish.args.data:{encodedDataLength:0,decodedBodyLength:0},{host:q,protocol:U,pathname:H,search:x}=new URL(z),j="https:"===U,G=e.Trace.activeURLForFrameAtTime(W,T.ts,r)||"",Y={args:{data:{syntheticData:{dnsLookup:C,download:D,downloadStart:_,finishTime:E,initialConnection:b,isDiskCached:c,isHttps:j,isMemoryCached:d,isPushedResource:o,networkDuration:w,processingDuration:M,proxyNegotiation:R,queueing:S,redirectionDuration:I,requestSent:N,sendStartTime:F,ssl:L,stalled:y,totalTime:k,waiting:P},decodedBodyLength:A,encodedDataLength:B,frame:W,fromServiceWorker:i.receiveResponse.args.data.fromServiceWorker,host:q,mimeType:i.receiveResponse.args.data.mimeType,pathname:H,priority:g,initialPriority:f,protocol:U,redirects:s,renderBlocking:O||"non_blocking",requestId:a,requestingFrameUrl:G,requestMethod:T.args.data.requestMethod,search:x,statusCode:i.receiveResponse.args.data.statusCode,stackTrace:T.args.data.stackTrace,timing:m,url:z}},cat:"loading",name:"SyntheticNetworkRequest",ph:"X",dur:t.Timing.MicroSeconds(p-h),tdur:t.Timing.MicroSeconds(p-h),ts:t.Timing.MicroSeconds(h),tts:t.Timing.MicroSeconds(h),pid:T.pid,tid:T.tid},V=n.MapUtilities.getWithDefault(Ut,q,(()=>({renderBlocking:[],nonRenderBlocking:[],all:[]})));"non_blocking"===Y.args.data.renderBlocking?V.nonRenderBlocking.push(Y):V.renderBlocking.push(Y),V.all.push(Y),Ht.push(Y)}Gt=3},data:function(){if(3!==Gt)throw new Error("Network Request handler is not finalized");return{byOrigin:new Map(Ut),byTime:[...Ht]}},deps:function(){return["Meta"]}});const Vt=new Map;let $t=[];let Kt=[];const Qt=new Set,Xt=[t.TraceEvents.isTraceEventMarkDOMContent,t.TraceEvents.isTraceEventMarkLoad,t.TraceEvents.isTraceEventFirstPaint,t.TraceEvents.isTraceEventFirstContentfulPaint,t.TraceEvents.isTraceEventLargestContentfulPaintCandidate,t.TraceEvents.isTraceEventNavigationStart];function Zt(e){return Xt.some((t=>t(e)))}const Jt=[...Xt,t.TraceEvents.isTraceEventInteractiveTime];function en(e){return Jt.some((t=>t(e)))}function tn(r,a){const i=r.args.data?.navigationId;if(!i)throw new Error("Navigation event unexpectedly had no navigation ID.");const s=rn(a),{rendererProcessesByFrame:o}=A(),c=o.get(s);if(!c)return;if(c.get(a.pid)&&!t.TraceEvents.isTraceEventNavigationStart(a))if(t.TraceEvents.isTraceEventFirstContentfulPaint(a)){const n=t.Timing.MicroSeconds(a.ts-r.ts);nn(s,i,{event:a,score:e.Timing.formatMicrosecondsTime(n,{format:2,maximumFractionDigits:2}),metricName:"FCP",classification:sn(n),navigation:r})}else if(t.TraceEvents.isTraceEventFirstPaint(a)){const n=t.Timing.MicroSeconds(a.ts-r.ts);nn(s,i,{event:a,score:e.Timing.formatMicrosecondsTime(n,{format:2,maximumFractionDigits:2}),metricName:"FP",classification:"unclassified",navigation:r})}else if(t.TraceEvents.isTraceEventMarkDOMContent(a)){const n=t.Timing.MicroSeconds(a.ts-r.ts);nn(s,i,{event:a,score:e.Timing.formatMicrosecondsTime(n,{format:2,maximumFractionDigits:2}),metricName:"DCL",classification:"unclassified",navigation:r})}else if(t.TraceEvents.isTraceEventInteractiveTime(a)){const n=t.Timing.MicroSeconds(a.ts-r.ts);nn(s,i,{event:a,score:e.Timing.formatMicrosecondsTime(n,{format:2,maximumFractionDigits:2}),metricName:"TTI",classification:on(n),navigation:r});const o=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(a.args.args.total_blocking_time_ms));nn(s,i,{event:a,score:e.Timing.formatMicrosecondsTime(o,{format:1,maximumFractionDigits:2}),metricName:"TBT",classification:ln(o),navigation:r})}else if(t.TraceEvents.isTraceEventMarkLoad(a)){const n=t.Timing.MicroSeconds(a.ts-r.ts);nn(s,i,{event:a,score:e.Timing.formatMicrosecondsTime(n,{format:2,maximumFractionDigits:2}),metricName:"L",classification:"unclassified",navigation:r})}else if(t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(a)){const o=a.args.data?.candidateIndex;if(!o)throw new Error("Largest Contenful Paint unexpectedly had no candidateIndex.");const c=t.Timing.MicroSeconds(a.ts-r.ts),d={event:a,score:e.Timing.formatMicrosecondsTime(c,{format:2,maximumFractionDigits:2}),metricName:"LCP",classification:cn(c),navigation:r},l=n.MapUtilities.getWithDefault(Vt,s,(()=>new Map)),m=n.MapUtilities.getWithDefault(l,i,(()=>new Map)).get("LCP");if(void 0===m)return Qt.add(d.event),void nn(s,i,d);const u=m.event;if(!t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(u))return;const T=u.args.data?.candidateIndex;if(!T)return;T<o&&(Qt.delete(u),Qt.add(d.event),nn(s,i,d))}else if(!t.TraceEvents.isTraceEventLayoutShift(a))return n.assertNever(a,`Unexpected event type: ${a}`)}function nn(e,t,r){const a=n.MapUtilities.getWithDefault(Vt,e,(()=>new Map)),i=n.MapUtilities.getWithDefault(a,t,(()=>new Map));i.delete(r.metricName),i.set(r.metricName,r)}function rn(e){if(t.TraceEvents.isTraceEventFirstContentfulPaint(e)||t.TraceEvents.isTraceEventInteractiveTime(e)||t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(e)||t.TraceEvents.isTraceEventNavigationStart(e)||t.TraceEvents.isTraceEventLayoutShift(e)||t.TraceEvents.isTraceEventFirstPaint(e))return e.args.frame;if(t.TraceEvents.isTraceEventMarkDOMContent(e)||t.TraceEvents.isTraceEventMarkLoad(e)){const t=e.args.data?.frame;if(!t)throw new Error("MarkDOMContent unexpectedly had no frame ID.");return t}n.assertNever(e,`Unexpected event type: ${e}`)}function an(r){if(t.TraceEvents.isTraceEventFirstContentfulPaint(r)||t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(r)||t.TraceEvents.isTraceEventFirstPaint(r)){const e=r.args.data?.navigationId;if(!e)throw new Error("Trace event unexpectedly had no navigation ID.");const{navigationsByNavigationId:t}=A(),n=t.get(e);return n||null}if(t.TraceEvents.isTraceEventMarkDOMContent(r)||t.TraceEvents.isTraceEventInteractiveTime(r)||t.TraceEvents.isTraceEventLayoutShift(r)||t.TraceEvents.isTraceEventMarkLoad(r)){const t=rn(r),{navigationsByFrameId:n}=A();return e.Trace.getNavigationForTraceEvent(r,t,n)}return t.TraceEvents.isTraceEventNavigationStart(r)?null:n.assertNever(r,`Unexpected event type: ${r}`)}function sn(n){const r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(1.8));let a="bad";return n<=e.Timing.secondsToMicroseconds(t.Timing.Seconds(3))&&(a="ok"),n<=r&&(a="good"),a}function on(n){const r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(3.8));let a="bad";return n<=e.Timing.secondsToMicroseconds(t.Timing.Seconds(7.3))&&(a="ok"),n<=r&&(a="good"),a}function cn(n){const r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(2.5));let a="bad";return n<=e.Timing.secondsToMicroseconds(t.Timing.Seconds(4))&&(a="ok"),n<=r&&(a="good"),a}function dn(e){return"unclassified"}function ln(n){const r=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(200));let a="bad";return n<=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(600))&&(a="ok"),n<=r&&(a="good"),a}var mn=Object.freeze({__proto__:null,reset:function(){Vt.clear(),Kt=[],$t=[],Qt.clear()},MarkerName:["MarkDOMContent","MarkLoad","firstPaint","firstContentfulPaint","largestContentfulPaint::Candidate"],isTraceEventMarkerEvent:Zt,eventIsPageLoadEvent:en,handleEvent:function(e){en(e)&&Kt.push(e)},getFrameIdForPageLoadEvent:rn,scoreClassificationForFirstContentfulPaint:sn,scoreClassificationForTimeToInteractive:on,scoreClassificationForLargestContentfulPaint:cn,scoreClassificationForDOMContentLoaded:dn,scoreClassificationForTotalBlockingTime:ln,finalize:async function(){Kt.sort(((e,t)=>e.ts-t.ts));for(const e of Kt){const t=an(e);t&&tn(t,e)}const e=function(){const e=[],t=[...Vt.values()].flatMap((e=>[...e.values()]));for(let n=0;n<t.length;n++){const r=t[n].get("LCP");r&&r.event&&e.push(r.event)}return e}(),n=A().mainFrameId,r=[...e,...Kt.filter((e=>!t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(e)))].filter(Zt);$t=r.filter((e=>rn(e)===n)).sort(((e,t)=>e.ts-t.ts))},data:function(){return{metricScoresByFrameId:new Map(Vt),allMarkerEvents:[...$t]}},deps:function(){return["Meta"]}});const un=[],Tn=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(200));let fn=null;const gn=[],hn=[],vn=new Map,pn=[];let En=1;const wn=new Set(["pointerdown","touchstart","pointerup","touchend","mousedown","mouseup","click"]),Mn=new Set(["keydown","keypress","keyup"]);function In(e){return wn.has(e.type)?"POINTER":Mn.has(e.type)?"KEYBOARD":"OTHER"}function Sn(e){const n={POINTER:new Map,KEYBOARD:new Map,OTHER:new Map};function r(e){const r=In(e),a=n[r],i=t.Timing.MicroSeconds(e.ts+e.dur),s=a.get(i);if(s){if(e.ts<s.ts)a.set(i,e);else if(e.ts===s.ts&&e.interactionId===s.interactionId){const t=s.processingEnd-s.processingStart;e.processingEnd-e.processingStart>t&&a.set(i,e)}e.processingStart<s.processingStart&&(s.processingStart=e.processingStart,yn(s)),e.processingEnd>s.processingEnd&&(s.processingEnd=e.processingEnd,yn(s))}else a.set(i,e)}for(const t of e)r(t);const a=Object.values(n).flatMap((e=>Array.from(e.values())));return a.sort(((e,t)=>e.ts-t.ts)),a}function yn(e){const n=e.args.data.beginEvent,r=e.args.data.endEvent;e.inputDelay=t.Timing.MicroSeconds(e.processingStart-n.ts),e.mainThreadHandling=t.Timing.MicroSeconds(e.processingEnd-e.processingStart),e.presentationDelay=t.Timing.MicroSeconds(r.ts-e.processingEnd)}function Fn(){return{allEvents:[...un],interactionEvents:[...gn],interactionEventsWithNoNesting:[...hn],longestInteractionEvent:fn,interactionsOverThreshold:new Set(gn.filter((e=>e.dur>Tn)))}}var Pn=Object.freeze({__proto__:null,LONG_INTERACTION_THRESHOLD:Tn,reset:function(){un.length=0,gn.length=0,pn.length=0,vn.clear(),hn.length=0,fn=null,En=2},handleEvent:function(e){if(2!==En)throw new Error("Handler is not initialized");if(!t.TraceEvents.isTraceEventEventTiming(e))return;if(t.TraceEvents.isTraceEventEventTimingEnd(e)&&vn.set(e.id,e),un.push(e),!e.args.data||!t.TraceEvents.isTraceEventEventTimingStart(e))return;const{duration:n,interactionId:r}=e.args.data;n<1||void 0===r||0===r||pn.push(e)},categoryOfInteraction:In,removeNestedInteractions:Sn,finalize:async function(){for(const n of pn){const r=vn.get(n.id);if(!r)continue;if(!n.args.data?.type||!n.args.data?.interactionId)continue;const a=t.Timing.MicroSeconds(e.Timing.millisecondsToMicroseconds(n.args.data.processingStart)-e.Timing.millisecondsToMicroseconds(n.args.data.timeStamp)+n.ts),i=t.Timing.MicroSeconds(e.Timing.millisecondsToMicroseconds(n.args.data.processingEnd)-e.Timing.millisecondsToMicroseconds(n.args.data.timeStamp)+n.ts),s={cat:n.cat,name:n.name,pid:n.pid,tid:n.tid,ph:n.ph,processingStart:a,processingEnd:i,inputDelay:t.Timing.MicroSeconds(-1),mainThreadHandling:t.Timing.MicroSeconds(-1),presentationDelay:t.Timing.MicroSeconds(-1),args:{data:{beginEvent:n,endEvent:r}},ts:n.ts,dur:t.Timing.MicroSeconds(r.ts-n.ts),type:n.args.data.type,interactionId:n.args.data.interactionId};yn(s),gn.push(s)}En=3,hn.push(...Sn(gn));for(const e of hn)(!fn||fn.dur<e.dur)&&(fn=e)},data:Fn});const _n=[],Dn=[],kn=[],Cn=[],Ln=[];let Rn=1;const Nn=["workerStart","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd"],bn=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","commitNavigationEnd","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];var Wn=Object.freeze({__proto__:null,reset:function(){_n.length=0,Dn.length=0,kn.length=0,Cn.length=0,Ln.length=0,Rn=2},handleEvent:function(e){if(2!==Rn)throw new Error("UserTimings handler is not initialized");[...Nn,...bn].includes(e.name)||(t.TraceEvents.isTraceEventPerformanceMeasure(e)?Dn.push(e):(t.TraceEvents.isTraceEventPerformanceMark(e)&&kn.push(e),t.TraceEvents.isTraceEventConsoleTime(e)&&Cn.push(e),t.TraceEvents.isTraceEventTimeStamp(e)&&Ln.push(e)))},finalize:async function(){if(2!==Rn)throw new Error("UserTimings handler is not initialized");const t=[...Dn,...Cn];_n.push(...e.Trace.createMatchedSortedSyntheticEvents(t)),Rn=3},data:function(){if(3!==Rn)throw new Error("UserTimings handler is not finalized");return{performanceMeasures:_n.filter(t.TraceEvents.isTraceEventPerformanceMeasure),consoleTimings:_n.filter(t.TraceEvents.isTraceEventConsoleTime),performanceMarks:[...kn],timestampEvents:[...Ln]}}});const zn=new Map,On=new Map,Bn=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(10)),An=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(50));function qn(e,t){const r=n.MapUtilities.getWithDefault(zn,e,(()=>[]));r.push(t),zn.set(e,r);const a=n.MapUtilities.getWithDefault(On,t,(()=>[]));a.push(e),On.set(t,a)}var Un=Object.freeze({__proto__:null,FORCED_LAYOUT_AND_STYLES_THRESHOLD:Bn,LONG_MAIN_THREAD_TASK_THRESHOLD:An,reset:function(){zn.clear(),On.clear()},handleEvent:function(n){if("RunTask"!==n.name)if(t.TraceEvents.isTraceEventFireIdleCallback(n)){const{duration:t}=e.Timing.eventTimingsMilliSeconds(n);t>n.args.data.allottedMilliseconds&&qn(n,"IDLE_CALLBACK_OVER_TIME")}else"Layout"!==n.name?"RecalculateStyles"!==n.name&&"UpdateLayoutTree"!==n.name||n.dur&&n.dur>=Bn&&qn(n,"FORCED_STYLE"):n.dur&&n.dur>=Bn&&qn(n,"FORCED_LAYOUT");else{const{duration:t}=e.Timing.eventTimingsMicroSeconds(n);t>An&&qn(n,"LONG_TASK")}},deps:function(){return["UserInteractions"]},finalize:async function(){const e=Fn().interactionsOverThreshold;for(const t of e)qn(t,"LONG_INTERACTION")},data:function(){return{perEvent:new Map(zn),perWarning:new Map(On)}}});let Hn=1;const xn=[],jn=new Map,Gn=new Map;var Yn=Object.freeze({__proto__:null,initialize:function(){if(1!==Hn)throw new Error("Workers Handler was not reset");Hn=2},reset:function(){xn.length=0,jn.clear(),Gn.clear(),Hn=1},handleEvent:function(e){if(2!==Hn)throw new Error("Workers Handler is not initialized");t.TraceEvents.isTraceEventTracingSessionIdForWorker(e)&&xn.push(e)},finalize:async function(){if(2!==Hn)throw new Error("Handler is not initialized");for(const e of xn)e.args.data&&(jn.set(e.args.data.workerThreadId,e.args.data.workerId),Gn.set(e.args.data.workerId,e.args.data.url));Hn=3},data:function(){if(3!==Hn)throw new Error("Workers Handler is not finalized");return{workerSessionIdEvents:[...xn],workerIdByThread:new Map(jn),workerURLById:new Map(Gn)}}}),Vn=Object.freeze({__proto__:null,Animations:o,AuctionWorklets:h,Frames:qe,GPU:je,Initiators:nt,Invalidations:dt,LargestImagePaint:mt,LargestTextPaint:Tt,LayerTree:Q,LayoutShifts:Wt,Memory:Ot,Meta:q,NetworkRequests:Yt,PageLoadMetrics:mn,Renderer:Pe,Samples:ae,Screenshots:vt,UserInteractions:Pn,UserTimings:Wn,Warnings:Un,Workers:Yn});var $n=Object.freeze({__proto__:null,handlerDataHasAllHandlers:function(e){let t=!1;for(const n of Object.keys(Vn))if(n in e==!1){t=!0;break}return!t}});export{Vn as ModelHandlers,ke as Threads,$n as Types};
