import*as e from"../platform/platform.js";const t=new URLSearchParams(location.search||location.hash.replace(/^#/,""));let s,r="";class n{constructor(){}static instance(e={forceNew:null}){const{forceNew:t}=e;return s&&!t||(s=new n),s}static removeInstance(){s=void 0}static queryParam(e){return t.get(e)}static setQueryParamForTesting(e,s){t.set(e,s)}static experimentsSetting(){try{return JSON.parse(self.localStorage&&self.localStorage.experiments?self.localStorage.experiments:"{}")}catch(e){return console.error("Failed to parse localStorage['experiments']"),{}}}static setPlatform(e){r=e}static platform(){return r}static isDescriptorEnabled(e){const t=e.experiment;if("*"===t)return!0;if(t&&t.startsWith("!")&&l.isEnabled(t.substring(1)))return!1;if(t&&!t.startsWith("!")&&!l.isEnabled(t))return!1;const s=e.condition;return!(s&&!s.startsWith("!")&&!n.queryParam(s))&&!(s&&s.startsWith("!")&&n.queryParam(s.substring(1)))}loadLegacyModule(e){return import(`../../${e}`)}}class i{#e;#t;#s;#r;#n;constructor(){this.#e=[],this.#t=new Set,this.#s=new Set,this.#r=new Set,this.#n=new Set}allConfigurableExperiments(){const e=[];for(const t of this.#e)this.#s.has(t.name)||e.push(t);return e}setExperimentsSetting(e){self.localStorage&&(self.localStorage.experiments=JSON.stringify(e))}register(t,s,r,n,i){this.#t.add(t),this.#e.push(new a(this,t,s,Boolean(r),n??e.DevToolsPath.EmptyUrlString,i??e.DevToolsPath.EmptyUrlString))}isEnabled(e){return this.checkExperiment(e),!1!==n.experimentsSetting()[e]&&(!(!this.#s.has(e)&&!this.#r.has(e))||(!!this.#n.has(e)||Boolean(n.experimentsSetting()[e])))}setEnabled(e,t){this.checkExperiment(e);const s=n.experimentsSetting();s[e]=t,this.setExperimentsSetting(s)}enableExperimentsTransiently(e){for(const t of e)this.checkExperiment(t),this.#s.add(t)}enableExperimentsByDefault(e){for(const t of e)this.checkExperiment(t),this.#r.add(t)}setServerEnabledExperiments(e){for(const t of e)this.checkExperiment(t),this.#n.add(t)}enableForTest(e){this.checkExperiment(e),this.#s.add(e)}disableForTest(e){this.checkExperiment(e),this.#s.delete(e)}clearForTest(){this.#e=[],this.#t.clear(),this.#s.clear(),this.#r.clear(),this.#n.clear()}cleanUpStaleExperiments(){const e=n.experimentsSetting(),t={};for(const{name:s}of this.#e)if(e.hasOwnProperty(s)){const r=e[s];(r||this.#r.has(s))&&(t[s]=r)}this.setExperimentsSetting(t)}checkExperiment(e){}}class a{name;title;unstable;docLink;feedbackLink;#e;constructor(e,t,s,r,n,i){this.name=t,this.title=s,this.unstable=r,this.docLink=n,this.feedbackLink=i,this.#e=e}isEnabled(){return this.#e.isEnabled(this.name)}setEnabled(e){this.#e.setEnabled(this.name,e)}}const l=new i;var o,E;!function(e){e.CAPTURE_NODE_CREATION_STACKS="captureNodeCreationStacks",e.CSS_OVERVIEW="cssOverview",e.LIVE_HEAP_PROFILE="liveHeapProfile",e.ALL="*",e.PROTOCOL_MONITOR="protocolMonitor",e.FULL_ACCESSIBILITY_TREE="fullAccessibilityTree",e.STYLES_PANE_CSS_CHANGES="stylesPaneCSSChanges",e.HEADER_OVERRIDES="headerOverrides",e.INSTRUMENTATION_BREAKPOINTS="instrumentationBreakpoints",e.AUTHORED_DEPLOYED_GROUPING="authoredDeployedGrouping",e.IMPORTANT_DOM_PROPERTIES="importantDOMProperties",e.JUST_MY_CODE="justMyCode",e.PRELOADING_STATUS_PANEL="preloadingStatusPanel",e.TIMELINE_AS_CONSOLE_PROFILE_RESULT_PANEL="timelineAsConsoleProfileResultPanel",e.OUTERMOST_TARGET_SELECTOR="outermostTargetSelector",e.JS_PROFILER_TEMP_ENABLE="jsProfilerTemporarilyEnable",e.HIGHLIGHT_ERRORS_ELEMENTS_PANEL="highlightErrorsElementsPanel",e.SET_ALL_BREAKPOINTS_EAGERLY="setAllBreakpointsEagerly",e.SELF_XSS_WARNING="selfXssWarning",e.USE_SOURCE_MAP_SCOPES="useSourceMapScopes",e.STORAGE_BUCKETS_TREE="storageBucketsTree",e.NETWORK_PANEL_FILTER_BAR_REDESIGN="networkPanelFilterBarRedesign",e.BREADCRUMBS_PERFORMANCE_PANEL="breadcrumbsPerformancePanel",e.TRACK_CONTEXT_MENU="trackContextMenu",e.AUTOFILL_VIEW="autofillView",e.INDENTATION_MARKERS_TEMP_DISABLE="sourcesFrameIndentationMarkersTemporarilyDisable",e.CONSOLE_INSIGHTS="consoleInsights"}(o||(o={})),function(e){e.CAN_DOCK="can_dock",e.NOT_SOURCES_HIDE_ADD_FOLDER="!sources.hide_add_folder"}(E||(E={}));var c=Object.freeze({__proto__:null,getRemoteBase:function(e=self.location.toString()){const t=new URL(e).searchParams.get("remoteBase");if(!t)return null;const s=/\/serve_file\/(@[0-9a-zA-Z]+)\/?$/.exec(t);return s?{base:`devtools://devtools/remote/serve_file/${s[1]}/`,version:s[1]}:null},Runtime:n,ExperimentsSupport:i,Experiment:a,experiments:l,get ExperimentName(){return o},get ConditionName(){return E}});export{c as Runtime};
