import*as e from"../../core/common/common.js";import*as t from"../../core/i18n/i18n.js";import*as a from"../../ui/legacy/legacy.js";import*as s from"../../ui/visual_logging/visual_logging.js";import*as n from"../../core/host/host.js";import*as o from"../../core/root/root.js";import*as r from"../../core/sdk/sdk.js";import*as i from"../../panels/mobile_throttling/mobile_throttling.js";import*as l from"../../ui/components/icon_button/icon_button.js";import*as d from"../../ui/legacy/components/utils/utils.js";import*as c from"../../core/platform/platform.js";import*as g from"../../models/bindings/bindings.js";const h=new CSSStyleSheet;h.replaceSync(':host{padding:12px}[is="dt-checkbox"]{margin:0 0 10px;flex:none}.panel-section-separator{height:1px;margin-bottom:10px;background:var(--sys-color-divider);flex:none}.panel-section-separator:last-child{background:transparent}.chrome-select-label{margin-bottom:16px}\n/*# sourceURL=renderingOptions.css */\n');const u={paintFlashing:"Paint flashing",highlightsAreasOfThePageGreen:"Highlights areas of the page (green) that need to be repainted. May not be suitable for people prone to photosensitive epilepsy.",layoutShiftRegions:"Layout Shift Regions",highlightsAreasOfThePageBlueThat:"Highlights areas of the page (blue) that were shifted. May not be suitable for people prone to photosensitive epilepsy.",layerBorders:"Layer borders",showsLayerBordersOrangeoliveAnd:"Shows layer borders (orange/olive) and tiles (cyan).",frameRenderingStats:"Frame Rendering Stats",plotsFrameThroughputDropped:"Plots frame throughput, dropped frames distribution, and GPU memory.",scrollingPerformanceIssues:"Scrolling performance issues",highlightsElementsTealThatCan:"Highlights elements (teal) that can slow down scrolling, including touch & wheel event handlers and other main-thread scrolling situations.",highlightAdFrames:"Highlight ad frames",highlightsFramesRedDetectedToBe:"Highlights frames (red) detected to be ads.",coreWebVitals:"Core Web Vitals",showsAnOverlayWithCoreWebVitals:"Shows an overlay with Core Web Vitals.",disableLocalFonts:"Disable local fonts",disablesLocalSourcesInFontface:"Disables `local()` sources in `@font-face` rules. Requires a page reload to apply.",emulateAFocusedPage:"Emulate a focused page",emulatesAFocusedPage:"Emulates a focused page.",emulateAutoDarkMode:"Enable automatic dark mode",emulatesAutoDarkMode:"Enables automatic dark mode and sets `prefers-color-scheme` to `dark`.",forcesMediaTypeForTestingPrint:"Forces media type for testing print and screen styles",forcesCssPreferscolorschemeMedia:"Forces CSS `prefers-color-scheme` media feature",forcesCssPrefersreducedmotion:"Forces CSS `prefers-reduced-motion` media feature",forcesCssPreferscontrastMedia:"Forces CSS `prefers-contrast` media feature",forcesCssPrefersreduceddataMedia:"Forces CSS `prefers-reduced-data` media feature",forcesCssPrefersreducedtransparencyMedia:"Forces CSS `prefers-reduced-transparency` media feature",forcesCssColorgamutMediaFeature:"Forces CSS `color-gamut` media feature",forcesVisionDeficiencyEmulation:"Forces vision deficiency emulation",disableAvifImageFormat:"Disable `AVIF` image format",requiresAPageReloadToApplyAnd:"Requires a page reload to apply and disables caching for image requests.",disableWebpImageFormat:"Disable `WebP` image format",forcesCssForcedColors:"Forces CSS forced-colors media feature"},p=t.i18n.registerUIStrings("entrypoints/inspector_main/RenderingOptions.ts",u),m=t.i18n.getLocalizedString.bind(void 0,p);class S extends a.Widget.VBox{constructor(){super(!0),this.element.setAttribute("jslog",`${s.panel().context("rendering")}`),this.#e(m(u.paintFlashing),m(u.highlightsAreasOfThePageGreen),e.Settings.Settings.instance().moduleSetting("showPaintRects")),this.#e(m(u.layoutShiftRegions),m(u.highlightsAreasOfThePageBlueThat),e.Settings.Settings.instance().moduleSetting("showLayoutShiftRegions")),this.#e(m(u.layerBorders),m(u.showsLayerBordersOrangeoliveAnd),e.Settings.Settings.instance().moduleSetting("showDebugBorders")),this.#e(m(u.frameRenderingStats),m(u.plotsFrameThroughputDropped),e.Settings.Settings.instance().moduleSetting("showFPSCounter")),this.#e(m(u.scrollingPerformanceIssues),m(u.highlightsElementsTealThatCan),e.Settings.Settings.instance().moduleSetting("showScrollBottleneckRects")),this.#e(m(u.highlightAdFrames),m(u.highlightsFramesRedDetectedToBe),e.Settings.Settings.instance().moduleSetting("showAdHighlights")),this.#e(m(u.coreWebVitals),m(u.showsAnOverlayWithCoreWebVitals),e.Settings.Settings.instance().moduleSetting("showWebVitals")),this.#e(m(u.disableLocalFonts),m(u.disablesLocalSourcesInFontface),e.Settings.Settings.instance().moduleSetting("localFontsDisabled")),this.#e(m(u.emulateAFocusedPage),m(u.emulatesAFocusedPage),e.Settings.Settings.instance().moduleSetting("emulatePageFocus")),this.#e(m(u.emulateAutoDarkMode),m(u.emulatesAutoDarkMode),e.Settings.Settings.instance().moduleSetting("emulateAutoDarkMode")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.#t(m(u.forcesCssPreferscolorschemeMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersColorScheme")),this.#t(m(u.forcesMediaTypeForTestingPrint),e.Settings.Settings.instance().moduleSetting("emulatedCSSMedia")),this.#t(m(u.forcesCssForcedColors),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeatureForcedColors")),window.matchMedia("not all and (prefers-contrast), (prefers-contrast)").matches&&this.#t(m(u.forcesCssPreferscontrastMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersContrast")),this.#t(m(u.forcesCssPrefersreducedmotion),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedMotion")),window.matchMedia("not all and (prefers-reduced-data), (prefers-reduced-data)").matches&&this.#t(m(u.forcesCssPrefersreduceddataMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedData")),window.matchMedia("not all and (prefers-reduced-transparency), (prefers-reduced-transparency)").matches&&this.#t(m(u.forcesCssPrefersreducedtransparencyMedia),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedTransparency")),this.#t(m(u.forcesCssColorgamutMediaFeature),e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeatureColorGamut")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.#t(m(u.forcesVisionDeficiencyEmulation),e.Settings.Settings.instance().moduleSetting("emulatedVisionDeficiency")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this.#e(m(u.disableAvifImageFormat),m(u.requiresAPageReloadToApplyAnd),e.Settings.Settings.instance().moduleSetting("avifFormatDisabled")),this.#e(m(u.disableWebpImageFormat),m(u.requiresAPageReloadToApplyAnd),e.Settings.Settings.instance().moduleSetting("webpFormatDisabled")),this.contentElement.createChild("div").classList.add("panel-section-separator")}#e(e,t,s){const n=a.UIUtils.CheckboxLabel.create(e,!1,t,s.name);return a.SettingsUI.bindCheckbox(n.checkboxElement,s),this.contentElement.appendChild(n),n}#t(e,t){const s=a.SettingsUI.createControlForSetting(t,e);s&&this.contentElement.appendChild(s)}wasShown(){super.wasShown(),this.registerCSSFiles([h])}}var f=Object.freeze({__proto__:null,RenderingOptionsView:S,ReloadActionDelegate:class{handleAction(t,a){const s=e.Settings.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersColorScheme");if("rendering.toggle-prefers-color-scheme"===a){const e=["","light","dark"],t=e.findIndex((e=>e===s.get()||""));return s.set(e[(t+1)%3]),!0}return!1}}});const b=new CSSStyleSheet;b.replaceSync(".node-icon{width:28px;height:26px;background-image:var(--image-file-nodeIcon);background-size:17px 17px;background-repeat:no-repeat;background-position:center;opacity:80%;cursor:auto}.node-icon:hover{opacity:100%}.node-icon.inactive{filter:grayscale(100%)}\n/*# sourceURL=nodeIcon.css */\n");const T={main:"Main",tab:"Tab",javascriptIsDisabled:"JavaScript is disabled",openDedicatedTools:"Open dedicated DevTools for `Node.js`"},C=t.i18n.registerUIStrings("entrypoints/inspector_main/InspectorMain.ts",T),y=t.i18n.getLocalizedString.bind(void 0,C);let F,I;class w{static instance(e={forceNew:null}){const{forceNew:t}=e;return F&&!t||(F=new w),F}async run(){let e=!0;await r.Connections.initMainConnection((async()=>{const t=o.Runtime.Runtime.queryParam("v8only")?r.Target.Type.Node:"tab"===o.Runtime.Runtime.queryParam("targetType")?r.Target.Type.Tab:r.Target.Type.Frame,a=t===r.Target.Type.Frame&&"sources"===o.Runtime.Runtime.queryParam("panel"),s=t===r.Target.Type.Frame?y(T.main):y(T.tab),n=r.TargetManager.TargetManager.instance().createTarget("main",s,t,null,void 0,a),i=r.TargetManager.TargetManager.instance();if(i.observeTargets({targetAdded:e=>{e===i.primaryPageTarget()&&e.setName(y(T.main))},targetRemoved:e=>{}}),e){if(e=!1,a){const e=n.model(r.DebuggerModel.DebuggerModel);e&&(e.isReadyToPause()||await e.once(r.DebuggerModel.Events.DebuggerIsReadyToPause),e.pause())}t!==r.Target.Type.Tab&&n.runtimeAgent().invoke_runIfWaitingForDebugger()}}),d.TargetDetachedDialog.TargetDetachedDialog.webSocketConnectionLost),new M,new P,new i.NetworkPanelIndicator.NetworkPanelIndicator,n.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(n.InspectorFrontendHostAPI.Events.ReloadInspectedPage,(({data:e})=>{r.ResourceTreeModel.ResourceTreeModel.reloadAllPages(e)}))}}e.Runnable.registerEarlyInitializationRunnable(w.instance);class v{#a;#s;constructor(){const e=document.createElement("div"),t=a.Utils.createShadowRootWithCoreStyles(e,{cssFile:[b],delegatesFocus:void 0});this.#a=t.createChild("div","node-icon"),e.addEventListener("click",(()=>n.InspectorFrontendHost.InspectorFrontendHostInstance.openNodeFrontend()),!1),this.#s=new a.Toolbar.ToolbarItem(e),this.#s.setTitle(y(T.openDedicatedTools)),r.TargetManager.TargetManager.instance().addEventListener(r.TargetManager.Events.AvailableTargetsChanged,(e=>this.#n(e.data))),this.#s.setVisible(!1),this.#n([])}static instance(e={forceNew:null}){const{forceNew:t}=e;return I&&!t||(I=new v),I}#n(e){const t=Boolean(e.find((e=>"node"===e.type&&!e.attached)));this.#a.classList.toggle("inactive",!t),t&&this.#s.setVisible(!0)}item(){return this.#s}}class M{constructor(){function t(){let t=null;e.Settings.Settings.instance().moduleSetting("javaScriptDisabled").get()&&(t=new l.Icon.Icon,t.data={iconName:"warning-filled",color:"var(--icon-warning)",width:"14px",height:"14px"},a.Tooltip.Tooltip.install(t,y(T.javascriptIsDisabled))),a.InspectorView.InspectorView.instance().setPanelIcon("sources",t)}e.Settings.Settings.instance().moduleSetting("javaScriptDisabled").addChangeListener(t),t()}}class P{#o;#r;#i;constructor(){this.#o=e.Settings.Settings.instance().moduleSetting("autoAttachToCreatedPages"),this.#o.addChangeListener(this.#l,this),this.#l(),this.#r=e.Settings.Settings.instance().moduleSetting("network.adBlockingEnabled"),this.#r.addChangeListener(this.#n,this),this.#i=e.Settings.Settings.instance().moduleSetting("emulatePageFocus"),this.#i.addChangeListener(this.#n,this),r.TargetManager.TargetManager.instance().observeTargets(this)}#d(e){e.type()===r.Target.Type.Frame&&e.parentTarget()?.type()!==r.Target.Type.Frame&&(e.pageAgent().invoke_setAdBlockingEnabled({enabled:this.#r.get()}),e.emulationAgent().invoke_setFocusEmulationEnabled({enabled:this.#i.get()}))}#l(){n.InspectorFrontendHost.InspectorFrontendHostInstance.setOpenNewWindowForPopups(this.#o.get())}#n(){for(const e of r.TargetManager.TargetManager.instance().targets())this.#d(e)}targetAdded(e){this.#d(e)}targetRemoved(e){}}r.ChildTargetManager.ChildTargetManager.install();var A=Object.freeze({__proto__:null,InspectorMainImpl:w,ReloadActionDelegate:class{handleAction(e,t){switch(t){case"inspector_main.reload":return r.ResourceTreeModel.ResourceTreeModel.reloadAllPages(!1),!0;case"inspector_main.hard-reload":return r.ResourceTreeModel.ResourceTreeModel.reloadAllPages(!0),!0}return!1}},FocusDebuggeeActionDelegate:class{handleAction(e,t){const a=r.TargetManager.TargetManager.instance().primaryPageTarget();return!!a&&(a.pageAgent().invoke_bringToFront(),!0)}},NodeIndicator:v,SourcesPanelIndicator:M,BackendSettingsSync:P});const x=new CSSStyleSheet;x.replaceSync(":host{padding:2px 1px 2px 2px;white-space:nowrap;display:flex;flex-direction:column;height:36px;justify-content:center;overflow-y:auto}.title{overflow:hidden;padding-left:8px;text-overflow:ellipsis;flex-grow:0}.subtitle{color:var(--sys-color-token-subtle);margin-right:3px;overflow:hidden;padding-left:8px;text-overflow:ellipsis;flex-grow:0}:host(.highlighted) .subtitle{color:inherit}\n/*# sourceURL=outermostTargetSelector.css */\n");const R={targetNotSelected:"Page: Not selected",targetS:"Page: {PH1}"},k=t.i18n.registerUIStrings("entrypoints/inspector_main/OutermostTargetSelector.ts",R),D=t.i18n.getLocalizedString.bind(void 0,k);let L;class E{listItems;#c;#g;constructor(){this.listItems=new a.ListModel.ListModel,this.#c=new a.SoftDropDown.SoftDropDown(this.listItems,this),this.#c.setRowHeight(36),this.#g=new a.Toolbar.ToolbarItem(this.#c.element),this.#g.setTitle(D(R.targetNotSelected)),this.listItems.addEventListener(a.ListModel.Events.ItemsReplaced,(()=>this.#g.setEnabled(Boolean(this.listItems.length)))),this.#g.element.classList.add("toolbar-has-dropdown");const e=r.TargetManager.TargetManager.instance();e.addModelListener(r.ChildTargetManager.ChildTargetManager,r.ChildTargetManager.Events.TargetInfoChanged,this.#h,this),e.addEventListener(r.TargetManager.Events.NameChanged,this.#u,this),e.observeTargets(this),a.Context.Context.instance().addFlavorChangeListener(r.Target.Target,this.#p,this)}static instance(e={forceNew:null}){const{forceNew:t}=e;return L&&!t||(L=new E),L}item(){return this.#g}highlightedItemChanged(e,t,a,s){a&&a.classList.remove("highlighted"),s&&s.classList.add("highlighted")}titleFor(e){return e.name()}targetAdded(e){e.outermostTarget()===e&&(this.listItems.insertWithComparator(e,this.#m()),this.#g.setVisible(this.listItems.length>1),e===a.Context.Context.instance().flavor(r.Target.Target)&&this.#c.selectItem(e))}targetRemoved(e){const t=this.listItems.indexOf(e);-1!==t&&(this.listItems.remove(t),this.#g.setVisible(this.listItems.length>1))}#m(){return(e,t)=>{const a=e.targetInfo(),s=t.targetInfo();return a&&s?!a.subtype?.length&&s.subtype?.length?-1:a.subtype?.length&&!s.subtype?.length?1:a.url.localeCompare(s.url):0}}#h(e){const t=r.TargetManager.TargetManager.instance().targetById(e.data.targetId);t&&t.outermostTarget()===t&&(this.targetRemoved(t),this.targetAdded(t))}#u(e){const t=e.data;t&&t.outermostTarget()===t&&(this.targetRemoved(t),this.targetAdded(t))}#p({data:e}){this.#c.selectItem(e?.outermostTarget()||null)}createElementForItem(e){const t=document.createElement("div");t.classList.add("target");const s=a.Utils.createShadowRootWithCoreStyles(t,{cssFile:[x],delegatesFocus:void 0}),n=s.createChild("div","title");a.UIUtils.createTextChild(n,c.StringUtilities.trimEndWithMaxLength(this.titleFor(e),100));const o=s.createChild("div","subtitle");return a.UIUtils.createTextChild(o,this.#S(e)),t}#S(e){const t=e.targetInfo();return e===r.TargetManager.TargetManager.instance().primaryPageTarget()&&t?g.ResourceUtils.displayNameForURL(t.url):e.targetInfo()?.subtype||""}isItemSelectable(e){return!0}itemSelected(e){const t=e?D(R.targetS,{PH1:this.titleFor(e)}):D(R.targetNotSelected);this.#g.setTitle(t),e&&e!==a.Context.Context.instance().flavor(r.Target.Target)?.outermostTarget()&&a.Context.Context.instance().setFlavor(r.Target.Target,e)}}var _=Object.freeze({__proto__:null,OutermostTargetSelector:E});export{A as InspectorMain,_ as OutermostTargetSelector,f as RenderingOptions};
