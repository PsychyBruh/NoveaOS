import*as e from"../../core/i18n/i18n.js";import*as t from"../../ui/legacy/theme_support/theme_support.js";import*as i from"../../models/trace/trace.js";import*as n from"../../core/sdk/sdk.js";import*as r from"../../core/common/common.js";import*as a from"./components/components.js";import*as s from"../../ui/legacy/components/perf_ui/perf_ui.js";import*as o from"../../core/platform/platform.js";import*as l from"../../core/root/root.js";import*as c from"../../models/bindings/bindings.js";import*as d from"../../models/timeline_model/timeline_model.js";import*as h from"../../ui/legacy/legacy.js";import*as m from"../../services/trace_bounds/trace_bounds.js";import*as p from"../../ui/legacy/components/utils/utils.js";import*as u from"../../ui/legacy/components/data_grid/data_grid.js";import*as g from"../../models/source_map_scopes/source_map_scopes.js";import*as T from"../../core/host/host.js";import*as v from"../../models/workspace/workspace.js";import*as f from"../../ui/components/panel_feedback/panel_feedback.js";import*as y from"../mobile_throttling/mobile_throttling.js";import*as w from"../../models/text_utils/text_utils.js";import*as S from"../layer_viewer/layer_viewer.js";const b={sSelfS:"{PH1} (self {PH2})"},C=e.i18n.registerUIStrings("panels/timeline/AppenderUtils.ts",b),P=e.i18n.getLocalizedString.bind(void 0,C);function k(e){const i={padding:4,height:17,collapsible:!0,color:t.ThemeSupport.instance().getComputedValue("--sys-color-on-surface"),backgroundColor:t.ThemeSupport.instance().getComputedValue("--sys-color-cdt-base-container"),nestingLevel:0,shareHeaderLine:!0};return Object.assign(i,e)}function E(e,t,i,n,r,a,s){const o={startLevel:e,name:t,style:i,selectable:n,expanded:r,showStackContextMenu:s};return n&&a&&(o.track=a),o}function M(t,n){const r=i.Helpers.Timing.microSecondsToMilliseconds(t||0);if(r===i.Types.Timing.MilliSeconds(0))return"";const a=i.Helpers.Timing.microSecondsToMilliseconds(n||0),s=1e-6;return Math.abs(r-a)>s&&a>s?P(b.sSelfS,{PH1:e.TimeUtilities.millisToString(r,!0),PH2:e.TimeUtilities.millisToString(a,!0)}):e.TimeUtilities.millisToString(r,!0)}function F(e,t){let i=0;const n=e.ts,r=e.ts+(e.dur||0);for(;i<t.length&&n<t[i];)++i;return t[i]=r,i}function L(e,t,i){const n=e.entryDecorations[t]||[];n.push(i),e.entryDecorations[t]=n}var R=Object.freeze({__proto__:null,buildGroupStyle:k,buildTrackHeader:E,getFormattedTime:M,getEventLevel:F,addDecorationToEvent:L});const I={animations:"Animations"},x=e.i18n.registerUIStrings("panels/timeline/AnimationsTrackAppender.ts",I),D=e.i18n.getLocalizedString.bind(void 0,x);class A{appenderName="Animations";#e;#t;constructor(e,t){this.#e=e,this.#t=t}appendTrackAtLevel(e,t){const i=this.#t.Animations.animations;return 0===i.length?e:(this.#i(e,t),this.#e.appendEventsAtLevel(i,e,this))}#i(e,t){const i=k({useFirstLineForOverview:!1}),n=E(e,D(I.animations),i,!0,t);this.#e.registerTrackForGroup(n,this)}colorForEvent(){return t.ThemeSupport.instance().getComputedValue("--app-color-rendering")}titleForEvent(e){return e.name}highlightedEntryInfo(e){return{title:this.titleForEvent(e),formattedTime:M(e.dur)}}}var N=Object.freeze({__proto__:null,AnimationsTrackAppender:A});class B extends Event{duration;static eventName="traceload";constructor(e){super(B.eventName,{bubbles:!0,composed:!0}),this.duration=e}}var H=Object.freeze({__proto__:null,TraceLoadEvent:B});class U{x;y;width;height;color;outlineColor;constructor([e,t,i,n]){this.x=e,this.y=t,this.width=i,this.height=n,this.color={r:238,g:111,b:99,a:.4},this.outlineColor={r:238,g:111,b:99,a:.7}}}let W;class V{static instance(e={forceNew:null}){const{forceNew:t}=e;return W&&!t||(W=new V),W}linkify(e,t){const i=document.createElement("span"),r=e,{x:a,y:s,width:o,height:l}=r;return i.textContent=`Location: [${a},${s}], Size: [${o}x${l}]`,i.addEventListener("mouseover",(()=>n.OverlayModel.OverlayModel.highlightRect(r))),i.addEventListener("mouseleave",(()=>n.OverlayModel.OverlayModel.clearHighlight())),i}}var O=Object.freeze({__proto__:null,CLSRect:U,Linkifier:V});const z={loading:"Loading",experience:"Experience",scripting:"Scripting",rendering:"Rendering",painting:"Painting",gpu:"GPU",async:"Async",system:"System",idle:"Idle",task:"Task",other:"Other",animation:"Animation",event:"Event",requestMainThreadFrame:"Request Main Thread Frame",frameStart:"Frame Start",frameStartMainThread:"Frame Start (main thread)",drawFrame:"Draw Frame",profilingOverhead:"Profiling Overhead",hitTest:"Hit Test",scheduleStyleRecalculation:"Schedule Style Recalculation",recalculateStyle:"Recalculate Style",invalidateLayout:"Invalidate Layout",layerize:"Layerize",layout:"Layout",paintSetup:"Paint Setup",paintImage:"Paint Image",prePaint:"Pre-Paint",updateLayer:"Update Layer",updateLayerTree:"Update Layer Tree",paint:"Paint",rasterizePaint:"Rasterize Paint",scroll:"Scroll",commit:"Commit",compositeLayers:"Composite Layers",computeIntersections:"Compute Intersections",parseHtml:"Parse HTML",parseStylesheet:"Parse Stylesheet",installTimer:"Install Timer",removeTimer:"Remove Timer",timerFired:"Timer Fired",xhrReadyStateChange:"`XHR` Ready State Change",xhrLoad:"`XHR` Load",compileScript:"Compile Script",cacheScript:"Cache Script Code",compileCode:"Compile Code",optimizeCode:"Optimize Code",evaluateScript:"Evaluate Script",compileModule:"Compile Module",cacheModule:"Cache Module Code",evaluateModule:"Evaluate Module",streamingCompileTask:"Streaming Compile Task",waitingForNetwork:"Waiting for Network",parseAndCompile:"Parse and Compile",deserializeCodeCache:"Deserialize Code Cache",streamingWasmResponse:"Streaming Wasm Response",compiledWasmModule:"Compiled Wasm Module",cachedWasmModule:"Cached Wasm Module",wasmModuleCacheHit:"Wasm Module Cache Hit",wasmModuleCacheInvalid:"Wasm Module Cache Invalid",frameStartedLoading:"Frame Started Loading",onloadEvent:"Onload Event",domcontentloadedEvent:"DOMContentLoaded Event",firstPaint:"First Paint",firstContentfulPaint:"First Contentful Paint",largestContentfulPaint:"Largest Contentful Paint",timestamp:"Timestamp",consoleTime:"Console Time",userTiming:"User Timing",willSendRequest:"Will Send Request",sendRequest:"Send Request",receiveResponse:"Receive Response",finishLoading:"Finish Loading",receiveData:"Receive Data",runMicrotasks:"Run Microtasks",functionCall:"Function Call",gcEvent:"GC Event",majorGc:"Major GC",minorGc:"Minor GC",requestAnimationFrame:"Request Animation Frame",cancelAnimationFrame:"Cancel Animation Frame",animationFrameFired:"Animation Frame Fired",requestIdleCallback:"Request Idle Callback",cancelIdleCallback:"Cancel Idle Callback",fireIdleCallback:"Fire Idle Callback",createWebsocket:"Create WebSocket",sendWebsocketHandshake:"Send WebSocket Handshake",receiveWebsocketHandshake:"Receive WebSocket Handshake",destroyWebsocket:"Destroy WebSocket",embedderCallback:"Embedder Callback",imageDecode:"Image Decode",imageResize:"Image Resize",domGc:"DOM GC",encrypt:"Encrypt",encryptReply:"Encrypt Reply",decrypt:"Decrypt",decryptReply:"Decrypt Reply",digest:"Digest",digestReply:"Digest Reply",sign:"Sign",signReply:"Sign Reply",verify:"Verify",verifyReply:"Verify Reply",asyncTask:"Async Task",layoutShift:"Layout Shift",eventTiming:"Event Timing",jsFrame:"JS Frame"},G=e.i18n.registerUIStrings("panels/timeline/EventUICategory.ts",z),_=e.i18n.getLocalizedString.bind(void 0,G);class j{title;category;hidden;constructor(e,t,i=!1){this.title=e,this.category=t,this.hidden=i}}class q{name;title;visible;childColor;colorInternal;hiddenInternal;constructor(e,t,i,n,r){this.name=e,this.title=t,this.visible=i,this.childColor=n,this.colorInternal=r,this.hidden=!1}get hidden(){return Boolean(this.hiddenInternal)}get color(){return this.getComputedColorValue()}getCSSValue(){return`var(${this.colorInternal})`}getComputedColorValue(){return t.ThemeSupport.instance().getComputedValue(this.colorInternal)}set hidden(e){this.hiddenInternal=e}}let J,$;function X(e){return function(){if($)return $;const e=K();return $=new Map([["RunTask",new j(_(z.task),e.Other)],["ProfileCall",new j(_(z.jsFrame),e.Scripting)],["Program",new j(_(z.other),e.Other)],["CpuProfiler::StartProfiling",new j(_(z.profilingOverhead),e.Other)],["Animation",new j(_(z.animation),e.Rendering)],["EventDispatch",new j(_(z.event),e.Scripting)],["RequestMainThreadFrame",new j(_(z.requestMainThreadFrame),e.Rendering,!0)],["BeginFrame",new j(_(z.frameStart),e.Rendering,!0)],["BeginMainThreadFrame",new j(_(z.frameStartMainThread),e.Rendering,!0)],["DrawFrame",new j(_(z.drawFrame),e.Rendering,!0)],["HitTest",new j(_(z.hitTest),e.Rendering)],["ScheduleStyleRecalculation",new j(_(z.scheduleStyleRecalculation),e.Rendering)],["RecalculateStyles",new j(_(z.recalculateStyle),e.Rendering)],["UpdateLayoutTree",new j(_(z.recalculateStyle),e.Rendering)],["InvalidateLayout",new j(_(z.invalidateLayout),e.Rendering,!0)],["Layerize",new j(_(z.layerize),e.Rendering)],["Layout",new j(_(z.layout),e.Rendering)],["PaintSetup",new j(_(z.paintSetup),e.Painting)],["PaintImage",new j(_(z.paintImage),e.Painting,!0)],["UpdateLayer",new j(_(z.updateLayer),e.Painting,!0)],["UpdateLayerTree",new j(_(z.updateLayerTree),e.Rendering)],["Paint",new j(_(z.paint),e.Painting)],["PrePaint",new j(_(z.prePaint),e.Rendering)],["RasterTask",new j(_(z.rasterizePaint),e.Painting)],["ScrollLayer",new j(_(z.scroll),e.Rendering)],["Commit",new j(_(z.commit),e.Painting)],["CompositeLayers",new j(_(z.compositeLayers),e.Painting)],["ComputeIntersections",new j(_(z.computeIntersections),e.Rendering)],["ParseHTML",new j(_(z.parseHtml),e.Loading)],["ParseAuthorStyleSheet",new j(_(z.parseStylesheet),e.Loading)],["TimerInstall",new j(_(z.installTimer),e.Scripting)],["TimerRemove",new j(_(z.removeTimer),e.Scripting)],["TimerFire",new j(_(z.timerFired),e.Scripting)],["XHRReadyStateChange",new j(_(z.xhrReadyStateChange),e.Scripting)],["XHRLoad",new j(_(z.xhrLoad),e.Scripting)],["v8.compile",new j(_(z.compileScript),e.Scripting)],["v8.produceCache",new j(_(z.cacheScript),e.Scripting)],["V8.CompileCode",new j(_(z.compileCode),e.Scripting)],["V8.OptimizeCode",new j(_(z.optimizeCode),e.Scripting)],["EvaluateScript",new j(_(z.evaluateScript),e.Scripting)],["V8.CompileModule",new j(_(z.compileModule),e.Scripting)],["v8.produceModuleCache",new j(_(z.cacheModule),e.Scripting)],["v8.evaluateModule",new j(_(z.evaluateModule),e.Scripting)],["v8.parseOnBackground",new j(_(z.streamingCompileTask),e.Other)],["v8.parseOnBackgroundWaiting",new j(_(z.waitingForNetwork),e.Idle)],["v8.parseOnBackgroundParsing",new j(_(z.parseAndCompile),e.Scripting)],["v8.deserializeOnBackground",new j(_(z.deserializeCodeCache),e.Scripting)],["V8.FinalizeDeserialization",new j(_(z.profilingOverhead),e.Other)],["v8.wasm.streamFromResponseCallback",new j(_(z.streamingWasmResponse),e.Scripting)],["v8.wasm.compiledModule",new j(_(z.compiledWasmModule),e.Scripting)],["v8.wasm.cachedModule",new j(_(z.cachedWasmModule),e.Scripting)],["v8.wasm.moduleCacheHit",new j(_(z.wasmModuleCacheHit),e.Scripting)],["v8.wasm.moduleCacheInvalid",new j(_(z.wasmModuleCacheInvalid),e.Scripting)],["FrameStartedLoading",new j(_(z.frameStartedLoading),e.Loading,!0)],["MarkLoad",new j(_(z.onloadEvent),e.Scripting,!0)],["MarkDOMContent",new j(_(z.domcontentloadedEvent),e.Scripting,!0)],["firstPaint",new j(_(z.firstPaint),e.Painting,!0)],["firstContentfulPaint",new j(_(z.firstContentfulPaint),e.Rendering,!0)],["largestContentfulPaint::Candidate",new j(_(z.largestContentfulPaint),e.Rendering,!0)],["TimeStamp",new j(_(z.timestamp),e.Scripting)],["ConsoleTime",new j(_(z.consoleTime),e.Scripting)],["UserTiming",new j(_(z.userTiming),e.Scripting)],["ResourceWillSendRequest",new j(_(z.willSendRequest),e.Loading)],["ResourceSendRequest",new j(_(z.sendRequest),e.Loading)],["ResourceReceiveResponse",new j(_(z.receiveResponse),e.Loading)],["ResourceFinish",new j(_(z.finishLoading),e.Loading)],["ResourceReceivedData",new j(_(z.receiveData),e.Loading)],["RunMicrotasks",new j(_(z.runMicrotasks),e.Scripting)],["FunctionCall",new j(_(z.functionCall),e.Scripting)],["GCEvent",new j(_(z.gcEvent),e.Scripting)],["MajorGC",new j(_(z.majorGc),e.Scripting)],["MinorGC",new j(_(z.minorGc),e.Scripting)],["RequestAnimationFrame",new j(_(z.requestAnimationFrame),e.Scripting)],["CancelAnimationFrame",new j(_(z.cancelAnimationFrame),e.Scripting)],["FireAnimationFrame",new j(_(z.animationFrameFired),e.Scripting)],["RequestIdleCallback",new j(_(z.requestIdleCallback),e.Scripting)],["CancelIdleCallback",new j(_(z.cancelIdleCallback),e.Scripting)],["FireIdleCallback",new j(_(z.fireIdleCallback),e.Scripting)],["WebSocketCreate",new j(_(z.createWebsocket),e.Scripting)],["WebSocketSendHandshakeRequest",new j(_(z.sendWebsocketHandshake),e.Scripting)],["WebSocketReceiveHandshakeResponse",new j(_(z.receiveWebsocketHandshake),e.Scripting)],["WebSocketDestroy",new j(_(z.destroyWebsocket),e.Scripting)],["EmbedderCallback",new j(_(z.embedderCallback),e.Scripting)],["Decode Image",new j(_(z.imageDecode),e.Painting)],["Resize Image",new j(_(z.imageResize),e.Painting)],["GPUTask",new j(_(z.gpu),e.GPU)],["BlinkGC.AtomicPhase",new j(_(z.domGc),e.Scripting)],["DoEncrypt",new j(_(z.encrypt),e.Scripting)],["DoEncryptReply",new j(_(z.encryptReply),e.Scripting)],["DoDecrypt",new j(_(z.decrypt),e.Scripting)],["DoDecryptReply",new j(_(z.decryptReply),e.Scripting)],["DoDigest",new j(_(z.digest),e.Scripting)],["DoDigestReply",new j(_(z.digestReply),e.Scripting)],["DoSign",new j(_(z.sign),e.Scripting)],["DoSignReply",new j(_(z.signReply),e.Scripting)],["DoVerify",new j(_(z.verify),e.Scripting)],["DoVerifyReply",new j(_(z.verifyReply),e.Scripting)],["AsyncTask",new j(_(z.asyncTask),e.Async)],["LayoutShift",new j(_(z.layoutShift),e.Experience)],["EventTiming",new j(_(z.eventTiming),e.Experience)]]),$}().get(e)}function K(){return J||(J={Loading:new q("loading",_(z.loading),!0,"--app-color-loading-children","--app-color-loading"),Experience:new q("experience",_(z.experience),!1,"--app-color-rendering-children","--app-color-rendering"),Scripting:new q("scripting",_(z.scripting),!0,"--app-color-scripting-children","--app-color-scripting"),Rendering:new q("rendering",_(z.rendering),!0,"--app-color-rendering-children","--app-color-rendering"),Painting:new q("painting",_(z.painting),!0,"--app-color-painting-children","--app-color-painting"),GPU:new q("gpu",_(z.gpu),!1,"--app-color-painting-children","--app-color-painting"),Async:new q("async",_(z.async),!1,"--app-color-async-children","--app-color-async"),Other:new q("other",_(z.system),!1,"--app-color-system-children","--app-color-system"),Idle:new q("idle",_(z.idle),!1,"--app-color-idle-children","--app-color-idle")},J)}var Y=Object.freeze({__proto__:null,EventCategories:["Loading","Experience","Scripting","Rendering","Painting","GPU","Async","Other","Idle"],TimelineRecordStyle:j,TimelineCategory:q,getEventStyle:X,getCategoryStyles:K});const Z={gpu:"GPU"},Q=e.i18n.registerUIStrings("panels/timeline/GPUTrackAppender.ts",Z),ee=e.i18n.getLocalizedString.bind(void 0,Q);class te{appenderName="GPU";#e;#t;constructor(e,t){this.#e=e,this.#t=t}appendTrackAtLevel(e,t){const i=this.#t.GPU.mainGPUThreadTasks;return 0===i.length?e:(this.#i(e,t),this.#e.appendEventsAtLevel(i,e,this))}#i(e,t){const i=k({shareHeaderLine:!1}),n=E(e,ee(Z.gpu),i,!0,t);this.#e.registerTrackForGroup(n,this)}colorForEvent(e){if(!i.Types.TraceEvents.isTraceEventGPUTask(e))throw new Error(`Unexpected GPU Task: The event's type is '${e.name}'`);return t.ThemeSupport.instance().getComputedValue("--app-color-painting")}titleForEvent(e){return i.Types.TraceEvents.isTraceEventGPUTask(e)?"GPU":e.name}highlightedEntryInfo(e){return{title:this.titleForEvent(e),formattedTime:M(e.dur)}}}var ie=Object.freeze({__proto__:null,GPUTrackAppender:te});const ne={interactions:"Interactions"},re=e.i18n.registerUIStrings("panels/timeline/InteractionsTrackAppender.ts",ne),ae=e.i18n.getLocalizedString.bind(void 0,re);class se{appenderName="Interactions";#n;#e;#t;constructor(e,t,i){this.#e=e,this.#n=i,this.#t=t}appendTrackAtLevel(e,t){return 0===this.#t.UserInteractions.interactionEvents.length?e:(this.#i(e,t),this.#r(e))}#i(e,t){const i=k({shareHeaderLine:!1,collapsible:this.#t.UserInteractions.interactionEvents.length>0}),n=E(e,ae(ne.interactions),i,!0,t);this.#e.registerTrackForGroup(n,this)}#r(e){const{interactionEventsWithNoNesting:t,interactionsOverThreshold:i}=this.#t.UserInteractions;return this.#e.appendEventsAtLevel(t,e,this,((e,t)=>{i.has(e)&&void 0!==t&&this.#a(e,t)}))}#a(e,t){const n=this.#e.getFlameChartTimelineData().entryDecorations[t]||[];n.push({type:"CANDY",startAtTime:i.Handlers.ModelHandlers.UserInteractions.LONG_INTERACTION_THRESHOLD,endAtTime:e.processingEnd},{type:"WARNING_TRIANGLE",customEndTime:e.processingEnd}),this.#e.getFlameChartTimelineData().entryDecorations[t]=n}colorForEvent(e){let t=this.titleForEvent(e);return i.Types.TraceEvents.isSyntheticInteractionEvent(e)&&(t+=e.interactionId),this.#n.colorForID(t)}titleForEvent(e){return i.Types.TraceEvents.isSyntheticInteractionEvent(e)?oe(e):e.name}highlightedEntryInfo(e){return{title:this.titleForEvent(e),formattedTime:M(e.dur)}}}function oe(e){const t=i.Handlers.ModelHandlers.UserInteractions.categoryOfInteraction(e);return"OTHER"===t?"Other":"KEYBOARD"===t?"Keyboard":"POINTER"===t?"Pointer":e.type}var le=Object.freeze({__proto__:null,InteractionsTrackAppender:se,titleForInteractionEvent:oe});const ce={layoutShifts:"Layout Shifts"},de=e.i18n.registerUIStrings("panels/timeline/LayoutShiftsTrackAppender.ts",ce),he=e.i18n.getLocalizedString.bind(void 0,de);class me{appenderName="LayoutShifts";#e;#t;constructor(e,t){this.#e=e,this.#t=t}appendTrackAtLevel(e,t){return 0===this.#t.LayoutShifts.clusters.length?e:(this.#i(e,t),this.#s(e))}#i(e,t){const i=k({collapsible:!1}),n=E(e,he(ce.layoutShifts),i,!0,t);this.#e.registerTrackForGroup(n,this)}#s(e){const t=this.#t.LayoutShifts.clusters.flatMap((e=>e.events)),n=i.Types.Timing.MicroSeconds(5e3);return this.#e.appendEventsAtLevel(t,e,this,((e,t)=>{this.#e.getFlameChartTimelineData().entryTotalTimes[t]=i.Helpers.Timing.microSecondsToMilliseconds(n)}))}colorForEvent(e){return t.ThemeSupport.instance().getComputedValue("--app-color-rendering")}titleForEvent(e){return i.Types.TraceEvents.isTraceEventLayoutShift(e)?"Layout shift":e.name}highlightedEntryInfo(e){return{title:this.titleForEvent(e),formattedTime:M(e.dur)}}}var pe=Object.freeze({__proto__:null,LayoutShiftsTrackAppender:me});const ue={onIgnoreList:"On ignore list",mainS:"Main — {PH1}",main:"Main",frameS:"Frame — {PH1}",workerS:"`Worker` — {PH1}",workerSS:"`Worker`: {PH1} — {PH2}",dedicatedWorker:"Dedicated `Worker`",anonymous:"(anonymous)",threadS:"Thread {PH1}",raster:"Raster",threadPool:"Thread Pool",rasterizerThreadS:"Rasterizer Thread {PH1}",threadPoolThreadS:"Thread Pool Worker {PH1}",bidderWorkletS:"Bidder Worklet — {PH1}",bidderWorklet:"Bidder Worklet",sellerWorklet:"Seller Worklet",unknownWorklet:"Auction Worklet",workletService:"Auction Worklet Service",sellerWorkletS:"Seller Worklet — {PH1}",unknownWorkletS:"Auction Worklet — {PH1}",workletServiceS:"Auction Worklet Service — {PH1}",eventDispatchS:"Event: {PH1}"},ge=e.i18n.registerUIStrings("panels/timeline/ThreadAppender.ts",ue),Te=e.i18n.getLocalizedString.bind(void 0,ge);class ve{appenderName="Thread";#n;#e;#t;#o=[];#l;#c;#d;#h;#m=!1;#p=!1;threadType="MAIN_THREAD";isOnMainFrame;#u=l.Runtime.experiments.isEnabled("ignoreListJSFramesOnTimeline");#g=l.Runtime.experiments.isEnabled("timelineShowAllEvents");#T;#v="";#f=null;constructor(e,t,n,a,s,o){this.#e=e,this.#n=new r.Color.Generator({min:30,max:330,count:void 0},{min:50,max:80,count:3},85),this.#n.setColorForID("","#f2ecdc"),this.#t=t,this.#c=n,this.#d=a;const l="CPU_PROFILE"===o?this.#t.Samples?.profilesInProcess.get(n)?.get(a)?.profileCalls:this.#t.Renderer?.processes.get(n)?.threads?.get(a)?.entries,c="CPU_PROFILE"===o?this.#t.Samples?.profilesInProcess.get(n)?.get(a)?.profileTree:this.#t.Renderer?.processes.get(n)?.threads?.get(a)?.tree;if(!l||!c)throw new Error(`Could not find data for thread with id ${a} in process with id ${n}`);this.#o=l,this.#l=c,this.#h=s||Te(ue.threadS,{PH1:a}),this.isOnMainFrame=Boolean(this.#t.Renderer?.processes.get(n)?.isOnMainFrame),this.threadType=o,this.#t.AuctionWorklets.worklets.has(n)&&(this.appenderName="Thread_AuctionWorklet"),this.#T=new i.EntriesFilter.EntriesFilter("CPU_PROFILE"===this.threadType?t.Samples.entryToNode:t.Renderer.entryToNode),this.#v=this.#t.Renderer?.processes.get(this.#c)?.url||""}modifyTree(e,t,i){this.#T&&(this.#T.applyAction({type:t,entry:e}),i.dispatchEventToListeners(s.FlameChart.Events.EntriesModified))}processId(){return this.#c}threadId(){return this.#d}appendTrackAtLevel(e,t=!1){return 0===this.#o.length?e:(this.#m=t,this.#y(e))}setHeaderNestingLevel(e){this.#f=e}#w(e){this.#p||("RASTERIZER"===this.threadType||"THREAD_POOL"===this.threadType?this.#S(e,this.threadType):this.#i(e),this.#p=!0)}setHeaderAppended(e){this.#p=e}headerAppended(){return this.#p}#i(e){const t=k({shareHeaderLine:!1,collapsible:this.#o.length>0});null!==this.#f&&(t.nestingLevel=this.#f);const i=E(e,this.trackName(),t,!0,this.#m,null,!0);this.#e.registerTrackForGroup(i,this)}#S(e,t){const i=this.#e.getCurrentTrackCountForThreadType(t);if(0===i){const t=k({shareHeaderLine:!1,collapsible:this.#o.length>0}),i=E(e,this.trackName(),t,!1,this.#m);this.#e.getFlameChartTimelineData().groups.push(i)}const n=k({padding:2,nestingLevel:1,collapsible:!1}),r=E(e,"RASTERIZER"===this.threadType?Te(ue.rasterizerThreadS,{PH1:i+1}):Te(ue.threadPoolThreadS,{PH1:i+1}),n,!0,this.#m);this.#e.registerTrackForGroup(r,this)}trackName(){let e=null;switch(this.threadType){case"MAIN_THREAD":e=this.isOnMainFrame?Te(ue.mainS,{PH1:this.#v}):Te(ue.frameS,{PH1:this.#v});break;case"CPU_PROFILE":e=Te(ue.main);break;case"WORKER":e=this.#b();break;case"RASTERIZER":e=Te(ue.raster);break;case"THREAD_POOL":e=Te(ue.threadPool);break;case"OTHER":break;case"AUCTION_WORKLET":e=this.#C();break;default:return o.assertNever(this.threadType,`Unknown thread type: ${this.threadType}`)}let t="";return this.#t.Meta.traceIsGeneric&&(t+=` (${this.threadId()})`),(e||this.#h)+t}getUrl(){return this.#v}#C(){const e=this.#t.AuctionWorklets.worklets.get(this.#c);if(!e)return Te(ue.unknownWorklet);const t=e.host?`https://${e.host}`:"",i=t.length>0,n=e.args.data.utilityThread.tid===this.#d,r=e.args.data.v8HelperThread.tid===this.#d;if(n)return i?Te(ue.workletServiceS,{PH1:t}):Te(ue.workletService);if(r)switch(e.type){case"seller":return i?Te(ue.sellerWorkletS,{PH1:t}):Te(ue.sellerWorklet);case"bidder":return i?Te(ue.bidderWorkletS,{PH1:t}):Te(ue.bidderWorklet);case"unknown":return i?Te(ue.unknownWorkletS,{PH1:t}):Te(ue.unknownWorklet);default:o.assertNever(e.type,`Unexpected Auction Worklet Type ${e.type}`)}return i?Te(ue.unknownWorkletS,{PH1:t}):Te(ue.unknownWorklet)}#b(){const e=this.#t.Renderer?.processes.get(this.#c)?.url||"",t=this.#t.Workers.workerIdByThread.get(this.#d),i=t?this.#t.Workers.workerURLById.get(t):e;let r=i?Te(ue.workerS,{PH1:i}):Te(ue.dedicatedWorker);const a=void 0!==t&&n.TargetManager.TargetManager.instance().targetById(t);return a&&(r=Te(ue.workerSS,{PH1:a.name(),PH2:e})),r}#y(e){return this.#P(this.#l.roots,e)}#P(e,t,i=!1){const n=this.#T?.invisibleEntries()??[];let r=t;for(const a of e){let e=t;const s=a.entry,o=this.isIgnoreListedEntry(s);(!n.includes(s)&&this.#e.entryIsVisibleInTimeline(s)||this.#g)&&!(o&&i)&&(this.#k(s,t,this.#T?.isEntryModified(s)),e++);const l=this.#P(a.children,e,o);r=Math.max(l,r)}return r}#k(e,t,i){this.#w(t);const n=this.#e.appendEventAtLevel(e,t,this);this.#E(e,n,i)}#E(e,t,n){const r=this.#e.getFlameChartTimelineData();n&&L(r,t,{type:"HIDDEN_ANCESTORS_ARROW"});const a=this.#t.Warnings.perEvent.get(e);a&&(L(r,t,{type:"WARNING_TRIANGLE"}),a.includes("LONG_TASK")&&L(r,t,{type:"CANDY",startAtTime:i.Handlers.ModelHandlers.Warnings.LONG_MAIN_THREAD_TASK_THRESHOLD}))}isIgnoreListedEntry(e){if(!this.#u)return!1;if(!i.Types.TraceEvents.isProfileCall(e))return!1;const t=e.callFrame.url;return t&&this.isIgnoreListedURL(t)}isIgnoreListedURL(e){return c.IgnoreListManager.IgnoreListManager.instance().isUserIgnoreListedURL(e)}colorForEvent(e){if(this.#t.Meta.traceIsGeneric)return e.name?`hsl(${o.StringUtilities.hashCode(e.name)%300+30}, 40%, 70%)`:"#ccc";if(i.Types.TraceEvents.isProfileCall(e))return"(idle)"===e.callFrame.functionName?K().Idle.getComputedColorValue():"0"===e.callFrame.scriptId?K().Scripting.getComputedColorValue():this.#n.colorForID(e.callFrame.url);const t=X(e.name)?.category.getComputedColorValue();return t||K().Other.getComputedColorValue()}titleForEvent(e){if(this.isIgnoreListedEntry(e))return Te(ue.onIgnoreList);if(i.Types.TraceEvents.isProfileCall(e)){if(this.#t.Samples){const t=i.Handlers.ModelHandlers.Samples.getProfileCallFunctionName(this.#t.Samples,e);if(t)return t}return e.callFrame.functionName||Te(ue.anonymous)}if(i.Types.TraceEvents.isTraceEventDispatch(e))return Te(ue.eventDispatchS,{PH1:e.args.data.type});const t=X(e.name)?.title;return t||e.name}highlightedEntryInfo(e){let t=this.titleForEvent(e);if(i.Types.TraceEvents.isTraceEventParseHTML(e)){const i=e.args.beginData.startLine,n=e.args.endData&&e.args.endData.endLine,r=e.args.beginData.url;t+=` - ${c.ResourceUtils.displayNameForURL(r)} [${-1!==n||n===i?`${i}...${n}`:i}]`}return{title:t,formattedTime:M(e.dur,e.selfTime)}}}var fe=Object.freeze({__proto__:null,ThreadAppender:ve});let ye=null;class we{static instance(e={forceNew:null}){const t=Boolean(e.forceNew);return ye&&!t||(ye=new we),ye}static removeInstance(){ye=null}#M=[];activeFilters(){return this.#M}setFilters(e){this.#M=e}isVisible(e){return this.#M.every((t=>t.accept(e)))}}function Se(e,t){const n=[];let r=t;for(;r;){const t=e.Initiators.eventToInitiator.get(r);if(t){n.push({event:r,initiator:t}),r=t;continue}if(!i.Types.TraceEvents.isRendererEvent(r)){r=null;break}const a=e.Renderer.entryToNode.get(r);if(!a){r=null;break}r=a.parent?.entry||null}return n}var be=Object.freeze({__proto__:null,eventInitiatorPairsToDraw:Se});const Ce=new CSSStyleSheet;Ce.replaceSync(".timeline-flamechart-popover{overflow:hidden}.timeline-flamechart-popover devtools-interaction-breakdown{margin-top:10px}.timeline-flamechart-popover span{margin-right:5px}.timeline-flamechart-popover span.timeline-info-network-time{color:var(--sys-color-primary)}.timeline-flamechart-popover span.timeline-info-time{color:var(--sys-color-green)}.timeline-flamechart-popover span.timeline-info-warning{color:var(--sys-color-error)}.timeline-flamechart-popover span.timeline-info-warning *{color:inherit}\n/*# sourceURL=timelineFlamechartPopover.css */\n");const Pe={jsHeap:"JS Heap",documents:"Documents",nodes:"Nodes",listeners:"Listeners",gpuMemory:"GPU Memory",ss:"[{PH1} – {PH2}]"},ke=e.i18n.registerUIStrings("panels/timeline/CountersGraph.ts",Pe),Ee=e.i18n.getLocalizedString.bind(void 0,ke);class Me extends h.Widget.VBox{delegate;calculator;header;toolbar;graphsContainer;canvasContainer;canvas;timelineGrid;counters;counterUI;countersByName;gpuMemoryCounter;#F=null;currentValuesBar;markerXPosition;#L=this.#R.bind(this);constructor(e){super(),this.element.id="memory-graphs-container",this.delegate=e,this.calculator=new Re,this.header=new h.Widget.HBox,this.header.element.classList.add("timeline-memory-header"),this.header.show(this.element),this.toolbar=new h.Toolbar.Toolbar("timeline-memory-toolbar"),this.header.element.appendChild(this.toolbar.element),this.graphsContainer=new h.Widget.VBox,this.graphsContainer.show(this.element);const t=new h.Widget.VBoxWithResizeCallback(this.resize.bind(this));t.show(this.graphsContainer.element),this.createCurrentValuesBar(),this.canvasContainer=t.element,this.canvasContainer.id="memory-graphs-canvas-container",this.canvas=document.createElement("canvas"),this.canvasContainer.appendChild(this.canvas),this.canvas.id="memory-counters-graph",this.canvasContainer.addEventListener("mouseover",this.onMouseMove.bind(this),!0),this.canvasContainer.addEventListener("mousemove",this.onMouseMove.bind(this),!0),this.canvasContainer.addEventListener("mouseleave",this.onMouseLeave.bind(this),!0),this.canvasContainer.addEventListener("click",this.onClick.bind(this),!0),this.timelineGrid=new s.TimelineGrid.TimelineGrid,this.canvasContainer.appendChild(this.timelineGrid.dividersElement),this.counters=[],this.counterUI=[],this.countersByName=new Map,this.countersByName.set("jsHeapSizeUsed",this.createCounter(Ee(Pe.jsHeap),"hsl(220, 90%, 43%)",o.NumberUtilities.bytesToString)),this.countersByName.set("documents",this.createCounter(Ee(Pe.documents),"hsl(0, 90%, 43%)")),this.countersByName.set("nodes",this.createCounter(Ee(Pe.nodes),"hsl(120, 90%, 43%)")),this.countersByName.set("jsEventListeners",this.createCounter(Ee(Pe.listeners),"hsl(38, 90%, 43%)")),this.gpuMemoryCounter=this.createCounter(Ee(Pe.gpuMemory),"hsl(300, 90%, 43%)",o.NumberUtilities.bytesToString),this.countersByName.set("gpuMemoryUsedKB",this.gpuMemoryCounter),m.TraceBounds.onChange(this.#L)}#R(e){if("RESET"===e.updateType||"VISIBLE_WINDOW"===e.updateType){const t=e.state.milli.timelineTraceWindow;this.calculator.setWindow(t.min,t.max),this.#I()}}setModel(e,t){if(this.#F=t,!t)return;const n=e?i.Helpers.Timing.traceWindowMilliSeconds(e.Meta.traceBounds).min:0;this.calculator.setZeroTime(n);for(let e=0;e<this.counters.length;++e)this.counters[e].reset(),this.counterUI[e].reset();this.#I();for(let e=0;e<t.length;++e){const n=t[e];if(!i.Types.TraceEvents.isTraceEventUpdateCounters(n))continue;const r=n.args.data;if(!r)return;for(const e in r){const t=this.countersByName.get(e);if(t){const{startTime:a}=i.Legacy.timesForEventInMilliseconds(n);t.appendSample(a,r[e])}}void 0!==r.gpuMemoryLimitKB&&this.gpuMemoryCounter.setLimit(r.gpuMemoryLimitKB)}}createCurrentValuesBar(){this.currentValuesBar=this.graphsContainer.element.createChild("div"),this.currentValuesBar.id="counter-values-bar"}createCounter(e,t,i){const n=new Fe;return this.counters.push(n),this.counterUI.push(new Le(this,e,t,n,i)),n}resizerElement(){return this.header.element}resize(){const e=this.canvas.parentElement;this.canvas.width=e.clientWidth*window.devicePixelRatio,this.canvas.height=e.clientHeight*window.devicePixelRatio,this.calculator.setDisplayWidth(this.canvas.width),this.refresh()}#I(){h.UIUtils.invokeOnceAfterBatchUpdate(this,this.refresh)}draw(){this.clear();for(const e of this.counters)e.calculateVisibleIndexes(this.calculator),e.calculateXValues(this.canvas.width);for(const e of this.counterUI)e.drawGraph(this.canvas)}onClick(e){const t=e.x-this.canvasContainer.getBoundingClientRect().left;let i,n=1/0;for(const e of this.counterUI){if(!e.counter.times.length)continue;const r=e.recordIndexAt(t),a=Math.abs(t*window.devicePixelRatio-e.counter.x[r]);a<n&&(n=a,i=e.counter.times[r])}void 0!==i&&this.#F&&this.delegate.selectEntryAtTime(this.#F,i)}onMouseLeave(e){delete this.markerXPosition,this.clearCurrentValueAndMarker()}clearCurrentValueAndMarker(){for(let e=0;e<this.counterUI.length;e++)this.counterUI[e].clearCurrentValueAndMarker()}onMouseMove(e){const t=e.x-this.canvasContainer.getBoundingClientRect().left;this.markerXPosition=t,this.refreshCurrentValues()}refreshCurrentValues(){if(void 0!==this.markerXPosition)for(let e=0;e<this.counterUI.length;++e)this.counterUI[e].updateCurrentValue(this.markerXPosition)}refresh(){this.timelineGrid.updateDividers(this.calculator),this.draw(),this.refreshCurrentValues()}clear(){const e=this.canvas.getContext("2d");if(!e)throw new Error("Unable to get canvas context");e.clearRect(0,0,e.canvas.width,e.canvas.height)}}class Fe{times;values;x;minimumIndex;maximumIndex;maxTime;minTime;limitValue;constructor(){this.times=[],this.values=[],this.x=[],this.minimumIndex=0,this.maximumIndex=0,this.maxTime=0,this.minTime=0}appendSample(e,t){this.values.length&&this.values[this.values.length-1]===t||(this.times.push(e),this.values.push(t))}reset(){this.times=[],this.values=[]}setLimit(e){this.limitValue=e}calculateBounds(){let e,t;for(let i=this.minimumIndex;i<=this.maximumIndex;i++){const n=this.values[i];(void 0===t||n<t)&&(t=n),(void 0===e||n>e)&&(e=n)}return t=t||0,e=e||1,this.limitValue&&(e>.5*this.limitValue&&(e=Math.max(e,this.limitValue)),t=Math.min(t,this.limitValue)),{min:t,max:e}}calculateVisibleIndexes(e){const t=e.minimumBoundary(),i=e.maximumBoundary();this.minimumIndex=o.NumberUtilities.clamp(o.ArrayUtilities.upperBound(this.times,t,o.ArrayUtilities.DEFAULT_COMPARATOR)-1,0,this.times.length-1),this.maximumIndex=o.NumberUtilities.clamp(o.ArrayUtilities.lowerBound(this.times,i,o.ArrayUtilities.DEFAULT_COMPARATOR),0,this.times.length-1),this.minTime=t,this.maxTime=i}calculateXValues(e){if(!this.values.length)return;const t=e/(this.maxTime-this.minTime);this.x=new Array(this.values.length);for(let e=this.minimumIndex+1;e<=this.maximumIndex;e++)this.x[e]=t*(this.times[e]-this.minTime)}}class Le{countersPane;counter;formatter;setting;filter;range;value;graphColor;limitColor;graphYValues;verticalPadding;currentValueLabel;marker;constructor(e,t,i,n,a){this.countersPane=e,this.counter=n,this.formatter=a||o.NumberUtilities.withThousandsSeparator,this.setting=r.Settings.Settings.instance().createSetting("timelineCountersGraph-"+t,!0),this.setting.setTitle(t),this.filter=new h.Toolbar.ToolbarSettingCheckbox(this.setting,t),this.filter.inputElement.classList.add("-theme-preserve-input");const s=r.Color.parse(i);if(s){const e=s.setAlpha(.5).asString("rgba"),t=this.filter.element;e&&(t.style.backgroundColor=e),t.style.borderColor="transparent"}this.filter.inputElement.addEventListener("click",this.toggleCounterGraph.bind(this)),e.toolbar.appendToolbarItem(this.filter),this.range=this.filter.element.createChild("span","range"),this.value=e.currentValuesBar.createChild("span","memory-counter-value"),this.value.style.color=i,this.graphColor=i,s&&(this.limitColor=s.setAlpha(.3).asString("rgba")),this.graphYValues=[],this.verticalPadding=10,this.currentValueLabel=t,this.marker=e.canvasContainer.createChild("div","memory-counter-marker"),this.marker.style.backgroundColor=i,this.clearCurrentValueAndMarker()}reset(){this.range.textContent=""}setRange(e,t){const i=this.formatter(e),n=this.formatter(t);this.range.textContent=Ee(Pe.ss,{PH1:i,PH2:n})}toggleCounterGraph(){this.value.classList.toggle("hidden",!this.filter.checked()),this.countersPane.refresh()}recordIndexAt(e){return o.ArrayUtilities.upperBound(this.counter.x,e*window.devicePixelRatio,o.ArrayUtilities.DEFAULT_COMPARATOR,this.counter.minimumIndex+1,this.counter.maximumIndex+1)-1}updateCurrentValue(e){if(!this.visible()||!this.counter.values.length||!this.counter.x)return;const t=this.recordIndexAt(e),i=o.NumberUtilities.withThousandsSeparator(this.counter.values[t]);this.value.textContent=`${this.currentValueLabel}: ${i}`;const n=this.graphYValues[t]/window.devicePixelRatio;this.marker.style.left=e+"px",this.marker.style.top=n+"px",this.marker.classList.remove("hidden")}clearCurrentValueAndMarker(){this.value.textContent="",this.marker.classList.add("hidden")}drawGraph(e){const t=e.getContext("2d");if(!t)throw new Error("Unable to get canvas context");const i=e.width,n=e.height-2*this.verticalPadding;if(n<=0)return void(this.graphYValues=[]);const r=this.verticalPadding,a=this.counter,s=a.values;if(!s.length)return;const o=a.calculateBounds(),l=o.min,c=o.max;if(this.setRange(l,c),!this.visible())return;const d=this.graphYValues,h=c-l,m=h?n/h:1;t.save(),t.lineWidth=window.devicePixelRatio,t.lineWidth%2&&t.translate(.5,.5),t.beginPath();let p=s[a.minimumIndex],u=Math.round(r+n-(p-l)*m);t.moveTo(0,u);let g=a.minimumIndex;for(;g<=a.maximumIndex;g++){const e=Math.round(a.x[g]);t.lineTo(e,u);const i=s[g];void 0!==i&&(p=i),u=Math.round(r+n-(p-l)*m),t.lineTo(e,u),d[g]=u}if(d.length=g,t.lineTo(i,u),t.strokeStyle=this.graphColor,t.stroke(),a.limitValue){const e=Math.round(r+n-(a.limitValue-l)*m);t.moveTo(0,e),t.lineTo(i,e),this.limitColor&&(t.strokeStyle=this.limitColor),t.stroke()}t.closePath(),t.restore()}visible(){return this.filter.checked()}}class Re{minimumBoundaryInternal;maximumBoundaryInternal;workingArea;zeroTimeInternal;constructor(){this.minimumBoundaryInternal=0,this.maximumBoundaryInternal=0,this.workingArea=0,this.zeroTimeInternal=0}setZeroTime(e){this.zeroTimeInternal=e}computePosition(e){return(e-this.minimumBoundaryInternal)/this.boundarySpan()*this.workingArea}setWindow(e,t){this.minimumBoundaryInternal=e,this.maximumBoundaryInternal=t}setDisplayWidth(e){this.workingArea=e}formatValue(t,i){return e.TimeUtilities.preciseMillisToString(t-this.zeroTime(),i)}maximumBoundary(){return this.maximumBoundaryInternal}minimumBoundary(){return this.minimumBoundaryInternal}zeroTime(){return this.zeroTimeInternal}boundarySpan(){return this.maximumBoundaryInternal-this.minimumBoundaryInternal}}var Ie=Object.freeze({__proto__:null,CountersGraph:Me,Counter:Fe,CounterUI:Le,Calculator:Re});const xe=new CSSStyleSheet;xe.replaceSync(".image-preview-container{background:transparent;text-align:center;border-spacing:0}.image-preview-container img{margin:6px 0;max-width:100px;max-height:100px;background-image:var(--image-file-checker);user-select:text;vertical-align:top;-webkit-user-drag:auto}.image-container{padding:0}.image-container > div{min-height:50px;display:flex;align-items:center;justify-content:center;cursor:pointer}.image-preview-container .row{line-height:1.2;vertical-align:baseline}.image-preview-container .title{padding-right:0.5em;text-align:right;color:var(--sys-color-token-subtle);white-space:nowrap}.image-preview-container .description{white-space:nowrap;text-align:left;color:var(--sys-color-on-surface)}.image-preview-container .description-link{max-width:20em}.image-preview-container .source-link{white-space:normal;word-break:break-all;color:var(--sys-color-primary);cursor:pointer}\n/*# sourceURL=imagePreview.css */\n");class De extends Event{static eventName="nodenamesupdated";constructor(){super(De.eventName,{composed:!0,bubbles:!0})}}const Ae=new Map;class Ne extends EventTarget{#x;#D=!1;#A=new Set;constructor(e){super(),this.#x=e}static clearResolvedNodeNames(){Ae.clear()}static resolvedNodeNameForEntry(e){return Ae.get(e.pid)?.get(e.tid)?.get(e.nodeId)??null}static storeResolvedNodeNameForEntry(e,t,i,n){const r=Ae.get(e)||new Map,a=r.get(t)||new Map;a.set(i,n),r.set(t,a),Ae.set(e,r)}async install(){if(this.#x.Samples){for(const e of this.#x.Samples.profilesInProcess.values())for(const[t,i]of e){const e=i.parsedProfile.nodes();if(!e||0===e.length)continue;const r=this.#N(t),a=r?.model(n.DebuggerModel.DebuggerModel);if(a)for(const t of e){const e=a.scriptForId(String(t.callFrame.scriptId));(!e||e.sourceMapURL)&&this.#A.add(a)}}for(const e of this.#A)e.sourceMapManager().addEventListener(n.SourceMapManager.Events.SourceMapAttached,this.#B,this);await this.#H()}}uninstall(){for(const e of this.#A)e.sourceMapManager().removeEventListener(n.SourceMapManager.Events.SourceMapAttached,this.#B,this);this.#A.clear()}async#H(){if(this.#x.Samples){for(const[e,t]of this.#x.Samples.profilesInProcess)for(const[i,n]of t){const t=n.parsedProfile.nodes()??[],r=this.#N(i);if(r)for(const n of t){const t=await g.NamesResolver.resolveProfileFrameFunctionName(n.callFrame,r);n.setFunctionName(t),Ne.storeResolvedNodeNameForEntry(e,i,n.id,t)}}this.dispatchEvent(new De)}}#B(){this.#D||(this.#D=!0,setTimeout((async()=>{this.#D=!1,await this.#H()}),500))}#N(e){const t=this.#x.Workers.workerIdByThread.get(e);return t?n.TargetManager.TargetManager.instance().targetById(t):n.TargetManager.TargetManager.instance().primaryPageTarget()}}var Be=Object.freeze({__proto__:null,NodeNamesUpdated:De,SourceMapsResolver:Ne});const He=new CSSStyleSheet;He.replaceSync('.content{margin-left:5px}.history-dropdown-button{width:160px;height:26px;text-align:left;display:flex;border:1px solid transparent}.history-dropdown-button[disabled]{opacity:50%;border:1px solid transparent}.history-dropdown-button > .content{padding-right:5px;overflow:hidden;text-overflow:ellipsis;flex:1 1;min-width:35px;&::after{float:right;user-select:none;mask-image:var(--image-file-triangle-down);width:14px;height:14px;content:"";position:absolute;background-color:var(--icon-default);right:-3px}}.history-dropdown-button:focus-visible::before{content:"";position:absolute;top:2px;left:0;right:0;bottom:2px;border-radius:2px;background:var(--divider-line)}@media (forced-colors: active){.history-dropdown-button[disabled]{opacity:100%}.history-dropdown-button > .content::after{background-color:ButtonText}.history-dropdown-button[disabled] > .content::after{background-color:GrayText}}\n/*# sourceURL=historyToolbarButton.css */\n');class Ue{timelineModelInternal;constructor(){this.timelineModelInternal=new d.TimelineModel.TimelineModelImpl}async setTracingModel(e,t=!1){this.timelineModelInternal.setEvents(e,t)}timelineModel(){return this.timelineModelInternal}}var We=Object.freeze({__proto__:null,PerformanceModel:Ue});function*Ve(e){if(yield"[\n",e.length>0){const t=e[Symbol.iterator](),i=t.next().value;yield`  ${JSON.stringify(i)}`;let n=1e4,r="";for(const e of t)r+=`,\n  ${JSON.stringify(e)}`,n--,0===n&&(yield r,n=1e4,r="");yield r}yield"\n]"}function*Oe(e,t){yield'{"traceEvents": ',yield*Ve(e),yield`,\n"metadata": ${JSON.stringify(t||{},null,2)}`,yield"}\n"}function ze(e){return JSON.stringify(e)}var Ge=Object.freeze({__proto__:null,arrayOfObjectsJsonGenerator:Ve,traceJsonGenerator:Oe,cpuprofileJsonGenerator:ze});const _e={tracingNotSupported:"Performance trace recording not supported for this type of target"},je=e.i18n.registerUIStrings("panels/timeline/TimelineController.ts",_e),qe=e.i18n.getLocalizedString.bind(void 0,je);class Je{primaryPageTarget;rootTarget;tracingManager;performanceModel;#U=[];#W=null;client;tracingModel;tracingCompleteCallback;constructor(e,t,n){this.primaryPageTarget=t,this.rootTarget=e,this.tracingManager=e.model(i.TracingManager.TracingManager),this.performanceModel=new Ue,this.client=n,this.tracingModel=new i.Legacy.TracingModel}async dispose(){this.tracingManager&&await this.tracingManager.reset()}async startRecording(e){function t(e){return"disabled-by-default-"+e}const i=[l.Runtime.experiments.isEnabled("timelineShowAllEvents")?"*":"-*",d.TimelineModel.TimelineModelImpl.Category.Console,d.TimelineModel.TimelineModelImpl.Category.UserTiming,"devtools.timeline",t("devtools.timeline"),t("devtools.timeline.frame"),t("devtools.timeline.stack"),t("v8.compile"),t("v8.cpu_profiler.hires"),d.TimelineModel.TimelineModelImpl.Category.Loading,t("lighthouse"),"v8.execute","v8"];l.Runtime.experiments.isEnabled("timelineV8RuntimeCallStats")&&e.enableJSSampling&&i.push(t("v8.runtime_stats_sampling")),e.enableJSSampling&&i.push(t("v8.cpu_profiler")),l.Runtime.experiments.isEnabled("timelineInvalidationTracking")&&i.push(t("devtools.timeline.invalidationTracking")),e.capturePictures&&i.push(t("devtools.timeline.layers"),t("devtools.timeline.picture"),t("blink.graphics_context_annotations")),e.captureFilmStrip&&i.push(t("devtools.screenshot")),this.#W=Date.now();const r=await this.startRecordingWithCategories(i.join(","));return r.getError()&&(await this.waitForTracingToStop(!1),await n.TargetManager.TargetManager.instance().resumeAllTargets()),r}async stopRecording(){return this.tracingManager&&this.tracingManager.stop(),this.client.loadingStarted(),await this.waitForTracingToStop(!0),await this.allSourcesFinished(),this.performanceModel}getPerformanceModel(){return this.performanceModel}async waitForTracingToStop(e){const t=[];this.tracingManager&&e&&t.push(new Promise((e=>{this.tracingCompleteCallback=e}))),await Promise.all(t)}async startRecordingWithCategories(e){if(!this.tracingManager)throw new Error(qe(_e.tracingNotSupported));return await n.TargetManager.TargetManager.instance().suspendAllTargets("performance-timeline"),this.tracingManager.start(this,e,"")}traceEventsCollected(e){this.#U=this.#U.concat(e),this.tracingModel.addEvents(e)}tracingComplete(){this.tracingCompleteCallback&&(this.tracingCompleteCallback(void 0),this.tracingCompleteCallback=null)}async allSourcesFinished(){this.client.processingStarted(),await this.finalizeTrace()}async finalizeTrace(){await n.TargetManager.TargetManager.instance().resumeAllTargets(),this.tracingModel.tracingComplete(),await this.client.loadingComplete(this.#U,this.tracingModel,null,!1,this.#W),this.client.loadingCompleteForTest()}tracingBufferUsage(e){this.client.recordingProgress(e)}eventsRetrievalProgress(e){this.client.loadingProgress(e)}}var $e=Object.freeze({__proto__:null,TimelineController:Je});const Xe={net:"NET",cpu:"CPU",heap:"HEAP",sSDash:"{PH1} – {PH2}"},Ke=e.i18n.registerUIStrings("panels/timeline/TimelineEventOverview.ts",Xe),Ye=e.i18n.getLocalizedString.bind(void 0,Ke);class Ze extends s.TimelineOverviewPane.TimelineOverviewBase{constructor(e,t){super(),this.element.id="timeline-overview-"+e,this.element.classList.add("overview-strip"),t&&(this.element.createChild("div","timeline-overview-strip-title").textContent=t)}renderBar(e,t,i,n,r){const a=e,s=t-e,o=this.context();o.fillStyle=r,o.fillRect(a,i,s,n)}}const Qe=new Set(["VeryHigh","High","Medium"]);class et extends Ze{#t;constructor(e){super("network",Ye(Xe.net)),this.#t=e}update(e,t){this.resetCanvas(),this.#V(e,t)}#V(e,t){if(!this.#t)return;const n=e&&t?{min:e,max:t,range:t-e}:i.Helpers.Timing.traceWindowMilliSeconds(this.#t.Meta.traceBounds),r=this.height()/2,a=this.width(),s=a/n.range,o=new Path2D,l=new Path2D;for(const e of this.#t.NetworkRequests.byTime){const t=Qe.has(e.args.data.priority)?o:l,{startTime:c,endTime:d}=i.Helpers.Timing.eventTimingsMilliSeconds(e),h=Math.max(Math.floor((c-n.min)*s),0),m=Math.min(Math.ceil((d-n.min)*s+1),a);t.rect(h,0,m-h,r-1)}const c=this.context();c.save(),c.fillStyle="hsl(214, 60%, 60%)",c.fill(o),c.translate(0,r),c.fillStyle="hsl(214, 80%, 80%)",c.fill(l),c.restore()}}const tt=new WeakMap;class it extends Ze{backgroundCanvas;#t;#O=!1;#z;#G;constructor(e){super("cpu-activity",Ye(Xe.cpu)),this.#t=e,this.backgroundCanvas=this.element.createChild("canvas","fill background"),this.#z=i.Helpers.Timing.traceWindowMilliSeconds(e.Meta.traceBounds).min,this.#G=i.Helpers.Timing.traceWindowMilliSeconds(e.Meta.traceBounds).max}#_(e){if(i.Types.TraceEvents.isProfileCall(e)&&"(idle)"===e.callFrame.functionName)return"idle";return(X(e.name)?.category||K().Other).name}resetCanvas(){super.resetCanvas(),this.#O=!1,this.backgroundCanvas.width=this.element.clientWidth*window.devicePixelRatio,this.backgroundCanvas.height=this.element.clientHeight*window.devicePixelRatio}#j(e){const t=4*window.devicePixelRatio,n=this.width(),r=this.height(),a=r,s=this.#G-this.#z,o=t/(n/s),l=di.categories(),c=di.getTimelineMainEventCategories(),d=c.indexOf("other");console.assert(0===c.indexOf("idle"));for(let e=0;e<c.length;++e)tt.set(l[c[e]],e);const h=(e,h)=>{const m=new st(this.#z,o,(function(e){let i=a;for(let n=1;n<c.length;++n){i-=(e[n]||0)/o*r,g[n].bezierCurveTo(p,T[n],p,i,p+t/2,i),T[n]=i}p+=t}));let p=0;const u=[],g=[],T=[];for(let e=0;e<c.length;++e)g[e]=new Path2D,g[e].moveTo(0,r),T[e]=r;const v=i.Helpers.Timing.millisecondsToMicroseconds(this.#z),f=i.Helpers.Timing.millisecondsToMicroseconds(this.#G),y={min:v,max:f,range:i.Types.Timing.MicroSeconds(f-v)},w=i.Types.Timing.MicroSeconds(y.range>2e5?16e3:0);i.Helpers.TreeHelpers.walkEntireTree(h.entryToNode,h.tree,(e=>{const t=this.#_(e);if(!t||"idle"===t)return;const n=i.Helpers.Timing.microSecondsToMilliseconds(e.ts),r=u.length?u[u.length-1]:0;m.appendInterval(n,r);const a=c.indexOf(t);u.push(a||d)}),(function(e){const t=i.Helpers.Timing.microSecondsToMilliseconds(e.ts)+i.Helpers.Timing.microSecondsToMilliseconds(i.Types.Timing.MicroSeconds(e.dur||0)),n=u.pop();void 0!==t&&n&&m.appendInterval(t,n)}),y,w),m.appendInterval(this.#z+s+o,0);for(let t=c.length-1;t>0;--t){g[t].lineTo(n,r);const i=l[c[t]].getComputedColorValue();e.fillStyle=i,e.fill(g[t]),e.strokeStyle="white",e.lineWidth=1,e.stroke(g[t])}},m=this.backgroundCanvas.getContext("2d");if(!m)throw new Error("Could not find 2d canvas");const p=i.Handlers.Threads.threadsInTrace(e),u=this.context();for(const e of p){h("MAIN_THREAD"===e.type||"CPU_PROFILE"===e.type?u:m,e)}!function(e){const t=4*window.devicePixelRatio;e.save(),e.lineWidth=t/Math.sqrt(8);for(let i=.5;i<n+r;i+=t)e.moveTo(i,0),e.lineTo(i-r,r);e.globalCompositeOperation="destination-out",e.stroke(),e.restore()}(m)}update(){const e=m.TraceBounds.BoundsManager.instance().state(),t=e?.milli.minimapTraceBounds;t&&(t.min===this.#z&&t.max===this.#G&&this.#O||(this.#z=t.min,this.#G=t.max,this.resetCanvas(),this.#O=!0,this.#j(this.#t)))}}class nt extends Ze{#t;constructor(e){super("responsiveness",null),this.#t=e}#q(){const{topLevelRendererIds:e}=this.#t.Meta,t=new Set(["LONG_TASK","FORCED_STYLE","IDLE_CALLBACK_OVER_TIME","FORCED_LAYOUT"]),i=new Set;for(const n of t){const t=this.#t.Warnings.perWarning.get(n);if(t)for(const n of t)e.has(n.pid)&&i.add(n)}return i}update(e,t){this.resetCanvas();const n=this.height(),r=e&&t?{min:i.Helpers.Timing.millisecondsToMicroseconds(e),max:i.Helpers.Timing.millisecondsToMicroseconds(t),range:i.Helpers.Timing.millisecondsToMicroseconds(i.Types.Timing.MilliSeconds(t-e))}:this.#t.Meta.traceBounds,a=r.range,s=this.width()/a,o=this.context(),l=new Path2D,c=new Path2D,d=this.#q();for(const e of d)h(e);function h(e){const{startTime:t,duration:a}=i.Helpers.Timing.eventTimingsMicroSeconds(e),o=Math.round(s*(t-r.min)),d=Math.round(s*a);l.rect(o,0,d,n),c.moveTo(o+d,0),c.lineTo(o+d,n)}o.fillStyle="hsl(0, 80%, 90%)",o.strokeStyle="red",o.lineWidth=2*window.devicePixelRatio,o.fill(l),o.stroke(c)}}class rt extends Ze{frameToImagePromise;lastFrame=null;lastElement;drawGeneration;emptyImage;#J=null;constructor(e){super("filmstrip",null),this.frameToImagePromise=new Map,this.#J=e,this.lastFrame=null,this.lastElement=null,this.reset()}update(e,t){this.resetCanvas();const i=this.#J?this.#J.frames:[];if(!i.length)return;if(0===this.height())return void console.warn("TimelineFilmStrip could not be drawn as its canvas height is 0");const n=Symbol("drawGeneration");this.drawGeneration=n,this.imageByFrame(i[0]).then((i=>{if(this.drawGeneration!==n)return;if(!i||!i.naturalWidth||!i.naturalHeight)return;const r=this.height()-2*rt.Padding,a=Math.ceil(r*i.naturalWidth/i.naturalHeight),s=Math.min(200/i.naturalWidth,1);this.emptyImage=new Image(i.naturalWidth*s,i.naturalHeight*s),this.drawFrames(a,r,e,t)}))}async imageByFrame(e){let t=this.frameToImagePromise.get(e);if(!t){const i=e.screenshotAsString;t=h.UIUtils.loadImageFromData(i),this.frameToImagePromise.set(e,t)}return t}drawFrames(e,t,n,r){if(!e)return;if(!this.#J||this.#J.frames.length<1)return;const a=rt.Padding,s=this.width(),o=n??i.Helpers.Timing.microSecondsToMilliseconds(this.#J.zeroTime),l=(r?r-o:i.Helpers.Timing.microSecondsToMilliseconds(this.#J.spanTime))/s,c=this.context(),d=this.drawGeneration;c.beginPath();for(let n=a;n<s;n+=e+2*a){const r=i.Types.Timing.MilliSeconds(o+(n+e/2)*l),a=i.Helpers.Timing.millisecondsToMicroseconds(r),s=i.Extras.FilmStrip.frameClosestToTimestamp(this.#J,a);s&&(c.rect(n-.5,.5,e+1,t+1),this.imageByFrame(s).then(h.bind(this,n)))}function h(i,n){this.drawGeneration===d&&n&&c.drawImage(n,i,1,e,t)}c.strokeStyle="#ddd",c.stroke()}async overviewInfoPromise(e){if(!this.#J||0===this.#J.frames.length)return null;const t=this.calculator();if(!t)return null;const n=i.Types.Timing.MilliSeconds(t.positionToTime(e)),r=i.Helpers.Timing.millisecondsToMicroseconds(n),a=i.Extras.FilmStrip.frameClosestToTimestamp(this.#J,r);if(a===this.lastFrame)return this.lastElement;const s=a?this.imageByFrame(a):Promise.resolve(this.emptyImage),o=await s,l=document.createElement("div");return l.classList.add("frame"),o&&l.createChild("div","thumbnail").appendChild(o),this.lastFrame=a,this.lastElement=l,l}reset(){this.lastFrame=null,this.lastElement=null,this.frameToImagePromise=new Map}static Padding=2}class at extends Ze{heapSizeLabel;#t;constructor(e){super("memory",Ye(Xe.heap)),this.heapSizeLabel=this.element.createChild("div","memory-graph-label"),this.#t=e}resetHeapSizeLabels(){this.heapSizeLabel.textContent=""}update(e,t){this.resetCanvas();const n=window.devicePixelRatio;if(0===this.#t.Memory.updateCountersByProcess.size)return void this.resetHeapSizeLabels();const r=Array.from(this.#t.Meta.topLevelRendererIds).map((e=>this.#t.Memory.updateCountersByProcess.get(e)||[])).filter((e=>e.length>0)),a=3*n;let s=0,l=1e11;const c=e&&t?{min:e,max:t,range:t-e}:i.Helpers.Timing.traceWindowMilliSeconds(this.#t.Meta.traceBounds),d=c.min,h=c.max;function m(e){const t=e.args.data;t&&t.jsHeapSizeUsed&&(s=Math.max(s,t.jsHeapSizeUsed),l=Math.min(l,t.jsHeapSizeUsed))}for(let e=0;e<r.length;e++)r[e].forEach(m);l=Math.min(l,s);const p=this.width(),u=this.height()-a,g=p/(h-d),T=(u-1)/Math.max(s-l,1),v=new Array(p);function f(e){const t=e.args.data;if(!t||!t.jsHeapSizeUsed)return;const{startTime:n}=i.Helpers.Timing.eventTimingsMilliSeconds(e),r=Math.round((n-d)*g),a=Math.round((t.jsHeapSizeUsed-l)*T);v[r]=Math.max(v[r]||0,a)}for(let e=0;e<r.length;e++)r[e].forEach(f);const y=this.context(),w=u+a+1;y.translate(.5,.5),y.beginPath(),y.moveTo(-1,w);let S=0,b=!0,C=0;for(let e=0;e<v.length;e++){if(void 0===v[e])continue;b&&(b=!1,S=v[e],y.lineTo(-1,u-S));const t=v[e];Math.abs(t-S)>2&&Math.abs(e-C)>1&&y.lineTo(e,u-S),S=t,y.lineTo(e,u-S),C=e}y.lineTo(p+1,u-S),y.lineTo(p+1,w),y.closePath(),y.fillStyle="hsla(220, 90%, 70%, 0.2)",y.fill(),y.lineWidth=1,y.strokeStyle="hsl(220, 90%, 70%)",y.stroke(),this.heapSizeLabel.textContent=Ye(Xe.sSDash,{PH1:o.NumberUtilities.bytesToString(l),PH2:o.NumberUtilities.bytesToString(s)})}}class st{lastTime;quantDuration;callback;counters;remainder;constructor(e,t,i){this.lastTime=e,this.quantDuration=t,this.callback=i,this.counters=[],this.remainder=t}appendInterval(e,t){let i=e-this.lastTime;if(i<=this.remainder)return this.counters[t]=(this.counters[t]||0)+i,this.remainder-=i,void(this.lastTime=e);for(this.counters[t]=(this.counters[t]||0)+this.remainder,this.callback(this.counters),i-=this.remainder;i>=this.quantDuration;){const e=[];e[t]=this.quantDuration,this.callback(e),i-=this.quantDuration}this.counters=[],this.counters[t]=i,this.lastTime=e,this.remainder=this.quantDuration-i}}var ot=Object.freeze({__proto__:null,TimelineEventOverview:Ze,TimelineEventOverviewNetwork:et,TimelineEventOverviewCPUActivity:it,TimelineEventOverviewResponsiveness:nt,TimelineFilmStripOverview:rt,TimelineEventOverviewMemory:at,Quantizer:st});const lt=new CSSStyleSheet;lt.replaceSync(".drop-down{padding:1px;box-shadow:var(--drop-shadow);background:var(--sys-color-cdt-base-container)}.preview-item{border-color:transparent;border-style:solid;border-width:1px 5px;padding:2px 0;margin:2px 1px}.preview-item.selected{border-color:var(--sys-color-primary)}.preview-item canvas{width:100%;height:100%}.text-details{font-size:11px;padding:3px}.text-details span{flex:1 0;padding-left:8px;padding-right:8px}.text-details .name{font-weight:bold}.text-details span.time{color:var(--sys-color-token-subtle);text-align:right}.screenshot-thumb{display:flex;border:1px solid var(--sys-color-neutral-outline);margin:2px 4px}.screenshot-thumb img{margin:auto;max-width:100%;max-height:100%}\n/*# sourceURL=timelineHistoryManager.css */\n");const ct={currentSessionSS:"Current Session: {PH1}. {PH2}",noRecordings:"(no recordings)",sAgo:"({PH1} ago)",moments:"moments",sM:"{PH1} m",sH:"{PH1} h",sD:"{PH1} #{PH2}",selectTimelineSession:"Select Timeline Session"},dt=e.i18n.registerUIStrings("panels/timeline/TimelineHistoryManager.ts",ct),ht=e.i18n.getLocalizedString.bind(void 0,dt);class mt{recordings;action;nextNumberByDomain;buttonInternal;allOverviews;totalHeight;enabled;lastActiveTraceIndex=null;#$;constructor(e){this.recordings=[],this.#$=e,this.action=h.ActionRegistry.ActionRegistry.instance().getAction("timeline.show-history"),this.nextNumberByDomain=new Map,this.buttonInternal=new vt(this.action),h.ARIAUtils.markAsMenuButton(this.buttonInternal.element),this.clear(),this.allOverviews=[{constructor:e=>{const t=this.#$?.getControls().find((e=>e instanceof nt));return t||new nt(e)},height:3},{constructor:e=>{const t=this.#$?.getControls().find((e=>e instanceof it));return t||new it(e)},height:20},{constructor:e=>{const t=this.#$?.getControls().find((e=>e instanceof et));return t||new et(e)},height:8}],this.totalHeight=this.allOverviews.reduce(((e,t)=>e+t.height),0),this.enabled=!0}addRecording(e){const{legacyModel:t,traceParseDataIndex:i}=e.data,n=e.filmStripForPreview;this.lastActiveTraceIndex=i,this.recordings.unshift({legacyModel:t,traceParseDataIndex:i}),this.#X(i,e.traceParsedData,n,e.startTime);const r=this.title(i);this.buttonInternal.setText(r);const a=this.action.title();if(h.ARIAUtils.setLabel(this.buttonInternal.element,ht(ct.currentSessionSS,{PH1:r,PH2:a})),this.updateState(),this.recordings.length<=pt)return;const s=this.recordings.reduce(((e,t)=>o(e.traceParseDataIndex)<o(t.traceParseDataIndex)?e:t));function o(e){const t=mt.dataForTraceIndex(e);if(!t)throw new Error("Unable to find data for model");return t.lastUsed}this.recordings.splice(this.recordings.indexOf(s),1)}setEnabled(e){this.enabled=e,this.updateState()}button(){return this.buttonInternal}clear(){this.recordings=[],this.lastActiveTraceIndex=null,this.updateState(),this.buttonInternal.setText(ht(ct.noRecordings)),this.nextNumberByDomain.clear()}async showHistoryDropDown(){if(this.recordings.length<2||!this.enabled)return null;const e=await Tt.show(this.recordings.map((e=>e.traceParseDataIndex)),this.lastActiveTraceIndex,this.buttonInternal.element);if(null===e)return null;const t=this.recordings.findIndex((t=>t.traceParseDataIndex===e));return t<0?(console.assert(!1,"selected recording not found"),null):(this.setCurrentModel(e),this.recordings[t])}cancelIfShowing(){Tt.cancelIfShowing()}navigate(e){if(!this.enabled||null===this.lastActiveTraceIndex)return null;const t=this.recordings.findIndex((e=>e.traceParseDataIndex===this.lastActiveTraceIndex));if(t<0)return null;const i=o.NumberUtilities.clamp(t+e,0,this.recordings.length-1),{traceParseDataIndex:n}=this.recordings[i];return this.setCurrentModel(n),this.recordings[i]}setCurrentModel(e){const t=mt.dataForTraceIndex(e);if(!t)throw new Error("Unable to find data for model");t.lastUsed=Date.now(),this.lastActiveTraceIndex=e;const i=this.title(e),n=this.action.title();this.buttonInternal.setText(i),h.ARIAUtils.setLabel(this.buttonInternal.element,ht(ct.currentSessionSS,{PH1:i,PH2:n}))}updateState(){this.action.setEnabled(this.recordings.length>1&&this.enabled)}static previewElement(e){const t=mt.dataForTraceIndex(e);if(!t)throw new Error("Unable to find data for model");const i=t.startTime;return t.time.textContent=i?ht(ct.sAgo,{PH1:mt.coarseAge(i)}):"",t.preview}static coarseAge(e){const t=Math.round((Date.now()-e)/1e3);if(t<50)return ht(ct.moments);const i=Math.round(t/60);if(i<50)return ht(ct.sM,{PH1:i});const n=Math.round(i/60);return ht(ct.sH,{PH1:n})}title(e){const t=mt.dataForTraceIndex(e);if(!t)throw new Error("Unable to find data for model");return t.title}#X(e,t,i,n){const a=r.ParsedURL.ParsedURL.fromString(t.Meta.mainFrameURL),s=a?a.host:"",o=this.nextNumberByDomain.get(s)||1,l=ht(ct.sD,{PH1:s,PH2:o});this.nextNumberByDomain.set(s,o+1);const c=document.createElement("span"),d=document.createElement("div");d.classList.add("preview-item"),d.classList.add("vbox");const h={preview:d,title:l,time:c,lastUsed:Date.now(),startTime:n};gt.set(e,h),d.appendChild(this.#K(t,s,c));const m=d.createChild("div","hbox");return m.appendChild(this.#Y(i)),m.appendChild(this.#Z(t)),h.preview}#K(t,n,r){const a=document.createElement("div");a.classList.add("text-details"),a.classList.add("hbox");const s=a.createChild("span","name");s.textContent=n,h.ARIAUtils.setLabel(s,n);const o=i.Helpers.Timing.traceWindowMilliSeconds(t.Meta.traceBounds),l=e.TimeUtilities.millisToString(o.range,!1),c=a.createChild("span","time");return c.appendChild(document.createTextNode(l)),c.appendChild(r),a}#Y(e){const t=document.createElement("div");t.classList.add("screenshot-thumb");if(t.style.width=1.5*this.totalHeight+"px",t.style.height=this.totalHeight+"px",!e)return t;const i=e.frames.at(-1);return i?(h.UIUtils.loadImageFromData(i.screenshotAsString).then((e=>{e&&t.appendChild(e)})),t):t}#Z(e){const t=document.createElement("div"),i=window.devicePixelRatio;t.style.width=ut+"px",t.style.height=this.totalHeight+"px";const n=t.createChild("canvas");n.width=i*ut,n.height=i*this.totalHeight;const r=n.getContext("2d");let a=0;for(const t of this.allOverviews){const n=t.constructor(e);n.update(),r&&r.drawImage(n.context().canvas,0,a,i*ut,t.height*i),a+=t.height*i}return t}static dataForTraceIndex(e){return gt.get(e)||null}}const pt=5,ut=450,gt=new Map;class Tt{glassPane;listControl;focusRestorer;selectionDone;constructor(e){this.glassPane=new h.GlassPane.GlassPane,this.glassPane.setSizeBehavior("MeasureContent"),this.glassPane.setOutsideClickCallback((()=>this.close(null))),this.glassPane.setPointerEventsBehavior("BlockedByGlassPane"),this.glassPane.setAnchorBehavior("PreferBottom"),this.glassPane.element.addEventListener("blur",(()=>this.close(null)));const t=h.Utils.createShadowRootWithCoreStyles(this.glassPane.contentElement,{cssFile:[lt],delegatesFocus:void 0}).createChild("div","drop-down"),i=new h.ListModel.ListModel;this.listControl=new h.ListControl.ListControl(i,this,h.ListControl.ListMode.NonViewport),this.listControl.element.addEventListener("mousemove",this.onMouseMove.bind(this),!1),i.replaceAll(e),h.ARIAUtils.markAsMenu(this.listControl.element),h.ARIAUtils.setLabel(this.listControl.element,ht(ct.selectTimelineSession)),t.appendChild(this.listControl.element),t.addEventListener("keydown",this.onKeyDown.bind(this),!1),t.addEventListener("click",this.onClick.bind(this),!1),this.focusRestorer=new h.UIUtils.ElementFocusRestorer(this.listControl.element),this.selectionDone=null}static show(e,t,i){if(Tt.instance)return Promise.resolve(null);return new Tt(e).show(i,t)}static cancelIfShowing(){Tt.instance&&Tt.instance.close(null)}show(e,t){return Tt.instance=this,this.glassPane.setContentAnchorBox(e.boxInWindow()),this.glassPane.show(this.glassPane.contentElement.ownerDocument),this.listControl.element.focus(),this.listControl.selectItem(t),new Promise((e=>{this.selectionDone=e}))}onMouseMove(e){const t=e.target.enclosingNodeOrSelfWithClass("preview-item"),i=t&&this.listControl.itemForNode(t);null!==i&&this.listControl.selectItem(i)}onClick(e){e.target.enclosingNodeOrSelfWithClass("preview-item")&&this.close(this.listControl.selectedItem())}onKeyDown(e){switch(e.key){case"Tab":case"Escape":this.close(null);break;case"Enter":this.close(this.listControl.selectedItem());break;default:return}e.consume(!0)}close(e){this.selectionDone&&this.selectionDone(e),this.focusRestorer.restore(),this.glassPane.hide(),Tt.instance=null}createElementForItem(e){const t=mt.previewElement(e);return h.ARIAUtils.markAsMenuItem(t),t.classList.remove("selected"),t}heightForItem(e){return console.assert(!1,"Should not be called"),0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,n){i&&i.classList.remove("selected"),n&&n.classList.add("selected")}updateSelectedItemARIA(e,t){return!1}static instance=null}class vt extends h.Toolbar.ToolbarItem{contentElement;constructor(e){const t=document.createElement("button");t.classList.add("history-dropdown-button"),super(t),this.contentElement=this.element.createChild("span","content"),this.element.addEventListener("click",(()=>{e.execute()}),!1),this.setEnabled(e.enabled()),e.addEventListener("Enabled",(e=>this.setEnabled(e.data))),this.setTitle(e.title())}setText(e){this.contentElement.textContent=e}}var ft=Object.freeze({__proto__:null,TimelineHistoryManager:mt,maxRecordings:pt,previewWidth:ut,DropDown:Tt,ToolbarButton:vt});const yt={malformedTimelineDataUnknownJson:"Malformed timeline data: Unknown JSON format",malformedTimelineInputWrongJson:"Malformed timeline input, wrong JSON brackets balance",malformedTimelineDataS:"Malformed timeline data: {PH1}",legacyTimelineFormatIsNot:"Legacy Timeline format is not supported.",malformedCpuProfileFormat:"Malformed CPU profile format"},wt=e.i18n.registerUIStrings("panels/timeline/TimelineLoader.ts",yt),St=e.i18n.getLocalizedString.bind(void 0,wt);class bt{client;tracingModel;canceledCallback;state;buffer;firstRawChunk;firstChunk;loadedBytes;totalSize;jsonTokenizer;filter;#U=[];#Q;#ee;constructor(e,t){this.client=e,this.tracingModel=new i.Legacy.TracingModel(t),this.canceledCallback=null,this.state=Pt.Initial,this.buffer="",this.firstRawChunk=!0,this.firstChunk=!0,this.loadedBytes=0,this.jsonTokenizer=new w.TextUtils.BalancedJSONTokenizer(this.writeBalancedJSON.bind(this),!0),this.filter=null,this.#ee=new Promise((e=>{this.#Q=e}))}static async loadFromFile(e,t){const i=new bt(t),n=new c.FileUtils.ChunkedFileReader(e,Ct);return i.canceledCallback=n.cancel.bind(n),i.totalSize=e.size,setTimeout((async()=>{!await n.read(i)&&n.error()&&i.reportErrorAndCancelLoading(n.error().message)})),i}static loadFromEvents(e,t){const i=new bt(t);return window.setTimeout((async()=>{i.addEvents(e)})),i}static getCpuProfileFilter(){const e=[];return e.push(d.TimelineModel.RecordType.JSFrame),e.push(d.TimelineModel.RecordType.JSIdleFrame),e.push(d.TimelineModel.RecordType.JSSystemFrame),new d.TimelineModelFilter.TimelineVisibleEventsFilter(e)}static loadFromCpuProfile(e,t,i){const n=new bt(t,i);n.state=Pt.LoadingCPUProfileFromRecording;try{const t=d.TimelineJSProfile.TimelineJSProfileProcessor.createFakeTraceFromCpuProfile(e,1,!0);n.filter=bt.getCpuProfileFilter(),window.setTimeout((async()=>{n.addEvents(t)}))}catch(e){console.error(e.stack)}return n}static async loadFromURL(e,t){const i=new bt(t),n=new r.StringOutputStream.StringOutputStream;await t.loadingStarted();const a=r.Settings.Settings.instance().moduleSetting("network.enable-remote-file-loading").get();return T.ResourceLoader.loadAsStream(e,null,n,(async function(e,t,r){if(!e)return i.reportErrorAndCancelLoading(r.message);const a=n.data(),s=JSON.parse(a);if(Array.isArray(s.nodes))return i.state=Pt.LoadingCPUProfileFromFile,i.buffer=a,void await i.close();const o=Array.isArray(s.traceEvents)?s.traceEvents:s;i.addEvents(o)}),a),i}async addEvents(e){await(this.client?.loadingStarted());for(let t=0;t<e.length;t+=15e3){const i=e.slice(t,t+15e3);this.#te(i),this.tracingModel.addEvents(i),await(this.client?.loadingProgress((t+i.length)/e.length)),await new Promise((e=>window.setTimeout(e)))}this.close()}async cancel(){this.tracingModel=null,this.client&&(await this.client.loadingComplete([],null,null,!1,null),this.client=null),this.canceledCallback&&this.canceledCallback()}async write(e){if(!this.client)return Promise.resolve();if(this.loadedBytes+=e.length,this.firstRawChunk)await this.client.loadingStarted(),await new Promise((e=>requestAnimationFrame((()=>requestAnimationFrame(e)))));else{let e;this.totalSize&&(e=this.loadedBytes/this.totalSize,e=e>1?e-Math.floor(e):e),await this.client.loadingProgress(e)}if(this.firstRawChunk=!1,this.state===Pt.Initial)if(e.match(/^{(\s)*"nodes":(\s)*\[/))this.state=Pt.LoadingCPUProfileFromFile;else if("{"===e[0])this.state=Pt.LookingForEvents;else{if("["!==e[0])return this.reportErrorAndCancelLoading(St(yt.malformedTimelineDataUnknownJson)),Promise.resolve();this.state=Pt.ReadingEvents}if(this.state===Pt.LoadingCPUProfileFromFile)return this.buffer+=e,Promise.resolve();if(this.state===Pt.LookingForEvents){const t='"traceEvents":',i=this.buffer.length-t.length;this.buffer+=e;const n=this.buffer.indexOf(t,i);if(-1===n)return Promise.resolve();e=this.buffer.slice(n+t.length),this.state=Pt.ReadingEvents}return this.state!==Pt.ReadingEvents||this.jsonTokenizer.write(e)||(this.state=Pt.SkippingTail,this.firstChunk&&this.reportErrorAndCancelLoading(St(yt.malformedTimelineInputWrongJson))),Promise.resolve()}writeBalancedJSON(e){let t,i=e+"]";if(!this.firstChunk){const e=i.indexOf(",");-1!==e&&(i=i.slice(e+1)),i="["+i}try{t=JSON.parse(i)}catch(e){return void this.reportErrorAndCancelLoading(St(yt.malformedTimelineDataS,{PH1:e.toString()}))}if(this.firstChunk&&(this.firstChunk=!1,this.looksLikeAppVersion(t[0])))this.reportErrorAndCancelLoading(St(yt.legacyTimelineFormatIsNot));else try{this.tracingModel.addEvents(t),this.#te(t)}catch(e){this.reportErrorAndCancelLoading(St(yt.malformedTimelineDataS,{PH1:e.toString()}))}}reportErrorAndCancelLoading(e){e&&r.Console.Console.instance().error(e),this.cancel()}looksLikeAppVersion(e){return"string"==typeof e&&-1!==e.indexOf("Chrome")}async close(){this.client&&(await this.client.processingStarted(),await this.finalizeTrace())}isCpuProfile(){return this.state===Pt.LoadingCPUProfileFromFile||this.state===Pt.LoadingCPUProfileFromRecording}async finalizeTrace(){this.state===Pt.LoadingCPUProfileFromFile&&(this.parseCPUProfileFormat(this.buffer),this.buffer=""),this.tracingModel.tracingComplete(),await this.client.loadingComplete(this.#U,this.tracingModel,this.filter,this.isCpuProfile(),null),this.#Q?.()}traceFinalizedForTest(){return this.#ee}parseCPUProfileFormat(e){let t;try{const i=JSON.parse(e);t=d.TimelineJSProfile.TimelineJSProfileProcessor.createFakeTraceFromCpuProfile(i,1,!0)}catch(e){return void this.reportErrorAndCancelLoading(St(yt.malformedCpuProfileFormat))}this.filter=bt.getCpuProfileFilter(),this.tracingModel.addEvents(t),this.#te(t)}#te(e){this.#U=this.#U.concat(e)}}const Ct=5e6;var Pt;!function(e){e.Initial="Initial",e.LookingForEvents="LookingForEvents",e.ReadingEvents="ReadingEvents",e.SkippingTail="SkippingTail",e.LoadingCPUProfileFromFile="LoadingCPUProfileFromFile",e.LoadingCPUProfileFromRecording="LoadingCPUProfileFromRecording"}(Pt||(Pt={}));var kt=Object.freeze({__proto__:null,TimelineLoader:bt,TransferChunkLengthBytes:Ct,get State(){return Pt}});const Et=new CSSStyleSheet;Et.replaceSync('.timeline-minimap .overview-strip{margin-top:2px;justify-content:center}.timeline-minimap .overview-strip .timeline-overview-strip-title{color:var(--sys-color-token-subtle);font-size:10px;font-weight:bold;z-index:100;background-color:var(--sys-color-cdt-base-container);padding:0 4px;position:absolute;top:-2px;right:0}.timeline-minimap #timeline-overview-cpu-activity{flex-basis:20px}.timeline-minimap #timeline-overview-network{flex-basis:8px}.timeline-minimap #timeline-overview-filmstrip{flex-basis:30px}.timeline-minimap #timeline-overview-memory{flex-basis:20px}.timeline-minimap #timeline-overview-network::before,\n.timeline-minimap #timeline-overview-cpu-activity::before{content:"";position:absolute;left:0;right:0;bottom:0;border-bottom:1px solid var(--divider-line);z-index:-200}.timeline-minimap .overview-strip .background{z-index:-10}.timeline-minimap #timeline-overview-responsiveness{flex-basis:5px;margin-top:0!important}.timeline-minimap #timeline-overview-input{flex-basis:6px}.timeline-minimap #timeline-overview-pane{flex:auto;position:relative;overflow:hidden}.timeline-minimap #timeline-overview-container{display:flex;flex-direction:column;flex:none;position:relative;overflow:hidden}.timeline-minimap #timeline-overview-container canvas{width:100%;height:100%}.timeline-minimap .memory-graph-label{position:absolute;right:0;bottom:0;font-size:9px;color:var(--sys-color-token-subtle);white-space:nowrap;padding:0 4px;background-color:var(--sys-color-cdt-base-container)}\n/*# sourceURL=timelineMiniMap.css */\n');class Mt extends(r.ObjectWrapper.eventMixin(h.Widget.VBox)){breadcrumbsActivated=!1;#ie=new s.TimelineOverviewPane.TimelineOverviewPane("timeline");#ne=[];breadcrumbs=null;#re;#ae=null;#L=this.#R.bind(this);constructor(){super(),this.element.classList.add("timeline-minimap"),this.#re=new a.BreadcrumbsUI.BreadcrumbsUI,this.#ie.show(this.element),this.#ie.addEventListener(s.TimelineOverviewPane.Events.OverviewPaneWindowChanged,(e=>{this.#se(e)})),l.Runtime.experiments.isEnabled(l.Runtime.ExperimentName.BREADCRUMBS_PERFORMANCE_PANEL)&&this.#oe(),m.TraceBounds.onChange(this.#L)}#se(e){const t=this.#ae?.traceParsedData;if(!t)return;const n=m.TraceBounds.BoundsManager.instance().state();if(!n)return;const r=e.data.startTime>0?e.data.startTime:n.milli.entireTraceBounds.min,a=Number.isFinite(e.data.endTime)?e.data.endTime:n.milli.entireTraceBounds.max;m.TraceBounds.BoundsManager.instance().setTimelineVisibleWindow(i.Helpers.Timing.traceWindowFromMilliSeconds(i.Types.Timing.MilliSeconds(r),i.Types.Timing.MilliSeconds(a)),{shouldAnimate:!0})}#R(e){"RESET"!==e.updateType&&"VISIBLE_WINDOW"!==e.updateType||this.#ie.setWindowTimes(e.state.milli.timelineTraceWindow.min,e.state.milli.timelineTraceWindow.max),"RESET"!==e.updateType&&"MINIMAP_BOUNDS"!==e.updateType||this.#ie.setBounds(e.state.milli.minimapTraceBounds.min,e.state.milli.minimapTraceBounds.max)}#oe(){this.breadcrumbsActivated=!0,this.element.prepend(this.#re),this.#ie.addEventListener(s.TimelineOverviewPane.Events.OverviewPaneBreadcrumbAdded,(e=>{this.#le(e.data)})),this.#re.addEventListener(a.BreadcrumbsUI.BreadcrumbRemovedEvent.eventName,(e=>{const t=e.breadcrumb;this.#ce(t)})),this.#ie.enableCreateBreadcrumbsButton()}#le({startTime:e,endTime:t}){const n=m.TraceBounds.BoundsManager.instance().state();if(!n)return;const r=n.milli.minimapTraceBounds,s={startTime:i.Types.Timing.MilliSeconds(Math.max(e,r.min)),endTime:i.Types.Timing.MilliSeconds(Math.min(t,r.max))},o=i.Helpers.Timing.traceWindowFromMilliSeconds(s.startTime,s.endTime);m.TraceBounds.BoundsManager.instance().setMiniMapBounds(o),m.TraceBounds.BoundsManager.instance().setTimelineVisibleWindow(o),null===this.breadcrumbs?this.breadcrumbs=new a.Breadcrumbs.Breadcrumbs(o):this.breadcrumbs.add(o),this.#re.data={breadcrumb:this.breadcrumbs.initialBreadcrumb}}#ce(e){const t=i.Helpers.Timing.traceWindowMilliSeconds(e.window);this.breadcrumbs&&(this.breadcrumbs.makeBreadcrumbActive(e),this.#re.data={breadcrumb:this.breadcrumbs.initialBreadcrumb});const n=i.Helpers.Timing.traceWindowFromMilliSeconds(t.min,t.max);m.TraceBounds.BoundsManager.instance().setMiniMapBounds(n),m.TraceBounds.BoundsManager.instance().setTimelineVisibleWindow(n)}wasShown(){super.wasShown(),this.registerCSSFiles([Et])}reset(){this.#ae=null,this.#ie.reset()}#de(e){const t=new Map,{Meta:n,PageLoadMetrics:r}=e,a=n.mainFrameNavigations,s=i.Helpers.Timing.microSecondsToMilliseconds(n.traceBounds.min);for(const e of a){const{startTime:n}=i.Legacy.timesForEventInMilliseconds(e);t.set(n,di.createEventDivider(e,s))}for(const e of r.allMarkerEvents){const{startTime:n}=i.Legacy.timesForEventInMilliseconds(e);t.set(n,di.createEventDivider(e,s))}this.#ie.setMarkers(t)}#he(e){this.#ie.setNavStartTimes(e.Meta.mainFrameNavigations)}getControls(){return this.#ne}setData(e){if(this.#ae?.traceParsedData!==e.traceParsedData){if(this.#ae=e,this.#ne=[],this.#de(e.traceParsedData),this.#he(e.traceParsedData),this.#ne.push(new nt(e.traceParsedData)),this.#ne.push(new it(e.traceParsedData)),this.#ne.push(new et(e.traceParsedData)),e.settings.showScreenshots){const t=i.Extras.FilmStrip.fromTraceData(e.traceParsedData);t.frames.length&&this.#ne.push(new rt(t))}e.settings.showMemory&&this.#ne.push(new at(e.traceParsedData)),this.#ie.setOverviewControls(this.#ne),this.#ie.showingScreenshots=e.settings.showScreenshots}}addInitialBreadcrumb(){this.breadcrumbs=null;const e=m.TraceBounds.BoundsManager.instance().state();e&&this.#le({startTime:e.milli.entireTraceBounds.min,endTime:e.milli.entireTraceBounds.max})}}var Ft=Object.freeze({__proto__:null,TimelineMiniMap:Mt});const Lt=new CSSStyleSheet;Lt.replaceSync('.timeline-toolbar-container{display:flex;flex:none}.timeline-toolbar-container > .toolbar{background-color:var(--sys-color-cdt-base-container);border-bottom:1px solid var(--sys-color-divider)}.timeline-main-toolbar{flex:1 1 auto}.timeline-settings-pane{flex:none;background-color:var(--sys-color-cdt-base-container);border-bottom:1px solid var(--sys-color-divider)}#timeline-overview-panel{flex:none;position:relative;border-bottom:1px solid var(--sys-color-divider)}#timeline-overview-grid{background-color:var(--sys-color-cdt-base-container)}#timeline-overview-grid .timeline-grid-header{height:12px}#timeline-overview-grid .resources-dividers-label-bar{pointer-events:auto;height:12px}#timeline-overview-grid .resources-divider-label{top:1px}.timeline-details-split{flex:auto}.timeline.panel .status-pane-container{z-index:1000;display:flex;align-items:center;pointer-events:none}.timeline.panel .status-pane-container.tinted{background-color:var(--sys-color-cdt-base-container);pointer-events:auto}.popover ul{margin:0;padding:0;list-style-type:none}#memory-graphs-canvas-container{overflow:hidden;flex:auto;position:relative}#memory-counters-graph{flex:auto}#memory-graphs-canvas-container .memory-counter-marker{position:absolute;border-radius:3px;width:5px;height:5px;margin-left:-3px;margin-top:-2px}#memory-graphs-container .timeline-memory-header{flex:0 0 26px;background-color:var(--sys-color-surface2);border-bottom:1px solid var(--sys-color-divider);justify-content:space-between}#memory-graphs-container .timeline-memory-header::after{content:"";background-image:var(--image-file-toolbarResizerVertical);background-repeat:no-repeat;background-position:right center,center;flex:20px 0 0;margin:0 4px}.timeline-memory-toolbar{flex-shrink:1}.memory-counter-value{margin:8px}#counter-values-bar{flex:0 0 20px;border-top:solid 1px var(--sys-color-divider);width:100%;overflow:hidden;line-height:18px}.timeline-details{vertical-align:top}.timeline-details-view{color:var(--sys-color-on-surface);overflow:hidden}.timeline-details-view-body{flex:auto;overflow:auto;position:relative;background-color:var(--sys-color-cdt-base-container);user-select:text}.timeline-details-view-block{flex:none;display:flex;background-color:var(--sys-color-cdt-base-container);flex-direction:column;padding-bottom:5px;border-bottom:1px solid var(--sys-color-divider)}.timeline-details-view-row{padding-left:10px;line-height:20px}.timeline-details-view-block .timeline-details-stack-values{flex-direction:column!important}.timeline-details-chip-title{font-size:13px;padding:8px;display:flex;align-items:center}.timeline-details-view-row-title:not(:empty){color:var(--sys-color-token-subtle);overflow:hidden;padding-right:10px;display:inline-block}.timeline-details-warning{--override-details-warning-background-color:rgb(250 209 209/48%);background-color:var(--override-details-warning-background-color)}.-theme-with-dark-background .timeline-details-warning,\n:host-context(.-theme-with-dark-background) .timeline-details-warning{--override-details-warning-background-color:rgb(87 10 10/48%)}.timeline-details-warning .timeline-details-view-row-title{color:var(--sys-color-error)}.timeline-details-view-row-value{display:inline-block;user-select:text;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;padding:0 3px}.timeline-details-warning .timeline-details-view-row-value{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.timeline-details-view-row-value .stack-preview-container{line-height:11px}.timeline-details-view-pie-chart-wrapper{margin:4px 0}.timeline-details-view-pie-chart{margin-top:5px}.timeline-details-view-row-stack-trace{padding:4px 0;line-height:inherit}.timeline-flamechart{overflow:hidden}.timeline-flamechart-resizer{flex:8px 0 0;background-color:var(--sys-color-surface2);border:1px var(--sys-color-divider);border-style:solid none;display:flex;flex-direction:row;align-items:flex-end;justify-content:center}.timeline-network-resizer-disabled > .timeline-flamechart-resizer{display:none}.timeline-flamechart-resizer::after{content:"...";font-size:14px;margin-bottom:-1px}.timeline-layers-view-properties table{width:100%;border-collapse:collapse}.timeline-layers-view-properties td{border:1px solid var(--sys-color-divider);line-height:22px}.timeline-filmstrip-preview > img{margin-top:5px;max-width:500px;max-height:300px;cursor:pointer;border:1px solid var(--sys-color-divider)}.timeline-tree-view{display:flex;overflow:hidden}.timeline-tree-view .toolbar{background-color:var(--sys-color-cdt-base-container);border-bottom:1px solid var(--sys-color-divider)}.timeline-tree-view .data-grid{border:none;flex:auto}.timeline-tree-view .data-grid .data-container{overflow-y:scroll}.timeline-tree-view .data-grid.data-grid-fits-viewport .corner{display:table-cell}.timeline-tree-view .data-grid table.data{background:var(--sys-color-cdt-base-container)}.timeline-tree-view .data-grid .odd{background-color:var(--sys-color-surface1)}.timeline-tree-view .data-grid tr:hover td:not(.bottom-filler-td){background-color:var(--sys-color-state-hover-on-subtle)}.timeline-tree-view .data-grid td.numeric-column{text-align:right;position:relative}.timeline-tree-view .data-grid div.background-percent-bar{float:right;position:relative;z-index:1}.timeline-tree-view .data-grid span.percent-column{color:var(--sys-color-token-subtle);width:45px;display:inline-block}.timeline-tree-view .data-grid tr.selected span{color:inherit}.timeline-tree-view .data-grid tr.selected{background-color:var(--sys-color-tonal-container)}.timeline-tree-view .data-grid .name-container{display:flex;align-items:center;padding-left:2px}.timeline-tree-view .data-grid .name-container .activity-icon{width:12px;height:12px;border:1px solid var(--divider-line);margin:3px 0}.timeline-tree-view .data-grid .name-container .activity-icon-container{margin-right:3px;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;width:18px;height:18px;overflow:hidden}.timeline-tree-view .data-grid .name-container .activity-warning::after{content:"[deopt]";margin:0 4px;line-height:12px;font-size:10px;color:var(--sys-color-state-disabled)}.timeline-tree-view .data-grid tr.selected .name-container .activity-warning::after{color:var(--sys-color-on-tonal-container)}.timeline-tree-view .data-grid .name-container .activity-link{flex:auto;text-align:right;overflow:hidden;text-overflow:ellipsis;margin-left:5px}.timeline-tree-view .data-grid .background-bar-container{position:absolute;left:3px;right:0}.timeline-tree-view .data-grid .background-bar{float:right;height:18px;background-color:var(--sys-color-surface-yellow);border-bottom:1px solid var(--sys-color-yellow-outline)}.timeline-tree-view .data-grid .selected .background-bar{background-color:var(--app-color-selected-progress-bar);border-bottom:1px solid var(--app-border-selected-progress-bar)}.timeline-tree-view .timeline-details-view-body .full-widget-dimmed-banner{background-color:inherit}.timeline-details .filter-input-field{width:120px}.timeline-tree-view .data-grid thead{height:21px;z-index:2}.timeline-stack-view-header{height:27px;background-color:var(--sys-color-cdt-base-container);padding:6px 10px;color:var(--sys-color-on-surface);white-space:nowrap;border-bottom:1px solid var(--sys-color-divider)}.timeline-landing-page{position:absolute;background-color:var(--sys-color-cdt-base-container);justify-content:center;align-items:center;overflow:auto;font-size:13px;color:var(--sys-color-on-surface-subtle)}@media (forced-colors: active){.timeline-tree-view .data-grid .name-container .activity-icon{forced-color-adjust:none}.timeline-tree-view .data-grid tr.selected span.percent-column,\n  .timeline-tree-view .data-grid tr.selected div.background-percent-bar span,\n  .timeline-tree-view .data-grid tr.selected .name-container .activity-link .devtools-link{color:HighlightText}.timeline-tree-view .data-grid .background-bar,\n  .timeline-tree-view .data-grid tr:hover td:not(.bottom-filler-td){background-color:transparent}.timeline-tree-view .data-grid tr.selected .background-bar{background-color:transparent;border-bottom-color:HighlightText}}.timeline-details-view-row-stack-trace div{white-space:nowrap;text-overflow:ellipsis;line-height:12px}.timeline-details-view-body > div{overflow-y:hidden;overflow-x:auto}.timeline-landing-page > div{max-width:450px;margin:10px}.timeline-details-chip-title > div{width:12px;height:12px;border:1px solid var(--sys-color-divider);display:inline-block;margin-right:4px;content:" "}.timeline-paint-profiler-log-split > div:last-child{background-color:var(--color-background-elevation-1);z-index:0}.timeline-layers-view > div:last-child,\n.timeline-layers-view-properties > div:last-child{background-color:var(--color-background-elevation-1)}.timeline.panel .status-pane-container > div{pointer-events:auto}.timeline-landing-page > div > p{flex:none;white-space:pre-line;line-height:18px}.timeline-tree-view .data-grid .name-container div{flex:none}.status-pane-container > .small-dialog{width:100%;height:100%}.timeline-concurrency-input{width:50px}.timeline-concurrency-hidden{visibility:hidden}devtools-feedback-button{float:right}\n/*# sourceURL=timelinePanel.css */\n');const Rt=Symbol("SelectionRange");class It{startTime;endTime;object;constructor(e,t,i){this.startTime=e,this.endTime=t,this.object=i}static isFrameObject(e){return e instanceof i.Handlers.ModelHandlers.Frames.TimelineFrame}static fromFrame(e){return new It(i.Helpers.Timing.microSecondsToMilliseconds(e.startTime),i.Helpers.Timing.microSecondsToMilliseconds(e.endTime),e)}static isSyntheticNetworkRequestDetailsEventSelection(e){return!(e instanceof i.Legacy.Event)&&(!It.isFrameObject(e)&&!It.isRangeSelection(e)&&(!!i.Legacy.eventIsFromNewEngine(e)&&i.Types.TraceEvents.isSyntheticNetworkRequestDetailsEvent(e)))}static isTraceEventSelection(e){return e instanceof i.Legacy.Event||!It.isFrameObject(e)&&!It.isRangeSelection(e)&&(!i.Types.TraceEvents.isSyntheticNetworkRequestDetailsEvent(e)&&i.Legacy.eventIsFromNewEngine(e))}static fromTraceEvent(e){const{startTime:t,endTime:n}=i.Legacy.timesForEventInMilliseconds(e);return new It(t,i.Types.Timing.MilliSeconds(n||t+1),e)}static isRangeSelection(e){return e===Rt}static fromRange(e,t){return new It(i.Types.Timing.MilliSeconds(e),i.Types.Timing.MilliSeconds(t),Rt)}}var xt=Object.freeze({__proto__:null,TimelineSelection:It});const Dt=new CSSStyleSheet;Dt.replaceSync(".timeline-status-dialog{display:flex;flex-direction:column;padding:16px 16px 12px;align-self:center;background-color:var(--sys-color-cdt-base-container);box-shadow:var(--drop-shadow);border-radius:10px}.status-dialog-line{margin:2px;height:14px;min-height:auto;display:flex;align-items:baseline}.status-dialog-line .label{display:inline-block;width:80px;text-align:right;color:var(--sys-color-on-surface);margin-right:10px}.timeline-status-dialog .progress .indicator-container{display:inline-block;width:200px;height:8px;background-color:var(--sys-color-surface5)}.timeline-status-dialog .progress .indicator{background-color:var(--sys-color-primary);height:100%;width:0;margin:0}.timeline-status-dialog .stop-button{margin-top:8px;height:100%;align-self:flex-end}.timeline-status-dialog .stop-button button{border-radius:12px}.timeline-status-dialog.small-dialog{width:inherit;justify-content:center}.small-dialog > .stop-button{align-self:center;margin-top:20px;height:initial}@media (forced-colors: active){.timeline-status-dialog{border:1px solid canvastext}.timeline-status-dialog .progress .indicator-container{border:1px solid ButtonText;background-color:ButtonFace}.timeline-status-dialog .progress .indicator{forced-color-adjust:none;background-color:ButtonText}}\n/*# sourceURL=timelineStatusDialog.css */\n");const At={frameStart:"Frame Start",drawFrame:"Draw Frame",layout:"Layout",rasterizing:"Rasterizing",drawing:"Drawing",painting:"Painting",system:"System",idle:"Idle"},Nt=e.i18n.registerUIStrings("panels/timeline/UIDevtoolsUtils.ts",At),Bt=e.i18n.getLocalizedString.bind(void 0,Nt);let Ht=null,Ut=null;class Wt{static isUiDevTools(){return"true"===l.Runtime.Runtime.queryParam("uiDevTools")}static categorizeEvents(){if(Ht)return Ht;const e=Vt,t=Wt.categories(),i=t.drawing,n=t.rasterizing,r=t.layout,a=t.painting,s=t.other,o={};return o[e.ViewPaint]=new j("View::Paint",a),o[e.ViewOnPaint]=new j("View::OnPaint",a),o[e.ViewPaintChildren]=new j("View::PaintChildren",a),o[e.ViewOnPaintBackground]=new j("View::OnPaintBackground",a),o[e.ViewOnPaintBorder]=new j("View::OnPaintBorder",a),o[e.LayerPaintContentsToDisplayList]=new j("Layer::PaintContentsToDisplayList",a),o[e.ViewLayout]=new j("View::Layout",r),o[e.ViewLayoutBoundsChanged]=new j("View::Layout(bounds_changed)",r),o[e.RasterTask]=new j("RasterTask",n),o[e.RasterizerTaskImplRunOnWorkerThread]=new j("RasterizerTaskImpl::RunOnWorkerThread",n),o[e.DirectRendererDrawFrame]=new j("DirectRenderer::DrawFrame",i),o[e.BeginFrame]=new j(Bt(At.frameStart),i,!0),o[e.DrawFrame]=new j(Bt(At.drawFrame),i,!0),o[e.NeedsBeginFrameChanged]=new j("NeedsBeginFrameChanged",i,!0),o[e.ThreadControllerImplRunTask]=new j("ThreadControllerImpl::RunTask",s),Ht=o,o}static categories(){return Ut||(Ut={layout:new q("layout",Bt(At.layout),!0,"--app-color-loading-children","--app-color-loading"),rasterizing:new q("rasterizing",Bt(At.rasterizing),!0,"--app-color-children","--app-color-scripting"),drawing:new q("drawing",Bt(At.drawing),!0,"--app-color-rendering-children","--app-color-rendering"),painting:new q("painting",Bt(At.painting),!0,"--app-color-painting-children","--app-color-painting"),other:new q("other",Bt(At.system),!1,"--app-color-system-children","--app-color-system"),idle:new q("idle",Bt(At.idle),!1,"--app-color-idle-children","--app-color-idle")},Ut)}static getMainCategoriesList(){return["idle","drawing","painting","rasterizing","layout","other"]}}var Vt;!function(e){e.ViewPaint="View::Paint",e.ViewOnPaint="View::OnPaint",e.ViewPaintChildren="View::PaintChildren",e.ViewOnPaintBackground="View::OnPaintBackground",e.ViewOnPaintBorder="View::OnPaintBorder",e.ViewLayout="View::Layout",e.ViewLayoutBoundsChanged="View::Layout(bounds_changed)",e.LayerPaintContentsToDisplayList="Layer::PaintContentsToDisplayList",e.DirectRendererDrawFrame="DirectRenderer::DrawFrame",e.RasterTask="RasterTask",e.RasterizerTaskImplRunOnWorkerThread="RasterizerTaskImpl::RunOnWorkerThread",e.BeginFrame="BeginFrame",e.DrawFrame="DrawFrame",e.NeedsBeginFrameChanged="NeedsBeginFrameChanged",e.ThreadControllerImplRunTask="ThreadControllerImpl::RunTask"}(Vt||(Vt={}));var Ot=Object.freeze({__proto__:null,UIDevtoolsUtils:Wt,get RecordType(){return Vt}});class zt extends Je{constructor(e,t,i){super(e,t,i),di.setEventStylesMap(Wt.categorizeEvents()),di.setCategories(Wt.categories()),di.setTimelineMainEventCategories(Wt.getMainCategoriesList())}}var Gt=Object.freeze({__proto__:null,UIDevtoolsController:zt});const _t={dropTimelineFileOrUrlHere:"Drop timeline file or URL here",disableJavascriptSamples:"Disable JavaScript samples",enableAdvancedPaint:"Enable advanced paint instrumentation (slow)",screenshots:"Screenshots",memory:"Memory",clear:"Clear",loadProfile:"Load profile…",saveProfile:"Save profile…",captureScreenshots:"Capture screenshots",showMemoryTimeline:"Show memory timeline",captureSettings:"Capture settings",disablesJavascriptSampling:"Disables JavaScript sampling, reduces overhead when running against mobile devices",capturesAdvancedPaint:"Captures advanced paint instrumentation, introduces significant performance overhead",network:"Network:",cpu:"CPU:",networkConditions:"Network conditions",failedToSaveTimelineSS:"Failed to save timeline: {PH1} ({PH2})",CpuThrottlingIsEnabled:"- CPU throttling is enabled",NetworkThrottlingIsEnabled:"- Network throttling is enabled",HardwareConcurrencyIsEnabled:"- Hardware concurrency override is enabled",SignificantOverheadDueToPaint:"- Significant overhead due to paint instrumentation",JavascriptSamplingIsDisabled:"- JavaScript sampling is disabled",stoppingTimeline:"Stopping timeline…",received:"Received",close:"Close",downloadAfterError:"Download raw trace events",recordingFailed:"Recording failed",profiling:"Profiling…",bufferUsage:"Buffer usage",learnmore:"Learn more",wasd:"WASD",clickTheRecordButtonSOrHitSTo:"Click the record button {PH1} or hit {PH2} to start a new recording.",clickTheReloadButtonSOrHitSTo:"Click the reload button {PH1} or hit {PH2} to record the page load.",afterRecordingSelectAnAreaOf:"After recording, select an area of interest in the overview by dragging. Then, zoom and pan the timeline with the mousewheel or {PH1} keys. {PH2}",loadingProfile:"Loading profile…",processingProfile:"Processing profile…",initializingProfiler:"Initializing profiler…",status:"Status",time:"Time",description:"Description",stop:"Stop",ssec:"{PH1} sec"},jt=e.i18n.registerUIStrings("panels/timeline/TimelinePanel.ts",_t),qt=e.i18n.getLocalizedString.bind(void 0,jt);let Jt,$t;class Xt extends h.Panel.Panel{dropTarget;recordingOptionUIControls;state;recordingPageReload;millisecondsToRecordAfterLoadEvent;toggleRecordAction;recordReloadAction;#me;performanceModel;disableCaptureJSProfileSetting;captureLayersAndPicturesSetting;showScreenshotsSetting;showMemorySetting;panelToolbar;panelRightToolbar;timelinePane;#$=new Mt;statusPaneContainer;flameChart;searchableViewInternal;showSettingsPaneButton;showSettingsPaneSetting;settingsPane;controller;cpuProfiler;clearButton;loadButton;saveButton;statusPane;landingPage;loader;showScreenshotsToolbarCheckbox;showMemoryToolbarCheckbox;networkThrottlingSelect;cpuThrottlingSelect;fileSelectorElement;selection;traceLoadStart;primaryPageTargetPromiseCallback=e=>{};primaryPageTargetPromise=new Promise((e=>{this.primaryPageTargetPromiseCallback=e}));#pe;#ue=-1;#ge=null;#Te=this.#ve.bind(this);constructor(){super("timeline");const e=i.Types.Configuration.DEFAULT;e.experiments.timelineShowAllEvents=l.Runtime.experiments.isEnabled("timelineShowAllEvents"),e.experiments.timelineV8RuntimeCallStats=l.Runtime.experiments.isEnabled("timelineV8RuntimeCallStats"),this.#pe=i.TraceModel.Model.createWithAllHandlers(e),this.element.addEventListener("contextmenu",this.contextMenu.bind(this),!1),this.dropTarget=new h.DropTarget.DropTarget(this.element,[h.DropTarget.Type.File,h.DropTarget.Type.URI],qt(_t.dropTimelineFileOrUrlHere),this.handleDrop.bind(this)),this.recordingOptionUIControls=[],this.state=Kt.Idle,this.recordingPageReload=!1,this.millisecondsToRecordAfterLoadEvent=5e3,this.toggleRecordAction=h.ActionRegistry.ActionRegistry.instance().getAction("timeline.toggle-recording"),this.recordReloadAction=h.ActionRegistry.ActionRegistry.instance().getAction("timeline.record-reload"),this.#me=new mt(this.#$),this.performanceModel=null,this.traceLoadStart=null,this.disableCaptureJSProfileSetting=r.Settings.Settings.instance().createSetting("timelineDisableJSSampling",!1),this.disableCaptureJSProfileSetting.setTitle(qt(_t.disableJavascriptSamples)),this.captureLayersAndPicturesSetting=r.Settings.Settings.instance().createSetting("timelineCaptureLayersAndPictures",!1),this.captureLayersAndPicturesSetting.setTitle(qt(_t.enableAdvancedPaint)),this.showScreenshotsSetting=r.Settings.Settings.instance().createSetting("timelineShowScreenshots",!$t),this.showScreenshotsSetting.setTitle(qt(_t.screenshots)),this.showScreenshotsSetting.addChangeListener(this.updateOverviewControls,this),this.showMemorySetting=r.Settings.Settings.instance().createSetting("timelineShowMemory",!1),this.showMemorySetting.setTitle(qt(_t.memory)),this.showMemorySetting.addChangeListener(this.onModeChanged,this);const t=this.element.createChild("div","timeline-toolbar-container");this.panelToolbar=new h.Toolbar.Toolbar("timeline-main-toolbar",t),this.panelToolbar.makeWrappable(!0),this.panelRightToolbar=new h.Toolbar.Toolbar("",t),$t||(this.createSettingsPane(),this.updateShowSettingsToolbarButton()),this.timelinePane=new h.Widget.VBox,this.timelinePane.show(this.element);const a=this.timelinePane.element.createChild("div","hbox");if(a.id="timeline-overview-panel",this.#$.show(a),this.statusPaneContainer=this.timelinePane.element.createChild("div","status-pane-container fill"),this.createFileSelector(),n.TargetManager.TargetManager.instance().addModelListener(n.ResourceTreeModel.ResourceTreeModel,n.ResourceTreeModel.Events.Load,this.loadEventFired,this),this.flameChart=new dn(this),this.searchableViewInternal=new h.SearchableView.SearchableView(this.flameChart,null),this.searchableViewInternal.setMinimumSize(0,100),this.searchableViewInternal.element.classList.add("searchable-view"),this.searchableViewInternal.show(this.timelinePane.element),this.flameChart.show(this.searchableViewInternal.element),this.flameChart.setSearchableView(this.searchableViewInternal),this.searchableViewInternal.hideWidget(),this.onModeChanged(),this.populateToolbar(),this.showLandingPage(),this.updateTimelineControls(),n.TargetManager.TargetManager.instance().addEventListener(n.TargetManager.Events.SuspendStateChanged,this.onSuspendStateChanged,this),l.Runtime.experiments.isEnabled("timelineAsConsoleProfileResultPanel")){const e=n.TargetManager.TargetManager.instance().models(n.CPUProfilerModel.CPUProfilerModel);for(const t of e)for(const e of t.registeredConsoleProfileMessages)this.consoleProfileFinished(e);n.TargetManager.TargetManager.instance().observeModels(n.CPUProfilerModel.CPUProfilerModel,{modelAdded:e=>{e.addEventListener(n.CPUProfilerModel.Events.ConsoleProfileFinished,(e=>this.consoleProfileFinished(e.data)))},modelRemoved:e=>{}})}n.TargetManager.TargetManager.instance().observeTargets({targetAdded:e=>{e===n.TargetManager.TargetManager.instance().primaryPageTarget()&&this.primaryPageTargetPromiseCallback(e)},targetRemoved:e=>{}})}static instance(e={forceNew:null,isNode:!1}){const{forceNew:t,isNode:i}=e;return $t=i,Jt&&!t||(Jt=new Xt),Jt}searchableView(){return this.searchableViewInternal}wasShown(){super.wasShown(),h.Context.Context.instance().setFlavor(Xt,this),this.registerCSSFiles([Lt]),T.userMetrics.panelLoaded("timeline","DevTools.Launch.Timeline")}willHide(){h.Context.Context.instance().setFlavor(Xt,null),this.#me.cancelIfShowing()}loadFromEvents(e){this.state===Kt.Idle&&(this.prepareToLoadTimeline(),this.loader=bt.loadFromEvents(e,this))}getFlameChart(){return this.flameChart}loadFromCpuProfile(e,t){this.state===Kt.Idle&&(this.prepareToLoadTimeline(),this.loader=bt.loadFromCpuProfile(e,this,t))}setState(e){this.state=e,this.updateTimelineControls()}createSettingCheckbox(e,t){const i=new h.Toolbar.ToolbarSettingCheckbox(e,t);return this.recordingOptionUIControls.push(i),i}populateToolbar(){this.panelToolbar.appendToolbarItem(h.Toolbar.Toolbar.createActionButton(this.toggleRecordAction)),this.panelToolbar.appendToolbarItem(h.Toolbar.Toolbar.createActionButton(this.recordReloadAction)),this.clearButton=new h.Toolbar.ToolbarButton(qt(_t.clear),"clear"),this.clearButton.addEventListener(h.Toolbar.ToolbarButton.Events.Click,(()=>this.onClearButton())),this.panelToolbar.appendToolbarItem(this.clearButton),this.loadButton=new h.Toolbar.ToolbarButton(qt(_t.loadProfile),"import"),this.loadButton.addEventListener(h.Toolbar.ToolbarButton.Events.Click,(()=>{T.userMetrics.actionTaken(T.UserMetrics.Action.PerfPanelTraceImported),this.selectFileToLoad()})),this.saveButton=new h.Toolbar.ToolbarButton(qt(_t.saveProfile),"download"),this.saveButton.addEventListener(h.Toolbar.ToolbarButton.Events.Click,(e=>{T.userMetrics.actionTaken(T.UserMetrics.Action.PerfPanelTraceExported),this.saveToFile()})),this.panelToolbar.appendSeparator(),this.panelToolbar.appendToolbarItem(this.loadButton),this.panelToolbar.appendToolbarItem(this.saveButton),this.panelToolbar.appendSeparator(),this.panelToolbar.appendToolbarItem(this.#me.button()),this.panelToolbar.registerCSSFiles([He]),this.panelToolbar.appendSeparator(),this.panelToolbar.appendSeparator(),$t||(this.showScreenshotsToolbarCheckbox=this.createSettingCheckbox(this.showScreenshotsSetting,qt(_t.captureScreenshots)),this.panelToolbar.appendToolbarItem(this.showScreenshotsToolbarCheckbox)),this.showMemoryToolbarCheckbox=this.createSettingCheckbox(this.showMemorySetting,qt(_t.showMemoryTimeline)),this.panelToolbar.appendToolbarItem(this.showMemoryToolbarCheckbox),this.panelToolbar.appendToolbarItem(h.Toolbar.Toolbar.createActionButtonForId("components.collect-garbage")),$t||(this.panelRightToolbar.appendSeparator(),this.panelRightToolbar.appendToolbarItem(this.showSettingsPaneButton))}createSettingsPane(){this.showSettingsPaneSetting=r.Settings.Settings.instance().createSetting("timelineShowSettingsToolbar",!1),this.showSettingsPaneButton=new h.Toolbar.ToolbarSettingToggle(this.showSettingsPaneSetting,"gear",qt(_t.captureSettings),"gear-filled"),n.NetworkManager.MultitargetNetworkManager.instance().addEventListener(n.NetworkManager.MultitargetNetworkManager.Events.ConditionsChanged,this.updateShowSettingsToolbarButton,this),n.CPUThrottlingManager.CPUThrottlingManager.instance().addEventListener(n.CPUThrottlingManager.Events.RateChanged,this.updateShowSettingsToolbarButton,this),n.CPUThrottlingManager.CPUThrottlingManager.instance().addEventListener(n.CPUThrottlingManager.Events.HardwareConcurrencyChanged,this.updateShowSettingsToolbarButton,this),this.disableCaptureJSProfileSetting.addChangeListener(this.updateShowSettingsToolbarButton,this),this.captureLayersAndPicturesSetting.addChangeListener(this.updateShowSettingsToolbarButton,this),this.settingsPane=new h.Widget.HBox,this.settingsPane.element.classList.add("timeline-settings-pane"),this.settingsPane.show(this.element);const e=new h.Toolbar.Toolbar("",this.settingsPane.element);e.element.classList.add("flex-auto"),e.makeVertical(),e.appendToolbarItem(this.createSettingCheckbox(this.disableCaptureJSProfileSetting,qt(_t.disablesJavascriptSampling))),e.appendToolbarItem(this.createSettingCheckbox(this.captureLayersAndPicturesSetting,qt(_t.capturesAdvancedPaint)));const t=new h.Widget.VBox;t.element.classList.add("flex-auto"),t.show(this.settingsPane.element);const i=new h.Toolbar.Toolbar("",t.element);i.appendText(qt(_t.cpu)),this.cpuThrottlingSelect=y.ThrottlingManager.throttlingManager().createCPUThrottlingSelector(),i.appendToolbarItem(this.cpuThrottlingSelect);const a=new h.Toolbar.Toolbar("",t.element);a.appendText(qt(_t.network)),this.networkThrottlingSelect=this.createNetworkConditionsSelect(),a.appendToolbarItem(this.networkThrottlingSelect);const s=new h.Widget.VBox;s.element.classList.add("flex-auto"),s.show(this.settingsPane.element);const{toggle:o,input:l,reset:c,warning:d}=y.ThrottlingManager.throttlingManager().createHardwareConcurrencySelector(),m=new h.Toolbar.Toolbar("",s.element);m.registerCSSFiles([Lt]),l.element.classList.add("timeline-concurrency-input"),m.appendToolbarItem(o),m.appendToolbarItem(l),m.appendToolbarItem(c),m.appendToolbarItem(d),this.showSettingsPaneSetting.addChangeListener(this.updateSettingsPaneVisibility.bind(this)),this.updateSettingsPaneVisibility()}createNetworkConditionsSelect(){const e=new h.Toolbar.ToolbarComboBox(null,qt(_t.networkConditions));return e.setMaxWidth(140),y.ThrottlingManager.throttlingManager().decorateSelectWithNetworkThrottling(e.selectElement()),e}prepareToLoadTimeline(){console.assert(this.state===Kt.Idle),this.setState(Kt.Loading),this.performanceModel&&(this.performanceModel=null)}createFileSelector(){this.fileSelectorElement&&this.fileSelectorElement.remove(),this.fileSelectorElement=h.UIUtils.createFileSelectorElement(this.loadFromFile.bind(this)),this.timelinePane.element.appendChild(this.fileSelectorElement)}contextMenu(e){const t=new h.ContextMenu.ContextMenu(e);t.appendItemsAtLocation("timelineMenu"),t.show()}async saveToFile(){if(this.state!==Kt.Idle)return;if(!this.performanceModel)return;const e=this.#pe.traceEvents(this.#ue),t=this.#pe.metadata(this.#ue);if(!e)return;const i=o.DateUtilities.toISO8601Compact(new Date);let n;n="CPUProfile"===t?.dataOrigin?`CPU-${i}.cpuprofile`:`Trace-${i}.json`;try{let i;if("CPUProfile"===t?.dataOrigin){const t=e.find((e=>"CpuProfile"===e.name));if(!t||!t.args?.data)return;const n=t.args?.data;if(n.hasOwnProperty("cpuProfile")){i=ze(n.cpuProfile)}}else{const n=Oe(e,t);i=Array.from(n).join("")}if(!i)throw new Error("Trace content empty");await v.FileManager.FileManager.instance().save(n,i,!0),v.FileManager.FileManager.instance().close(n)}catch(e){if(console.error(e.stack),"AbortError"===e.name)return;r.Console.Console.instance().error(qt(_t.failedToSaveTimelineSS,{PH1:e.message,PH2:e.name}))}}async showHistory(){const e=await this.#me.showHistoryDropDown();e&&e.traceParseDataIndex!==this.#ue&&this.setModel(e.legacyModel,null,e.traceParseDataIndex)}navigateHistory(e){const t=this.#me.navigate(e);return t&&t.traceParseDataIndex!==this.#ue&&this.setModel(t.legacyModel,null,t.traceParseDataIndex),!0}selectFileToLoad(){this.fileSelectorElement&&this.fileSelectorElement.click()}async loadFromFile(e){this.state===Kt.Idle&&(this.prepareToLoadTimeline(),this.loader=await bt.loadFromFile(e,this),this.createFileSelector())}async loadFromURL(e){this.state===Kt.Idle&&(this.prepareToLoadTimeline(),this.loader=await bt.loadFromURL(e,this))}updateOverviewControls(){const e=this.#pe.traceParsedData(this.#ue),t="CPUProfile"===this.#pe.metadata(this.#ue)?.dataOrigin;e&&this.#$.setData({traceParsedData:e,isCpuProfile:t,settings:{showScreenshots:this.showScreenshotsSetting.get(),showMemory:this.showMemorySetting.get()}})}onModeChanged(){this.updateOverviewControls(),this.doResize(),this.select(null)}updateSettingsPaneVisibility(){$t||(this.showSettingsPaneSetting.get()?this.settingsPane.showWidget():this.settingsPane.hideWidget())}updateShowSettingsToolbarButton(){const e=[];if(1!==n.CPUThrottlingManager.CPUThrottlingManager.instance().cpuThrottlingRate()&&e.push(qt(_t.CpuThrottlingIsEnabled)),y.ThrottlingManager.throttlingManager().hardwareConcurrencyOverrideEnabled&&e.push(qt(_t.HardwareConcurrencyIsEnabled)),n.NetworkManager.MultitargetNetworkManager.instance().isThrottling()&&e.push(qt(_t.NetworkThrottlingIsEnabled)),this.captureLayersAndPicturesSetting.get()&&e.push(qt(_t.SignificantOverheadDueToPaint)),this.disableCaptureJSProfileSetting.get()&&e.push(qt(_t.JavascriptSamplingIsDisabled)),this.showSettingsPaneButton.setDefaultWithRedColor(e.length>0),this.showSettingsPaneButton.setToggleWithRedColor(e.length>0),e.length){const t=document.createElement("div");e.forEach((e=>{t.createChild("div").textContent=e})),this.showSettingsPaneButton.setTitle(t.textContent||"")}else this.showSettingsPaneButton.setTitle(qt(_t.captureSettings))}setUIControlsEnabled(e){this.recordingOptionUIControls.forEach((t=>t.setEnabled(e)))}async#fe(){if(!this.controller)return o.DevToolsPath.EmptyUrlString;const e=this.controller.primaryPageTarget.inspectedURL(),t=this.controller.primaryPageTarget.model(n.ResourceTreeModel.ResourceTreeModel),i=t&&await t.navigationHistory();if(!t||!i)return e;const{currentIndex:r,entries:a}=i;return a[r].url}async#ye(){const e=new Promise((async(e,t)=>{if(!this.controller)return void t("Could not find TimelineController");const i=this.controller.primaryPageTarget.model(n.ResourceTreeModel.ResourceTreeModel);i?(i.addEventListener(n.ResourceTreeModel.Events.FrameNavigated,(function r(a){"about:blank"===a.data.url?e():t(`Unexpected navigation to ${a.data.url}`),i?.removeEventListener(n.ResourceTreeModel.Events.FrameNavigated,r)})),await i.navigate("about:blank")):t("Could not load resourceModel")}));await e}async#we(){try{const e=n.TargetManager.TargetManager.instance().targets().find((e=>e.type()===n.Target.Type.Node));if(!e)throw new Error("Could not load any Node target.");if(e&&(this.cpuProfiler=e.model(n.CPUProfilerModel.CPUProfilerModel)),this.setUIControlsEnabled(!1),this.hideLandingPage(),!this.cpuProfiler)throw new Error("No Node target is found.");await n.TargetManager.TargetManager.instance().suspendAllTargets("performance-timeline"),await this.cpuProfiler.startRecording(),this.recordingStarted()}catch(e){await this.recordingFailed(e.message)}}async#Se(){try{const e=n.TargetManager.TargetManager.instance().rootTarget(),t=n.TargetManager.TargetManager.instance().primaryPageTarget();if(!t)throw new Error("Could not load primary page target.");if(!e)throw new Error("Could not load root target.");if(Wt.isUiDevTools()?this.controller=new zt(e,t,this):this.controller=new Je(e,t,this),this.setUIControlsEnabled(!1),this.hideLandingPage(),!this.controller)throw new Error("Could not create Timeline controller");const i=await this.#fe();this.recordingPageReload&&await this.#ye();const r={enableJSSampling:!this.disableCaptureJSProfileSetting.get(),capturePictures:this.captureLayersAndPicturesSetting.get(),captureFilmStrip:this.showScreenshotsSetting.get()},a=await this.controller.startRecording(r);if(a.getError())throw new Error(a.getError());const s=this.recordingPageReload?{navigateToUrl:i}:void 0;this.recordingStarted(s)}catch(e){await this.recordingFailed(e.message)}}async startRecording(){console.assert(!this.statusPane,"Status pane is already opened."),this.setState(Kt.StartPending),this.showRecordingStarted(),$t?await this.#we():await this.#Se()}async stopRecording(){if(this.statusPane&&(this.statusPane.finish(),this.statusPane.updateStatus(qt(_t.stoppingTimeline)),this.statusPane.updateProgressBar(qt(_t.received),0)),this.setState(Kt.StopPending),this.controller)return this.performanceModel=this.controller.getPerformanceModel(),await this.controller.stopRecording(),this.setUIControlsEnabled(!0),await this.controller.dispose(),void(this.controller=null);if(this.cpuProfiler){const e=await this.cpuProfiler.stopRecording();this.setState(Kt.Idle),this.loadFromCpuProfile(e),this.setUIControlsEnabled(!0),this.cpuProfiler=null,await n.TargetManager.TargetManager.instance().resumeAllTargets()}}async recordingFailed(e,t){this.statusPane&&this.statusPane.remove(),this.statusPane=new Yt({description:e,buttonText:qt(_t.close),buttonDisabled:!1,showProgress:void 0,showTimer:void 0},(async()=>{this.statusPane?.remove(),await this.loadingComplete([],null,null,!1,null)})),this.statusPane.showPane(this.statusPaneContainer),this.statusPane.updateStatus(qt(_t.recordingFailed)),t&&this.statusPane.enableDownloadOfEvents(t),this.setState(Kt.RecordingFailed),this.performanceModel=null,this.traceLoadStart=null,this.setUIControlsEnabled(!0),this.controller&&(await this.controller.dispose(),this.controller=null),n.TargetManager.TargetManager.instance().resumeAllTargets()}onSuspendStateChanged(){this.updateTimelineControls()}consoleProfileFinished(e){this.loadFromCpuProfile(e.cpuProfile,e.title),h.InspectorView.InspectorView.instance().showPanel("timeline")}updateTimelineControls(){const e=Kt;this.toggleRecordAction.setToggled(this.state===e.Recording),this.toggleRecordAction.setEnabled(this.state===e.Recording||this.state===e.Idle),this.recordReloadAction.setEnabled(!$t&&this.state===e.Idle),this.#me.setEnabled(this.state===e.Idle),this.clearButton.setEnabled(this.state===e.Idle),this.panelToolbar.setEnabled(this.state!==e.Loading),this.panelRightToolbar.setEnabled(this.state!==e.Loading),this.dropTarget.setEnabled(this.state===e.Idle),this.loadButton.setEnabled(this.state===e.Idle),this.saveButton.setEnabled(this.state===e.Idle&&Boolean(this.performanceModel))}async toggleRecording(){this.state===Kt.Idle?(this.recordingPageReload=!1,await this.startRecording(),T.userMetrics.actionTaken(T.UserMetrics.Action.TimelineStarted)):this.state===Kt.Recording&&await this.stopRecording()}recordReload(){this.state===Kt.Idle&&(this.recordingPageReload=!0,this.startRecording(),T.userMetrics.actionTaken(T.UserMetrics.Action.TimelinePageReloadStarted))}onClearButton(){this.#me.clear(),this.clear()}clear(){this.statusPane&&this.statusPane.remove(),this.showLandingPage(),this.reset()}reset(){s.LineLevelProfile.Performance.instance().reset(),this.#ge&&(this.#ge.removeEventListener(De.eventName,this.#Te),this.#ge.uninstall(),this.#ge=null),this.setModel(null)}#be(e,t=null){if(e||l.Runtime.experiments.isEnabled("timelineShowAllEvents"))return;const i=t?[t]:[di.visibleEventsFilter()];we.instance().setFilters(i)}applyFilters(e,t=null){this.#be(!1,t)}setModel(e,t=null,r=-1){this.performanceModel=e,this.#ue=r;const a=this.#pe.traceParsedData(this.#ue),o="CPUProfile"===this.#pe.metadata(this.#ue)?.dataOrigin;if(this.#$.reset(),a&&(m.TraceBounds.BoundsManager.instance().resetWithNewBounds(a.Meta.traceBounds),this.#be(a.Meta.traceIsGeneric,t)),e?this.searchableViewInternal.showWidget():this.searchableViewInternal.hideWidget(),this.flameChart.setModel(e,a,o),this.flameChart.setSelection(null),s.LineLevelProfile.Performance.instance().reset(),a&&a.Samples.profilesInProcess.size){const e=n.TargetManager.TargetManager.instance().rootTarget(),t=Array.from(a.Samples.profilesInProcess).flatMap((([e,t])=>Array.from(t.values()).map((e=>e.parsedProfile))));for(const i of t)s.LineLevelProfile.Performance.instance().appendCPUProfile(i,e)}if(this.updateOverviewControls(),this.flameChart&&this.flameChart.resizeToPreferredHeights(),this.#$.breadcrumbsActivated)this.#$.addInitialBreadcrumb();else if(a){const e=["MAIN_THREAD","CPU_PROFILE"],t=i.Handlers.Threads.threadsInTrace(a).filter((t=>e.includes(t.type))).at(-1);if(t){const e=i.Extras.MainThreadActivity.calculateWindow(a.Meta.traceBounds,t.entries);m.TraceBounds.BoundsManager.instance().setTimelineVisibleWindow(e)}}this.updateTimelineControls()}recordingStarted(e){if(e&&this.recordingPageReload&&this.controller){const t=this.controller?.primaryPageTarget.model(n.ResourceTreeModel.ResourceTreeModel);if(!t)return void this.recordingFailed("Could not navigate to original URL");t.navigate(e.navigateToUrl)}this.reset(),this.setState(Kt.Recording),this.showRecordingStarted(),this.statusPane&&(this.statusPane.enableAndFocusButton(),this.statusPane.updateStatus(qt(_t.profiling)),this.statusPane.updateProgressBar(qt(_t.bufferUsage),0),this.statusPane.startTimer()),this.hideLandingPage()}recordingProgress(e){this.statusPane&&this.statusPane.updateProgressBar(qt(_t.bufferUsage),100*e)}showLandingPage(){if(this.updateSettingsPaneVisibility(),this.landingPage)return void this.landingPage.show(this.statusPaneContainer);function t(e,t){const i=document.createElement(e);return i.textContent=t,i}const i=h.XLink.XLink.create("https://developer.chrome.com/docs/devtools/evaluate-performance/",qt(_t.learnmore),void 0,void 0,"learn-more"),n=t("b",h.ShortcutRegistry.ShortcutRegistry.instance().shortcutsForAction("timeline.toggle-recording")[0].title()),r=t("b",h.ShortcutRegistry.ShortcutRegistry.instance().shortcutsForAction("timeline.record-reload")[0].title()),a=t("b",qt(_t.wasd));this.landingPage=new h.Widget.VBox,this.landingPage.contentElement.classList.add("timeline-landing-page","fill");const s=this.landingPage.contentElement.createChild("div"),o=h.UIUtils.createInlineButton(h.Toolbar.Toolbar.createActionButton(this.toggleRecordAction)),l=h.UIUtils.createInlineButton(h.Toolbar.Toolbar.createActionButtonForId("timeline.record-reload"));if(s.createChild("p").appendChild(e.i18n.getFormatLocalizedString(jt,_t.clickTheRecordButtonSOrHitSTo,{PH1:o,PH2:n})),s.createChild("p").appendChild(e.i18n.getFormatLocalizedString(jt,_t.clickTheReloadButtonSOrHitSTo,{PH1:l,PH2:r})),s.createChild("p").appendChild(e.i18n.getFormatLocalizedString(jt,_t.afterRecordingSelectAnAreaOf,{PH1:a,PH2:i})),$t){const e=new f.PanelFeedback.PanelFeedback;e.data={feedbackUrl:"https://crbug.com/1354548",quickStartUrl:"https://goo.gle/js-profiler-deprecation",quickStartLinkText:qt(_t.learnmore)},s.appendChild(e);const t=new f.FeedbackButton.FeedbackButton;t.data={feedbackUrl:"https://crbug.com/1354548"},s.appendChild(t)}this.landingPage.show(this.statusPaneContainer)}hideLandingPage(){this.landingPage.detach(),this.showSettingsPaneButton?.setToggled(!1),this.settingsPane?.hideWidget()}async loadingStarted(){this.hideLandingPage(),this.statusPane&&this.statusPane.remove(),this.statusPane=new Yt({showProgress:!0,showTimer:void 0,buttonDisabled:void 0,buttonText:void 0,description:void 0},(()=>this.cancelLoading())),this.statusPane.showPane(this.statusPaneContainer),this.statusPane.updateStatus(qt(_t.loadingProfile)),this.loader||this.statusPane.finish(),this.traceLoadStart=i.Types.Timing.MilliSeconds(performance.now()),await this.loadingProgress(0)}async loadingProgress(e){"number"==typeof e&&this.statusPane&&this.statusPane.updateProgressBar(qt(_t.received),100*e)}async processingStarted(){this.statusPane&&this.statusPane.updateStatus(qt(_t.processingProfile))}#ve(){this.flameChart.updateColorMapper()}async loadingComplete(e,t,n=null,r,a){this.#pe.resetProcessor(),Ne.clearResolvedNodeNames(),delete this.loader;const s=this.state===Kt.StopPending;if(this.setState(Kt.Idle),t){this.performanceModel||(this.performanceModel=new Ue);try{await Promise.all([this.performanceModel.setTracingModel(t,s),this.#Ce(e,s,r,a)]),this.#ue=this.#pe.size()-1,this.setModel(this.performanceModel,n,this.#ue),this.statusPane&&this.statusPane.remove(),this.statusPane=null;const o=this.#pe.traceParsedData(this.#ue);if(!o)throw new Error(`Could not get trace data at index ${this.#ue}`);this.#ge=new Ne(o),this.#ge.addEventListener(De.eventName,this.#Te),await this.#ge.install(),this.#me.addRecording({data:{legacyModel:this.performanceModel,traceParseDataIndex:this.#ue},filmStripForPreview:i.Extras.FilmStrip.fromTraceData(o),traceParsedData:o,startTime:a??null})}catch(e){let i;try{i=t.allRawEvents()}catch{}this.recordingFailed(e.message,i),console.error(e)}finally{this.recordTraceLoadMetric()}}else this.clear()}recordTraceLoadMetric(){if(!this.traceLoadStart)return;const e=this.traceLoadStart;requestAnimationFrame((()=>{setTimeout((()=>{const t=i.Types.Timing.MilliSeconds(performance.now()),n=performance.measure("TraceLoad",{start:e,end:t}),r=i.Types.Timing.MilliSeconds(n.duration);this.element.dispatchEvent(new B(r)),T.userMetrics.performanceTraceLoad(n)}),0)}))}async#Ce(e,t,n,r){const a=t&&!n?await i.Extras.Metadata.forNewRecording(r??void 0):{};return a.dataOrigin=n?"CPUProfile":"TraceEvents",this.#pe.parse(e,{metadata:a,isFreshRecording:t})}loadingCompleteForTest(){}showRecordingStarted(){this.statusPane&&this.statusPane.remove(),this.statusPane=new Yt({showTimer:!0,showProgress:!0,buttonDisabled:!0,description:void 0,buttonText:void 0},(()=>this.stopRecording())),this.statusPane.showPane(this.statusPaneContainer),this.statusPane.updateStatus(qt(_t.initializingProfiler))}cancelLoading(){this.loader&&this.loader.cancel()}async loadEventFired(e){if(this.state!==Kt.Recording||!this.recordingPageReload||!this.controller||this.controller.primaryPageTarget!==e.data.resourceTreeModel.target())return;const t=this.controller;await new Promise((e=>window.setTimeout(e,this.millisecondsToRecordAfterLoadEvent))),t===this.controller&&this.state===Kt.Recording&&this.stopRecording()}frameForSelection(e){if(It.isFrameObject(e.object))return e.object;if(It.isRangeSelection(e.object)||It.isSyntheticNetworkRequestDetailsEventSelection(e.object))return null;if(It.isTraceEventSelection(e.object)){if(!this.performanceModel)return null;const t=this.#pe.traceParsedData(this.#ue);if(!t)return null;const n=i.Helpers.Timing.millisecondsToMicroseconds(e.endTime);return i.Handlers.ModelHandlers.Frames.framesWithinWindow(t.Frames.frames,n,n).at(0)||null}return console.assert(!1,"Should never be reached"),null}jumpToFrame(e){const t=this.selection&&this.frameForSelection(this.selection);if(!t)return;const n=this.#pe.traceParsedData(this.#ue);if(!n)return;let r=n.Frames.frames.indexOf(t);console.assert(r>=0,"Can't find current frame in the frame list"),r=o.NumberUtilities.clamp(r+e,0,n.Frames.frames.length-1);const a=n.Frames.frames[r];return this.#Pe(i.Helpers.Timing.microSecondsToMilliseconds(a.startTime),i.Helpers.Timing.microSecondsToMilliseconds(a.endTime)),this.select(It.fromFrame(a)),!0}select(e){this.selection=e,this.flameChart.setSelection(e)}selectEntryAtTime(e,t){if(e)if(0!==e.length){for(let n=o.ArrayUtilities.upperBound(e,t,((e,t)=>e-t.ts))-1;n>=0;--n){const r=e[n],{endTime:a}=i.Helpers.Timing.eventTimingsMilliSeconds(r);if(i.Legacy.TracingModel.isTopLevelEvent(r)&&a<t)break;if(we.instance().isVisible(r)&&a>=t)return void this.select(It.fromTraceEvent(r))}this.select(null)}else this.select(null)}highlightEvent(e){this.flameChart.highlightEvent(e)}#Pe(e,t){const n=m.TraceBounds.BoundsManager.instance().state();if(!n)return;const r=n.milli.timelineTraceWindow;let a=0;r.max<t?a=t-r.max:r.min>e&&(a=e-r.min),m.TraceBounds.BoundsManager.instance().setTimelineVisibleWindow(i.Helpers.Timing.traceWindowFromMilliSeconds(i.Types.Timing.MilliSeconds(r.min+a),i.Types.Timing.MilliSeconds(r.max+a)),{shouldAnimate:!0})}handleDrop(e){const t=e.items;if(!t.length)return;const i=t[0];if(T.userMetrics.actionTaken(T.UserMetrics.Action.PerfPanelTraceImported),"string"===i.kind){const t=e.getData("text/uri-list");new r.ParsedURL.ParsedURL(t).isValid&&this.loadFromURL(t)}else if("file"===i.kind){const e=t[0].getAsFile();if(!e)return;this.loadFromFile(e)}}}var Kt;!function(e){e.Idle="Idle",e.StartPending="StartPending",e.Recording="Recording",e.StopPending="StopPending",e.Loading="Loading",e.RecordingFailed="RecordingFailed"}(Kt||(Kt={}));class Yt extends h.Widget.VBox{status;time;progressLabel;progressBar;description;button;downloadTraceButton;startTime;timeUpdateTimer;#ke;constructor(e,t){super(!0),this.contentElement.classList.add("timeline-status-dialog");const i=this.contentElement.createChild("div","status-dialog-line status");if(i.createChild("div","label").textContent=qt(_t.status),this.status=i.createChild("div","content"),h.ARIAUtils.markAsStatus(this.status),e.showTimer){const e=this.contentElement.createChild("div","status-dialog-line time");e.createChild("div","label").textContent=qt(_t.time),this.time=e.createChild("div","content")}if(e.showProgress){const e=this.contentElement.createChild("div","status-dialog-line progress");this.progressLabel=e.createChild("div","label"),this.progressBar=e.createChild("div","indicator-container").createChild("div","indicator"),h.ARIAUtils.markAsProgressBar(this.progressBar)}if("string"==typeof e.description){const t=this.contentElement.createChild("div","status-dialog-line description");t.createChild("div","label").textContent=qt(_t.description),this.description=t.createChild("div","content"),this.description.innerText=e.description}const n=this.contentElement.createChild("div","stop-button");this.downloadTraceButton=h.UIUtils.createTextButton(qt(_t.downloadAfterError),(async()=>{this.#Ee()})),this.downloadTraceButton.disabled=!0,this.downloadTraceButton.style.visibility="hidden";const r=e.buttonText||qt(_t.stop);this.button=h.UIUtils.createTextButton(r,t,"",!0),this.button.disabled=!1==!e.buttonDisabled,n.append(this.downloadTraceButton),n.append(this.button)}finish(){this.stopTimer(),this.button.disabled=!0}async#Ee(){if(!this.#ke||0===this.#ke.length)return;const e=`Trace-Load-Error-${o.DateUtilities.toISO8601Compact(new Date)}.json`,t=Oe(this.#ke,{}),i=Array.from(t).join("");await v.FileManager.FileManager.instance().save(e,i,!0),v.FileManager.FileManager.instance().close(e)}enableDownloadOfEvents(e){this.#ke=e,this.downloadTraceButton.disabled=!1,this.downloadTraceButton.style.visibility="visible"}remove(){this.element.parentNode&&(this.element.parentNode.classList.remove("tinted"),this.arrangeDialog(this.element.parentNode)),this.stopTimer(),this.element.remove()}showPane(e){this.arrangeDialog(e),this.show(e),e.classList.add("tinted")}enableAndFocusButton(){this.button.disabled=!1,this.button.focus()}updateStatus(e){this.status.textContent=e}updateProgressBar(e,t){this.progressLabel.textContent=e,this.progressBar.style.width=t.toFixed(1)+"%",h.ARIAUtils.setValueNow(this.progressBar,t),this.updateTimer()}startTimer(){this.startTime=Date.now(),this.timeUpdateTimer=window.setInterval(this.updateTimer.bind(this,!1),1e3),this.updateTimer()}stopTimer(){this.timeUpdateTimer&&(clearInterval(this.timeUpdateTimer),this.updateTimer(!0),delete this.timeUpdateTimer)}updateTimer(e){if(this.arrangeDialog(this.element.parentNode),!this.timeUpdateTimer||!this.time)return;const t=(Date.now()-this.startTime)/1e3;this.time.textContent=qt(_t.ssec,{PH1:t.toFixed(e?1:0)})}arrangeDialog(e){const t=e.clientWidth<325;this.element.classList.toggle("small-dialog",t),this.contentElement.classList.toggle("small-dialog",t)}wasShown(){super.wasShown(),this.registerCSSFiles([Dt])}}let Zt;class Qt{static instance(e={forceNew:null}){const{forceNew:t}=e;return Zt&&!t||(Zt=new Qt),Zt}handleQueryParam(e){h.ViewManager.ViewManager.instance().showView("timeline").then((async()=>{await Xt.instance().loadFromURL(window.decodeURIComponent(e))}))}}var ei=Object.freeze({__proto__:null,TimelinePanel:Xt,get State(){return Kt},rowHeight:18,headerHeight:20,StatusPane:Yt,LoadTimelineHandler:Qt,ActionDelegate:class{handleAction(e,t){const i=e.flavor(Xt);if(null===i)return!1;switch(t){case"timeline.toggle-recording":return i.toggleRecording(),!0;case"timeline.record-reload":return i.recordReload(),!0;case"timeline.save-to-file":return i.saveToFile(),!0;case"timeline.load-from-file":return i.selectFileToLoad(),!0;case"timeline.jump-to-previous-frame":return i.jumpToFrame(-1),!0;case"timeline.jump-to-next-frame":return i.jumpToFrame(1),!0;case"timeline.show-history":return i.showHistory(),!0;case"timeline.previous-recording":return i.navigateHistory(1),!0;case"timeline.next-recording":return i.navigateHistory(-1),!0}return!1}}});const ti={emptyPlaceholder:"{PH1}",task:"Task",other:"Other",animation:"Animation",event:"Event",requestMainThreadFrame:"Request Main Thread Frame",frameStart:"Frame Start",frameStartMainThread:"Frame Start (main thread)",drawFrame:"Draw Frame",profilingOverhead:"Profiling Overhead",hitTest:"Hit Test",scheduleStyleRecalculation:"Schedule Style Recalculation",recalculateStyle:"Recalculate Style",invalidateLayout:"Invalidate Layout",layerize:"Layerize",layout:"Layout",paintSetup:"Paint Setup",paintImage:"Paint Image",prePaint:"Pre-Paint",updateLayer:"Update Layer",updateLayerTree:"Update Layer Tree",initialPriority:"Initial Priority",paint:"Paint",rasterizePaint:"Rasterize Paint",scroll:"Scroll",commit:"Commit",compositeLayers:"Composite Layers",computeIntersections:"Compute Intersections",parseHtml:"Parse HTML",parseStylesheet:"Parse Stylesheet",installTimer:"Install Timer",removeTimer:"Remove Timer",timerFired:"Timer Fired",xhrReadyStateChange:"`XHR` Ready State Change",xhrLoad:"`XHR` Load",compileScript:"Compile Script",cacheScript:"Cache Script Code",compileCode:"Compile Code",optimizeCode:"Optimize Code",evaluateScript:"Evaluate Script",compileModule:"Compile Module",cacheModule:"Cache Module Code",evaluateModule:"Evaluate Module",streamingCompileTask:"Streaming Compile Task",waitingForNetwork:"Waiting for Network",parseAndCompile:"Parse and Compile",deserializeCodeCache:"Deserialize Code Cache",streamingWasmResponse:"Streaming Wasm Response",compiledWasmModule:"Compiled Wasm Module",cachedWasmModule:"Cached Wasm Module",wasmModuleCacheHit:"Wasm Module Cache Hit",wasmModuleCacheInvalid:"Wasm Module Cache Invalid",frameStartedLoading:"Frame Started Loading",onloadEvent:"Onload Event",domcontentloadedEvent:"DOMContentLoaded Event",firstPaint:"First Paint",firstContentfulPaint:"First Contentful Paint",largestContentfulPaint:"Largest Contentful Paint",timestamp:"Timestamp",consoleTime:"Console Time",userTiming:"User Timing",willSendRequest:"Will Send Request",sendRequest:"Send Request",receiveResponse:"Receive Response",finishLoading:"Finish Loading",receiveData:"Receive Data",runMicrotasks:"Run Microtasks",functionCall:"Function Call",gcEvent:"GC Event",majorGc:"Major GC",minorGc:"Minor GC",jsRoot:"JS Root",jsFrame:"JS Frame",jsIdleFrame:"JS Idle Frame",jsSystemFrame:"JS System Frame",requestAnimationFrame:"Request Animation Frame",interactionID:"ID",inputDelay:"Input delay",processingTime:"Processing time",presentationDelay:"Presentation delay",cancelAnimationFrame:"Cancel Animation Frame",animationFrameFired:"Animation Frame Fired",requestIdleCallback:"Request Idle Callback",cancelIdleCallback:"Cancel Idle Callback",fireIdleCallback:"Fire Idle Callback",createWebsocket:"Create WebSocket",sendWebsocketHandshake:"Send WebSocket Handshake",receiveWebsocketHandshake:"Receive WebSocket Handshake",destroyWebsocket:"Destroy WebSocket",embedderCallback:"Embedder Callback",imageDecode:"Image Decode",imageResize:"Image Resize",gpu:"GPU",domGc:"DOM GC",encrypt:"Encrypt",encryptReply:"Encrypt Reply",decrypt:"Decrypt",decryptReply:"Decrypt Reply",digest:"Digest",digestReply:"Digest Reply",sign:"Sign",signReply:"Sign Reply",verify:"Verify",verifyReply:"Verify Reply",asyncTask:"Async Task",layoutShift:"Layout Shift",eventTiming:"Event Timing",compile:"Compile",parse:"Parse",sS:"{PH1}: {PH2}",sCollected:"{PH1} collected",sSs:"{PH1} [{PH2}…{PH3}]",sSSquareBrackets:"{PH1} [{PH2}…]",learnMore:"Learn more",compilationCacheStatus:"Compilation cache status",compilationCacheSize:"Compilation cache size",compilationCacheKind:"Compilation cache kind",scriptLoadedFromCache:"script loaded from cache",failedToLoadScriptFromCache:"failed to load script from cache",scriptNotEligible:"script not eligible",totalTime:"Total Time",selfTime:"Self Time",collected:"Collected",function:"Function",timerId:"Timer ID",timeout:"Timeout",repeats:"Repeats",callbackId:"Callback ID",requestMethod:"Request Method",priority:"Priority",encodedData:"Encoded Data",decodedBody:"Decoded Body",module:"Module",script:"Script",streamed:"Streamed",eagerCompile:"Compiling all functions eagerly",url:"Url",producedCacheSize:"Produced Cache Size",consumedCacheSize:"Consumed Cache Size",location:"Location",sSCurlyBrackets:"({PH1}, {PH2})",dimensions:"Dimensions",sSDimensions:"{PH1} × {PH2}",layerRoot:"Layer Root",ownerElement:"Owner Element",imageUrl:"Image URL",stylesheetUrl:"Stylesheet URL",elementsAffected:"Elements Affected",nodesThatNeedLayout:"Nodes That Need Layout",sOfS:"{PH1} of {PH2}",layoutRoot:"Layout root",message:"Message",callbackFunction:"Callback Function",state:"State",range:"Range",allottedTime:"Allotted Time",invokedByTimeout:"Invoked by Timeout",type:"Type",size:"Size",details:"Details",cumulativeLayoutShifts:"Cumulative Layout Shifts",evolvedClsLink:"evolved",sCLSInformation:"{PH1} can result in poor user experiences. It has recently {PH2}.",warning:"Warning",score:"Score",cumulativeScore:"Cumulative Score",currentClusterScore:"Current Cluster Score",currentClusterId:"Current Cluster ID",hadRecentInput:"Had recent input",yes:"Yes",no:"No",movedFrom:"Moved from",movedTo:"Moved to",relatedNode:"Related Node",preview:"Preview",aggregatedTime:"Aggregated Time",networkRequest:"Network request",loadFromCache:"load from cache",networkTransfer:"network transfer",SSSResourceLoading:" ({PH1} {PH2} + {PH3} resource loading)",duration:"Duration",mimeType:"Mime Type",FromMemoryCache:" (from memory cache)",FromCache:" (from cache)",FromPush:" (from push)",FromServiceWorker:" (from `service worker`)",initiator:"Initiator",timerInstalled:"Timer Installed",animationFrameRequested:"Animation Frame Requested",idleCallbackRequested:"Idle Callback Requested",recalculationForced:"Recalculation Forced",firstLayoutInvalidation:"First Layout Invalidation",layoutForced:"Layout Forced",callStacks:"Call Stacks",stackTrace:"Stack Trace",invalidations:"Invalidations",pendingFor:"Pending for",reveal:"Reveal",firstInvalidated:"First Invalidated",paintProfiler:"Paint Profiler",sAtS:"{PH1} at {PH2}",loading:"Loading",experience:"Experience",scripting:"Scripting",rendering:"Rendering",painting:"Painting",async:"Async",system:"System",idle:"Idle",sSelf:"{PH1} (self)",sChildren:"{PH1} (children)",timeSpentInRendering:"Time spent in rendering",frame:"Frame",sAtSParentheses:"{PH1} (at {PH2})",UnknownNode:"[ unknown node ]",invalidationWithCallFrame:"{PH1} at {PH2}"},ii=e.i18n.registerUIStrings("panels/timeline/TimelineUIUtils.ts",ti),ni=e.i18n.getLocalizedString.bind(void 0,ii);let ri,ai,si,oi,li;const ci=new WeakMap;class di{static initEventStyles(){if(ri)return ri;const e=d.TimelineModel.RecordType,t=di.categories(),i=t.rendering,n=t.scripting,r=t.loading,a=t.experience,s=t.painting,o=t.other,l=t.idle,c={};return c[e.Task]=new j(ni(ti.task),o),c[e.Program]=new j(ni(ti.other),o),c[e.StartProfiling]=new j(ti.profilingOverhead,o),c[e.Animation]=new j(ni(ti.animation),i),c[e.EventDispatch]=new j(ni(ti.event),n),c[e.RequestMainThreadFrame]=new j(ni(ti.requestMainThreadFrame),i,!0),c[e.BeginFrame]=new j(ni(ti.frameStart),i,!0),c[e.BeginMainThreadFrame]=new j(ni(ti.frameStartMainThread),i,!0),c[e.DrawFrame]=new j(ni(ti.drawFrame),i,!0),c[e.HitTest]=new j(ni(ti.hitTest),i),c[e.ScheduleStyleRecalculation]=new j(ni(ti.scheduleStyleRecalculation),i),c[e.RecalculateStyles]=new j(ni(ti.recalculateStyle),i),c[e.UpdateLayoutTree]=new j(ni(ti.recalculateStyle),i),c[e.InvalidateLayout]=new j(ni(ti.invalidateLayout),i,!0),c[e.Layerize]=new j(ni(ti.layerize),i),c[e.Layout]=new j(ni(ti.layout),i),c[e.PaintSetup]=new j(ni(ti.paintSetup),s),c[e.PaintImage]=new j(ni(ti.paintImage),s,!0),c[e.UpdateLayer]=new j(ni(ti.updateLayer),s,!0),c[e.UpdateLayerTree]=new j(ni(ti.updateLayerTree),i),c[e.Paint]=new j(ni(ti.paint),s),c[e.PrePaint]=new j(ni(ti.prePaint),i),c[e.RasterTask]=new j(ni(ti.rasterizePaint),s),c[e.ScrollLayer]=new j(ni(ti.scroll),i),c[e.Commit]=new j(ni(ti.commit),s),c[e.CompositeLayers]=new j(ni(ti.compositeLayers),s),c[e.ComputeIntersections]=new j(ni(ti.computeIntersections),i),c[e.ParseHTML]=new j(ni(ti.parseHtml),r),c[e.ParseAuthorStyleSheet]=new j(ni(ti.parseStylesheet),r),c[e.TimerInstall]=new j(ni(ti.installTimer),n),c[e.TimerRemove]=new j(ni(ti.removeTimer),n),c[e.TimerFire]=new j(ni(ti.timerFired),n),c[e.XHRReadyStateChange]=new j(ni(ti.xhrReadyStateChange),n),c[e.XHRLoad]=new j(ni(ti.xhrLoad),n),c[e.CompileScript]=new j(ni(ti.compileScript),n),c[e.CacheScript]=new j(ni(ti.cacheScript),n),c[e.CompileCode]=new j(ni(ti.compileCode),n),c[e.OptimizeCode]=new j(ni(ti.optimizeCode),n),c[e.EvaluateScript]=new j(ni(ti.evaluateScript),n),c[e.CompileModule]=new j(ni(ti.compileModule),n),c[e.CacheModule]=new j(ni(ti.cacheModule),n),c[e.EvaluateModule]=new j(ni(ti.evaluateModule),n),c[e.StreamingCompileScript]=new j(ni(ti.streamingCompileTask),o),c[e.StreamingCompileScriptWaiting]=new j(ni(ti.waitingForNetwork),l),c[e.StreamingCompileScriptParsing]=new j(ni(ti.parseAndCompile),n),c[e.BackgroundDeserialize]=new j(ni(ti.deserializeCodeCache),n),c[e.FinalizeDeserialization]=new j(ti.profilingOverhead,o),c[e.WasmStreamFromResponseCallback]=new j(ni(ti.streamingWasmResponse),n),c[e.WasmCompiledModule]=new j(ni(ti.compiledWasmModule),n),c[e.WasmCachedModule]=new j(ni(ti.cachedWasmModule),n),c[e.WasmModuleCacheHit]=new j(ni(ti.wasmModuleCacheHit),n),c[e.WasmModuleCacheInvalid]=new j(ni(ti.wasmModuleCacheInvalid),n),c[e.FrameStartedLoading]=new j(ni(ti.frameStartedLoading),r,!0),c[e.MarkLoad]=new j(ni(ti.onloadEvent),n,!0),c[e.MarkDOMContent]=new j(ni(ti.domcontentloadedEvent),n,!0),c[e.MarkFirstPaint]=new j(ni(ti.firstPaint),s,!0),c[e.MarkFCP]=new j(ni(ti.firstContentfulPaint),i,!0),c[e.MarkLCPCandidate]=new j(ni(ti.largestContentfulPaint),i,!0),c[e.TimeStamp]=new j(ni(ti.timestamp),n),c[e.ConsoleTime]=new j(ni(ti.consoleTime),n),c[e.UserTiming]=new j(ni(ti.userTiming),n),c[e.ResourceWillSendRequest]=new j(ni(ti.willSendRequest),r),c[e.ResourceSendRequest]=new j(ni(ti.sendRequest),r),c[e.ResourceReceiveResponse]=new j(ni(ti.receiveResponse),r),c[e.ResourceFinish]=new j(ni(ti.finishLoading),r),c[e.ResourceReceivedData]=new j(ni(ti.receiveData),r),c[e.RunMicrotasks]=new j(ni(ti.runMicrotasks),n),c[e.FunctionCall]=new j(ni(ti.functionCall),n),c[e.GCEvent]=new j(ni(ti.gcEvent),n),c[e.MajorGC]=new j(ni(ti.majorGc),n),c[e.MinorGC]=new j(ni(ti.minorGc),n),c[e.JSRoot]=new j(ni(ti.jsRoot),l,!0),c[e.JSFrame]=new j(ni(ti.jsFrame),n),c[e.JSIdleFrame]=new j(ni(ti.jsIdleFrame),l,!0),c[e.JSSystemFrame]=new j(ni(ti.jsSystemFrame),o,!0),c[e.RequestAnimationFrame]=new j(ni(ti.requestAnimationFrame),n),c[e.CancelAnimationFrame]=new j(ni(ti.cancelAnimationFrame),n),c[e.FireAnimationFrame]=new j(ni(ti.animationFrameFired),n),c[e.RequestIdleCallback]=new j(ni(ti.requestIdleCallback),n),c[e.CancelIdleCallback]=new j(ni(ti.cancelIdleCallback),n),c[e.FireIdleCallback]=new j(ni(ti.fireIdleCallback),n),c[e.WebSocketCreate]=new j(ni(ti.createWebsocket),n),c[e.WebSocketSendHandshakeRequest]=new j(ni(ti.sendWebsocketHandshake),n),c[e.WebSocketReceiveHandshakeResponse]=new j(ni(ti.receiveWebsocketHandshake),n),c[e.WebSocketDestroy]=new j(ni(ti.destroyWebsocket),n),c[e.EmbedderCallback]=new j(ni(ti.embedderCallback),n),c[e.DecodeImage]=new j(ni(ti.imageDecode),s),c[e.ResizeImage]=new j(ni(ti.imageResize),s),c[e.GPUTask]=new j(ni(ti.gpu),t.gpu),c[e.GCCollectGarbage]=new j(ni(ti.domGc),n),c[e.CryptoDoEncrypt]=new j(ni(ti.encrypt),n),c[e.CryptoDoEncryptReply]=new j(ni(ti.encryptReply),n),c[e.CryptoDoDecrypt]=new j(ni(ti.decrypt),n),c[e.CryptoDoDecryptReply]=new j(ni(ti.decryptReply),n),c[e.CryptoDoDigest]=new j(ni(ti.digest),n),c[e.CryptoDoDigestReply]=new j(ni(ti.digestReply),n),c[e.CryptoDoSign]=new j(ni(ti.sign),n),c[e.CryptoDoSignReply]=new j(ni(ti.signReply),n),c[e.CryptoDoVerify]=new j(ni(ti.verify),n),c[e.CryptoDoVerifyReply]=new j(ni(ti.verifyReply),n),c[e.AsyncTask]=new j(ni(ti.asyncTask),t.async),c[e.LayoutShift]=new j(ni(ti.layoutShift),a),c[e.EventTiming]=new j(ti.eventTiming,a),ri=c,c}static setEventStylesMap(e){ri=e}static frameDisplayName(e){if(!d.TimelineJSProfile.TimelineJSProfileProcessor.isNativeRuntimeFrame(e))return h.UIUtils.beautifyFunctionName(e.functionName);const t=d.TimelineJSProfile.TimelineJSProfileProcessor.nativeGroup(e.functionName),i=d.TimelineJSProfile.TimelineJSProfileProcessor.NativeGroups;switch(t){case i.Compile:return ni(ti.compile);case i.Parse:return ni(ti.parse)}return e.functionName}static testContentMatching(e,t,n){const r=[di.eventStyle(e).title];i.Legacy.eventIsFromNewEngine(e)&&i.Types.TraceEvents.isProfileCall(e)&&(n&&n.Samples?r.push(i.Handlers.ModelHandlers.Samples.getProfileCallFunctionName(n.Samples,e)):r.push(e.callFrame.functionName));const a=d.TimelineModel.EventOnTimelineData.forEvent(e).url;a&&r.push(a),function e(t,i){if(!i)return;for(const n in t){const a=t[n];"string"==typeof a?r.push(a):"number"==typeof a?r.push(String(a)):"object"==typeof a&&null!==a&&e(a,i-1)}}(e.args,2);const s=r.join("|").match(t);return!!s&&s.length>0}static eventStyle(e){const t=di.initEventStyles();if(i.Legacy.eventHasCategory(e,d.TimelineModel.TimelineModelImpl.Category.Console)||i.Legacy.eventHasCategory(e,d.TimelineModel.TimelineModelImpl.Category.UserTiming))return new j(e.name,di.categories().scripting);if(i.Legacy.eventIsFromNewEngine(e)){if(i.Types.TraceEvents.isProfileCall(e)&&"(idle)"===e.callFrame.functionName)return new j(e.name,K().Idle);const t=new j(e.name,K().Other);return X(e.name)||t}let n=t[e.name];return n||(n=new j(e.name,di.categories().other,!0),t[e.name]=n),n}static eventColor(e){if(i.Legacy.eventIsFromNewEngine(e)&&i.Types.TraceEvents.isProfileCall(e)){const t=e.callFrame;if(di.isUserFrame(t))return di.colorForId(t.url)}let t=di.eventStyle(e).category.getComputedColorValue();if(e.name===d.TimelineModel.RecordType.StreamingCompileScriptWaiting&&(t=di.categories().scripting.getComputedColorValue(),!t))throw new Error("Unable to parse color from TimelineUIUtils.categories().scripting.color");return t}static eventTitle(e){if(i.Legacy.eventIsFromNewEngine(e)&&i.Types.TraceEvents.isProfileCall(e)){return Ne.resolvedNodeNameForEntry(e)||di.frameDisplayName(e.callFrame)}const t=d.TimelineModel.RecordType,n=e.args.data;if("EventTiming"===e.name){let t=null;if(e instanceof i.Legacy.PayloadEvent?t=e.rawPayload():i.Legacy.eventIsFromNewEngine(e)&&(t=e),t&&i.Types.TraceEvents.isSyntheticInteractionEvent(t))return oe(t)}const r=di.eventStyle(e).title;return i.Legacy.eventHasCategory(e,d.TimelineModel.TimelineModelImpl.Category.Console)?r:e.name===t.TimeStamp?ni(ti.sS,{PH1:r,PH2:n.message}):e.name===t.Animation&&n&&n.name?ni(ti.sS,{PH1:r,PH2:n.name}):e.name===t.EventDispatch&&n&&n.type?ni(ti.sS,{PH1:r,PH2:n.type}):r}static isUserFrame(e){return"0"!==e.scriptId&&!(e.url&&e.url.startsWith("native "))}static syntheticNetworkRequestCategory(e){const t=hi;switch(e.args.data.mimeType){case"text/html":return t.HTML;case"application/javascript":case"application/x-javascript":case"text/javascript":return t.Script;case"text/css":return t.Style;case"audio/ogg":case"image/gif":case"image/jpeg":case"image/png":case"image/svg+xml":case"image/webp":case"image/x-icon":case"font/opentype":case"font/woff2":case"font/ttf":case"application/font-woff":return t.Media;default:return t.Other}}static networkCategoryColor(e){const i=hi;let n="--app-color-system";switch(e){case i.HTML:n="--app-color-loading";break;case i.Script:n="--app-color-scripting";break;case i.Style:n="--app-color-rendering";break;case i.Media:n="--app-color-painting";break;default:n="--app-color-system"}return t.ThemeSupport.instance().getComputedValue(n)}static async buildDetailsTextForTraceEvent(e){const t=d.TimelineModel.RecordType;let n;const r=e.args.data;switch(e.name){case t.GCEvent:case t.MajorGC:case t.MinorGC:{const t=e.args.usedHeapSizeBefore-e.args.usedHeapSizeAfter;n=ni(ti.sCollected,{PH1:o.NumberUtilities.bytesToString(t)});break}case t.FunctionCall:r&&r.url&&void 0!==r.lineNumber&&void 0!==r.columnNumber&&(n=r.url+":"+(r.lineNumber+1)+":"+(r.columnNumber+1));break;case t.JSRoot:case t.JSFrame:case t.JSIdleFrame:case t.JSSystemFrame:n=di.frameDisplayName(r);break;case t.EventDispatch:n=r?r.type:null;break;case t.Paint:{const e=di.quadWidth(r.clip),t=di.quadHeight(r.clip);e&&t&&(n=ni(ti.sSDimensions,{PH1:e,PH2:t}));break}case t.ParseHTML:{const t=e.args.beginData.startLine,i=e.args.endData&&e.args.endData.endLine,r=c.ResourceUtils.displayNameForURL(e.args.beginData.url);n=i>=0?ni(ti.sSs,{PH1:r,PH2:t+1,PH3:i+1}):ni(ti.sSSquareBrackets,{PH1:r,PH2:t+1});break}case t.CompileModule:case t.CacheModule:n=c.ResourceUtils.displayNameForURL(e.args.fileName);break;case t.CompileScript:case t.CacheScript:case t.EvaluateScript:{const e=r&&r.url;e&&(n=c.ResourceUtils.displayNameForURL(e)+":"+(r.lineNumber+1));break}case t.WasmCompiledModule:case t.WasmModuleCacheHit:{const t=e.args.url;t&&(n=c.ResourceUtils.displayNameForURL(t));break}case t.StreamingCompileScript:case t.BackgroundDeserialize:case t.XHRReadyStateChange:case t.XHRLoad:{const e=r.url;e&&(n=c.ResourceUtils.displayNameForURL(e));break}case t.TimeStamp:n=r.message;break;case t.WebSocketCreate:case t.WebSocketSendHandshakeRequest:case t.WebSocketReceiveHandshakeResponse:case t.WebSocketDestroy:case t.ResourceWillSendRequest:case t.ResourceSendRequest:case t.ResourceReceivedData:case t.ResourceReceiveResponse:case t.ResourceFinish:case t.PaintImage:case t.DecodeImage:case t.ResizeImage:case t.DecodeLazyPixelRef:{const t=d.TimelineModel.EventOnTimelineData.forEvent(e).url;t&&(n=c.ResourceUtils.displayNameForURL(t));break}case t.EmbedderCallback:n=r.callbackName;break;case t.Animation:n=r&&r.name;break;case t.AsyncTask:n=r?r.name:null;break;default:n=i.Legacy.eventHasCategory(e,d.TimelineModel.TimelineModelImpl.Category.Console)?null:await async function(){const t=d.TimelineModel.EventOnTimelineData.forEvent(e).topFrame();if(!t)return null;return t.url+":"+(t.lineNumber+1)+":"+(t.columnNumber+1)}()}return n}static async buildDetailsNodeForTraceEvent(e,t,n,r=!1){const a=d.TimelineModel.RecordType;let s,o=null;const l=e.args.data;switch(e.name){case a.GCEvent:case a.MajorGC:case a.MinorGC:case a.EventDispatch:case a.Paint:case a.Animation:case a.EmbedderCallback:case a.ParseHTML:case a.WasmStreamFromResponseCallback:case a.WasmCompiledModule:case a.WasmModuleCacheHit:case a.WasmCachedModule:case a.WasmModuleCacheInvalid:case a.WebSocketCreate:case a.WebSocketSendHandshakeRequest:case a.WebSocketReceiveHandshakeResponse:case a.WebSocketDestroy:s=await di.buildDetailsTextForTraceEvent(e);break;case a.PaintImage:case a.DecodeImage:case a.ResizeImage:case a.DecodeLazyPixelRef:case a.XHRReadyStateChange:case a.XHRLoad:case a.ResourceWillSendRequest:case a.ResourceSendRequest:case a.ResourceReceivedData:case a.ResourceReceiveResponse:case a.ResourceFinish:{const t=d.TimelineModel.EventOnTimelineData.forEvent(e).url;if(t){const e={tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0};o=p.Linkifier.Linkifier.linkifyURL(t,e)}break}case a.JSRoot:case a.FunctionCall:case a.JSIdleFrame:case a.JSSystemFrame:case a.JSFrame:{o=document.createElement("span"),h.UIUtils.createTextChild(o,di.frameDisplayName(l));const e=this.linkifyLocation({scriptId:l.scriptId,url:l.url,lineNumber:l.lineNumber,columnNumber:l.columnNumber,target:t,isFreshRecording:r,linkifier:n});e&&(h.UIUtils.createTextChild(o," @ "),o.appendChild(e));break}case a.CompileModule:case a.CacheModule:o=this.linkifyLocation({scriptId:null,url:e.args.fileName,lineNumber:0,columnNumber:0,target:t,isFreshRecording:r,linkifier:n});break;case a.CompileScript:case a.CacheScript:case a.EvaluateScript:{const e=l.url;e&&(o=this.linkifyLocation({scriptId:null,url:e,lineNumber:l.lineNumber,columnNumber:0,target:t,isFreshRecording:r,linkifier:n}));break}case a.BackgroundDeserialize:case a.StreamingCompileScript:{const e=l.url;e&&(o=this.linkifyLocation({scriptId:null,url:e,lineNumber:0,columnNumber:0,target:t,isFreshRecording:r,linkifier:n}));break}case"ProfileCall":{if(o=document.createElement("span"),!i.Legacy.eventIsFromNewEngine(e)||!i.Types.TraceEvents.isProfileCall(e))break;const a=Ne.resolvedNodeNameForEntry(e)||di.frameDisplayName(e.callFrame);h.UIUtils.createTextChild(o,a);const s=this.linkifyLocation({scriptId:e.callFrame.scriptId,url:e.callFrame.url,lineNumber:e.callFrame.lineNumber,columnNumber:e.callFrame.columnNumber,target:t,isFreshRecording:r,linkifier:n});s&&(h.UIUtils.createTextChild(o," @ "),o.appendChild(s));break}default:i.Legacy.eventHasCategory(e,d.TimelineModel.TimelineModelImpl.Category.Console)?s=null:o=i.Legacy.eventIsFromNewEngine(e)?this.linkifyTopCallFrame(e,t,n,r):null}return!o&&s&&(o=document.createTextNode(s)),o}static linkifyLocation(e){const{scriptId:t,url:i,lineNumber:n,columnNumber:r,isFreshRecording:a,linkifier:s,target:o}=e,l={lineNumber:n,columnNumber:r,showColumnNumber:!0,inlineFrameIndex:0,className:"timeline-details",tabStop:!0};return a?s.linkifyScriptLocation(o,t,i,n,l):p.Linkifier.Linkifier.linkifyURL(i,l)}static linkifyTopCallFrame(e,t,i,n=!1){const r=d.TimelineProfileTree.eventStackFrame(e);if(!r)return null;const a={className:"timeline-details",tabStop:!0,inlineFrameIndex:0,showColumnNumber:!0,columnNumber:r.columnNumber,lineNumber:r.lineNumber};return n?i.maybeLinkifyConsoleCallFrame(t,r,{showColumnNumber:!0,inlineFrameIndex:0}):p.Linkifier.Linkifier.linkifyURL(r.url,a)}static buildDetailsNodeForPerformanceEvent(e){let t="https://web.dev/user-centric-performance-metrics/",i="page performance metrics";const n=d.TimelineModel.RecordType;switch(e.name){case n.MarkLCPCandidate:t="https://web.dev/lcp/",i="largest contentful paint";break;case n.MarkFCP:t="https://web.dev/first-contentful-paint/",i="first contentful paint"}return h.Fragment.html`<div>${h.XLink.XLink.create(t,ni(ti.learnMore),void 0,void 0,"learn-more")} about ${i}.</div>`}static buildConsumeCacheDetails(e,t){if("number"==typeof e.consumedCacheSize){t.appendTextRow(ni(ti.compilationCacheStatus),ni(ti.scriptLoadedFromCache)),t.appendTextRow(ni(ti.compilationCacheSize),o.NumberUtilities.bytesToString(e.consumedCacheSize));const i=e.cacheKind;i&&t.appendTextRow(ni(ti.compilationCacheKind),i)}else"cacheRejected"in e&&e.cacheRejected?t.appendTextRow(ni(ti.compilationCacheStatus),ni(ti.failedToLoadScriptFromCache)):t.appendTextRow(ni(ti.compilationCacheStatus),ni(ti.scriptNotEligible))}static async buildTraceEventDetails(t,s,l,c,m=null){const u=s.targetByEvent(t),{duration:g,selfTime:T}=i.Legacy.timesForEventInMilliseconds(t);let v=null;if(u){const e=u;if(void 0===t[pi]){let n=null;const r=d.TimelineModel.EventOnTimelineData.forEvent(t).url;r?n=await p.ImagePreview.ImagePreview.build(e,r,!1,{imageAltText:p.ImagePreview.ImagePreview.defaultAltTextForImageURL(r),precomputedFeatures:void 0}):m&&i.Legacy.eventIsFromNewEngine(t)&&i.Types.TraceEvents.isTraceEventPaint(t)&&(n=await di.buildPicturePreviewContent(m,t,e)),t[pi]=n}const r=new Set,a=d.TimelineModel.EventOnTimelineData.forEvent(t);if(a.backendNodeIds)for(let e=0;e<a.backendNodeIds.length;++e)r.add(a.backendNodeIds[e]);if(r.size){const t=e.model(n.DOMModel.DOMModel);t&&(v=await t.pushNodesByBackendIdsToFrontend(r))}}const f=d.TimelineModel.RecordType;let y;t.name===f.LayoutShift&&(c=!1);const w=new gi(s.targetByEvent(t),l),S=i.Legacy.eventIsFromNewEngine(t)?X(t.name)?.category.getComputedColorValue():di.eventStyle(t).category.getComputedColorValue(),b=s.isMarkerEvent(t)?di.markerStyleForEvent(t).color:S;w.addSection(di.eventTitle(t),b);const C=t.args.data,P=d.TimelineModel.EventOnTimelineData.forEvent(t),k=i.Legacy.eventIsFromNewEngine(t)?m?.Initiators.eventToInitiator.get(t)??null:null;let E=null;if(i.Legacy.eventIsFromNewEngine(t)&&m){const e=a.DetailsView.buildWarningElementsForEvent(t,m);for(const t of e)w.appendElementRow(ni(ti.warning),t,!0)}if(c&&!Number.isNaN(g||0)&&(w.appendTextRow(ni(ti.totalTime),e.TimeUtilities.millisToString(g||0,!0)),w.appendTextRow(ni(ti.selfTime),e.TimeUtilities.millisToString(T,!0))),m?.Meta.traceIsGeneric){for(const e in t.args)try{w.appendTextRow(e,JSON.stringify(t.args[e]))}catch(i){w.appendTextRow(e,`<${typeof t.args[e]}>`)}return w.fragment}if(i.Legacy.eventIsFromNewEngine(t)&&i.Types.TraceEvents.isTraceEventV8Compile(t)){if(E=t.args.data?.url,E){const e=t.args?.data?.lineNumber||0,i=t.args?.data?.columnNumber;w.appendLocationRow(ni(ti.script),E,e,i)}Boolean(t.args.data?.eager)&&w.appendTextRow(ni(ti.eagerCompile),!0);const e=Boolean(t.args.data?.streamed);w.appendTextRow(ni(ti.streamed),e+(e?"":`: ${t.args.data?.notStreamedReason||""}`)),di.buildConsumeCacheDetails(C,w)}switch(t.name){case f.GCEvent:case f.MajorGC:case f.MinorGC:{const e=t.args.usedHeapSizeBefore-t.args.usedHeapSizeAfter;w.appendTextRow(ni(ti.collected),o.NumberUtilities.bytesToString(e));break}case f.JSRoot:case f.JSFrame:case"ProfileCall":case f.JSIdleFrame:case f.JSSystemFrame:case f.FunctionCall:{const e=await di.buildDetailsNodeForTraceEvent(t,s.targetByEvent(t),l,s.isFreshRecording());e&&w.appendElementRow(ni(ti.function),e);break}case f.TimerFire:case f.TimerInstall:case f.TimerRemove:w.appendTextRow(ni(ti.timerId),C.timerId),t.name===f.TimerInstall&&(w.appendTextRow(ni(ti.timeout),e.TimeUtilities.millisToString(C.timeout)),w.appendTextRow(ni(ti.repeats),!C.singleShot));break;case f.FireAnimationFrame:w.appendTextRow(ni(ti.callbackId),C.id);break;case f.CompileModule:w.appendLocationRow(ni(ti.module),t.args.fileName,0);break;case f.CompileScript:break;case f.CacheModule:E=C&&C.url,w.appendTextRow(ni(ti.compilationCacheSize),o.NumberUtilities.bytesToString(C.producedCacheSize));break;case f.CacheScript:E=C&&C.url,E&&w.appendLocationRow(ni(ti.script),E,C.lineNumber,C.columnNumber),w.appendTextRow(ni(ti.compilationCacheSize),o.NumberUtilities.bytesToString(C.producedCacheSize));break;case f.EvaluateScript:E=C&&C.url,E&&w.appendLocationRow(ni(ti.script),E,C.lineNumber,C.columnNumber);break;case f.WasmStreamFromResponseCallback:case f.WasmCompiledModule:case f.WasmCachedModule:case f.WasmModuleCacheHit:case f.WasmModuleCacheInvalid:if(C){E=t.args.url,E&&w.appendTextRow(ni(ti.url),E);const e=t.args.producedCachedSize;e&&w.appendTextRow(ni(ti.producedCacheSize),e);const i=t.args.consumedCachedSize;i&&w.appendTextRow(ni(ti.consumedCacheSize),i)}break;case f.Paint:{const e=C.clip;w.appendTextRow(ni(ti.location),ni(ti.sSCurlyBrackets,{PH1:e[0],PH2:e[1]}));const t=di.quadWidth(e),i=di.quadHeight(e);w.appendTextRow(ni(ti.dimensions),ni(ti.sSDimensions,{PH1:t,PH2:i}))}case f.PaintSetup:case f.Rasterize:case f.ScrollLayer:y=ni(ti.layerRoot);break;case f.PaintImage:case f.DecodeLazyPixelRef:case f.DecodeImage:case f.ResizeImage:case f.DrawLazyPixelRef:if(y=ni(ti.ownerElement),E=P.url,E){const e={tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0};w.appendElementRow(ni(ti.imageUrl),p.Linkifier.Linkifier.linkifyURL(E,e))}break;case f.ParseAuthorStyleSheet:if(E=C.styleSheetUrl,E){const e={tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0};w.appendElementRow(ni(ti.stylesheetUrl),p.Linkifier.Linkifier.linkifyURL(E,e))}break;case f.UpdateLayoutTree:case f.RecalculateStyles:w.appendTextRow(ni(ti.elementsAffected),t.args.elementCount);break;case f.Layout:{const e=t.args.beginData;w.appendTextRow(ni(ti.nodesThatNeedLayout),ni(ti.sOfS,{PH1:e.dirtyObjects,PH2:e.totalObjects})),y=ni(ti.layoutRoot);break}case f.ConsoleTime:w.appendTextRow(ni(ti.message),t.name);break;case f.WebSocketCreate:case f.WebSocketSendHandshakeRequest:case f.WebSocketReceiveHandshakeResponse:case f.WebSocketDestroy:if(i.Legacy.eventIsFromNewEngine(t)&&i.Types.TraceEvents.isWebSocketTraceEvent(t)&&m){const e=a.DetailsView.buildRowsForWebSocketEvent(t,m);for(const{key:t,value:i}of e)w.appendTextRow(t,i)}break;case f.EmbedderCallback:w.appendTextRow(ni(ti.callbackFunction),C.callbackName);break;case f.Animation:"n"===i.Legacy.phaseForEvent(t)&&w.appendTextRow(ni(ti.state),C.state);break;case f.ParseHTML:{const e=t.args.beginData,i=e.startLine-1,n=t.args.endData?t.args.endData.endLine-1:void 0;E=e.url,E&&w.appendLocationRange(ni(ti.range),E,i,n);break}case f.FireIdleCallback:w.appendTextRow(ni(ti.allottedTime),e.TimeUtilities.millisToString(C.allottedMilliseconds)),w.appendTextRow(ni(ti.invokedByTimeout),C.timedOut);case f.RequestIdleCallback:case f.CancelIdleCallback:w.appendTextRow(ni(ti.callbackId),C.id);break;case f.EventDispatch:w.appendTextRow(ni(ti.type),C.type);break;case f.MarkLCPCandidate:w.appendTextRow(ni(ti.type),String(C.type)),w.appendTextRow(ni(ti.size),String(C.size));case f.MarkFirstPaint:case f.MarkFCP:case f.MarkLoad:case f.MarkDOMContent:if(m&&i.Legacy.eventIsFromNewEngine(t)){const i=vi(t,m);w.appendTextRow(ni(ti.timestamp),e.TimeUtilities.preciseMillisToString(i,1)),w.appendElementRow(ni(ti.details),di.buildDetailsNodeForPerformanceEvent(t))}break;case f.EventTiming:{const e=await di.buildDetailsNodeForTraceEvent(t,s.targetByEvent(t),l,s.isFreshRecording());e&&w.appendElementRow(ni(ti.details),e);let n=null;if(i.Legacy.eventIsFromNewEngine(t)?n=t:i.Legacy.eventHasPayload(t)&&(n=t.rawPayload()),n&&i.Types.TraceEvents.isSyntheticInteractionEvent(n)){const e=i.Helpers.Timing.formatMicrosecondsTime(n.inputDelay),t=i.Helpers.Timing.formatMicrosecondsTime(n.mainThreadHandling),r=i.Helpers.Timing.formatMicrosecondsTime(n.presentationDelay);w.appendTextRow(ni(ti.interactionID),n.interactionId),w.appendTextRow(ni(ti.inputDelay),e),w.appendTextRow(ni(ti.processingTime),t),w.appendTextRow(ni(ti.presentationDelay),r)}break}case f.LayoutShift:{if(!i.Legacy.eventIsFromNewEngine(t)||!i.Types.TraceEvents.isSyntheticLayoutShift(t)){console.error("Unexpected type for LayoutShift event");break}const n=t,a=n.args.data,s=document.createElement("span"),o=h.XLink.XLink.create("https://web.dev/cls/",ni(ti.cumulativeLayoutShifts),void 0,void 0,"cumulative-layout-shifts"),l=h.XLink.XLink.create("https://web.dev/evolving-cls/",ni(ti.evolvedClsLink),void 0,void 0,"evolved-cls");if(s.appendChild(e.i18n.getFormatLocalizedString(ii,ti.sCLSInformation,{PH1:o,PH2:l})),w.appendElementRow(ni(ti.warning),s,!0),!a)break;w.appendTextRow(ni(ti.score),a.score.toPrecision(4)),w.appendTextRow(ni(ti.cumulativeScore),a.cumulative_score.toPrecision(4)),w.appendTextRow(ni(ti.currentClusterId),n.parsedData.sessionWindowData.id),w.appendTextRow(ni(ti.currentClusterScore),n.parsedData.sessionWindowData.cumulativeWindowScore.toPrecision(4)),w.appendTextRow(ni(ti.hadRecentInput),C.had_recent_input?ni(ti.yes):ni(ti.no));for(const e of C.impacted_nodes){const t=new U(e.old_rect),i=new U(e.new_rect),n=await r.Linkifier.Linkifier.linkify(t),a=await r.Linkifier.Linkifier.linkify(i);w.appendElementRow(ni(ti.movedFrom),n),w.appendElementRow(ni(ti.movedTo),a)}break}default:{const e=await di.buildDetailsNodeForTraceEvent(t,s.targetByEvent(t),l,s.isFreshRecording());e&&w.appendElementRow(ni(ti.details),e);break}}for(let e=0;e<P.backendNodeIds.length;++e){const t=v&&v.get(P.backendNodeIds[e]);if(t){const e=await r.Linkifier.Linkifier.linkify(t);w.appendElementRow(y||ni(ti.relatedNode),e)}}if(t[pi]&&(w.addSection(ni(ti.preview)),w.appendElementRow("",t[pi])),i.Legacy.eventIsFromNewEngine(t)&&m){const e=i.Helpers.Trace.stackTraceForEvent(t);(k||e||m?.Invalidations.invalidationsForEvent.get(t))&&await di.generateCauses(t,w,m)}const M={};if(c&&m&&di.aggregatedStatsForTraceEvent(M,m,t)){w.addSection(ni(ti.aggregatedTime));const e=di.generatePieChart(M,di.eventStyle(t).category,T);w.appendElementRow("",e)}return w.fragment}static statsForTimeRange(e,t,n){if(!e.length)return{idle:n-t};!function(e){if(e[Ti])return;const t={},n=[];let r=0;function a(e,i){let n=t[e];if(n||(n={time:[],value:[]},t[e]=n),n.time.length&&n.time[n.time.length-1]===i||r>i)return;const a=n.value.length>0?n.value[n.value.length-1]:0;n.value.push(a+i-r),n.time.push(i)}function s(e,t,i){e&&a(e,i),r=i,t&&a(t,i)}d.TimelineModel.TimelineModelImpl.forEachEvent(e,(function(e){const{startTime:t}=i.Legacy.timesForEventInMilliseconds(e),r=X(e.name)?.category.name||K().Other.name,a=n.length?n[n.length-1]:null;r!==a&&s(a||null,r,t),n.push(r)}),(function(e){const{endTime:t}=i.Legacy.timesForEventInMilliseconds(e),r=n.pop(),a=n.length?n[n.length-1]:null;r!==a&&s(r||null,a||null,t||0)}));const o=e;o[Ti]=t}(e);const r=function(e,t){const i=Object.assign({},e);for(const e in t)i[e]-=t[e];return i}(s(n),s(t)),a=Object.values(r).reduce(((e,t)=>e+t),0);return r.idle=Math.max(0,n-t-a),r;function s(t){const i={},n=e[Ti];for(const e in n){const r=n[e],a=o.ArrayUtilities.upperBound(r.time,t,o.ArrayUtilities.DEFAULT_COMPARATOR);let s;if(0===a)s=0;else if(a===r.time.length)s=r.value[r.value.length-1];else{const e=r.time[a-1],i=r.time[a],n=r.value[a-1];s=n+(r.value[a]-n)*(t-e)/(i-e)}i[e]=s}return i}}static async buildSyntheticNetworkRequestDetails(t,n,r){const a=n.targetByEvent(t),l=new gi(a,r),c=di.syntheticNetworkRequestCategory(t),h=di.networkCategoryColor(c);l.addSection(ni(ti.networkRequest),h);l.appendElementRow(e.i18n.lockedString("URL"),p.Linkifier.Linkifier.linkifyURL(t.args.data.url,{tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0}));const m=t.dur;if(isFinite(m)){let e=i.Helpers.Timing.formatMicrosecondsTime(m);const n=t.args.data.syntheticData.finishTime-t.ts,r=t.ts+t.dur-t.args.data.syntheticData.finishTime;if(isFinite(n)&&isFinite(r)){const a=i.Helpers.Timing.formatMicrosecondsTime(n),s=i.Helpers.Timing.formatMicrosecondsTime(r),o=t.args.data.syntheticData.isMemoryCached||t.args.data.syntheticData.isDiskCached,l=ni(o?ti.loadFromCache:ti.networkTransfer);e+=ni(ti.SSSResourceLoading,{PH1:a,PH2:l,PH3:s})}l.appendTextRow(ni(ti.duration),e)}if(t.args.data.requestMethod&&l.appendTextRow(ni(ti.requestMethod),t.args.data.requestMethod),t.args.data.initialPriority){const e=s.NetworkPriorities.uiLabelForNetworkPriority(t.args.data.initialPriority);l.appendTextRow(ni(ti.initialPriority),e)}const u=s.NetworkPriorities.uiLabelForNetworkPriority(t.args.data.priority);l.appendTextRow(ni(ti.priority),u),t.args.data.mimeType&&l.appendTextRow(ni(ti.mimeType),t.args.data.mimeType);let g="";t.args.data.syntheticData.isMemoryCached?g+=ni(ti.FromMemoryCache):t.args.data.syntheticData.isDiskCached?g+=ni(ti.FromCache):t.args.data.timing?.pushStart&&(g+=ni(ti.FromPush)),t.args.data.fromServiceWorker&&(g+=ni(ti.FromServiceWorker)),!t.args.data.encodedDataLength&&g||(g=`${o.NumberUtilities.bytesToString(t.args.data.encodedDataLength)}${g}`),l.appendTextRow(ni(ti.encodedData),g),t.args.data.decodedBodyLength&&l.appendTextRow(ni(ti.decodedBody),o.NumberUtilities.bytesToString(t.args.data.decodedBodyLength));const T=ni(ti.initiator),v=d.TimelineModel.EventOnTimelineData.forEvent(t).topFrame();if(v){const e=r.maybeLinkifyConsoleCallFrame(a,v,{tabStop:!0,inlineFrameIndex:0,showColumnNumber:!0});e&&l.appendElementRow(T,e)}if(!ci.get(t)&&t.args.data.url&&a){const e=await p.ImagePreview.ImagePreview.build(a,t.args.data.url,!1,{imageAltText:p.ImagePreview.ImagePreview.defaultAltTextForImageURL(t.args.data.url),precomputedFeatures:void 0});ci.set(t,e)}const f=ci.get(t);return f&&l.appendElementRow(ni(ti.preview),f),l.fragment}static stackTraceFromCallFrames(e){return{callFrames:e}}static async generateCauses(t,n,r){const{startTime:a}=i.Legacy.timesForEventInMilliseconds(t);let s,o;switch(t.name){case"TimerFire":s=ni(ti.timerInstalled);break;case"FireAnimationFrame":s=ni(ti.animationFrameRequested);break;case"FireIdleCallback":s=ni(ti.idleCallbackRequested);break;case"UpdateLayoutTree":case"RecalculateStyles":o=ni(ti.recalculationForced);break;case"Layout":s=ni(ti.firstLayoutInvalidation),o=ni(ti.layoutForced)}const l=i.Helpers.Trace.stackTraceForEvent(t);l&&l.length&&(n.addSection(ni(ti.callStacks)),n.appendStackTrace(o||ni(ti.stackTrace),di.stackTraceFromCallFrames(l)));const c=r.Initiators.eventToInitiator.get(t),d=r.Invalidations.invalidationsForEvent.get(t);if(c){const{startTime:t}=i.Legacy.timesForEventInMilliseconds(c),r=a-t;n.appendTextRow(ni(ti.pendingFor),e.TimeUtilities.preciseMillisToString(r,1));const o=document.createElement("span");o.classList.add("devtools-link"),h.ARIAUtils.markAsLink(o),o.tabIndex=0,o.textContent=ni(ti.reveal),o.addEventListener("click",(()=>{Xt.instance().select(It.fromTraceEvent(c))})),o.addEventListener("keydown",(e=>{"Enter"===e.key&&(Xt.instance().select(It.fromTraceEvent(c)),e.consume(!0))})),n.appendElementRow(ni(ti.initiator),o);const l=i.Helpers.Trace.stackTraceForEvent(c);l&&n.appendStackTrace(s||ni(ti.firstInvalidated),di.stackTraceFromCallFrames(l.map((e=>({...e,scriptId:String(e.scriptId)})))))}d&&d.length&&(n.addSection(ni(ti.invalidations)),await di.generateInvalidationsList(d,n))}static async generateInvalidationsList(e,t){const{groupedByReason:i,backendNodeIds:r}=a.DetailsView.generateInvalidationsList(e);let s=null;const o=n.TargetManager.TargetManager.instance().primaryPageTarget(),l=o?.model(n.DOMModel.DOMModel);l&&(s=await l.pushNodesByBackendIdsToFrontend(r)),Object.keys(i).forEach((e=>{di.generateInvalidationsForReason(e,i[e],s,t)}))}static generateInvalidationsForReason(t,a,s,o){function l(e){const t=e.nodeId&&s?s.get(e.nodeId):null;if(t){const e=document.createElement("span");return r.Linkifier.Linkifier.linkify(t).then((t=>e.appendChild(t))),e}if(e.nodeName){const t=document.createElement("span");return t.textContent=e.nodeName,t}const i=document.createElement("span");return h.UIUtils.createTextChild(i,ni(ti.UnknownNode)),i}const c=new Set;for(const r of a){const a=i.Helpers.Trace.stackTraceForEvent(r);let s=null;const d=a?.at(0);d&&(s=o.linkifier()?.maybeLinkifyScriptLocation(n.TargetManager.TargetManager.instance().rootTarget(),d.scriptId,d.url,d.lineNumber)||null);const h=l(r),m=s?e.i18n.getFormatLocalizedString(ii,ti.invalidationWithCallFrame,{PH1:h,PH2:s}):h,p="string"==typeof m?m:m.innerText;c.has(p)||(c.add(p),o.appendElementRow(t,m))}}static aggregatedStatsForTraceEvent(e,t,n){const r=t.Renderer?.allTraceEntries||[],{startTime:a,endTime:s}=i.Legacy.timesForEventInMilliseconds(n);const l=o.ArrayUtilities.binaryIndexOf(r,a,(function(e,t){const{startTime:n}=i.Legacy.timesForEventInMilliseconds(t);return e-n}));if(l<0)return!1;let c=!1;if(s)for(let t=l;t<r.length;t++){const a=r[t],{startTime:o,selfTime:d}=i.Legacy.timesForEventInMilliseconds(a);if(o>=s)break;if(!a.selfTime)continue;if(i.Legacy.threadIDForEvent(a)!==i.Legacy.threadIDForEvent(n))continue;t>l&&(c=!0);const h=di.eventStyle(a).category.name;e[h]=(e[h]||0)+d}if(i.Types.TraceEvents.isAsyncPhase(i.Legacy.phaseForEvent(n))){if(s){let t=0;for(const i in e)t+=e[i];e.idle=Math.max(0,s-a-t)}return!1}return c}static async buildPicturePreviewContent(e,t,i){const r=e.LayerTree.paintsToSnapshots.get(t);if(!r)return null;const a=i.model(n.PaintProfiler.PaintProfilerModel);if(!a)return null;const s=await a.loadSnapshot(r.args.snapshot.skp64);if(!s)return null;const o={snapshot:s,rect:r.args.snapshot.params?.layer_rect};if(!o)return null;const l=o.snapshot.replay();o.snapshot.release();const c=await l;if(!c)return null;const d=document.createElement("div"),m=d.attachShadow({mode:"open"});m.adoptedStyleSheets=[xe];const u=m.createChild("div");u.classList.add("image-preview-container","vbox","link");const g=u.createChild("img");g.src=c,g.alt=p.ImagePreview.ImagePreview.defaultAltTextForImageURL(c);return u.createChild("a").textContent=ni(ti.paintProfiler),h.ARIAUtils.markAsLink(u),u.tabIndex=0,u.addEventListener("click",(()=>Xt.instance().select(It.fromTraceEvent(t))),!1),u.addEventListener("keydown",(e=>{"Enter"===e.key&&(Xt.instance().select(It.fromTraceEvent(t)),e.consume(!0))})),d}static createEventDivider(t,n){const r=document.createElement("div");r.classList.add("resources-event-divider");const{startTime:a}=i.Legacy.timesForEventInMilliseconds(t),s=e.TimeUtilities.millisToString(a-n);h.Tooltip.Tooltip.install(r,ni(ti.sAtS,{PH1:di.eventTitle(t),PH2:s}));const o=di.markerStyleForEvent(t);return o.tall&&(r.style.backgroundColor=o.color),r}static visibleTypes(){const e=di.initEventStyles(),t=[];for(const i in e)e[i].hidden||t.push(i);return t}static visibleEventsFilter(){return new d.TimelineModelFilter.TimelineVisibleEventsFilter(di.visibleTypes())}static categories(){return ai||(ai={loading:new q("loading",ni(ti.loading),!0,"--app-color-loading-children","--app-color-loading"),experience:new q("experience",ni(ti.experience),!1,"--app-color-rendering-children","--app-color-rendering"),scripting:new q("scripting",ni(ti.scripting),!0,"--app-color-scripting-children","--app-color-scripting"),rendering:new q("rendering",ni(ti.rendering),!0,"--app-color-rendering-children","--app-color-rendering"),painting:new q("painting",ni(ti.painting),!0,"--app-color-painting-children","--app-color-painting"),gpu:new q("gpu",ni(ti.gpu),!1,"--app-color-painting-children","--app-color-painting"),async:new q("async",ni(ti.async),!1,"--app-color-async-children","--app-color-async"),other:new q("other",ni(ti.system),!1,"--app-color-system-children","--app-color-system"),idle:new q("idle",ni(ti.idle),!1,"--app-color-idle-children","--app-color-idle")},ai)}static setCategories(e){ai=e}static getTimelineMainEventCategories(){return si||(si=["idle","loading","painting","rendering","scripting","other"],si)}static setTimelineMainEventCategories(e){si=e}static generatePieChart(t,i,n){let r=0;for(const e in t)r+=t[e];const a=document.createElement("div");a.classList.add("timeline-details-view-pie-chart-wrapper"),a.classList.add("hbox");const o=new s.PieChart.PieChart,l=[];function c(e,t,i,n){i&&l.push({value:i,color:n,title:t})}if(i){n&&c(i.name,ni(ti.sSelf,{PH1:i.title}),n,i.getCSSValue());const e=t[i.name]-(n||0);e>0&&c(i.name,ni(ti.sChildren,{PH1:i.title}),e,i.getCSSValue())}for(const e in di.categories()){const n=di.categories()[e];e!==i?.name&&c(n.name,n.title,t[n.name],n.getCSSValue())}o.data={chartName:ni(ti.timeSpentInRendering),size:110,formatter:t=>e.TimeUtilities.preciseMillisToString(t),showLegend:!0,total:r,slices:l};return a.createChild("div","vbox").appendChild(o),a}static generateDetailsContentForFrame(e,t,i){const n=new gi(null,null);n.addSection(ni(ti.frame));const r=di.frameDuration(e);if(n.appendElementRow(ni(ti.duration),r),t&&i){const e=document.createElement("div");e.classList.add("timeline-filmstrip-preview"),h.UIUtils.loadImageFromData(i.screenshotAsString).then((t=>t&&e.appendChild(t))),n.appendElementRow("",e),e.addEventListener("click",function(e,t){s.FilmStripView.Dialog.fromFilmStrip(e,t.index)}.bind(null,t,i),!1)}return n.fragment}static frameDuration(t){const n=i.Helpers.Timing.microSecondsToMilliseconds(t.startTimeOffset),r=i.Helpers.Timing.microSecondsToMilliseconds(i.Types.Timing.MicroSeconds(t.endTime-t.startTime)),a=ni(ti.sAtSParentheses,{PH1:e.TimeUtilities.millisToString(r,!0),PH2:e.TimeUtilities.millisToString(n,!0)});return e.i18n.getFormatLocalizedString(ii,ti.emptyPlaceholder,{PH1:a})}static quadWidth(e){return Math.round(Math.sqrt(Math.pow(e[0]-e[2],2)+Math.pow(e[1]-e[3],2)))}static quadHeight(e){return Math.round(Math.sqrt(Math.pow(e[0]-e[6],2)+Math.pow(e[1]-e[7],2)))}static eventDispatchDesciptors(){if(oi)return oi;const e="hsl(40,100%,80%)",t="hsl(40,100%,50%)";return oi=[new ui(1,e,["mousemove","mouseenter","mouseleave","mouseout","mouseover"]),new ui(1,e,["pointerover","pointerout","pointerenter","pointerleave","pointermove"]),new ui(2,"hsl(90,100%,40%)",["wheel"]),new ui(3,t,["click","mousedown","mouseup"]),new ui(3,t,["touchstart","touchend","touchmove","touchcancel"]),new ui(3,t,["pointerdown","pointerup","pointercancel","gotpointercapture","lostpointercapture"]),new ui(3,"hsl(256,100%,75%)",["keydown","keyup","keypress"])],oi}static markerShortTitle(t){const i=d.TimelineModel.RecordType;switch(t.name){case i.MarkDOMContent:return e.i18n.lockedString("DCL");case i.MarkLoad:return e.i18n.lockedString("L");case i.MarkFirstPaint:return e.i18n.lockedString("FP");case i.MarkFCP:return e.i18n.lockedString("FCP");case i.MarkLCPCandidate:return e.i18n.lockedString("LCP")}return null}static markerStyleForEvent(e){const t=[6,4],n=di.eventTitle(e),r=d.TimelineModel.RecordType;if(e.name!==r.NavigationStart&&(i.Legacy.eventHasCategory(e,d.TimelineModel.TimelineModelImpl.Category.Console)||i.Legacy.eventHasCategory(e,d.TimelineModel.TimelineModelImpl.Category.UserTiming)))return{title:n,dashStyle:t,lineWidth:.5,color:i.Legacy.eventHasCategory(e,d.TimelineModel.TimelineModelImpl.Category.UserTiming)?"purple":"orange",tall:!1,lowPriority:!1};let a=!1,s="grey";switch(e.name){case r.NavigationStart:s="#FF9800",a=!0;break;case r.FrameStartedLoading:s="green",a=!0;break;case r.MarkDOMContent:s="#0867CB",a=!0;break;case r.MarkLoad:s="#B31412",a=!0;break;case r.MarkFirstPaint:s="#228847",a=!0;break;case r.MarkFCP:s="#1A6937",a=!0;break;case r.MarkLCPCandidate:s="#1A3422",a=!0;break;case r.TimeStamp:s="orange"}return{title:n,dashStyle:t,lineWidth:.5,color:s,tall:a,lowPriority:!1}}static colorForId(e){return li||(li=new r.Color.Generator({min:30,max:330,count:void 0},{min:50,max:80,count:3},85),li.setColorForID("","#f2ecdc")),li.colorForID(e)}static displayNameForFrame(e,t=30){const i=e.url;return t||(t=30),r.ParsedURL.schemeIs(i,"about:")?`"${o.StringUtilities.trimMiddle(e.name,t)}"`:e.url.trimEnd(t)}}var hi;!function(e){e.HTML="HTML",e.Script="Script",e.Style="Style",e.Media="Media",e.Other="Other"}(hi||(hi={}));const mi=Symbol("aggregatedStats"),pi=Symbol("previewElement");class ui{priority;color;eventTypes;constructor(e,t,i){this.priority=e,this.color=t,this.eventTypes=i}}class gi{fragment;linkifierInternal;target;element;tableElement;constructor(e,t){this.fragment=document.createDocumentFragment(),this.linkifierInternal=t,this.target=e,this.element=document.createElement("div"),this.element.classList.add("timeline-details-view-block"),this.tableElement=this.element.createChild("div","vbox timeline-details-chip-body"),this.fragment.appendChild(this.element)}addSection(e,t){if(this.tableElement.hasChildNodes()?(this.element=document.createElement("div"),this.element.classList.add("timeline-details-view-block"),this.fragment.appendChild(this.element)):this.element.removeChildren(),e){const i=this.element.createChild("div","timeline-details-chip-title");t&&(i.createChild("div").style.backgroundColor=t),h.UIUtils.createTextChild(i,e)}this.tableElement=this.element.createChild("div","vbox timeline-details-chip-body"),this.fragment.appendChild(this.element)}linkifier(){return this.linkifierInternal}appendTextRow(e,t){const i=this.tableElement.createChild("div","timeline-details-view-row");i.createChild("div","timeline-details-view-row-title").textContent=e,i.createChild("div","timeline-details-view-row-value").textContent=t.toString()}appendElementRow(e,t,i,n){const r=this.tableElement.createChild("div","timeline-details-view-row");r.setAttribute("data-row-title",e),i&&r.classList.add("timeline-details-warning"),n&&r.classList.add("timeline-details-stack-values");r.createChild("div","timeline-details-view-row-title").textContent=e;const a=r.createChild("div","timeline-details-view-row-value");t instanceof Node?a.appendChild(t):h.UIUtils.createTextChild(a,t||"")}appendLocationRow(e,t,i,n){if(!this.linkifierInternal)return;const r={tabStop:!0,columnNumber:n,showColumnNumber:!0,inlineFrameIndex:0},a=this.linkifierInternal.maybeLinkifyScriptLocation(this.target,null,t,i,r);a&&this.appendElementRow(e,a)}appendLocationRange(e,t,i,n){if(!this.linkifierInternal||!this.target)return;const r=document.createElement("span"),a=this.linkifierInternal.maybeLinkifyScriptLocation(this.target,null,t,i,{tabStop:!0,inlineFrameIndex:0});a&&(r.appendChild(a),h.UIUtils.createTextChild(r,o.StringUtilities.sprintf(" [%s…%s]",i+1,(n||0)+1||"")),this.appendElementRow(e,r))}appendStackTrace(e,t){if(!this.linkifierInternal)return;const i=this.tableElement.createChild("div","timeline-details-view-row");i.createChild("div","timeline-details-view-row-title").textContent=e,this.createChildStackTraceElement(i,t)}createChildStackTraceElement(e,t){if(!this.linkifierInternal)return;e.classList.add("timeline-details-stack-values");const i=e.createChild("div","timeline-details-view-row-value timeline-details-view-row-stack-trace"),n=p.JSPresentationUtils.buildStackTracePreviewContents(this.target,this.linkifierInternal,{stackTrace:t,tabStops:!0});i.appendChild(n.element)}}const Ti=Symbol("categoryBreakdownCache");function vi(e,t){if(!t){const{startTime:t}=i.Legacy.timesForEventInMilliseconds(e);return t}const n=i.Helpers.Timing.timeStampForEventAdjustedByClosestNavigation(e,t.Meta.traceBounds,t.Meta.navigationsByNavigationId,t.Meta.navigationsByFrameId);return i.Helpers.Timing.microSecondsToMilliseconds(n)}var fi=Object.freeze({__proto__:null,TimelineUIUtils:di,get NetworkCategory(){return hi},aggregatedStatsKey:mi,previewElementSymbol:pi,EventDispatchTypeDescriptor:ui,TimelineDetailsContentHelper:gi,categoryBreakdownCacheSymbol:Ti,timeStampForEventAdjustedForClosestNavigationIfPossible:vi});class yi extends d.TimelineModelFilter.TimelineModelFilter{minimumRecordDuration;constructor(){super(),this.minimumRecordDuration=0}setMinimumRecordDuration(e){this.minimumRecordDuration=e}accept(e){if(i.Legacy.eventIsFromNewEngine(e)){const{duration:t}=i.Helpers.Timing.eventTimingsMilliSeconds(e);return t>=this.minimumRecordDuration}return(e.endTime?e.endTime-e.startTime:0)>=this.minimumRecordDuration}}class wi extends d.TimelineModelFilter.TimelineModelFilter{constructor(){super()}accept(e){return!di.eventStyle(e).category.hidden}}class Si extends d.TimelineModelFilter.TimelineModelFilter{regExpInternal;constructor(e){super(),this.setRegExp(e||null)}setRegExp(e){this.regExpInternal=e}regExp(){return this.regExpInternal}accept(e,t){return!this.regExpInternal||di.testContentMatching(e,this.regExpInternal,t)}}var bi=Object.freeze({__proto__:null,IsLong:yi,Category:wi,TimelineRegExp:Si});const Ci={performance:"Performance",filter:"Filter",selfTime:"Self Time",totalTime:"Total Time",activity:"Activity",selectItemForDetails:"Select item for details.",notOptimizedS:"Not optimized: {PH1}",fms:"{PH1} ms",percentPlaceholder:"{PH1} %",chromeExtensionsOverhead:"[`Chrome` extensions overhead]",vRuntime:"[`V8` Runtime]",unattributed:"[unattributed]",page:"Page",noGrouping:"No Grouping",groupByActivity:"Group by Activity",groupByCategory:"Group by Category",groupByDomain:"Group by Domain",groupByFrame:"Group by Frame",groupBySubdomain:"Group by Subdomain",groupByUrl:"Group by URL",groupBy:"Group by",filterCallTree:"Filter call tree",filterBottomup:"Filter bottom-up",heaviestStack:"Heaviest stack",showHeaviestStack:"Show Heaviest stack",hideHeaviestStack:"Hide Heaviest stack",heaviestStackShown:"Heaviest stack sidebar shown",heaviestStackHidden:"Heaviest stack sidebar hidden",timelineStack:"Timeline Stack",matchCase:"Match Case",useRegularExpression:"Use Regular Expression",matchWholeWord:"Match whole word"},Pi=e.i18n.registerUIStrings("panels/timeline/TimelineTreeView.ts",Ci),ki=e.i18n.getLocalizedString.bind(void 0,Pi);class Ei extends h.Widget.VBox{modelInternal;#Me;searchResults;linkifier;dataGrid;lastHoveredProfileNode;textFilterInternal;taskFilter;startTime;endTime;splitWidget;detailsView;searchableView;currentThreadSetting;lastSelectedNodeInternal;root;currentResult;textFilterUI;caseSensitiveButton;regexButton;matchWholeWord;#Fe=null;constructor(){super(),this.modelInternal=null,this.#Me=null,this.element.classList.add("timeline-tree-view"),this.searchResults=[]}static eventNameForSorting(e){return e.name+":@"+d.TimelineProfileTree.eventURL(e)}setSearchableView(e){this.searchableView=e}setModelWithEvents(e,t,i=null){this.modelInternal=e,this.#Fe=i,this.#Me=t}setModel(e,t){this.setModelWithEvents(e,t?.eventsForTreeView()||null)}getToolbarInputAccessiblePlaceHolder(){return""}model(){return this.modelInternal}traceParseData(){return this.#Fe}init(){this.linkifier=new p.Linkifier.Linkifier,this.taskFilter=new d.TimelineModelFilter.ExclusiveNameFilter([d.TimelineModel.RecordType.Task]),this.textFilterInternal=new Si,this.currentThreadSetting=r.Settings.Settings.instance().createSetting("timelineTreeCurrentThread",0),this.currentThreadSetting.addChangeListener(this.refreshTree,this);const e=[];this.populateColumns(e),this.splitWidget=new h.SplitWidget.SplitWidget(!0,!0,"timelineTreeViewDetailsSplitWidget");const t=new h.Widget.VBox,i=new h.Toolbar.Toolbar("",t.element);i.makeWrappable(!0),this.populateToolbar(i),this.dataGrid=new u.SortableDataGrid.SortableDataGrid({displayName:ki(Ci.performance),columns:e,refreshCallback:void 0,editCallback:void 0,deleteCallback:void 0}),this.dataGrid.addEventListener(u.DataGrid.Events.SortingChanged,this.sortingChanged,this),this.dataGrid.element.addEventListener("mousemove",this.onMouseMove.bind(this),!0),this.dataGrid.setResizeMethod(u.DataGrid.ResizeMethod.Last),this.dataGrid.setRowContextMenuCallback(this.onContextMenu.bind(this)),this.dataGrid.asWidget().show(t.element),this.dataGrid.addEventListener(u.DataGrid.Events.SelectedNode,this.updateDetailsForSelection,this),this.detailsView=new h.Widget.VBox,this.detailsView.element.classList.add("timeline-details-view","timeline-details-view-body"),this.splitWidget.setMainWidget(t),this.splitWidget.setSidebarWidget(this.detailsView),this.splitWidget.hideSidebar(),this.splitWidget.show(this.element),this.splitWidget.addEventListener(h.SplitWidget.Events.ShowModeChanged,this.onShowModeChanged,this),this.lastSelectedNodeInternal}lastSelectedNode(){return this.lastSelectedNodeInternal}updateContents(e){this.setRange(e.startTime,e.endTime)}setRange(e,t){this.startTime=e,this.endTime=t,this.refreshTree()}filters(){return[this.taskFilter,this.textFilterInternal,...we.instance().activeFilters()]}filtersWithoutTextFilter(){return[this.taskFilter,...we.instance().activeFilters()]}textFilter(){return this.textFilterInternal}exposePercentages(){return!1}populateToolbar(e){this.caseSensitiveButton=new h.Toolbar.ToolbarToggle(ki(Ci.matchCase)),this.caseSensitiveButton.setText("Aa"),this.caseSensitiveButton.addEventListener(h.Toolbar.ToolbarButton.Events.Click,(()=>{this.#Le(this.caseSensitiveButton)}),this),e.appendToolbarItem(this.caseSensitiveButton),this.regexButton=new h.Toolbar.ToolbarToggle(ki(Ci.useRegularExpression)),this.regexButton.setText(".*"),this.regexButton.addEventListener(h.Toolbar.ToolbarButton.Events.Click,(()=>{this.#Le(this.regexButton)}),this),e.appendToolbarItem(this.regexButton),this.matchWholeWord=new h.Toolbar.ToolbarToggle(ki(Ci.matchWholeWord),"match-whole-word"),this.matchWholeWord.addEventListener(h.Toolbar.ToolbarButton.Events.Click,(()=>{this.#Le(this.matchWholeWord)}),this),e.appendToolbarItem(this.matchWholeWord);const t=new h.Toolbar.ToolbarInput(ki(Ci.filter),this.getToolbarInputAccessiblePlaceHolder());this.textFilterUI=t,t.addEventListener(h.Toolbar.ToolbarInput.Event.TextChanged,this.#Re,this),e.appendToolbarItem(t)}modelEvents(){return this.#Me||[]}onHover(e){}appendContextMenuItems(e,t){}selectProfileNode(e,t){const i=[];let n=e;for(;n;n=n.parent)i.push(n);for(let e=i.length-1;e>0;--e){const t=this.dataGridNodeForTreeNode(i[e]);t&&t.dataGrid&&t.expand()}const r=this.dataGridNodeForTreeNode(e);r&&r.dataGrid&&(r.reveal(),r.select(t))}refreshTree(){if(this.linkifier.reset(),this.dataGrid.rootNode().removeChildren(),!this.modelInternal)return void this.updateDetailsForSelection();this.root=this.buildTree();const e=this.root.children();let t=0,i=0;const n=this.root.totalTime-this.root.selfTime;for(const n of e.values())t=Math.max(t,n.selfTime),i=Math.max(i,n.totalTime);for(const r of e.values()){const e=new Fi(r,n,t,i,this);this.dataGrid.insertChild(e)}this.sortingChanged(),this.updateDetailsForSelection(),this.searchableView&&this.searchableView.refreshSearch();const r=this.dataGrid.rootNode();r.children.length>0&&r.children[0].select(!0)}buildTree(){throw new Error("Not Implemented")}buildTopDownTree(e,t){return new d.TimelineProfileTree.TopDownRootNode(this.modelEvents(),this.filters(),this.startTime,this.endTime,e,t)}populateColumns(e){e.push({id:"self",title:ki(Ci.selfTime),width:"120px",fixedWidth:!0,sortable:!0}),e.push({id:"total",title:ki(Ci.totalTime),width:"120px",fixedWidth:!0,sortable:!0}),e.push({id:"activity",title:ki(Ci.activity),disclosure:!0,sortable:!0})}sortingChanged(){const e=this.dataGrid.sortColumnId();if(!e)return;let t;switch(e){case"startTime":t=function(e,t){const i=t,n=e.profileNode.event,r=i.profileNode.event;return n.startTime-r.startTime};break;case"self":t=i.bind(null,"selfTime");break;case"total":t=i.bind(null,"totalTime");break;case"activity":t=function(e,t){const i=t,n=e.profileNode.event,r=i.profileNode.event,a=Ei.eventNameForSorting(n),s=Ei.eventNameForSorting(r);return a.localeCompare(s)};break;default:return void console.assert(!1,"Unknown sort field: "+e)}function i(e,t,i){const n=i;return t.profileNode[e]-n.profileNode[e]}this.dataGrid.sortNodes(t,!this.dataGrid.isSortOrderAscending())}#Re(){const e=this.textFilterUI&&this.textFilterUI.value(),t=void 0!==this.caseSensitiveButton&&this.caseSensitiveButton.toggled(),i=void 0!==this.regexButton&&this.regexButton.toggled(),n=void 0!==this.matchWholeWord&&this.matchWholeWord.toggled();this.textFilterInternal.setRegExp(e?o.StringUtilities.createSearchRegex(e,t,i,n):null),this.refreshTree()}#Le(e){e&&e.setToggled(!e.toggled()),this.#Re()}onShowModeChanged(){this.splitWidget.showMode()!==h.SplitWidget.ShowMode.OnlyMain&&(this.lastSelectedNodeInternal=void 0,this.updateDetailsForSelection())}updateDetailsForSelection(){const e=this.dataGrid.selectedNode?this.dataGrid.selectedNode.profileNode:null;if(e===this.lastSelectedNodeInternal)return;if(this.lastSelectedNodeInternal=e,this.splitWidget.showMode()===h.SplitWidget.ShowMode.OnlyMain)return;if(this.detailsView.detachChildWidgets(),this.detailsView.element.removeChildren(),e&&this.showDetailsForNode(e))return;const t=this.detailsView.element.createChild("div","full-widget-dimmed-banner");h.UIUtils.createTextChild(t,ki(Ci.selectItemForDetails))}showDetailsForNode(e){return!1}onMouseMove(e){const t=e.target&&e.target instanceof Node?this.dataGrid.dataGridNodeFromNode(e.target):null,i=t&&t._profileNode;i!==this.lastHoveredProfileNode&&(this.lastHoveredProfileNode=i,this.onHover(i))}onContextMenu(e,t){const i=t;i.linkElement&&!e.containsTarget(i.linkElement)&&e.appendApplicableItems(i.linkElement);const n=i.profileNode;n&&this.appendContextMenuItems(e,n)}dataGridNodeForTreeNode(e){return Li.get(e)||null}onSearchCanceled(){this.searchResults=[],this.currentResult=0}performSearch(e,t,i){if(this.searchResults=[],this.currentResult=0,!this.root)return;const n=e.toSearchRegex();this.searchResults=this.root.searchTree((e=>di.testContentMatching(e,n.regex,this.#Fe||void 0))),this.searchableView.updateSearchMatchesCount(this.searchResults.length)}jumpToNextSearchResult(){this.searchResults.length&&void 0!==this.currentResult&&(this.selectProfileNode(this.searchResults[this.currentResult],!1),this.currentResult=o.NumberUtilities.mod(this.currentResult+1,this.searchResults.length))}jumpToPreviousSearchResult(){this.searchResults.length&&void 0!==this.currentResult&&(this.selectProfileNode(this.searchResults[this.currentResult],!1),this.currentResult=o.NumberUtilities.mod(this.currentResult-1,this.searchResults.length))}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}}class Mi extends u.SortableDataGrid.SortableDataGridNode{populated;profileNode;treeView;grandTotalTime;maxSelfTime;maxTotalTime;linkElement;constructor(e,t,i,n,r){super(null,!1),this.populated=!1,this.profileNode=e,this.treeView=r,this.grandTotalTime=t,this.maxSelfTime=i,this.maxTotalTime=n,this.linkElement=null}createCell(e){return"activity"===e?this.createNameCell(e):this.createValueCell(e)||super.createCell(e)}createNameCell(e){const t=this.createTD(e),n=t.createChild("div","name-container"),r=n.createChild("div","activity-icon-container"),a=r.createChild("div","activity-icon"),s=n.createChild("div","activity-name"),o=this.profileNode.event;if(this.profileNode.isGroupNode()){const e=this.treeView.displayInfoForGroupNode(this.profileNode);s.textContent=e.name,a.style.backgroundColor=e.color,e.icon&&r.insertBefore(e.icon,a)}else if(o){const e=o.args.data,t=e&&e.deoptReason;t&&(n.createChild("div","activity-warning").title=ki(Ci.notOptimizedS,{PH1:t})),s.textContent=di.eventTitle(o);const r=this.treeView.modelInternal?.timelineModel().targetByEvent(o)||null,l=this.treeView.linkifier,c=Boolean(this.treeView.modelInternal?.timelineModel().isFreshRecording());this.linkElement=i.Legacy.eventIsFromNewEngine(o)?di.linkifyTopCallFrame(o,r,l,c):null,this.linkElement&&n.createChild("div","activity-link").appendChild(this.linkElement);const d=di.eventStyle(o).category;h.ARIAUtils.setLabel(a,d.title),a.style.backgroundColor=d.getComputedColorValue()}return t}createValueCell(e){if("self"!==e&&"total"!==e&&"startTime"!==e)return null;let t,n,r,a=!1;switch(e){case"startTime":{r=this.profileNode.event;const e=this.treeView.traceParseData();if(!e)throw new Error("Unable to load trace data for tree view");const n=r&&i.Legacy.timesForEventInMilliseconds(r);t=(n?.startTime??0)-i.Helpers.Timing.microSecondsToMilliseconds(e.Meta.traceBounds.min)}break;case"self":t=this.profileNode.selfTime,n=this.maxSelfTime,a=!0;break;case"total":t=this.profileNode.totalTime,n=this.maxTotalTime,a=!0;break;default:return null}const s=this.createTD(e);s.className="numeric-column",s.setAttribute("title",ki(Ci.fms,{PH1:t.toFixed(4)}));const o=s.createChild("div");return o.createChild("span").textContent=ki(Ci.fms,{PH1:t.toFixed(1)}),a&&this.treeView.exposePercentages()&&(o.createChild("span","percent-column").textContent=ki(Ci.percentPlaceholder,{PH1:(t/this.grandTotalTime*100).toFixed(1)})),n&&(o.classList.add("background-percent-bar"),s.createChild("div","background-bar-container").createChild("div","background-bar").style.width=(100*t/n).toFixed(1)+"%"),s}}class Fi extends Mi{constructor(e,t,i,n,r){super(e,t,i,n,r),this.setHasChildren(this.profileNode.hasChildren()),Li.set(e,this)}populate(){if(!this.populated&&(this.populated=!0,this.profileNode.children))for(const e of this.profileNode.children().values()){const t=new Fi(e,this.grandTotalTime,this.maxSelfTime,this.maxTotalTime,this.treeView);this.insertChildOrdered(t)}}}const Li=new WeakMap;class Ri extends Ei{groupBySetting;stackView;executionContextNamesByOrigin=new Map;constructor(){super(),this.groupBySetting=r.Settings.Settings.instance().createSetting("timelineTreeGroupBy",Ri.GroupBy.None),this.groupBySetting.addChangeListener(this.refreshTree.bind(this)),this.init(),this.stackView=new Di(this),this.stackView.addEventListener(Di.Events.SelectionChanged,this.onStackViewSelectionChanged,this)}setGroupBySettingForTests(e){this.groupBySetting.set(e)}setModelWithEvents(e,t,i=null){super.setModelWithEvents(e,t,i)}setModel(e,t){super.setModel(e,t)}updateContents(e){this.updateExtensionResolver(),super.updateContents(e);const t=this.dataGrid.rootNode();t.children.length&&t.children[0].select(!0)}updateExtensionResolver(){this.executionContextNamesByOrigin=new Map;for(const e of n.TargetManager.TargetManager.instance().models(n.RuntimeModel.RuntimeModel))for(const t of e.executionContexts())this.executionContextNamesByOrigin.set(t.origin,t.name)}beautifyDomainName(e){return Ri.isExtensionInternalURL(e)?e=ki(Ci.chromeExtensionsOverhead):Ri.isV8NativeURL(e)?e=ki(Ci.vRuntime):e.startsWith("chrome-extension")&&(e=this.executionContextNamesByOrigin.get(e)||e),e}displayInfoForGroupNode(e){const t=di.categories(),i=e.id&&e.event?di.eventColor(e.event):t.other.color,n=ki(Ci.unattributed),r="symbol"==typeof e.id?void 0:e.id;switch(this.groupBySetting.get()){case Ri.GroupBy.Category:{const e=r?t[r]||t.other:{title:n,color:n};return{name:e.title,color:e.color,icon:void 0}}case Ri.GroupBy.Domain:case Ri.GroupBy.Subdomain:return{name:(r?this.beautifyDomainName(r):void 0)||n,color:i,icon:void 0};case Ri.GroupBy.EventName:if(!e.event)throw new Error("Unable to find event for group by operation");return{name:di.eventTitle(e.event),color:i,icon:void 0};case Ri.GroupBy.URL:break;case Ri.GroupBy.Frame:{if(!this.modelInternal)throw new Error("Unable to find model for group by frame operation");const e=r?this.modelInternal.timelineModel().pageFrameById(r):void 0;return{name:e?di.displayNameForFrame(e,80):ki(Ci.page),color:i,icon:void 0}}default:console.assert(!1,"Unexpected grouping type")}return{name:r||n,color:i,icon:void 0}}populateToolbar(e){super.populateToolbar(e);const t=Ri.GroupBy,i=[{label:ki(Ci.noGrouping),value:t.None},{label:ki(Ci.groupByActivity),value:t.EventName},{label:ki(Ci.groupByCategory),value:t.Category},{label:ki(Ci.groupByDomain),value:t.Domain},{label:ki(Ci.groupByFrame),value:t.Frame},{label:ki(Ci.groupBySubdomain),value:t.Subdomain},{label:ki(Ci.groupByUrl),value:t.URL}];e.appendToolbarItem(new h.Toolbar.ToolbarSettingComboBox(i,this.groupBySetting,ki(Ci.groupBy))),e.appendSpacer(),e.appendToolbarItem(this.splitWidget.createShowHideSidebarButton(ki(Ci.showHeaviestStack),ki(Ci.hideHeaviestStack),ki(Ci.heaviestStackShown),ki(Ci.heaviestStackHidden)))}buildHeaviestStack(e){console.assert(Boolean(e.parent),"Attempt to build stack for tree root");let t=[];for(let i=e;i&&i.parent;i=i.parent)t.push(i);t=t.reverse();for(let i=e;i&&i.children()&&i.children().size;){const e=Array.from(i.children().values());i=e.reduce(((e,t)=>e.totalTime>t.totalTime?e:t)),t.push(i)}return t}exposePercentages(){return!0}onStackViewSelectionChanged(){const e=this.stackView.selectedTreeNode();e&&this.selectProfileNode(e,!0)}showDetailsForNode(e){const t=this.buildHeaviestStack(e);return this.stackView.setStack(t,e),this.stackView.show(this.detailsView.element),!0}groupingFunction(e){const t=Ri.GroupBy;switch(e){case t.None:return null;case t.EventName:return e=>di.eventStyle(e).title;case t.Category:return e=>di.eventStyle(e).category.name;case t.Subdomain:return this.domainByEvent.bind(this,!1);case t.Domain:return this.domainByEvent.bind(this,!0);case t.URL:return e=>d.TimelineProfileTree.eventURL(e)||"";case t.Frame:return e=>d.TimelineModel.EventOnTimelineData.forEvent(e).frameId||"";default:return console.assert(!1,`Unexpected aggregation setting: ${e}`),null}}domainByEvent(e,t){const i=d.TimelineProfileTree.eventURL(t);if(!i)return"";if(Ri.isExtensionInternalURL(i))return Ri.extensionInternalPrefix;if(Ri.isV8NativeURL(i))return Ri.v8NativePrefix;const n=r.ParsedURL.ParsedURL.fromString(i);if(!n)return"";if("chrome-extension"===n.scheme)return n.scheme+"://"+n.host;if(!e)return n.host;if(/^[.0-9]+$/.test(n.host))return n.host;const a=/([^.]*\.)?[^.]*$/.exec(n.host);return a&&a[0]||""}appendContextMenuItems(e,t){if(this.groupBySetting.get()!==Ri.GroupBy.Frame)return;if(!t.isGroupNode())return;if(!this.modelInternal)return;const i=this.modelInternal.timelineModel().pageFrameById(t.id);i&&i.ownerNode&&e.appendApplicableItems(i.ownerNode)}static isExtensionInternalURL(e){return e.startsWith(Ri.extensionInternalPrefix)}static isV8NativeURL(e){return e.startsWith(Ri.v8NativePrefix)}static extensionInternalPrefix="extensions::";static v8NativePrefix="native "}!function(e){let t;!function(e){e.None="None",e.EventName="EventName",e.Category="Category",e.Domain="Domain",e.Subdomain="Subdomain",e.URL="URL",e.Frame="Frame"}(t=e.GroupBy||(e.GroupBy={}))}(Ri||(Ri={}));class Ii extends Ri{constructor(){super(),this.dataGrid.markColumnAsSortedBy("total",u.DataGrid.Order.Descending)}getToolbarInputAccessiblePlaceHolder(){return ki(Ci.filterCallTree)}buildTree(){const e=this.groupBySetting.get();return this.buildTopDownTree(!1,this.groupingFunction(e))}}class xi extends Ri{constructor(){super(),this.dataGrid.markColumnAsSortedBy("self",u.DataGrid.Order.Descending)}getToolbarInputAccessiblePlaceHolder(){return ki(Ci.filterBottomup)}buildTree(){return new d.TimelineProfileTree.BottomUpRootNode(this.modelEvents(),this.textFilter(),this.filtersWithoutTextFilter(),this.startTime,this.endTime,this.groupingFunction(this.groupBySetting.get()))}}class Di extends(r.ObjectWrapper.eventMixin(h.Widget.VBox)){treeView;dataGrid;constructor(e){super();this.element.createChild("div","timeline-stack-view-header").textContent=ki(Ci.heaviestStack),this.treeView=e;const t=[{id:"total",title:ki(Ci.totalTime),fixedWidth:!0,width:"110px"},{id:"activity",title:ki(Ci.activity)}];this.dataGrid=new u.ViewportDataGrid.ViewportDataGrid({displayName:ki(Ci.timelineStack),columns:t,deleteCallback:void 0,editCallback:void 0,refreshCallback:void 0}),this.dataGrid.setResizeMethod(u.DataGrid.ResizeMethod.Last),this.dataGrid.addEventListener(u.DataGrid.Events.SelectedNode,this.onSelectionChanged,this),this.dataGrid.asWidget().show(this.element)}setStack(e,t){const i=this.dataGrid.rootNode();i.removeChildren();let n=null;const r=Math.max.apply(Math,e.map((e=>e.totalTime)));for(const a of e){const e=new Mi(a,r,r,r,this.treeView);i.appendChild(e),a===t&&(n=e)}n&&n.revealAndSelect()}selectedTreeNode(){const e=this.dataGrid.selectedNode;return e&&e.profileNode}onSelectionChanged(){this.dispatchEventToListeners(Di.Events.SelectionChanged)}}!function(e){let t;!function(e){e.SelectionChanged="SelectionChanged"}(t=e.Events||(e.Events={}))}(Di||(Di={}));var Ai=Object.freeze({__proto__:null,TimelineTreeView:Ei,GridNode:Mi,TreeGridNode:Fi,get AggregatedTimelineTreeView(){return Ri},CallTreeTimelineTreeView:Ii,BottomUpTimelineTreeView:xi,get TimelineStackView(){return Di}});const Ni={filterEventLog:"Filter event log",startTime:"Start Time",durationFilter:"Duration filter",Dms:"{PH1} ms",all:"All"},Bi=e.i18n.registerUIStrings("panels/timeline/EventsTimelineTreeView.ts",Ni),Hi=e.i18n.getLocalizedString.bind(void 0,Bi);class Ui extends Ei{filtersControl;delegate;currentTree;constructor(e){super(),this.filtersControl=new Wi,this.filtersControl.addEventListener("FilterChanged",this.onFilterChanged,this),this.init(),this.delegate=e,this.dataGrid.markColumnAsSortedBy("startTime",u.DataGrid.Order.Ascending),this.splitWidget.showBoth()}filters(){return[...super.filters(),...this.filtersControl.filters()]}updateContents(e){super.updateContents(e),It.isTraceEventSelection(e.object)&&this.selectEvent(e.object,!0)}getToolbarInputAccessiblePlaceHolder(){return Hi(Ni.filterEventLog)}buildTree(){return this.currentTree=this.buildTopDownTree(!0,null),this.currentTree}onFilterChanged(){const e=this.lastSelectedNode(),t=e&&e.event;this.refreshTree(),t&&this.selectEvent(t,!1)}findNodeWithEvent(e){if("RunTask"===e.name)return null;const t=[this.currentTree.children().values()];for(;t.length;){const{done:i,value:n}=t[t.length-1].next();if(i)t.pop();else{if(n.event===e)return n;t.push(n.children().values())}}return null}selectEvent(e,t){const i=this.findNodeWithEvent(e);if(i&&(this.selectProfileNode(i,!1),t)){const e=this.dataGridNodeForTreeNode(i);e&&e.expand()}}populateColumns(e){e.push({id:"startTime",title:Hi(Ni.startTime),width:"80px",fixedWidth:!0,sortable:!0}),super.populateColumns(e),e.filter((e=>e.fixedWidth)).forEach((e=>{e.width="80px"}))}populateToolbar(e){super.populateToolbar(e),this.filtersControl.populateToolbar(e)}showDetailsForNode(e){const t=e.event;if(!t)return!1;const i=this.model();return!!i&&(di.buildTraceEventDetails(t,i.timelineModel(),this.linkifier,!1,this.traceParseData()).then((e=>this.detailsView.element.appendChild(e))),!0)}onHover(e){this.delegate.highlightEvent(e&&e.event)}}class Wi extends r.ObjectWrapper.ObjectWrapper{categoryFilter;durationFilter;filtersInternal;constructor(){super(),this.categoryFilter=new wi,this.durationFilter=new yi,this.filtersInternal=[this.categoryFilter,this.durationFilter]}filters(){return this.filtersInternal}populateToolbar(e){const t=new h.Toolbar.ToolbarComboBox(function(){const e=t.selectedOption().value,i=parseInt(e,10);this.durationFilter.setMinimumRecordDuration(i),this.notifyFiltersChanged()}.bind(this),Hi(Ni.durationFilter));for(const e of Wi.durationFilterPresetsMs)t.addOption(t.createOption(e?`≥ ${Hi(Ni.Dms,{PH1:e})}`:Hi(Ni.all),String(e)));e.appendToolbarItem(t);const i=new Map,n=di.categories();for(const t in n){const a=n[t];if(!a.visible)continue;const s=new h.Toolbar.ToolbarCheckbox(a.title,void 0,r.bind(this,t));s.setChecked(!0),s.inputElement.style.backgroundColor=a.color,i.set(a.name,s),e.appendToolbarItem(s)}function r(e){const t=di.categories(),n=i.get(e);t[e].hidden=!n||!n.checked(),this.notifyFiltersChanged()}}notifyFiltersChanged(){this.dispatchEventToListeners("FilterChanged")}static durationFilterPresetsMs=[0,1,15]}var Vi=Object.freeze({__proto__:null,EventsTimelineTreeView:Ui,Filters:Wi});class Oi extends h.SplitWidget.SplitWidget{model;showPaintProfilerCallback;rightSplitWidget;layerViewHost;layers3DView;frameLayerTree;updateWhenVisible;constructor(e,t){super(!0,!1,"timelineLayersView"),this.model=e,this.showPaintProfilerCallback=t,this.element.classList.add("timeline-layers-view"),this.rightSplitWidget=new h.SplitWidget.SplitWidget(!0,!0,"timelineLayersViewDetails"),this.rightSplitWidget.element.classList.add("timeline-layers-view-properties"),this.setMainWidget(this.rightSplitWidget);const i=new h.Widget.VBox;this.setSidebarWidget(i),this.layerViewHost=new S.LayerViewHost.LayerViewHost;const n=new S.LayerTreeOutline.LayerTreeOutline(this.layerViewHost);i.element.appendChild(n.element),this.layers3DView=new S.Layers3DView.Layers3DView(this.layerViewHost),this.layers3DView.addEventListener(S.Layers3DView.Events.PaintProfilerRequested,this.onPaintProfilerRequested,this),this.rightSplitWidget.setMainWidget(this.layers3DView);const r=new S.LayerDetailsView.LayerDetailsView(this.layerViewHost);this.rightSplitWidget.setSidebarWidget(r),r.addEventListener(S.LayerDetailsView.Events.PaintProfilerRequested,this.onPaintProfilerRequested,this)}showLayerTree(e){this.frameLayerTree=e,this.isShowing()?this.update():this.updateWhenVisible=!0}wasShown(){this.updateWhenVisible&&(this.updateWhenVisible=!1,this.update())}async onPaintProfilerRequested(e){const t=e.data,i=await this.layers3DView.snapshotForSelection(t);i&&this.showPaintProfilerCallback(i.snapshot)}update(){this.frameLayerTree&&this.frameLayerTree.layerTreePromise().then((e=>this.layerViewHost.setLayerTree(e)))}}var zi=Object.freeze({__proto__:null,TimelineLayersView:Oi});const Gi=new CSSStyleSheet;Gi.replaceSync(".paint-profiler-image-view{overflow:hidden}.paint-profiler-image-view .paint-profiler-image-container{transform-origin:0 0}.paint-profiler-image-view .paint-profiler-image-container div{border-color:1px solid var(--sys-color-divider);border-style:solid;z-index:100;position:absolute;top:0;left:0}.paint-profiler-image-view img{border:solid 1px var(--sys-color-inverse-surface)}\n/*# sourceURL=timelinePaintProfiler.css */\n");class _i extends h.SplitWidget.SplitWidget{logAndImageSplitWidget;imageView;paintProfilerView;logTreeView;needsUpdateWhenVisible;pendingSnapshot;event;paintProfilerModel;lastLoadedSnapshot;#Ie;constructor(e){super(!1,!1),this.element.classList.add("timeline-paint-profiler-view"),this.setSidebarSize(60),this.setResizable(!1),this.#Ie=e,this.logAndImageSplitWidget=new h.SplitWidget.SplitWidget(!0,!1),this.logAndImageSplitWidget.element.classList.add("timeline-paint-profiler-log-split"),this.setMainWidget(this.logAndImageSplitWidget),this.imageView=new ji,this.logAndImageSplitWidget.setMainWidget(this.imageView),this.paintProfilerView=new S.PaintProfilerView.PaintProfilerView(this.imageView.showImage.bind(this.imageView)),this.paintProfilerView.addEventListener(S.PaintProfilerView.Events.WindowChanged,this.onWindowChanged,this),this.setSidebarWidget(this.paintProfilerView),this.logTreeView=new S.PaintProfilerView.PaintProfilerCommandLogView,this.logAndImageSplitWidget.setSidebarWidget(this.logTreeView),this.needsUpdateWhenVisible=!1,this.pendingSnapshot=null,this.event=null,this.paintProfilerModel=null,this.lastLoadedSnapshot=null}wasShown(){super.wasShown(),this.needsUpdateWhenVisible&&(this.needsUpdateWhenVisible=!1,this.update())}setSnapshot(e){this.releaseSnapshot(),this.pendingSnapshot=e,this.event=null,this.updateWhenVisible()}#xe(e){const t=e.args.tileData;if(!t)return!1;const i=this.#Ie.Frames.framesById[t.sourceFrameNumber];return!(!i||!i.layerTree)}setEvent(e,t){if(this.releaseSnapshot(),this.paintProfilerModel=e,this.pendingSnapshot=null,this.event=t,this.updateWhenVisible(),i.Types.TraceEvents.isTraceEventPaint(t)){const e=this.#Ie.LayerTree.paintsToSnapshots.get(t);return Boolean(e)}return!!i.Types.TraceEvents.isTraceEventRasterTask(t)&&this.#xe(t)}updateWhenVisible(){this.isShowing()?this.update():this.needsUpdateWhenVisible=!0}async#De(e){const t=e.args.tileData;if(!t)return null;if(!t.tileId.id_ref)return null;const i=n.TargetManager.TargetManager.instance().rootTarget();if(!i)return null;const r=this.#Ie.Frames.framesById[t.sourceFrameNumber];if(!r||!r.layerTree)return null;const a=new d.TracingLayerTree.TracingFrameLayerTree(i,r.layerTree),s=await a.layerTreePromise();return s?s.pictureForRasterTile(t.tileId.id_ref):null}update(){let e;if(this.logTreeView.setCommandLog([]),this.paintProfilerView.setSnapshotAndLog(null,[],null),this.pendingSnapshot)e=Promise.resolve({rect:null,snapshot:this.pendingSnapshot});else if(this.event&&this.paintProfilerModel&&i.Types.TraceEvents.isTraceEventPaint(this.event)){const t=this.#Ie.LayerTree.paintsToSnapshots.get(this.event);if(t){const i=t.args.snapshot.skp64;e=this.paintProfilerModel.loadSnapshot(i).then((e=>e&&{rect:null,snapshot:e}))}else e=Promise.resolve(null)}else{if(!this.event||!i.Types.TraceEvents.isTraceEventRasterTask(this.event))return void console.assert(!1,"Unexpected event type or no snapshot");e=this.#De(this.event)}function t(e,t,i){this.logTreeView.setCommandLog(i||[]),this.paintProfilerView.setSnapshotAndLog(e,i||[],t)}e.then((e=>{if(this.releaseSnapshot(),!e)return void this.imageView.showImage();const i=e.snapshot;this.lastLoadedSnapshot=i,this.imageView.setMask(e.rect),i.commandLog().then((n=>t.call(this,i,e.rect,n||[])))}))}releaseSnapshot(){this.lastLoadedSnapshot&&(this.lastLoadedSnapshot.release(),this.lastLoadedSnapshot=null)}onWindowChanged(){this.logTreeView.updateWindow(this.paintProfilerView.selectionWindow())}}class ji extends h.Widget.Widget{imageContainer;imageElement;maskElement;transformController;maskRectangle;constructor(){super(!0),this.contentElement.classList.add("fill","paint-profiler-image-view"),this.imageContainer=this.contentElement.createChild("div","paint-profiler-image-container"),this.imageElement=this.imageContainer.createChild("img"),this.maskElement=this.imageContainer.createChild("div"),this.imageElement.addEventListener("load",this.updateImagePosition.bind(this),!1),this.transformController=new S.TransformController.TransformController(this.contentElement,!0),this.transformController.addEventListener(S.TransformController.Events.TransformChanged,this.updateImagePosition,this)}onResize(){this.imageElement.src&&this.updateImagePosition()}updateImagePosition(){const e=this.imageElement.naturalWidth,t=this.imageElement.naturalHeight,i=this.contentElement.clientWidth,n=this.contentElement.clientHeight,r=.1*i,a=.1*n,s=(i-r)/e,o=(n-a)/t,l=Math.min(s,o);if(this.maskRectangle){const i=this.maskElement.style;i.width=e+"px",i.height=t+"px",i.borderLeftWidth=this.maskRectangle.x+"px",i.borderTopWidth=this.maskRectangle.y+"px",i.borderRightWidth=e-this.maskRectangle.x-this.maskRectangle.width+"px",i.borderBottomWidth=t-this.maskRectangle.y-this.maskRectangle.height+"px"}this.transformController.setScaleConstraints(.5,10/l);let c=(new WebKitCSSMatrix).scale(this.transformController.scale(),this.transformController.scale()).translate(i/2,n/2).scale(l,l).translate(-e/2,-t/2);const d=h.Geometry.boundsForTransformedPoints(c,[0,0,0,e,t,0]);this.transformController.clampOffsets(r-d.maxX,i-r-d.minX,a-d.maxY,n-a-d.minY),c=(new WebKitCSSMatrix).translate(this.transformController.offsetX(),this.transformController.offsetY()).multiply(c),this.imageContainer.style.webkitTransform=c.toString()}showImage(e){this.imageContainer.classList.toggle("hidden",!e),e&&(this.imageElement.src=e)}setMask(e){this.maskRectangle=e,this.maskElement.classList.toggle("hidden",!e)}wasShown(){super.wasShown(),this.registerCSSFiles([Gi])}}var qi=Object.freeze({__proto__:null,TimelinePaintProfilerView:_i,TimelinePaintImageView:ji});const Ji={summary:"Summary",bottomup:"Bottom-Up",callTree:"Call Tree",eventLog:"Event Log",paintProfiler:"Paint Profiler",layers:"Layers",rangeSS:"Range:  {PH1} – {PH2}"},$i=e.i18n.registerUIStrings("panels/timeline/TimelineDetailsView.ts",Ji),Xi=e.i18n.getLocalizedString.bind(void 0,$i);class Ki extends h.Widget.VBox{detailsLinkifier;tabbedPane;defaultDetailsWidget;defaultDetailsContentElement;rangeDetailViews;model;#Me;lazyPaintProfilerView;lazyLayersView;preferredTabId;selection;updateContentsScheduled;#Ie=null;#J=null;#L=this.#R.bind(this);constructor(e){super(),this.element.classList.add("timeline-details"),this.detailsLinkifier=new p.Linkifier.Linkifier,this.tabbedPane=new h.TabbedPane.TabbedPane,this.tabbedPane.show(this.element),this.defaultDetailsWidget=new h.Widget.VBox,this.defaultDetailsWidget.element.classList.add("timeline-details-view"),this.defaultDetailsContentElement=this.defaultDetailsWidget.element.createChild("div","timeline-details-view-body vbox"),this.appendTab(Yi.Details,Xi(Ji.summary),this.defaultDetailsWidget),this.setPreferredTab(Yi.Details),this.rangeDetailViews=new Map,this.updateContentsScheduled=!1;const t=new xi;this.appendTab(Yi.BottomUp,Xi(Ji.bottomup),t),this.rangeDetailViews.set(Yi.BottomUp,t);const i=new Ii;this.appendTab(Yi.CallTree,Xi(Ji.callTree),i),this.rangeDetailViews.set(Yi.CallTree,i);const n=new Ui(e);this.appendTab(Yi.EventLog,Xi(Ji.eventLog),n),this.rangeDetailViews.set(Yi.EventLog,n),this.tabbedPane.addEventListener(h.TabbedPane.Events.TabSelected,this.tabSelected,this),m.TraceBounds.onChange(this.#L)}getDetailsContentElementForTest(){return this.defaultDetailsContentElement}#R(e){"RESET"!==e.updateType&&"VISIBLE_WINDOW"!==e.updateType||this.selection||this.scheduleUpdateContentsFromWindow()}async setModel(e,t,n){this.model!==e&&(this.model=e),this.#Ie=t,t&&(this.#J=i.Extras.FilmStrip.fromTraceData(t)),this.#Me=n,this.tabbedPane.closeTabs([Yi.PaintProfiler,Yi.LayerViewer],!1);for(const i of this.rangeDetailViews.values())i.setModelWithEvents(e,n,t);this.lazyPaintProfilerView=null,this.lazyLayersView=null,await this.setSelection(null)}setContent(e){const t=this.tabbedPane.otherTabs(Yi.Details);for(let e=0;e<t.length;++e)this.rangeDetailViews.has(t[e])||this.tabbedPane.closeTab(t[e]);this.defaultDetailsContentElement.removeChildren(),this.defaultDetailsContentElement.appendChild(e)}updateContents(){const e=this.rangeDetailViews.get(this.tabbedPane.selectedTabId||"");if(e){const t=m.TraceBounds.BoundsManager.instance().state();if(!t)return;const i=t.milli.timelineTraceWindow;e.updateContents(this.selection||It.fromRange(i.min,i.max))}}appendTab(e,t,i,n){this.tabbedPane.appendTab(e,t,i,void 0,void 0,n),this.preferredTabId!==this.tabbedPane.selectedTabId&&this.tabbedPane.selectTab(e)}headerElement(){return this.tabbedPane.headerElement()}setPreferredTab(e){this.preferredTabId=e}scheduleUpdateContentsFromWindow(e=!1){this.model?e?this.updateContentsFromWindow():this.updateContentsScheduled||(this.updateContentsScheduled=!0,setTimeout((()=>{this.updateContentsScheduled=!1,this.updateContentsFromWindow()}),100)):this.setContent(h.Fragment.html`<div/>`)}updateContentsFromWindow(){const e=m.TraceBounds.BoundsManager.instance().state();if(!e)return;const t=e.milli.timelineTraceWindow;this.updateSelectedRangeStats(t.min,t.max),this.updateContents()}#Ae(e){if(!this.#J)return null;const t=e.idle?e.startTime:e.endTime,n=i.Extras.FilmStrip.frameClosestToTimestamp(this.#J,t);if(!n)return null;return i.Helpers.Timing.microSecondsToMilliseconds(n.screenshotEvent.ts)-e.endTime<10?n:null}async setSelection(e){if(this.detailsLinkifier.reset(),this.selection=e,!this.selection)return void this.scheduleUpdateContentsFromWindow(!0);const t=this.selection.object;if(It.isSyntheticNetworkRequestDetailsEventSelection(t)){const e=t,i=await di.buildSyntheticNetworkRequestDetails(e,this.model.timelineModel(),this.detailsLinkifier);this.setContent(i)}else if(It.isTraceEventSelection(t)){const e=t,i=await di.buildTraceEventDetails(e,this.model.timelineModel(),this.detailsLinkifier,!0,this.#Ie);this.appendDetailsTabsForTraceEventAndShowDetails(e,i)}else if(It.isFrameObject(t)){const e=t,i=this.#Ae(e);this.setContent(di.generateDetailsContentForFrame(e,this.#J,i));const r=n.TargetManager.TargetManager.instance().rootTarget();if(e.layerTree&&r){const t=new d.TracingLayerTree.TracingFrameLayerTree(r,e.layerTree),i=this.layersView();i.showLayerTree(t),this.tabbedPane.hasTab(Yi.LayerViewer)||this.appendTab(Yi.LayerViewer,Xi(Ji.layers),i)}}else It.isRangeSelection(t)&&this.updateSelectedRangeStats(this.selection.startTime,this.selection.endTime);this.updateContents()}tabSelected(e){e.data.isUserGesture&&(this.setPreferredTab(e.data.tabId),this.updateContents())}layersView(){return this.lazyLayersView||(this.lazyLayersView=new Oi(this.model.timelineModel(),this.showSnapshotInPaintProfiler.bind(this))),this.lazyLayersView}paintProfilerView(){return this.lazyPaintProfilerView?this.lazyPaintProfilerView:this.#Ie?(this.lazyPaintProfilerView=new _i(this.#Ie),this.lazyPaintProfilerView):null}showSnapshotInPaintProfiler(e){const t=this.paintProfilerView();t&&(t.setSnapshot(e),this.tabbedPane.hasTab(Yi.PaintProfiler)||this.appendTab(Yi.PaintProfiler,Xi(Ji.paintProfiler),t,!0),this.tabbedPane.selectTab(Yi.PaintProfiler,!0))}appendDetailsTabsForTraceEventAndShowDetails(e,t){this.setContent(t),i.Legacy.eventIsFromNewEngine(e)&&(i.Types.TraceEvents.isTraceEventPaint(e)||i.Types.TraceEvents.isTraceEventRasterTask(e))&&this.showEventInPaintProfiler(e)}showEventInPaintProfiler(e){const t=n.TargetManager.TargetManager.instance().models(n.PaintProfiler.PaintProfilerModel)[0];if(!t)return;const i=this.paintProfilerView();if(!i)return;i.setEvent(t,e)&&(this.tabbedPane.hasTab(Yi.PaintProfiler)||this.appendTab(Yi.PaintProfiler,Xi(Ji.paintProfiler),i))}updateSelectedRangeStats(t,i){if(!this.model||!this.#Me)return;const n=di.statsForTimeRange(this.#Me,t,i),r=t-this.model.timelineModel().minimumRecordTime(),a=i-this.model.timelineModel().minimumRecordTime(),s=new gi(null,null);s.addSection(Xi(Ji.rangeSS,{PH1:e.TimeUtilities.millisToString(r),PH2:e.TimeUtilities.millisToString(a)}));const o=di.generatePieChart(n);s.appendElementRow("",o),this.setContent(s.fragment)}}var Yi;!function(e){e.Details="Details",e.EventLog="EventLog",e.CallTree="CallTree",e.BottomUp="BottomUp",e.PaintProfiler="PaintProfiler",e.LayerViewer="LayerViewer"}(Yi||(Yi={}));var Zi=Object.freeze({__proto__:null,TimelineDetailsView:Ki,get Tab(){return Yi}});const Qi={network:"Network"},en=e.i18n.registerUIStrings("panels/timeline/NetworkTrackAppender.ts",Qi),tn=e.i18n.getLocalizedString.bind(void 0,en);class nn{appenderName="Network";#t;#Ne;#Be;#He;constructor(e,i){this.#t=e,this.#Ne=i,this.#Be=`${s.Font.DEFAULT_FONT_SIZE} ${s.Font.getFontFamilyForCanvas()}`,t.ThemeSupport.instance().addEventListener(t.ThemeChangeEvent.eventName,(()=>{this.#He&&(this.#He.style.color=t.ThemeSupport.instance().getComputedValue("--sys-color-on-surface"),this.#He.style.backgroundColor=t.ThemeSupport.instance().getComputedValue("--sys-color-cdt-base-container"))}))}group(){return this.#He}font(){return this.#Be}appendTrackAtLevel(e,t){const i=this.#t.NetworkRequests.byTime;return 0===i.length?e:(this.#i(e,t),this.#Ue(i,e))}#i(e,t){const i=k({font:this.#Ne,shareHeaderLine:!1,useFirstLineForOverview:!1,useDecoratorsForOverview:!0});this.#He=E(0,tn(Qi.network),i,!0,t),this.#Ne.groups.push(this.#He)}#Ue(e,t){const i=[];for(let n=0;n<e.length;++n){const r=e[n],a=F(r,i);this.#We(r,t+a)}return t+i.length}#We(e,t){const n=this.#Ne.entryLevels.length;this.#Ne.entryLevels[n]=t,this.#Ne.entryStartTimes[n]=i.Helpers.Timing.microSecondsToMilliseconds(e.ts);const r=e.dur||i.Helpers.Timing.millisecondsToMicroseconds(wn);return this.#Ne.entryTotalTimes[n]=i.Helpers.Timing.microSecondsToMilliseconds(r),t}filterTimelineDataBetweenTimes(e,t){const n=this.#t.NetworkRequests.byTime;if(!this.#Ne||0===n.length)return 0;const r=[];let a=0;for(let s=0;s<n.length;++s){const o=n[s],l=i.Helpers.Timing.microSecondsToMilliseconds(o.ts),c=i.Helpers.Timing.microSecondsToMilliseconds(o.ts+o.dur);if(!(l<t&&c>e)){this.#Ne.entryLevels[s]=-1;continue}const d=F(o,r);this.#Ne.entryLevels[s]=d,a=Math.max(a,r.length)}for(let e=0;e<n.length;++e)-1===this.#Ne.entryLevels[e]&&(this.#Ne.entryLevels[e]=a);return a}colorForEvent(e){if(!i.Types.TraceEvents.isSyntheticNetworkRequestDetailsEvent(e))throw new Error(`Unexpected Network Request: The event's type is '${e.name}'`);const t=di.syntheticNetworkRequestCategory(e);return di.networkCategoryColor(t)}titleForEvent(e){return e.name}highlightedEntryInfo(e){return{title:this.titleForEvent(e),formattedTime:M(e.dur)}}}var rn=Object.freeze({__proto__:null,NetworkTrackAppender:nn});class an{#Ve;#Oe;#F;#ze;#Ge;#_e;#je;#qe;#Ie;constructor(){this.#Ve=0,this.#Oe=0,this.#F=[],this.#ze=0,this.#Ge=null,this.#Ie=null}setModel(e){this.#_e=null,this.#Ie=e,this.#F=e?.NetworkRequests.byTime||[],this.#Ie&&this.#Je(this.#Ie)}isEmpty(){return this.timelineData(),!this.#F.length}maxStackDepth(){return this.#ze}timelineData(){return this.#_e&&0!==this.#_e.entryLevels.length?this.#_e:(this.#_e=s.FlameChart.FlameChartTimelineData.createEmpty(),this.#Ie?(this.#F=this.#Ie.NetworkRequests.byTime,this.#Ge=new nn(this.#Ie,this.#_e),this.#ze=this.#Ge.appendTrackAtLevel(0),this.#_e):this.#_e)}minimumBoundary(){return this.#Ve}totalTime(){return this.#Oe}setWindowTimes(e,t){this.#$e(e,t)}createSelection(e){if(-1===e)return null;const t=this.#F[e];return this.#je=new hn(It.fromTraceEvent(t),e),this.#je.timelineSelection}entryIndexForSelection(e){if(!e)return-1;if(this.#je&&this.#je.timelineSelection.object===e.object)return this.#je.entryIndex;if(!It.isSyntheticNetworkRequestDetailsEventSelection(e.object))return-1;const t=this.#F.indexOf(e.object);return-1!==t&&(this.#je=new hn(It.fromTraceEvent(e.object),t)),t}entryColor(e){if(!this.#Ge)throw new Error("networkTrackAppender should not be empty");return this.#Ge.colorForEvent(this.#F[e])}textColor(e){return mn.textColor}entryTitle(e){const t=this.#F[e],i=new r.ParsedURL.ParsedURL(t.args.data.url);return i.isValid?`${i.displayName} (${i.host})`:t.args.data.url||null}entryFont(e){return this.#Ge?.font()||null}getDecorationPixels(e,t,n){const r=i.Helpers.Timing.microSecondsToMilliseconds(e.ts),a=e=>Math.floor(t+(e-r)*n),s=i.Helpers.Timing.microSecondsToMilliseconds(e.ts),o=i.Helpers.Timing.microSecondsToMilliseconds(e.ts+e.dur),l=i.Helpers.Timing.microSecondsToMilliseconds(e.args.data.syntheticData.sendStartTime),c=i.Helpers.Timing.microSecondsToMilliseconds(e.args.data.syntheticData.downloadStart),d=Math.max(a(l),t),h=Math.max(a(c),d),m=Math.max(a(i.Helpers.Timing.microSecondsToMilliseconds(e.args.data.syntheticData.finishTime)),h+2);return{sendStart:d,headersEnd:h,finish:m,start:a(s),end:Math.max(a(o),m)}}decorateEntry(e,i,n,r,a,s,o,l,c){const d=this.#F[e],{sendStart:m,headersEnd:p,finish:u,start:g,end:T}=this.getDecorationPixels(d,l,c);function v(e,t,n){i.moveTo(e,n-3),i.lineTo(e,n+3),i.moveTo(e,n),i.lineTo(t,n)}i.fillStyle="hsla(0, 100%, 100%, 0.8)",i.fillRect(m+.5,a+.5,p-m-.5,o-2),i.fillStyle=t.ThemeSupport.instance().getComputedValue("--sys-color-cdt-base-container"),i.fillRect(r,a-.5,m-r,o),i.fillRect(u,a-.5,r+s-u,o),i.beginPath(),i.lineWidth=1,i.strokeStyle="#ccc";const f=Math.floor(a+o/2)+.5,y=T-.5;v(g+.5,m,f),v(y,u,f),i.stroke();const w=this.#Xe(d.args.data.priority);w&&(i.fillStyle=w,i.fillRect(m+.5,a+.5,3.5,3.5));const S=Math.max(m,0),b=u-S;if(b>=20){let t=this.entryTitle(e)||"";if(d.args.data.fromServiceWorker&&(t="⚙ "+t),t){const e=4,n=o-5,r=h.UIUtils.trimTextEnd(i,t,b-2*e);i.fillStyle="#333",i.fillText(r,S+e,a+n)}}return!0}forceDecoration(e){return!0}prepareHighlightedEntryInfo(t){const n=this.#F[t],r=document.createElement("div"),a=h.Utils.createShadowRootWithCoreStyles(r,{cssFile:[Ce],delegatesFocus:void 0}).createChild("div","timeline-flamechart-popover"),l=i.Helpers.Timing.microSecondsToMilliseconds(n.ts),c=i.Helpers.Timing.microSecondsToMilliseconds(n.dur);l&&isFinite(c)&&(a.createChild("span","timeline-info-network-time").textContent=e.TimeUtilities.millisToString(c,!0));const d=a.createChild("span");return d.textContent=s.NetworkPriorities.uiLabelForNetworkPriority(n.args.data.priority),d.style.color=this.#Xe(n.args.data.priority)||"black",a.createChild("span").textContent=o.StringUtilities.trimMiddle(n.args.data.url,80),r}#Xe(e){this.#qe||(this.#qe=new Map([["VeryLow",1],["Low",2],["Medium",3],["High",4],["VeryHigh",5]]));const t=this.#qe.get(e);return t?`hsla(214, 80%, 50%, ${t/5})`:null}#Je(e){const{traceBounds:t}=e.Meta,n=i.Helpers.Timing.microSecondsToMilliseconds(t.min),r=i.Helpers.Timing.microSecondsToMilliseconds(t.max);this.#Ve=n,this.#Oe=n===r?1e3:r-this.#Ve}#$e(e,t){this.#Ge&&this.#_e&&(this.#ze=this.#Ge.filterTimelineDataBetweenTimes(i.Types.Timing.MilliSeconds(e),i.Types.Timing.MilliSeconds(t)),this.#_e=s.FlameChart.FlameChartTimelineData.create({entryLevels:this.#_e?.entryLevels,entryTotalTimes:this.#_e?.entryTotalTimes,entryStartTimes:this.#_e?.entryStartTimes,groups:this.#_e?.groups}))}preferredHeight(){if(!this.#Ge||0===this.#ze)return 0;const e=this.#Ge.group();return e?e.style.height*(this.isExpanded()?o.NumberUtilities.clamp(this.#ze+1,4,8.5):1):0}isExpanded(){return Boolean(this.#Ge?.group()?.expanded)}formatValue(t,i){return e.TimeUtilities.preciseMillisToString(t,i)}canJumpToEntry(e){return!1}mainFrameNavigationStartEvents(){return this.#Ie?this.#Ie.Meta.mainFrameNavigations:[]}}var sn=Object.freeze({__proto__:null,TimelineFlameChartNetworkDataProvider:an});const on={sAtS:"{PH1} at {PH2}"},ln=e.i18n.registerUIStrings("panels/timeline/TimelineFlameChartView.ts",on),cn=e.i18n.getLocalizedString.bind(void 0,ln);class dn extends h.Widget.VBox{delegate;model;searchResults;eventListeners;showMemoryGraphSetting;networkSplitWidget;mainDataProvider;mainFlameChart;networkFlameChartGroupExpansionSetting;networkDataProvider;networkFlameChart;networkPane;splitResizer;chartSplitWidget;countersView;detailsSplitWidget;detailsView;onMainEntrySelected;onNetworkEntrySelected;boundRefresh;#Me;groupBySetting;searchableView;needsResizeToPreferredHeights;selectedSearchResult;searchRegex;#Ie;#Ke=null;#L=this.#R.bind(this);constructor(e){super(),this.element.classList.add("timeline-flamechart"),this.delegate=e,this.model=null,this.eventListeners=[],this.#Ie=null,this.showMemoryGraphSetting=r.Settings.Settings.instance().createSetting("timelineShowMemory",!1),this.networkSplitWidget=new h.SplitWidget.SplitWidget(!1,!1,"timelineFlamechartMainView",150),this.networkSplitWidget.sidebarElement().style.zIndex="120";const t=r.Settings.Settings.instance().createSetting("timelineFlamechartMainViewGroupExpansion",{});this.mainDataProvider=new yn,this.mainDataProvider.addEventListener(Sn.DataChanged,(()=>this.mainFlameChart.scheduleUpdate())),this.mainFlameChart=new s.FlameChart.FlameChart(this.mainDataProvider,this,t),this.mainFlameChart.alwaysShowVerticalScroll(),this.mainFlameChart.enableRuler(!1),this.mainFlameChart.addEventListener(s.FlameChart.Events.TreeModified,(e=>{this.mainDataProvider.modifyTree(e.data.group,e.data.node,e.data.action,this.mainFlameChart)})),this.networkFlameChartGroupExpansionSetting=r.Settings.Settings.instance().createSetting("timelineFlamechartNetworkViewGroupExpansion",{}),this.networkDataProvider=new an,this.networkFlameChart=new s.FlameChart.FlameChart(this.networkDataProvider,this,this.networkFlameChartGroupExpansionSetting),this.networkFlameChart.alwaysShowVerticalScroll(),this.networkPane=new h.Widget.VBox,this.networkPane.setMinimumSize(23,23),this.networkFlameChart.show(this.networkPane.element),this.splitResizer=this.networkPane.element.createChild("div","timeline-flamechart-resizer"),this.networkSplitWidget.hideDefaultResizer(!0),this.networkSplitWidget.installResizer(this.splitResizer),this.networkSplitWidget.setMainWidget(this.mainFlameChart),this.networkSplitWidget.setSidebarWidget(this.networkPane),this.chartSplitWidget=new h.SplitWidget.SplitWidget(!1,!0,"timelineCountersSplitViewState"),this.countersView=new Me(this.delegate),this.chartSplitWidget.setMainWidget(this.networkSplitWidget),this.chartSplitWidget.setSidebarWidget(this.countersView),this.chartSplitWidget.hideDefaultResizer(),this.chartSplitWidget.installResizer(this.countersView.resizerElement()),this.updateCountersGraphToggle(),this.detailsSplitWidget=new h.SplitWidget.SplitWidget(!1,!0,"timelinePanelDetailsSplitViewState"),this.detailsSplitWidget.element.classList.add("timeline-details-split"),this.detailsView=new Ki(e),this.detailsSplitWidget.installResizer(this.detailsView.headerElement()),this.detailsSplitWidget.setMainWidget(this.chartSplitWidget),this.detailsSplitWidget.setSidebarWidget(this.detailsView),this.detailsSplitWidget.show(this.element),this.onMainEntrySelected=this.onEntrySelected.bind(this,this.mainDataProvider),this.onNetworkEntrySelected=this.onEntrySelected.bind(this,this.networkDataProvider),this.mainFlameChart.addEventListener(s.FlameChart.Events.EntrySelected,this.onMainEntrySelected,this),this.mainFlameChart.addEventListener(s.FlameChart.Events.EntryInvoked,this.onMainEntrySelected,this),this.mainFlameChart.addEventListener(s.FlameChart.Events.EntriesModified,this.onEntriesModified,this),this.networkFlameChart.addEventListener(s.FlameChart.Events.EntrySelected,this.onNetworkEntrySelected,this),this.networkFlameChart.addEventListener(s.FlameChart.Events.EntryInvoked,this.onNetworkEntrySelected,this),this.mainFlameChart.addEventListener(s.FlameChart.Events.EntryHighlighted,this.onEntryHighlighted,this),this.boundRefresh=this.#Ye.bind(this),this.#Me=null,this.mainDataProvider.setEventColorMapping(di.eventColor),this.groupBySetting=r.Settings.Settings.instance().createSetting("timelineTreeGroupBy",Ri.GroupBy.None),this.groupBySetting.addChangeListener(this.updateColorMapper,this),this.updateColorMapper(),m.TraceBounds.onChange(this.#L)}#R(e){if("MINIMAP_BOUNDS"===e.updateType)return;const t=e.state.milli.timelineTraceWindow,i=Boolean(e.options.shouldAnimate);this.mainFlameChart.setWindowTimes(t.min,t.max,i),this.networkDataProvider.setWindowTimes(t.min,t.max),this.networkFlameChart.setWindowTimes(t.min,t.max,i),this.updateSearchResults(!1,!1)}onEntriesModified(){if(!this.model)return;this.mainDataProvider.timelineData(!0);const e=m.TraceBounds.BoundsManager.instance().state();if(e){const t=e.milli.timelineTraceWindow;this.mainFlameChart.setWindowTimes(t.min,t.max)}this.mainFlameChart.update()}isNetworkTrackShownForTests(){return this.networkSplitWidget.showMode()!==h.SplitWidget.ShowMode.OnlyMain}getMainDataProvider(){return this.mainDataProvider}updateColorMapper(){this.model&&(this.mainDataProvider.setEventColorMapping(di.eventColor),this.mainFlameChart.update())}windowChanged(e,t,n){m.TraceBounds.BoundsManager.instance().setTimelineVisibleWindow(i.Helpers.Timing.traceWindowFromMilliSeconds(i.Types.Timing.MilliSeconds(e),i.Types.Timing.MilliSeconds(t)),{shouldAnimate:n})}updateRangeSelection(e,t){this.delegate.select(It.fromRange(e,t))}getMainFlameChart(){return this.mainFlameChart}updateSelectedGroup(e,t){e===this.mainFlameChart&&this.#Ke!==t?.name&&(this.#Ke=t?.name||null,this.#Me=t?this.mainDataProvider.groupTreeEvents(t):null,this.#Ze())}setModel(e,t,i=!1){if(e===this.model)return;this.#Ke=null,this.#Ie=t,r.EventTarget.removeEventListeners(this.eventListeners),this.model=e,this.#Me=null,this.mainDataProvider.setModel(this.model,t,i),this.networkDataProvider.setModel(t),this.#Ye();const n=m.TraceBounds.BoundsManager.instance().state();if(!n)throw new Error("TimelineFlameChartView could not set the window bounds.");const a=n.milli.timelineTraceWindow;this.mainFlameChart.setWindowTimes(a.min,a.max),this.networkDataProvider.setWindowTimes(a.min,a.max),this.networkFlameChart.setWindowTimes(a.min,a.max),this.updateSearchResults(!1,!1),this.updateColorMapper(),this.#Qe()}#Ye(){this.networkDataProvider.isEmpty()?(this.mainFlameChart.enableRuler(!0),this.networkSplitWidget.hideSidebar()):(this.mainFlameChart.enableRuler(!1),this.networkSplitWidget.showBoth(),this.resizeToPreferredHeights()),this.mainFlameChart.reset(),this.networkFlameChart.reset(),this.updateSearchResults(!1,!1)}#Ze(){this.countersView.setModel(this.#Ie,this.#Me),this.detailsView.setModel(this.model,this.#Ie,this.#Me)}#Qe(){this.mainFlameChart.scheduleUpdate(),this.networkFlameChart.scheduleUpdate()}onEntryHighlighted(e){n.OverlayModel.OverlayModel.hideDOMNodeHighlight();const t=e.data,r=this.mainDataProvider.eventByIndex(t);if(!r)return;const a=this.model&&this.model.timelineModel().targetByEvent(r);if(!a)return;let s;if(r instanceof i.Legacy.Event){s=d.TimelineModel.EventOnTimelineData.forEvent(r).backendNodeIds}else if(i.Types.TraceEvents.isTraceEventLayoutShift(r)){s=(r.args.data?.impacted_nodes??[]).map((e=>e.node_id))}if(s)for(let e=0;e<s.length;++e)new n.DOMModel.DeferredDOMNode(a,s[e]).highlight()}highlightEvent(e){const t=e?this.mainDataProvider.entryIndexForSelection(It.fromTraceEvent(e)):-1;t>=0?this.mainFlameChart.highlightEntry(t):this.mainFlameChart.hideHighlight()}willHide(){this.networkFlameChartGroupExpansionSetting.removeChangeListener(this.resizeToPreferredHeights,this),this.showMemoryGraphSetting.removeChangeListener(this.updateCountersGraphToggle,this),c.IgnoreListManager.IgnoreListManager.instance().removeChangeListener(this.boundRefresh)}wasShown(){this.networkFlameChartGroupExpansionSetting.addChangeListener(this.resizeToPreferredHeights,this),this.showMemoryGraphSetting.addChangeListener(this.updateCountersGraphToggle,this),c.IgnoreListManager.IgnoreListManager.instance().addChangeListener(this.boundRefresh),this.needsResizeToPreferredHeights&&this.resizeToPreferredHeights(),this.#Qe()}updateCountersGraphToggle(){this.showMemoryGraphSetting.get()?this.chartSplitWidget.showBoth():this.chartSplitWidget.hideSidebar()}setSelection(e){let t=this.mainDataProvider.entryIndexForSelection(e);this.mainFlameChart.setSelectedEntry(t),t=this.networkDataProvider.entryIndexForSelection(e),this.networkFlameChart.setSelectedEntry(t),this.detailsView&&this.detailsView.setSelection(e)}onEntrySelected(e,t){const i=t.data;e===this.mainDataProvider&&this.mainDataProvider.buildFlowForInitiator(i)&&this.mainFlameChart.scheduleUpdate(),this.delegate.select(e.createSelection(i))}resizeToPreferredHeights(){this.isShowing()?(this.needsResizeToPreferredHeights=!1,this.networkPane.element.classList.toggle("timeline-network-resizer-disabled",!this.networkDataProvider.isExpanded()),this.networkSplitWidget.setSidebarSize(this.networkDataProvider.preferredHeight()+this.splitResizer.clientHeight+s.FlameChart.RulerHeight+2)):this.needsResizeToPreferredHeights=!0}setSearchableView(e){this.searchableView=e}jumpToNextSearchResult(){if(!this.searchResults||!this.searchResults.length)return;const e=void 0!==this.selectedSearchResult?this.searchResults.indexOf(this.selectedSearchResult):-1;this.selectSearchResult(o.NumberUtilities.mod(e+1,this.searchResults.length))}jumpToPreviousSearchResult(){if(!this.searchResults||!this.searchResults.length)return;const e=void 0!==this.selectedSearchResult?this.searchResults.indexOf(this.selectedSearchResult):0;this.selectSearchResult(o.NumberUtilities.mod(e-1,this.searchResults.length))}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}selectSearchResult(e){this.searchableView.updateCurrentMatchIndex(e),this.searchResults&&(this.selectedSearchResult=this.searchResults[e],this.delegate.select(this.mainDataProvider.createSelection(this.selectedSearchResult)))}updateSearchResults(e,t){const i=m.TraceBounds.BoundsManager.instance().state();if(!i)return;const n=this.selectedSearchResult;if(delete this.selectedSearchResult,this.searchResults=[],!this.searchRegex||!this.model)return;const r=new Si(this.searchRegex),a=i.milli.timelineTraceWindow;if(this.searchResults=this.mainDataProvider.search(a.min,a.max,r),this.searchableView.updateSearchMatchesCount(this.searchResults.length),!e||!this.searchResults.length)return;let s=this.searchResults.indexOf(n);-1===s&&(s=t?this.searchResults.length-1:0),this.selectSearchResult(s)}getSearchResults(){return this.searchResults}onSearchCanceled(){void 0!==this.selectedSearchResult&&this.delegate.select(null),delete this.searchResults,delete this.selectedSearchResult,delete this.searchRegex}performSearch(e,t,i){this.searchRegex=e.toSearchRegex().regex,this.updateSearchResults(t,i)}}class hn{timelineSelection;entryIndex;constructor(e,t){this.timelineSelection=e,this.entryIndex=t}}const mn={textColor:"#333"};class pn{startTimeInternal;startOffset;style;constructor(e,t,i){this.startTimeInternal=e,this.startOffset=t,this.style=i}startTime(){return this.startTimeInternal}color(){return this.style.color}title(){if(this.style.lowPriority)return null;const t=e.TimeUtilities.millisToString(this.startOffset);return cn(on.sAtS,{PH1:this.style.title,PH2:t})}draw(e,t,i,n){this.style.lowPriority&&n<4||(e.save(),this.style.tall&&(e.strokeStyle=this.style.color,e.lineWidth=this.style.lineWidth,e.translate(this.style.lineWidth<1||1&this.style.lineWidth?.5:0,.5),e.beginPath(),e.moveTo(t,0),e.setLineDash(this.style.dashStyle),e.lineTo(t,e.canvas.height),e.stroke()),e.restore())}}var un;!function(e){e.URL="URL"}(un||(un={}));var gn=Object.freeze({__proto__:null,TimelineFlameChartView:dn,Selection:hn,FlameChartStyle:mn,TimelineFlameChartMarker:pn,get ColorBy(){return un}});const Tn={onIgnoreList:"On ignore list",mainS:"Main — {PH1}",main:"Main",frameS:"Frame — {PH1}",subframe:"Subframe",raster:"Raster",rasterizerThreadS:"Rasterizer Thread {PH1}",thread:"Thread",frames:"Frames",sSelfS:"{PH1} (self {PH2})",idleFrame:"Idle Frame",droppedFrame:"Dropped Frame",partiallyPresentedFrame:"Partially Presented Frame",frame:"Frame"},vn=e.i18n.registerUIStrings("panels/timeline/TimelineFlameChartDataProvider.ts",Tn),fn=e.i18n.getLocalizedString.bind(void 0,vn);class yn extends r.ObjectWrapper.ObjectWrapper{droppedFramePatternCanvas;partialFramePatternCanvas;timelineDataInternal;currentLevel;legacyPerformanceModel;compatibilityTracksAppender;legacyTimelineModel;traceEngineData;isCpuProfile=!1;#et=0;minimumBoundaryInternal;timeSpan;headerLevel1;headerLevel2;staticHeader;framesHeader;screenshotsHeader;entryData;entryTypeByLevel;screenshotImageCache;entryIndexToTitle;asyncColorByCategory;lastInitiatorEntry;entryParent;lastSelection;colorForEvent;#tt=new WeakMap;#Be;#it=new WeakMap;constructor(){super(),this.reset(),this.#Be=`${s.Font.DEFAULT_FONT_SIZE} ${s.Font.getFontFamilyForCanvas()}`,this.droppedFramePatternCanvas=document.createElement("canvas"),this.partialFramePatternCanvas=document.createElement("canvas"),this.preparePatternCanvas(),this.timelineDataInternal=null,this.currentLevel=0,this.legacyPerformanceModel=null,this.legacyTimelineModel=null,this.compatibilityTracksAppender=null,this.traceEngineData=null,this.minimumBoundaryInternal=0,this.timeSpan=0,this.headerLevel1=this.buildGroupStyle({shareHeaderLine:!1}),this.headerLevel2=this.buildGroupStyle({padding:2,nestingLevel:1,collapsible:!1}),this.staticHeader=this.buildGroupStyle({collapsible:!1}),this.framesHeader=this.buildGroupStyle({useFirstLineForOverview:!0}),this.screenshotsHeader=this.buildGroupStyle({useFirstLineForOverview:!0,nestingLevel:1,collapsible:!1,itemsHeight:150}),t.ThemeSupport.instance().addEventListener(t.ThemeChangeEvent.eventName,(()=>{const e=[this.headerLevel1,this.headerLevel2,this.staticHeader,this.framesHeader,this.screenshotsHeader];for(const i of e)i.color=t.ThemeSupport.instance().getComputedValue("--sys-color-on-surface"),i.backgroundColor=t.ThemeSupport.instance().getComputedValue("--sys-color-cdt-base-container")}))}modifyTree(e,t,i,n){const r=this.entryData[t];this.compatibilityTracksAppender?.modifyTree(e,r,i,n)}buildGroupStyle(e){const i={padding:4,height:17,collapsible:!0,color:t.ThemeSupport.instance().getComputedValue("--sys-color-on-surface"),backgroundColor:t.ThemeSupport.instance().getComputedValue("--sys-color-cdt-base-container"),nestingLevel:0,shareHeaderLine:!0};return Object.assign(i,e)}setModel(e,t,n=!1){if(this.reset(),this.legacyPerformanceModel=e,this.legacyTimelineModel=e&&e.timelineModel(),this.traceEngineData=t,this.isCpuProfile=n,t){const{traceBounds:e}=t.Meta,n=i.Helpers.Timing.microSecondsToMilliseconds(e.min),r=i.Helpers.Timing.microSecondsToMilliseconds(e.max);this.minimumBoundaryInternal=n,this.timeSpan=n===r?1e3:r-this.minimumBoundaryInternal}}compatibilityTracksAppenderInstance(e=!1){if(!this.compatibilityTracksAppender||e){if(!this.traceEngineData||!this.legacyTimelineModel)throw new Error("Attempted to instantiate a CompatibilityTracksAppender without having set the trace parse data first.");this.timelineDataInternal=this.#nt(),this.compatibilityTracksAppender=new Rn(this.timelineDataInternal,this.traceEngineData,this.entryData,this.entryTypeByLevel,this.legacyTimelineModel)}return this.compatibilityTracksAppender}#nt(){return this.timelineDataInternal||(this.timelineDataInternal=s.FlameChart.FlameChartTimelineData.createEmpty()),this.timelineDataInternal}buildFromTrackAppenders(e){if(!this.compatibilityTracksAppender)return;const t=this.compatibilityTracksAppender.allVisibleTrackAppenders();for(const i of t){if(i instanceof ve&&!i.trackName().includes(e?.filterThreadsByName||""))continue;const t=Boolean(e?.expandedTracks?.has(i.appenderName));this.currentLevel=i.appendTrackAtLevel(this.currentLevel,t)}}groupTrack(e){return e.track||null}groupTreeEvents(e){return this.compatibilityTracksAppender?.groupEventsForTreeView(e)??null}mainFrameNavigationStartEvents(){return this.traceEngineData?this.traceEngineData.Meta.mainFrameNavigations:[]}entryTitle(e){const t=bn,i=this.entryType(e);if(i===t.Event){const t=this.entryData[e];return"T"===t.phase||"p"===t.phase?t.name+":"+t.args.step:this.#tt.get(t)?fn(Tn.onIgnoreList):di.eventTitle(t)}if(i===t.Screenshot)return"";if(i===t.TrackAppender){const t=this.timelineDataInternal.entryLevels[e],i=this.entryData[e];return this.compatibilityTracksAppender?.titleForEvent(i,t)||null}let n=this.entryIndexToTitle[e];return n||(n=`Unexpected entryIndex ${e}`,console.error(n)),n}textColor(e){const t=this.entryData[e];return yn.isEntryRegularEvent(t)&&this.isIgnoreListedEvent(t)?"#888":mn.textColor}entryFont(e){return this.#Be}reset(e=!0){this.currentLevel=0,this.entryData=[],this.entryParent=[],this.entryTypeByLevel=[],this.entryIndexToTitle=[],this.asyncColorByCategory=new Map,this.screenshotImageCache=new Map,this.#tt=new WeakMap,e?(this.compatibilityTracksAppender=null,this.timelineDataInternal=null):!e&&this.timelineDataInternal&&(this.compatibilityTracksAppender?.setFlameChartDataAndEntryData(this.timelineDataInternal,this.entryData,this.entryTypeByLevel),this.compatibilityTracksAppender?.threadAppenders().forEach((e=>e.setHeaderAppended(!1))))}maxStackDepth(){return this.currentLevel}timelineData(e=!1){return this.timelineDataInternal&&0!==this.timelineDataInternal.entryLevels.length&&!e?this.timelineDataInternal:(this.timelineDataInternal=s.FlameChart.FlameChartTimelineData.createEmpty(),this.legacyTimelineModel?(e&&this.reset(!1),this.currentLevel=0,this.traceEngineData&&(this.compatibilityTracksAppender=this.compatibilityTracksAppenderInstance(),this.traceEngineData.Meta.traceIsGeneric?this.#rt():this.processInspectorTrace()),this.timelineDataInternal):this.timelineDataInternal)}#rt(){if(!this.compatibilityTracksAppender)return;const e=this.compatibilityTracksAppender.allThreadAppendersByProcess();for(const[t,i]of e){const e=this.buildGroupStyle({shareHeaderLine:!1}),n=this.traceEngineData?.Meta.processNames.get(t)?.args.name||"Process";this.appendHeader(`${n} (${t})`,e,!0,!1);for(const e of i)e.setHeaderNestingLevel(1),this.currentLevel=e.appendTrackAtLevel(this.currentLevel)}}processInspectorTrace(){this.isCpuProfile||this.appendFrames();const e=e=>{if(void 0!==e.appenderName)switch(e.appenderName){case"Animations":return 0;case"Timings":return 1;case"Interactions":return 2;case"LayoutShifts":return 3;case"GPU":return 8;case"Thread":return 4;case"Thread_AuctionWorklet":return 10;default:return-1}switch(e.type){case d.TimelineModel.TrackType.MainThread:return e.forMainFrame?5:6;case d.TimelineModel.TrackType.Worker:return 7;case d.TimelineModel.TrackType.Raster:return 9;case d.TimelineModel.TrackType.Other:return 11;default:return-1}};if(!this.legacyTimelineModel)return;const t=this.compatibilityTracksAppender?this.compatibilityTracksAppender.allVisibleTrackAppenders():[];t.sort(((t,i)=>e(t)-e(i)));for(const e of t)if(this.traceEngineData&&(this.currentLevel=e.appendTrackAtLevel(this.currentLevel),this.timelineDataInternal&&!this.timelineDataInternal.selectedGroup&&e instanceof ve&&("MAIN_THREAD"===e.threadType||"CPU_PROFILE"===e.threadType))){const t=this.compatibilityTracksAppender?.groupForAppender(e);t&&(this.timelineDataInternal.selectedGroup=t)}this.timelineDataInternal&&this.timelineDataInternal.selectedGroup&&(this.timelineDataInternal.selectedGroup.expanded=!0)}#at(e,t){if(!this.timelineDataInternal)return;const i=this.timelineDataInternal.entryDecorations[e]||[];i.push(t),this.timelineDataInternal.entryDecorations[e]=i}appendLegacyTrackData(e,t){this.#nt();const i=bn.Event;switch(e.type){case d.TimelineModel.TrackType.MainThread:if(e.forMainFrame){const n=this.appendSyncEvents(e,e.events,e.url?fn(Tn.mainS,{PH1:e.url}):fn(Tn.main),this.headerLevel1,i,!0,t);n&&this.timelineDataInternal&&(this.timelineDataInternal.selectedGroup=n)}else this.appendSyncEvents(e,e.events,e.url?fn(Tn.frameS,{PH1:e.url}):fn(Tn.subframe),this.headerLevel1,i,!0,t);break;case d.TimelineModel.TrackType.Worker:this.appendSyncEvents(e,e.events,e.name,this.headerLevel1,i,!0,t);break;case d.TimelineModel.TrackType.Raster:this.#et||this.appendHeader(fn(Tn.raster),this.headerLevel1,!1,t),++this.#et,this.appendSyncEvents(e,e.events,fn(Tn.rasterizerThreadS,{PH1:this.#et}),this.headerLevel2,i,!0,t);break;case d.TimelineModel.TrackType.Other:this.appendSyncEvents(e,e.events,e.name||fn(Tn.thread),this.headerLevel1,i,!0,t),this.appendAsyncEventsGroup(e,e.name,e.asyncEvents,this.headerLevel1,i,!0,t)}}minimumBoundary(){return this.minimumBoundaryInternal}totalTime(){return this.timeSpan}static isEntryRegularEvent(e){return"name"in e}search(e,t,n){const r=[];this.timelineData();for(let a=0;a<this.entryData.length;++a){const s=this.entryData[a];if(!yn.isEntryRegularEvent(s))continue;if(!s)continue;const o=i.Legacy.eventIsFromNewEngine(s)?i.Helpers.Timing.eventTimingsMilliSeconds(s).startTime:s.startTime,l=i.Legacy.eventIsFromNewEngine(s)?i.Helpers.Timing.eventTimingsMilliSeconds(s).endTime:s.endTime;o>t||((l||o)<e||n.accept(s,this.traceEngineData||void 0)&&r.push(a))}return r.sort(((e,t)=>{let n=this.entryData[e],r=this.entryData[t];return yn.isEntryRegularEvent(n)&&yn.isEntryRegularEvent(r)?(n=n instanceof i.Legacy.Event?n:this.compatibilityTracksAppender?.getLegacyEvent(n)||null,r=r instanceof i.Legacy.Event?r:this.compatibilityTracksAppender?.getLegacyEvent(r)||null,n&&r?i.Legacy.Event.compareStartTime(n,r):0):0})),r}appendSyncEvents(e,t,n,r,a,s,o){if(!t.length)return null;if(!this.legacyPerformanceModel||!this.legacyTimelineModel)return null;const c=[],h=l.Runtime.experiments.isEnabled("ignoreListJSFramesOnTimeline");let m=0,p=null;e&&e.type===d.TimelineModel.TrackType.MainThread&&(p=this.appendHeader(n,r,s,o),p.track=e);for(let a=0;a<t.length;++a){const l=t[a],{duration:u}=i.Legacy.timesForEventInMilliseconds(l);if(this.legacyPerformanceModel){const t=this.legacyPerformanceModel.timelineModel().isInteractiveTimeEvent(l),i=this.legacyPerformanceModel.timelineModel().isLayoutShiftEvent(l),n=t||i;if(e&&e.type===d.TimelineModel.TrackType.MainThread&&n)continue}if(!i.Types.TraceEvents.isFlowPhase(l.phase)){if(!l.endTime&&"I"!==l.phase)continue;if(i.Types.TraceEvents.isAsyncPhase(l.phase))continue;if(!we.instance().isVisible(l))continue}for(;c.length&&c[c.length-1].endTime<=l.startTime;)c.pop();if(this.#tt.set(l,!1),h&&this.isIgnoreListedEvent(l)){const e=c[c.length-1];if(e&&this.#tt.get(e))continue;this.#tt.set(l,!0)}!p&&n&&(p=this.appendHeader(n,r,s,o),s&&(p.track=e));const g=this.currentLevel+c.length,T=this.appendEvent(l,g);c.length&&(this.entryParent[T]=c[c.length-1]);Boolean(e?.forMainFrame&&e?.type===d.TimelineModel.TrackType.MainThread)&&l.name===d.TimelineModel.RecordType.Task&&i.Helpers.Timing.millisecondsToMicroseconds(u)>i.Handlers.ModelHandlers.Warnings.LONG_MAIN_THREAD_TASK_THRESHOLD&&this.#at(T,{type:"CANDY",startAtTime:i.Handlers.ModelHandlers.Warnings.LONG_MAIN_THREAD_TASK_THRESHOLD}),m=Math.max(m,c.length+1),l.endTime&&c.push(l)}return this.entryTypeByLevel.length=this.currentLevel+m,this.entryTypeByLevel.fill(a,this.currentLevel),this.currentLevel+=m,p}isIgnoreListedEvent(e){return!(!i.Legacy.eventIsFromNewEngine(e)||!i.Types.TraceEvents.isProfileCall(e))&&this.isIgnoreListedURL(e.callFrame.url)}isIgnoreListedURL(e){return c.IgnoreListManager.IgnoreListManager.instance().isUserIgnoreListedURL(e)}appendAsyncEventsGroup(e,t,i,n,r,a,s){if(!i.length)return null;const o=[];let l=null;for(let r=0;r<i.length;++r){const c=i[r];if(!this.legacyPerformanceModel||!we.instance().isVisible(c))continue;!l&&t&&(l=this.appendHeader(t,n,a,s),a&&(l.track=e));const d=c.startTime;let h;for(h=0;h<o.length&&o[h]>d;++h);this.appendAsyncEvent(c,this.currentLevel+h),o[h]=c.endTime}return this.entryTypeByLevel.length=this.currentLevel+o.length,this.entryTypeByLevel.fill(r,this.currentLevel),this.currentLevel+=o.length,l}getEntryTypeForLevel(e){return this.entryTypeByLevel[e]}appendFrames(){if(!(this.legacyPerformanceModel&&this.timelineDataInternal&&this.legacyTimelineModel&&this.traceEngineData))return;const e=i.Extras.FilmStrip.fromTraceData(this.traceEngineData),t=e.frames.length>0;this.framesHeader.collapsible=t;const n="frames"===l.Runtime.Runtime.queryParam("flamechart-force-expand");this.appendHeader(fn(Tn.frames),this.framesHeader,!1,n),this.entryTypeByLevel[this.currentLevel]=bn.Frame;for(const e of this.traceEngineData.Frames.frames)this.#st(e);++this.currentLevel,t&&this.#ot(e)}#ot(e){if(!this.timelineDataInternal||!this.legacyTimelineModel)return;let t;this.appendHeader("",this.screenshotsHeader,!1),this.entryTypeByLevel[this.currentLevel]=bn.Screenshot;for(const n of e.frames){const e=i.Helpers.Timing.microSecondsToMilliseconds(n.screenshotEvent.ts);this.entryData.push(n.screenshotEvent),this.timelineDataInternal.entryLevels.push(this.currentLevel),this.timelineDataInternal.entryStartTimes.push(e),t&&this.timelineDataInternal.entryTotalTimes.push(e-t),t=e}e.frames.length&&void 0!==t&&this.timelineDataInternal.entryTotalTimes.push(this.legacyTimelineModel.maximumRecordTime()-t),++this.currentLevel}entryType(e){return this.entryTypeByLevel[this.timelineDataInternal.entryLevels[e]]}prepareHighlightedEntryInfo(t){let n,r="",s=[],o="timeline-info-time";const l=[],c=this.entryType(t);if(c===bn.TrackAppender){if(!this.compatibilityTracksAppender)return null;const e=this.entryData[t],o=this.timelineDataInternal.entryLevels[t],c=this.compatibilityTracksAppender.highlightedEntryInfo(e,o);if(n=c.title,r=c.formattedTime,s=c.warningElements||s,i.Types.TraceEvents.isSyntheticInteractionEvent(e)){const t=new a.InteractionBreakdown.InteractionBreakdown;t.entry=e,l.push(t)}}else if(c===bn.Event){const i=this.entryData[t],a=i.duration,s=i.selfTime,o=1e-6;"number"==typeof a&&(r=Math.abs(a-s)>o&&s>o?fn(Tn.sSelfS,{PH1:e.TimeUtilities.millisToString(a,!0),PH2:e.TimeUtilities.millisToString(s,!0)}):e.TimeUtilities.millisToString(a,!0)),n=this.entryTitle(t)}else{if(c!==bn.Frame)return null;{const a=this.entryData[t];r=e.TimeUtilities.preciseMillisToString(i.Helpers.Timing.microSecondsToMilliseconds(a.duration),1),a.idle?n=fn(Tn.idleFrame):a.dropped?(n=a.isPartial?fn(Tn.partiallyPresentedFrame):fn(Tn.droppedFrame),o="timeline-info-warning"):n=fn(Tn.frame)}}const d=document.createElement("div"),m=h.Utils.createShadowRootWithCoreStyles(d,{cssFile:[Ce],delegatesFocus:void 0}).createChild("div","timeline-flamechart-popover");if(m.createChild("span",o).textContent=r,m.createChild("span","timeline-info-title").textContent=n,s)for(const e of s)e.classList.add("timeline-info-warning"),m.appendChild(e);for(const e of l)m.appendChild(e);return d}entryColor(e){if(!this.legacyPerformanceModel||!this.legacyTimelineModel)return"";const t=bn,n=this.entryType(e);if(n===t.Event){const t=this.entryData[e];if(this.legacyTimelineModel.isGenericTrace())return this.genericTraceEventColor(t);if(this.legacyPerformanceModel.timelineModel().isMarkerEvent(t))return di.markerStyleForEvent(t).color;if(!i.Types.TraceEvents.isAsyncPhase(t.phase)&&this.colorForEvent)return this.colorForEvent(t);const n=di.eventStyle(t).category;return function(e,t,i){let n=e.get(t);if(n)return n;const r=i(t);if(!r)throw new Error("Could not parse color from entry");return n=r,e.set(t,n),n}(this.asyncColorByCategory,n,(()=>n.getComputedColorValue()))}if(n===t.Frame)return"white";if(n===t.TrackAppender){const t=this.timelineDataInternal.entryLevels[e],i=this.entryData[e];return this.compatibilityTracksAppender?.colorForEvent(i,t)||""}return""}genericTraceEventColor(e){const t=e.categoriesString||e.name;return t?`hsl(${o.StringUtilities.hashCode(t)%300+30}, 40%, 70%)`:"#ccc"}preparePatternCanvas(){const e=17;this.droppedFramePatternCanvas.width=e,this.droppedFramePatternCanvas.height=e,this.partialFramePatternCanvas.width=e,this.partialFramePatternCanvas.height=e;const t=this.droppedFramePatternCanvas.getContext("2d");if(t){t.translate(8.5,8.5),t.rotate(.25*Math.PI),t.translate(-8.5,-8.5),t.fillStyle="rgb(255, 255, 255)";for(let e=-17;e<34;e+=3)t.fillRect(e,-17,1,51)}const i=this.partialFramePatternCanvas.getContext("2d");i&&(i.strokeStyle="rgb(255, 255, 255)",i.lineWidth=2,i.beginPath(),i.moveTo(17,0),i.lineTo(10,7),i.moveTo(8,9),i.lineTo(2,15),i.stroke())}drawFrame(t,n,r,a,s,o,l){const c=this.entryData[t];if(a+=1,o-=2,c.idle)n.fillStyle="white";else if(c.dropped)if(c.isPartial){n.fillStyle="#f0e442",n.fillRect(a,s,o,l);const e=n.createPattern(this.partialFramePatternCanvas,"repeat");n.fillStyle=e||n.fillStyle}else{n.fillStyle="#f08080",n.fillRect(a,s,o,l);const e=n.createPattern(this.droppedFramePatternCanvas,"repeat");n.fillStyle=e||n.fillStyle}else n.fillStyle="#d7f0d1";n.fillRect(a,s,o,l);const d=e.TimeUtilities.preciseMillisToString(i.Helpers.Timing.microSecondsToMilliseconds(c.duration),1),h=n.measureText(d).width;h<=o&&(n.fillStyle=this.textColor(t),n.fillText(d,a+(o-h)/2,s+l-4))}async drawScreenshot(e,t,i,n,r,a){const s=this.entryData[e];if(!this.screenshotImageCache.has(s)){this.screenshotImageCache.set(s,null);const e=s.args.snapshot,t=await h.UIUtils.loadImageFromData(e);return this.screenshotImageCache.set(s,t),void this.dispatchEventToListeners(Sn.DataChanged)}const o=this.screenshotImageCache.get(s);if(!o)return;const l=i+1,c=n+1,d=a-2,m=d/o.naturalHeight,p=Math.floor(o.naturalWidth*m);t.save(),t.beginPath(),t.rect(i,n,r,a),t.clip(),t.drawImage(o,l,c,p,d),t.strokeStyle="#ccc",t.strokeRect(l-.5,c-.5,Math.min(r-1,p+1),d),t.restore()}decorateEntry(e,t,n,r,a,s,o,l,c){const d=this.entryType(e);if(d===bn.Frame)return this.drawFrame(e,t,n,r,a,s,o),!0;if(d===bn.Screenshot)return this.drawScreenshot(e,t,r,a,s,o),!0;if(d===bn.TrackAppender){const d=this.entryData[e];if(i.Types.TraceEvents.isSyntheticInteractionEvent(d))return this.#lt(t,e,n,d,r,a,l,s,o,c),!0}return!1}#lt(e,n,r,a,s,o,l,c,d,m){const p=i.Helpers.Timing.microSecondsToMilliseconds(a.ts),u=s+c;function g(e){const t=i.Helpers.Timing.microSecondsToMilliseconds(e);return Math.floor(l+(t-p)*m)}e.save(),e.fillStyle=t.ThemeSupport.instance().getComputedValue("--sys-color-cdt-base-container");let T=g(a.processingStart);const v=g(a.processingEnd);function f(t,i,n){e.moveTo(t,n-3),e.lineTo(t,n+3),e.moveTo(t,n),e.lineTo(i,n)}a.processingEnd-a.processingStart==0&&(T-=1),e.fillRect(s,o-.5,T-s,d),e.fillRect(v,o-.5,u-v,d);const y=g(a.ts),w=g(i.Types.Timing.MicroSeconds(a.ts+a.dur));e.beginPath(),e.lineWidth=1,e.strokeStyle="#ccc";const S=Math.floor(o+d/2)+.5,b=w-.5;if(f(y+.5,T,S),f(b,v,S),e.stroke(),r){const t=T>0?T:s;e.font=this.#Be;const i=5,a=5;h.UIUtils.measureTextWidth(e,r)<=v-t+i&&(e.fillStyle=this.textColor(n),e.fillText(r,t+i,o+d-a))}e.restore()}forceDecoration(e){const t=bn,n=this.entryType(e);if(n===t.Frame)return!0;if(n===t.Screenshot)return!0;if(n===t.Event)return!1;const r=this.entryData[e];return!!i.Types.TraceEvents.isSyntheticInteractionEvent(r)||Boolean(this.traceEngineData?.Warnings.perEvent.get(r))}appendHeader(e,t,i,n){const r={startLevel:this.currentLevel,name:e,style:t,selectable:i,expanded:n};return this.timelineDataInternal.groups.push(r),r}appendEvent(e,t){const i=this.entryData.length;this.entryData.push(e);const n=this.timelineDataInternal;return n.entryLevels[i]=t,n.entryTotalTimes[i]=e.duration||wn,n.entryStartTimes[i]=e.startTime,i}appendAsyncEvent(e,t){const i=e.steps,n=i.length>1&&"p"===i[1].phase?1:0;for(let e=0;e<i.length-1;++e){const r=this.entryData.length;this.entryData.push(i[e+n]);const a=i[e].startTime,s=this.timelineDataInternal;s.entryLevels[r]=t,s.entryTotalTimes[r]=i[e+1].startTime-a,s.entryStartTimes[r]=a}}#st(t){const n=this.entryData.length;this.entryData.push(t);const r=i.Helpers.Timing.microSecondsToMilliseconds(t.duration);this.entryIndexToTitle[n]=e.TimeUtilities.millisToString(r,!0),this.timelineDataInternal&&(this.timelineDataInternal.entryLevels[n]=this.currentLevel,this.timelineDataInternal.entryTotalTimes[n]=r,this.timelineDataInternal.entryStartTimes[n]=i.Helpers.Timing.microSecondsToMilliseconds(t.startTime))}createSelection(e){const t=this.entryType(e);let i=null;const n=this.entryData[e];return n&&yn.isEntryRegularEvent(n)?i=It.fromTraceEvent(n):t===bn.Frame&&(i=It.fromFrame(this.entryData[e])),i&&(this.lastSelection=new hn(i,e)),i}formatValue(t,i){return e.TimeUtilities.preciseMillisToString(t,i)}canJumpToEntry(e){return!1}entryIndexForSelection(e){if(!e||It.isRangeSelection(e.object)||It.isSyntheticNetworkRequestDetailsEventSelection(e.object))return-1;if(this.lastSelection&&this.lastSelection.timelineSelection.object===e.object)return this.lastSelection.entryIndex;const t=this.entryData.indexOf(e.object);return-1!==t&&(this.lastSelection=new hn(e,t)),t}getIndexForEvent(e){const t=this.#it.get(e);if(t)return t;const i=this.entryData.indexOf(e),n=i>-1?i:null;return this.#it.set(e,n),n}buildFlowForInitiator(e){if(this.lastInitiatorEntry===e)return!1;if(!this.traceEngineData)return!1;if(!this.timelineDataInternal)return!1;if(!this.compatibilityTracksAppender)return!1;if(this.entryType(e)!==bn.TrackAppender)return!1;const t=this.entryData[e];if(!i.Legacy.eventIsFromNewEngine(t))return!1;this.timelineDataInternal.flowStartTimes=[],this.timelineDataInternal.flowStartLevels=[],this.timelineDataInternal.flowEndTimes=[],this.timelineDataInternal.flowEndLevels=[],this.lastInitiatorEntry=e;const n=Se(this.traceEngineData,t);if(0===n.length)return!1;for(const e of n){const t=this.getIndexForEvent(e.event),n=this.getIndexForEvent(e.initiator);if(null===t||null===n)continue;const{startTime:r}=i.Legacy.timesForEventInMilliseconds(e.event),{endTime:a,startTime:s}=i.Legacy.timesForEventInMilliseconds(e.initiator),o=this.timelineDataInternal;o.flowStartTimes.push(a||s),o.flowStartLevels.push(o.entryLevels[n]),o.flowEndTimes.push(r),o.flowEndLevels.push(o.entryLevels[t])}return!0}eventByIndex(e){if(e<0)return null;const t=this.entryType(e);return t===bn.TrackAppender||t===bn.Event?this.entryData[e]:null}setEventColorMapping(e){this.colorForEvent=e}get performanceModel(){return this.legacyPerformanceModel}}const wn=.001;var Sn,bn;!function(e){e.DataChanged="DataChanged"}(Sn||(Sn={})),function(e){e.Frame="Frame",e.Event="Event",e.TrackAppender="TrackAppender",e.Screenshot="Screenshot"}(bn||(bn={}));var Cn=Object.freeze({__proto__:null,TimelineFlameChartDataProvider:yn,InstantEventVisibleDurationMs:wn,get Events(){return Sn},get EntryType(){return bn}});const Pn={timings:"Timings"},kn=e.i18n.registerUIStrings("panels/timeline/TimingsTrackAppender.ts",Pn),En=e.i18n.getLocalizedString.bind(void 0,kn);class Mn{appenderName="Timings";#n;#e;#t;constructor(e,t,i){this.#e=e,this.#n=i,this.#t=t}appendTrackAtLevel(e,t){const i=this.#t.PageLoadMetrics.allMarkerEvents,n=this.#t.UserTimings.performanceMarks,r=this.#t.UserTimings.performanceMeasures,a=this.#t.UserTimings.timestampEvents,s=this.#t.UserTimings.consoleTimings;if(0===i.length&&0===n.length&&0===r.length&&0===a.length&&0===s.length)return e;this.#i(e,t);let o=this.#ct(e);return o=this.#e.appendEventsAtLevel(n,o,this),o=this.#e.appendEventsAtLevel(r,o,this),o=this.#e.appendEventsAtLevel(a,o,this),this.#e.appendEventsAtLevel(s,o,this)}#i(e,t){const i=k({shareHeaderLine:!0,useFirstLineForOverview:!0,collapsible:this.#t.UserTimings.performanceMeasures.length>0}),n=E(e,En(Pn.timings),i,!0,t);this.#e.registerTrackForGroup(n,this)}#ct(e){const t=this.#t.PageLoadMetrics.allMarkerEvents;t.forEach((t=>{const i=this.#e.appendEventAtLevel(t,e,this);this.#e.getFlameChartTimelineData().entryTotalTimes[i]=Number.NaN}));const n=i.Helpers.Timing.microSecondsToMilliseconds(this.#t.Meta.traceBounds.min),r=t.map((e=>{const t=i.Helpers.Timing.microSecondsToMilliseconds(e.ts);return new pn(t,t-n,this.markerStyleForEvent(e))}));return this.#e.getFlameChartTimelineData().markers.push(...r),++e}markerStyleForEvent(e){let t="",n="grey";return i.Types.TraceEvents.isTraceEventMarkDOMContent(e)&&(n="#0867CB",t="DCL"),i.Types.TraceEvents.isTraceEventMarkLoad(e)&&(n="#B31412",t="L"),i.Types.TraceEvents.isTraceEventFirstPaint(e)&&(n="#228847",t="FP"),i.Types.TraceEvents.isTraceEventFirstContentfulPaint(e)&&(n="#1A6937",t="FCP"),i.Types.TraceEvents.isTraceEventLargestContentfulPaintCandidate(e)&&(n="#1A3422",t="LCP"),i.Types.TraceEvents.isTraceEventNavigationStart(e)&&(n="#FF9800",t=""),{title:t,dashStyle:[6,4],lineWidth:.5,color:n,tall:!0,lowPriority:!1}}colorForEvent(e){return i.Handlers.ModelHandlers.PageLoadMetrics.eventIsPageLoadEvent(e)?this.markerStyleForEvent(e).color:this.#n.colorForID(e.name)}titleForEvent(e){if(i.Handlers.ModelHandlers.PageLoadMetrics.eventIsPageLoadEvent(e))switch(e.name){case"MarkDOMContent":return"DCL";case"MarkLoad":return"L";case"firstContentfulPaint":return"FCP";case"firstPaint":return"FP";case"largestContentfulPaint::Candidate":return"LCP";case"navigationStart":return"";default:return e.name}return i.Types.TraceEvents.isTraceEventTimeStamp(e)?`${e.name}: ${e.args.data.message}`:i.Types.TraceEvents.isTraceEventPerformanceMark(e)?`[mark]: ${e.name}`:e.name}highlightedEntryInfo(e){const t=this.titleForEvent(e);if(i.Handlers.ModelHandlers.PageLoadMetrics.isTraceEventMarkerEvent(e)||i.Types.TraceEvents.isTraceEventPerformanceMark(e)||i.Types.TraceEvents.isTraceEventTimeStamp(e)){return{title:t,formattedTime:M(i.Helpers.Timing.timeStampForEventAdjustedByClosestNavigation(e,this.#t.Meta.traceBounds,this.#t.Meta.navigationsByNavigationId,this.#t.Meta.navigationsByFrameId))}}return{title:t,formattedTime:M(e.dur)}}}var Fn=Object.freeze({__proto__:null,TimingsTrackAppender:Mn});const Ln=["Animations","Timings","Interactions","GPU","LayoutShifts","Thread","Thread_AuctionWorklet"];class Rn{#dt=new Map;#ht=new Map;#mt=new Map;#pt=new Map;#Ne;#t;#ut;#n;#gt=[];#Tt=new Set([...Ln]);#vt;#ft;#yt;#wt;#St;#bt;#Ct;#Pt=[];constructor(e,i,n,a,s){this.#Ne=e,this.#t=i,this.#ut=n,this.#n=new r.Color.Generator({min:30,max:55,count:void 0},{min:70,max:100,count:6},50,.7),this.#ft=a,this.#vt=s,this.#yt=new Mn(this,this.#t,this.#n),this.#gt.push(this.#yt),this.#St=new se(this,this.#t,this.#n),this.#gt.push(this.#St),this.#wt=new A(this,this.#t),this.#gt.push(this.#wt),this.#bt=new te(this,this.#t),this.#gt.push(this.#bt),this.#Ct=new me(this,this.#t),this.#gt.push(this.#Ct),this.#kt(),t.ThemeSupport.instance().addEventListener(t.ThemeChangeEvent.eventName,(()=>{for(const e of this.#Ne.groups)e.style.color=t.ThemeSupport.instance().getComputedValue("--sys-color-on-surface"),e.style.backgroundColor=t.ThemeSupport.instance().getComputedValue("--sys-color-cdt-base-container")}))}setFlameChartDataAndEntryData(e,t,i){this.#ht.clear(),this.#Ne=e,this.#ut=t,this.#ft=i}getFlameChartTimelineData(){return this.#Ne}modifyTree(e,t,i,n){const r=this.#ht.get(e);r instanceof ve?r.modifyTree(t,i,n):console.warn("Could not modify tree in not thread track")}#kt(){const e=e=>{switch(e.threadType){case"MAIN_THREAD":if(!e.getUrl())return 2;return"about:"===new URL(e.getUrl()).protocol?2:e.isOnMainFrame&&""!==e.getUrl()?0:1;case"WORKER":return 3;case"RASTERIZER":return 4;case"THREAD_POOL":return 5;case"AUCTION_WORKLET":return 6;case"OTHER":return 7;default:return 8}},t=i.Handlers.Threads.threadsInTrace(this.#t),n=new Set;for(const{pid:e,tid:i,name:r,type:a}of t){if(this.#t.Meta.traceIsGeneric){this.#Pt.push(new ve(this,this.#t,e,i,r,"OTHER"));continue}const t=this.#t.AuctionWorklets.worklets.get(e);n.has(e)||(t?(n.add(e),this.#Pt.push(new ve(this,this.#t,e,t.args.data.utilityThread.tid,"auction-worket-utility","AUCTION_WORKLET")),this.#Pt.push(new ve(this,this.#t,e,t.args.data.v8HelperThread.tid,"auction-worklet-v8helper","AUCTION_WORKLET"))):this.#Pt.push(new ve(this,this.#t,e,i,r,a)))}this.#Pt.sort(((t,i)=>e(t)-e(i))),this.#gt.push(...this.#Pt)}getLegacyEvent(e){const t=this.#vt.tracingModel()?.getProcessById(e.pid),n=t?.threadById(e.tid);return n?i.Legacy.PayloadEvent.fromPayload(e,n):null}timingsTrackAppender(){return this.#yt}animationsTrackAppender(){return this.#wt}interactionsTrackAppender(){return this.#St}gpuTrackAppender(){return this.#bt}layoutShiftsTrackAppender(){return this.#Ct}threadAppenders(){return this.#Pt}eventsInTrack(e){const t=this.#mt.get(e);if(t)return t;let i=null,n=null;for(const[t,r]of this.#dt)r===e&&(null===i&&(i=t),n=t);if(null===i||null===n)throw new Error(`Could not find events for track: ${e}`);const r=this.#Ne.entryLevels,a=[];for(let e=0;e<r.length;e++)i<=r[e]&&r[e]<=n&&a.push(this.#ut[e]);return a.sort(((e,t)=>e.ts-t.ts)),this.#mt.set(e,a),a}canBuildTreesFromEvents(e){const t=[];for(const i of e){const e=i.ts,n=i.ts+(i.dur||0);let r=t.at(-1);if(void 0===r){t.push(i);continue}let a=r.ts+(r.dur||0);for(;t.length&&e>=a&&(t.pop(),r=t.at(-1),void 0!==r);)a=r.ts+(r.dur||0);if(t.length&&n>a)return!1;t.push(i)}return!0}eventsForTreeView(e){const t=this.#pt.get(e);if(t)return t;let n=this.eventsInTrack(e);return this.canBuildTreesFromEvents(n)||(n=n.filter((e=>!i.Types.TraceEvents.isAsyncPhase(e.ph)))),this.#pt.set(e,n),n}registerTrackForGroup(e,t){this.#Ne.groups.push(e),this.#ht.set(e,t)}getCurrentTrackCountForThreadType(e){return this.#Pt.filter((t=>t.threadType===e&&t.headerAppended())).length}groupForAppender(e){let t=null;for(const[i,n]of this.#ht)if(n===e){t=i;break}return t}groupEventsForTreeView(e){const t=this.#ht.get(e);return t?this.eventsForTreeView(t):null}registerTrackForLevel(e,t){this.#dt.set(e,t)}appendEventAtLevel(e,t,n){this.#dt.set(t,n);const r=this.#ut.length;this.#ut.push(e),this.#ft[t]=bn.TrackAppender,this.#Ne.entryLevels[r]=t,this.#Ne.entryStartTimes[r]=i.Helpers.Timing.microSecondsToMilliseconds(e.ts);const a=e.dur||i.Helpers.Timing.millisecondsToMicroseconds(wn);return this.#Ne.entryTotalTimes[r]=i.Helpers.Timing.microSecondsToMilliseconds(a),r}appendEventsAtLevel(e,t,i,n){const r=[];for(let a=0;a<e.length;++a){const s=e[a];if(!this.entryIsVisibleInTimeline(s))continue;const o=F(s,r),l=this.appendEventAtLevel(s,t+o,i);n?.(s,l)}return this.#ft.length=t+r.length,this.#ft.fill(bn.TrackAppender,t),t+r.length}entryIsVisibleInTimeline(e){if(this.#t.Meta.traceIsGeneric)return!0;if(i.Types.TraceEvents.isTraceEventUpdateCounters(e))return!0;const t=X(e.name),n=i.Types.TraceEvents.isTraceEventConsoleTime(e)||i.Types.TraceEvents.isTraceEventPerformanceMeasure(e)||i.Types.TraceEvents.isTraceEventPerformanceMark(e);return t&&!t.hidden||n}allVisibleTrackAppenders(){return this.#gt.filter((e=>this.#Tt.has(e.appenderName)))}allThreadAppendersByProcess(){const e=this.allVisibleTrackAppenders(),t=new Map;for(const i of e){if(!(i instanceof ve))continue;const e=t.get(i.processId())??[];e.push(i),t.set(i.processId(),e)}return t}setVisibleTracks(e){this.#Tt=e||new Set([...Ln])}colorForEvent(e,t){const i=this.#dt.get(t);if(!i)throw new Error("Track not found for level");return i.colorForEvent(e)}titleForEvent(e,t){const i=this.#dt.get(t);if(!i)throw new Error("Track not found for level");return i.titleForEvent(e)}highlightedEntryInfo(e,t){const i=this.#dt.get(t);if(!i)throw new Error("Track not found for level");const n=a.DetailsView.buildWarningElementsForEvent(e,this.#t),{title:r,formattedTime:s,warningElements:o}=i.highlightedEntryInfo(e);return{title:r,formattedTime:s,warningElements:n.concat(o||[])}}}var In=Object.freeze({__proto__:null,TrackNames:Ln,CompatibilityTracksAppender:Rn});export{N as AnimationsTrackAppender,R as AppenderUtils,H as BenchmarkEvents,O as CLSLinkifier,In as CompatibilityTracksAppender,Ie as CountersGraph,Y as EventUICategory,Vi as EventsTimelineTreeView,ie as GPUTrackAppender,be as Initiators,le as InteractionsTrackAppender,pe as LayoutShiftsTrackAppender,rn as NetworkTrackAppender,We as PerformanceModel,Ge as SaveFileFormatter,Be as SourceMapsResolver,fe as ThreadAppender,$e as TimelineController,Zi as TimelineDetailsView,ot as TimelineEventOverview,bi as TimelineFilters,Cn as TimelineFlameChartDataProvider,sn as TimelineFlameChartNetworkDataProvider,gn as TimelineFlameChartView,ft as TimelineHistoryManager,zi as TimelineLayersView,kt as TimelineLoader,Ft as TimelineMiniMap,qi as TimelinePaintProfilerView,ei as TimelinePanel,xt as TimelineSelection,Ai as TimelineTreeView,fi as TimelineUIUtils,Fn as TimingsTrackAppender,Gt as UIDevtoolsController,Ot as UIDevtoolsUtils};
