import*as e from"../../core/common/common.js";import*as s from"../../models/issues_manager/issues_manager.js";import*as t from"../../ui/legacy/legacy.js";import*as i from"../../core/i18n/i18n.js";import*as n from"../../ui/components/issue_counter/issue_counter.js";import*as r from"../../ui/visual_logging/visual_logging.js";import*as a from"../../ui/components/adorners/adorners.js";import*as o from"../../ui/components/icon_button/icon_button.js";import*as d from"./components/components.js";import*as l from"../../core/host/host.js";import*as u from"../network/forward/forward.js";import*as c from"../../ui/components/markdown_view/markdown_view.js";import*as p from"../../core/sdk/sdk.js";import*as h from"../../models/logs/logs.js";import*as g from"../../ui/components/request_link_icon/request_link_icon.js";import*as f from"../../ui/legacy/components/utils/utils.js";import*as m from"../../core/platform/platform.js";class C extends s.Issue.Issue{#e=new Map;#s=new Map;#t=new Map;#i=new Map;#n=new Set;#r=new Map;#a=new Set;#o=new Set;#d=new Set;#l=new Set;#u=s.Issue.IssueKind.Improvement;#c=new Set;#p=new Set;#h=new Set;#g=new Set;#f=new Set;#m=new Set;#C=new Set;#I;#w=0;#y;constructor(e,s){super(e),this.#y=s}primaryKey(){throw new Error("This should never be called")}aggregationKey(){return this.#y}getBlockedByResponseDetails(){return this.#r.values()}cookies(){return Array.from(this.#e.values()).map((e=>e.cookie))}getRawCookieLines(){return this.#s.values()}sources(){return this.#i.values()}getBounceTrackingSites(){return this.#a.values()}cookiesWithRequestIndicator(){return this.#e.values()}getHeavyAdIssues(){return this.#n}getMetadataAllowedSites(){return this.#p.values()}getMixedContentIssues(){return this.#h}getCorsIssues(){return this.#o}getCspIssues(){return this.#d}getDeprecationIssues(){return this.#l}getLowContrastIssues(){return this.#c}requests(){return this.#t.values()}getSharedArrayBufferIssues(){return this.#g}getQuirksModeIssues(){return this.#f}getAttributionReportingIssues(){return this.#m}getGenericIssues(){return this.#C}getDescription(){return this.#I?this.#I.getDescription():null}getCategory(){return this.#I?this.#I.getCategory():s.Issue.IssueCategory.Other}getAggregatedIssuesCount(){return this.#w}#R(e){const{domain:s,path:t,name:i}=e;return`${s};${t};${i}`}addInstance(e){this.#w++,this.#I||(this.#I=e),this.#u=s.Issue.unionIssueKind(this.#u,e.getKind());let t=!1;for(const s of e.requests())t=!0,this.#t.has(s.requestId)||this.#t.set(s.requestId,s);for(const s of e.cookies()){const e=this.#R(s);this.#e.has(e)||this.#e.set(e,{cookie:s,hasRequest:t})}for(const s of e.rawCookieLines())this.#s.has(s)||this.#s.set(s,{rawCookieLine:s,hasRequest:t});for(const s of e.trackingSites())this.#a.has(s)||this.#a.add(s);for(const s of e.sources()){const e=JSON.stringify(s);this.#i.has(e)||this.#i.set(e,s)}for(const s of e.metadataAllowedSites())this.#p.has(s)||this.#p.add(s);e instanceof s.MixedContentIssue.MixedContentIssue&&this.#h.add(e),e instanceof s.HeavyAdIssue.HeavyAdIssue&&this.#n.add(e);for(const s of e.getBlockedByResponseDetails()){const e=JSON.stringify(s,["parentFrame","blockedFrame","requestId","frameId","reason","request"]);this.#r.set(e,s)}e instanceof s.ContentSecurityPolicyIssue.ContentSecurityPolicyIssue&&this.#d.add(e),e instanceof s.DeprecationIssue.DeprecationIssue&&this.#l.add(e),e instanceof s.SharedArrayBufferIssue.SharedArrayBufferIssue&&this.#g.add(e),e instanceof s.LowTextContrastIssue.LowTextContrastIssue&&this.#c.add(e),e instanceof s.CorsIssue.CorsIssue&&this.#o.add(e),e instanceof s.QuirksModeIssue.QuirksModeIssue&&this.#f.add(e),e instanceof s.AttributionReportingIssue.AttributionReportingIssue&&this.#m.add(e),e instanceof s.GenericIssue.GenericIssue&&this.#C.add(e)}getKind(){return this.#u}isHidden(){return this.#I?.isHidden()||!1}setHidden(e){throw new Error("Should not call setHidden on aggregatedIssue")}}class I extends e.ObjectWrapper.ObjectWrapper{issuesManager;#k=new Map;#v=new Map;constructor(e){super(),this.issuesManager=e,this.issuesManager.addEventListener("IssueAdded",this.#b,this),this.issuesManager.addEventListener("FullUpdateRequired",this.#A,this);for(const e of this.issuesManager.issues())this.#S(e)}#b(e){this.#S(e.data.issue)}#A(){this.#k.clear(),this.#v.clear();for(const e of this.issuesManager.issues())this.#S(e);this.dispatchEventToListeners("FullUpdateRequired")}#S(e){const s=e.isHidden()?this.#v:this.#k,t=this.#x(s,e);return this.dispatchEventToListeners("AggregatedIssueUpdated",t),t}#x(e,s){const t=s.code();let i=e.get(t);return i||(i=new C(s.code(),t),e.set(t,i)),i.addInstance(s),i}aggregatedIssues(){return[...this.#k.values(),...this.#v.values()]}hiddenAggregatedIssues(){return this.#v.values()}aggregatedIssueCodes(){return new Set([...this.#k.keys(),...this.#v.keys()])}aggregatedIssueCategories(){const e=new Set;for(const s of this.#k.values())e.add(s.getCategory());return e}aggregatedIssueKinds(){const e=new Set;for(const s of this.#k.values())e.add(s.getKind());return e}numberOfAggregatedIssues(){return this.#k.size}numberOfHiddenAggregatedIssues(){return this.#v.size}keyForIssue(e){return e.code()}}var w=Object.freeze({__proto__:null,AggregatedIssue:C,IssueAggregator:I});const y={hiddenIssues:"Hidden issues",unhideAll:"Unhide all"},R=i.i18n.registerUIStrings("panels/issues/HiddenIssuesRow.ts",y),k=i.i18n.getLocalizedString.bind(void 0,R);class v extends t.TreeOutline.TreeElement{#T;constructor(){super(void 0,!0),this.#T=document.createElement("span"),this.toggleOnClick=!0,this.listItemElement.classList.add("issue-category","hidden-issues"),this.childrenListElement.classList.add("hidden-issues-body"),this.#E()}#E(){const e=t.UIUtils.createTextButton(k(y.unhideAll),(()=>s.IssuesManager.IssuesManager.instance().unhideAllIssues()),"unhide-all-issues-button"),i=new a.Adorner.Adorner;i.data={name:"countWrapper",content:this.#T},i.classList.add("aggregated-issues-count"),this.#T.textContent="0";const n=document.createElement("div"),r=document.createElement("div");n.classList.add("header"),r.classList.add("title"),r.textContent=k(y.hiddenIssues),n.appendChild(i),n.appendChild(r),n.appendChild(e),this.listItemElement.appendChild(n)}update(e){this.#T.textContent=`${e}`}}const b={hideAllCurrentPageErrors:"Hide all current Page Errors",hideAllCurrentBreakingChanges:"Hide all current Breaking Changes",hideAllCurrentImprovements:"Hide all current Improvements"},A=i.i18n.registerUIStrings("panels/issues/IssueKindView.ts",b),S=i.i18n.getLocalizedString.bind(void 0,A);function x(){return e.Settings.Settings.instance().createSetting("groupIssuesByKind",!1)}class T extends t.TreeOutline.TreeElement{#L;#M;constructor(e){super(void 0,!0),this.#L=e,this.#M=document.createElement("span"),this.toggleOnClick=!0,this.listItemElement.classList.add("issue-kind"),this.listItemElement.classList.add(function(e){switch(e){case s.Issue.IssueKind.BreakingChange:return"breaking-changes";case s.Issue.IssueKind.Improvement:return"improvements";case s.Issue.IssueKind.PageError:return"page-errors"}}(e)),this.childrenListElement.classList.add("issue-kind-body")}getKind(){return this.#L}getHideAllCurrentKindString(){switch(this.#L){case s.Issue.IssueKind.PageError:return S(b.hideAllCurrentPageErrors);case s.Issue.IssueKind.Improvement:return S(b.hideAllCurrentImprovements);case s.Issue.IssueKind.BreakingChange:return S(b.hideAllCurrentBreakingChanges)}}#E(){const e=document.createElement("div");e.classList.add("header");const t=new o.Icon.Icon;t.data=n.IssueCounter.getIssueKindIconData(this.#L),t.classList.add("leading-issue-icon");const i=new a.Adorner.Adorner;i.data={name:"countWrapper",content:this.#M},i.classList.add("aggregated-issues-count"),this.#M.textContent="0";const r=document.createElement("div");r.classList.add("title"),r.textContent=s.Issue.getIssueKindName(this.#L);const l=new d.HideIssuesMenu.HideIssuesMenu;l.classList.add("hide-available-issues"),l.data={menuItemLabel:this.getHideAllCurrentKindString(),menuItemAction:()=>{const e=s.IssuesManager.getHideIssueByCodeSetting(),t=e.get();for(const e of s.IssuesManager.IssuesManager.instance().issues())e.getKind()===this.#L&&(t[e.code()]="Hidden");e.set(t)}},e.appendChild(t),e.appendChild(i),e.appendChild(r),e.appendChild(l),this.listItemElement.appendChild(e)}onattach(){this.#E(),this.expand()}update(e){this.#M.textContent=`${e}`}}const E=new CSSStyleSheet;E.replaceSync(".issues-pane{overflow:hidden}.issues-pane-no-issues{align-items:center;background-color:var(--sys-color-cdt-base-container);display:flex;flex:1 1 auto;font-size:14px;justify-content:center;padding:30px}.issues-toolbar-container{display:flex;flex:none}.issues-toolbar-container > .toolbar{background-color:var(--sys-color-cdt-base-container);border-bottom:1px solid var(--sys-color-divider)}.issues-toolbar-left{flex:1 1 auto}.issues-toolbar-right{padding-right:6px}\n/*# sourceURL=issuesPane.css */\n");const L=new CSSStyleSheet;L.replaceSync(':host,\n.issues{padding:0;overflow:auto}.issues{--issue-indent:8px}.issues li{white-space:normal;align-items:flex-start}.issues .always-parent::before{display:none}.issues li.parent::before{margin-top:8px}.issues .affected-resources li.parent::before{margin-top:3px;margin-right:0}.issue-category,\n.issue-kind,\n.issue{padding:0 8px;padding-left:var(--issue-indent);overflow:hidden;flex:none;transition:background-color 200ms;border:1px solid var(--sys-color-divider);border-width:0 0 1px}.issue-category.hidden-issues.parent.expanded,\n.issue-kind.parent.expanded{border-width:0 0 1px;background-color:var(--sys-color-surface2)}.issue-category + .children .issue,\n.issue.expanded{background:var(--sys-color-cdt-base-container)}.issue.expanded{border-width:0}.issue.selected,\n.issue.expanded.selected{background-color:var(--sys-color-surface2);&:focus{background-color:var(--sys-color-tonal-container)}}.tree-outline li:not(.selected):hover .selection{background-color:unset}.tree-outline li.issue:not(.expanded):not(.selected):hover .selection{background-color:var(--sys-color-state-hover-on-subtle)}.tree-outline li.issue.expanded:not(.selected):hover{background-color:var(--sys-color-state-hover-on-subtle)}.unhide-all-issues-button{margin:0;height:20px}p{margin-block-start:2px;margin-block-end:2px}.tree-outline-disclosure:not(.tree-outline-disclosure-hide-overflow) .tree-outline.hide-selection-when-blurred .issue-category.selected:focus-visible,\n.tree-outline-disclosure:not(.tree-outline-disclosure-hide-overflow) .tree-outline.hide-selection-when-blurred .issue-kind.selected:focus-visible,\n.tree-outline-disclosure:not(.tree-outline-disclosure-hide-overflow) .tree-outline.hide-selection-when-blurred .issue.selected:focus-visible{width:auto;padding-right:8px}.header{display:flex;flex-direction:row;align-items:flex-start;padding:4px 0;cursor:pointer;width:100%}.header devtools-hide-issues-menu{visibility:hidden}.header:hover devtools-hide-issues-menu,\n.issue.selected devtools-hide-issues-menu{visibility:visible}.header devtools-hide-issues-menu.has-context-menu-opened{visibility:visible}.title{flex:1;font-size:12px;color:var(--sys-color-on-surface);font-weight:normal;user-select:text;padding-top:2px}.issue.expanded .title{font-weight:450}.body.children{border-bottom:1px solid var(--sys-color-divider);padding:6px 0;position:relative;padding-left:calc(var(--issue-indent) + 43px);padding-bottom:26px;padding-right:8px}.issue-category + .children,\n.issue-kind + .children{--issue-indent:24px;padding-left:0}.body::before{content:"";display:block;position:absolute;left:calc(var(--issue-indent) + 23px);top:0;bottom:20px;width:2px}.issue-kind-breaking-change.body::before{border-left:2px solid var(--issue-color-yellow)}.issue-kind-page-error.body::before{border-left:2px solid var(--issue-color-red)}.issue-kind-improvement.body::before{border-left:2px solid var(--issue-color-blue)}devtools-icon.leading-issue-icon{margin:1px 0 -1px 7px}.message{line-height:18px;font-size:12px;color:var(--sys-color-token-subtle);margin-bottom:4px;user-select:text}.message p{margin-bottom:16px}.message li{margin-top:8px}.message code{color:var(--sys-color-on-surface);padding:0 2px;font-size:12px;user-select:text;cursor:text;background:var(--sys-color-surface2)}.separator::before{content:"·";padding-left:1ex;padding-right:1ex}.link{font-size:12px;color:var(--sys-color-primary)}.link-wrapper{margin-top:15px;user-select:text}.affected-resources-label,\n.resolutions-label{margin-top:5px;font-size:10px;font-weight:500;letter-spacing:0.06em;text-transform:uppercase;color:var(--sys-color-on-surface);display:inline-block}.link-list{list-style-type:none;list-style-position:inside;padding-inline-start:0}.resolutions-list{list-style-type:none;list-style-position:inside;padding-inline-start:0}.link-list li::before{content:none;-webkit-mask-image:none}.resolutions-list li::before{content:"→";-webkit-mask-image:none;padding-right:5px;position:relative;top:-1px}.resolutions-list li{display:list-item}ul > li.plain-enum{display:list-item}ul > li.plain-enum::before{content:"";padding:0;margin:0;max-width:0}.affected-resources-label + .affected-resources{padding:3px 0 0;position:relative;user-select:text}.affected-resource-label{font-size:12px;line-height:18px;color:var(--sys-color-on-surface);position:relative;cursor:pointer}.affected-resource-cookie{font-size:12px;line-height:18px;border:0;border-collapse:collapse}.affected-resource-element{font-size:12px;line-height:18px;color:var(--sys-color-primary);border:0;border-collapse:collapse}.affected-resource-row{font-size:12px;line-height:18px;border:0;border-collapse:collapse;vertical-align:top}.affected-resource-mixed-content{font-size:12px;line-height:18px;border:0;border-collapse:collapse}.affected-resource-heavy-ad{font-size:12px;line-height:18px;border:0;border-collapse:collapse}.affected-resource-request{font-size:12px;line-height:18px;border:0;border-collapse:collapse}.affected-resource-source{font-size:12px;line-height:18px;color:var(--sys-color-primary);border:0;border-collapse:collapse}.affected-resource-list{border-spacing:10px 0;margin-left:-12px}.affected-resource-header{font-size:12px;color:var(--sys-color-on-surface);padding-left:2px}.code-example{font-family:var(--monospace-font-family);font-size:var(--monospace-font-size)}.affected-resource-blocked-status{color:var(--issue-color-red)}.affected-resource-report-only-status{color:var(--issue-color-yellow)}.affected-resource-cookie-info{color:var(--sys-color-token-subtle);padding:2px;text-align:right}.affected-resource-cookie-info-header{text-align:right}.affected-resource-mixed-content-info{color:var(--sys-color-token-subtle);padding:2px}.affected-resource-heavy-ad-info{color:var(--sys-color-token-subtle);padding:2px}.affected-resource-heavy-ad-info-frame{display:flex;align-items:center;color:var(--sys-color-token-subtle);padding:2px}.affected-resource-cell{color:var(--sys-color-token-subtle);padding:2px}.affected-resource-cell.link{color:var(--sys-color-primary)}.affected-resource-cell span.icon{margin-right:0.5ex;vertical-align:sub}.affected-resources > .parent{margin-top:0;padding:2px 5px 0}.affected-resources > .parent.expanded{background:var(--sys-color-cdt-base-container)}.affected-resources > .children.expanded{background:var(--sys-color-cdt-base-container);padding:6px 0 9px 5px;margin-bottom:10px}.aggregated-issues-count{padding:3px 7px 0}.affected-resource-directive-info-header{text-align:left}.affected-resource-directive{font-size:12px;line-height:18px;border:0;border-collapse:collapse}.affected-resource-directive-info{color:var(--sys-color-token-subtle);padding:2px;text-align:left}.devtools-link{padding-top:4px}devtools-icon.link-icon{vertical-align:sub;margin-right:0.5ch}devtools-icon.elements-panel,\ndevtools-icon.network-panel{margin-right:0.5ex;vertical-align:baseline;height:14px}@media (forced-colors: active){.title{color:ButtonText}.tree-outline:not(.hide-selection-when-blurred) .selected .header .title,\n  .tree-outline.hide-selection-when-blurred .selected:focus-visible .header .title{color:HighlightText}}\n/*# sourceURL=issuesTree.css */\n');const M={unknown:"unknown",clickToRevealTheFramesDomNodeIn:"Click to reveal the frame's DOM node in the Elements panel",unavailable:"unavailable"},P=i.i18n.registerUIStrings("panels/issues/AffectedResourcesView.ts",M),D=i.i18n.getLocalizedString.bind(void 0,P);class q extends t.TreeOutline.TreeElement{#P;issue;affectedResourcesCountElement;affectedResources;#D;#q;#O;requestResolver;constructor(e,s){super(),this.#P=e,this.issue=s,this.toggleOnClick=!0,this.affectedResourcesCountElement=this.createAffectedResourcesCounter(),this.affectedResources=this.createAffectedResources(),this.#D=0,this.requestResolver=new h.RequestResolver.RequestResolver,this.#q=[],this.#O=new Set}setIssue(e){this.issue=e}createAffectedResourcesCounter(){const e=document.createElement("div");return e.classList.add("affected-resource-label"),this.listItemElement.appendChild(e),e}createAffectedResources(){const e=new t.TreeOutline.TreeElement,s=document.createElement("table");return s.classList.add("affected-resource-list"),e.listItemElement.appendChild(s),this.appendChild(e),s}updateAffectedResourceCount(e){this.#D=e,this.affectedResourcesCountElement.textContent=this.getResourceNameWithCount(e),this.hidden=0===this.#D,this.#P.updateAffectedResourceVisibility()}isEmpty(){return 0===this.#D}clear(){this.affectedResources.textContent="",this.requestResolver.clear()}expandIfOneResource(){1===this.#D&&this.expand()}#U(e){const s=p.FrameManager.FrameManager.instance().getFrame(e);if(!(s&&s.url||(this.#O.add(e),this.#q.length))){const e=p.FrameManager.FrameManager.instance().addEventListener(p.FrameManager.Events.FrameAddedToTarget,this.#V,this),s=p.FrameManager.FrameManager.instance().addEventListener(p.FrameManager.Events.FrameNavigated,this.#V,this);this.#q=[e,s]}return s}#V(s){const t=s.data.frame;if(!t.url)return;const i=this.#O.delete(t.id);0===this.#O.size&&this.#q.length&&(e.EventTarget.removeEventListeners(this.#q),this.#q=[]),i&&this.update()}createFrameCell(s,t){const i=this.#U(s),n=i&&(i.unreachableUrl()||i.url)||D(M.unknown),r=document.createElement("td");if(r.classList.add("affected-resource-cell"),i){const i=new o.Icon.Icon;i.data={iconName:"code-circle",color:"var(--icon-link)",width:"16px",height:"16px"},i.classList.add("link","elements-panel"),i.onclick=async()=>{l.userMetrics.issuesPanelResourceOpened(t,"Element");const i=p.FrameManager.FrameManager.instance().getFrame(s);if(i){const s=await i.getOwnerDOMNodeOrDocument();s&&e.Revealer.reveal(s)}},i.title=D(M.clickToRevealTheFramesDomNodeIn),r.appendChild(i)}return r.appendChild(document.createTextNode(n)),r.onmouseenter=()=>{const e=p.FrameManager.FrameManager.instance().getFrame(s);e&&e.highlight()},r.onmouseleave=()=>p.OverlayModel.OverlayModel.hideDOMNodeHighlight(),r}createRequestCell(e,s={}){const t=document.createElement("td");t.classList.add("affected-resource-cell");const i=new g.RequestLinkIcon.RequestLinkIcon;return i.data={...s,affectedRequest:e,requestResolver:this.requestResolver,displayURL:!0},t.appendChild(i),t}async createElementCell({backendNodeId:s,nodeName:t,target:i},n){if(!i){const e=document.createElement("td");return e.textContent=t||D(M.unavailable),e}function r(){l.userMetrics.issuesPanelResourceOpened(n,"Element")}const a=new p.DOMModel.DeferredDOMNode(i,s),o=await e.Linkifier.Linkifier.linkify(a);o.textContent=t,o.addEventListener("click",(()=>r())),o.addEventListener("keydown",(e=>{"Enter"===e.key&&r()}));const d=document.createElement("td");return d.classList.add("affected-resource-element","devtools-link"),d.appendChild(o),d}appendSourceLocation(e,s,t){const i=document.createElement("td");if(i.classList.add("affected-source-location"),s){const e=40,n=new f.Linkifier.Linkifier(e).linkifyScriptLocation(t||null,s.scriptId||null,s.url,s.lineNumber,{columnNumber:s.columnNumber,inlineFrameIndex:0});n.setAttribute("jslog",`${r.link().track({click:!0}).context("source-location")}`),i.appendChild(n)}e.appendChild(i)}appendColumnTitle(e,s,t=null){const i=document.createElement("td");i.classList.add("affected-resource-header"),t&&i.classList.add(t),i.textContent=s,e.appendChild(i)}createIssueDetailCell(e,s=null){const t=document.createElement("td");return t.textContent=e,s&&t.classList.add(s),t}appendIssueDetailCell(e,s,t=null){const i=this.createIssueDetailCell(s,t);return e.appendChild(i),i}}const O={nRequests:"{n, plural, =1 {# request} other {# requests}}",requestC:"Request",parentFrame:"Parent Frame",blockedResource:"Blocked Resource"},U=i.i18n.registerUIStrings("panels/issues/AffectedBlockedByResponseView.ts",O),V=i.i18n.getLocalizedString.bind(void 0,U);class H extends q{#H(e){const s=document.createElement("tr");this.appendColumnTitle(s,V(O.requestC)),this.appendColumnTitle(s,V(O.parentFrame)),this.appendColumnTitle(s,V(O.blockedResource)),this.affectedResources.appendChild(s);let t=0;for(const s of e)this.#N(s),t++;this.updateAffectedResourceCount(t)}getResourceNameWithCount(e){return V(O.nRequests,{n:e})}#N(e){const t=document.createElement("tr");t.classList.add("affected-resource-row");const i=this.createRequestCell(e.request,{additionalOnClickAction(){l.userMetrics.issuesPanelResourceOpened(s.Issue.IssueCategory.CrossOriginEmbedderPolicy,"Request")}});if(t.appendChild(i),e.parentFrame){const s=this.createFrameCell(e.parentFrame.frameId,this.issue.getCategory());t.appendChild(s)}else t.appendChild(document.createElement("td"));if(e.blockedFrame){const s=this.createFrameCell(e.blockedFrame.frameId,this.issue.getCategory());t.appendChild(s)}else t.appendChild(document.createElement("td"));this.affectedResources.appendChild(t)}update(){this.clear(),this.#H(this.issue.getBlockedByResponseDetails())}}const N={nCookies:"{n, plural, =1 {# cookie} other {# cookies}}",name:"Name",domain:"Domain",path:"Path",nRawCookieLines:"{n, plural, =1 {1 Raw `Set-Cookie` header} other {# Raw `Set-Cookie` headers}}",filterSetCookieTitle:"Show network requests that include this `Set-Cookie` header in the network panel"},F=i.i18n.registerUIStrings("panels/issues/AffectedCookiesView.ts",N),B=i.i18n.getLocalizedString.bind(void 0,F);class K extends q{getResourceNameWithCount(e){return B(N.nCookies,{n:e})}#F(e){const s=document.createElement("tr");this.appendColumnTitle(s,B(N.name)),this.appendColumnTitle(s,B(N.domain)+" & "+B(N.path),"affected-resource-cookie-info-header"),this.affectedResources.appendChild(s);let t=0;for(const s of e)t++,this.#B(s.cookie,s.hasRequest);this.updateAffectedResourceCount(t)}#B(s,i){const n=document.createElement("tr");n.classList.add("affected-resource-cookie");const a=document.createElement("td");if(i){const i=t.UIUtils.createTextButton(s.name,(()=>{l.userMetrics.issuesPanelResourceOpened(this.issue.getCategory(),"Cookie"),e.Revealer.reveal(u.UIFilter.UIRequestFilter.filters([{filterType:u.UIFilter.FilterType.CookieDomain,filterValue:s.domain},{filterType:u.UIFilter.FilterType.CookieName,filterValue:s.name},{filterType:u.UIFilter.FilterType.CookiePath,filterValue:s.path}]))}),"link-style devtools-link");i.setAttribute("jslog",`${r.link().track({click:!0}).context("cookie-filter")}`),a.appendChild(i)}else a.textContent=s.name;n.appendChild(a),this.appendIssueDetailCell(n,`${s.domain}${s.path}`,"affected-resource-cookie-info"),this.affectedResources.appendChild(n)}update(){this.clear(),this.#F(this.issue.cookiesWithRequestIndicator())}}class z extends q{getResourceNameWithCount(e){return B(N.nRawCookieLines,{n:e})}update(){this.clear();const s=this.issue.getRawCookieLines();let i=0;for(const n of s){const s=document.createElement("tr");if(s.classList.add("affected-resource-directive"),n.hasRequest){const i=document.createElement("td"),r=t.UIUtils.createTextButton(n.rawCookieLine,(()=>{e.Revealer.reveal(u.UIFilter.UIRequestFilter.filters([{filterType:u.UIFilter.FilterType.ResponseHeaderValueSetCookie,filterValue:n.rawCookieLine}]))}),"link-style devtools-link");r.title=B(N.filterSetCookieTitle),i.appendChild(r),s.appendChild(i)}else this.appendIssueDetailCell(s,n.rawCookieLine);this.affectedResources.appendChild(s),i++}this.updateAffectedResourceCount(i)}}const W={nDirectives:"{n, plural, =1 {# directive} other {# directives}}",reportonly:"report-only",blocked:"blocked",clickToRevealTheViolatingDomNode:"Click to reveal the violating DOM node in the Elements panel",directiveC:"Directive",element:"Element",sourceLocation:"Source location",status:"Status",resourceC:"Resource"},j=i.i18n.registerUIStrings("panels/issues/AffectedDirectivesView.ts",W),_=i.i18n.getLocalizedString.bind(void 0,j);class $ extends q{#K(e,s){const t=document.createElement("td");s?(t.classList.add("affected-resource-report-only-status"),t.textContent=_(W.reportonly)):(t.classList.add("affected-resource-blocked-status"),t.textContent=_(W.blocked)),e.appendChild(t)}getResourceNameWithCount(e){return _(W.nDirectives,{n:e})}#z(e,s){const t=document.createElement("td");t.textContent=s,e.appendChild(t)}#W(e,s){const t=document.createElement("td");t.classList.add("affected-resource-directive-info"),t.textContent=s,e.appendChild(t)}#j(s,t,i){const n=new d.ElementsPanelLink.ElementsPanelLink;if(t){const s=t;n.title=_(W.clickToRevealTheViolatingDomNode);const r=()=>{const t=i.getTargetIfNotDisposed();if(t){l.userMetrics.issuesPanelResourceOpened(this.issue.getCategory(),"Element");const i=new p.DOMModel.DeferredDOMNode(t,s);e.Revealer.reveal(i)}},a=()=>{const e=i.getTargetIfNotDisposed();if(e){const t=new p.DOMModel.DeferredDOMNode(e,s);t&&t.highlight()}},o=()=>{p.OverlayModel.OverlayModel.hideDOMNodeHighlight()};n.data={onElementRevealIconClick:r,onElementRevealIconMouseEnter:a,onElementRevealIconMouseLeave:o}}const r=document.createElement("td");r.classList.add("affected-resource-csp-info-node"),r.appendChild(n),s.appendChild(r)}#_(e){const t=document.createElement("tr");if(this.issue.code()===s.ContentSecurityPolicyIssue.inlineViolationCode)this.appendColumnTitle(t,_(W.directiveC)),this.appendColumnTitle(t,_(W.element)),this.appendColumnTitle(t,_(W.sourceLocation)),this.appendColumnTitle(t,_(W.status));else if(this.issue.code()===s.ContentSecurityPolicyIssue.urlViolationCode)this.appendColumnTitle(t,_(W.resourceC),"affected-resource-directive-info-header"),this.appendColumnTitle(t,_(W.status)),this.appendColumnTitle(t,_(W.directiveC)),this.appendColumnTitle(t,_(W.sourceLocation));else if(this.issue.code()===s.ContentSecurityPolicyIssue.evalViolationCode)this.appendColumnTitle(t,_(W.sourceLocation)),this.appendColumnTitle(t,_(W.directiveC)),this.appendColumnTitle(t,_(W.status));else if(this.issue.code()===s.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode)this.appendColumnTitle(t,_(W.sourceLocation)),this.appendColumnTitle(t,_(W.status));else{if(this.issue.code()!==s.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode)return void this.updateAffectedResourceCount(0);this.appendColumnTitle(t,_(W.sourceLocation)),this.appendColumnTitle(t,_(W.directiveC)),this.appendColumnTitle(t,_(W.status))}this.affectedResources.appendChild(t);let i=0;for(const s of e)i++,this.#$(s);this.updateAffectedResourceCount(i)}#$(e){const t=document.createElement("tr");t.classList.add("affected-resource-directive");const i=e.details(),n=s.Issue.toZeroBasedLocation(i.sourceCodeLocation),r=e.model(),a=e.model()?.getTargetIfNotDisposed();if(this.issue.code()===s.ContentSecurityPolicyIssue.inlineViolationCode&&r)this.#z(t,i.violatedDirective),this.#j(t,i.violatingNodeId,r),this.appendSourceLocation(t,n,a),this.#K(t,i.isReportOnly);else if(this.issue.code()===s.ContentSecurityPolicyIssue.urlViolationCode){const e=i.blockedURL?i.blockedURL:m.DevToolsPath.EmptyUrlString;this.#W(t,e),this.#K(t,i.isReportOnly),this.#z(t,i.violatedDirective),this.appendSourceLocation(t,n,a)}else if(this.issue.code()===s.ContentSecurityPolicyIssue.evalViolationCode)this.appendSourceLocation(t,n,a),this.#z(t,i.violatedDirective),this.#K(t,i.isReportOnly);else if(this.issue.code()===s.ContentSecurityPolicyIssue.trustedTypesSinkViolationCode)this.appendSourceLocation(t,n,a),this.#K(t,i.isReportOnly);else{if(this.issue.code()!==s.ContentSecurityPolicyIssue.trustedTypesPolicyViolationCode)return;this.appendSourceLocation(t,n,a),this.#z(t,i.violatedDirective),this.#K(t,i.isReportOnly)}this.affectedResources.appendChild(t)}update(){this.clear(),this.#_(this.issue.getCspIssues())}}const Q={nElements:"{n, plural, =1 {# element} other {# elements}}"},G=i.i18n.registerUIStrings("panels/issues/AffectedElementsView.ts",Q),J=i.i18n.getLocalizedString.bind(void 0,G);class Z extends q{async#Q(e){let s=0;for(const t of e)await this.#G(t),s++;this.updateAffectedResourceCount(s)}getResourceNameWithCount(e){return J(Q.nElements,{n:e})}async#G(e){const s=await this.createElementCell(e,this.issue.getCategory()),t=document.createElement("tr");t.appendChild(s),this.affectedResources.appendChild(t)}update(){this.clear(),this.#Q(this.issue.elements())}}const X={nDocuments:"{n, plural, =1 { document} other { documents}}",documentInTheDOMTree:"Document in the DOM tree",url:"URL",mode:"Mode"},Y=i.i18n.registerUIStrings("panels/issues/AffectedDocumentsInQuirksModeView.ts",X),ee=i.i18n.getLocalizedString.bind(void 0,Y);class se extends Z{#J=Promise.resolve();update(){this.#J=this.#J.then(this.#Z.bind(this))}getResourceName(e){return ee(X.nDocuments,{n:e})}async#Z(){this.clear(),await this.#X(this.issue.getQuirksModeIssues())}async#Y(e){const s=document.createElement("tr");s.classList.add("affected-resource-quirks-mode");const t=e.details(),i=p.FrameManager.FrameManager.instance().getFrame(t.frameId)?.resourceTreeModel().target()||null;s.appendChild(await this.createElementCell({nodeName:"document",backendNodeId:t.documentNodeId,target:i},e.getCategory())),this.appendIssueDetailCell(s,t.isLimitedQuirksMode?"Limited Quirks Mode":"Quirks Mode"),this.appendIssueDetailCell(s,t.url),this.affectedResources.appendChild(s)}async#X(e){const s=document.createElement("tr");this.appendColumnTitle(s,ee(X.documentInTheDOMTree)),this.appendColumnTitle(s,ee(X.mode)),this.appendColumnTitle(s,ee(X.url)),this.affectedResources.appendChild(s);let t=0;for(const s of e)t++,await this.#Y(s);this.updateAffectedResourceCount(t)}}class te extends Z{#J=Promise.resolve();update(){this.#J=this.#J.then(this.#Z.bind(this))}async#Z(){this.clear(),await this.#ee(this.issue.getLowContrastIssues())}async#se(e){const s=document.createElement("tr");s.classList.add("affected-resource-low-contrast");const t=e.details(),i=e.model()?.target()||null;s.appendChild(await this.createElementCell({nodeName:t.violatingNodeSelector,backendNodeId:t.violatingNodeId,target:i},e.getCategory())),this.appendIssueDetailCell(s,String(m.NumberUtilities.floor(t.contrastRatio,2))),this.appendIssueDetailCell(s,String(t.thresholdAA)),this.appendIssueDetailCell(s,String(t.thresholdAAA)),this.appendIssueDetailCell(s,t.fontSize),this.appendIssueDetailCell(s,t.fontWeight),this.affectedResources.appendChild(s)}async#ee(e){const s=document.createElement("tr");this.appendColumnTitle(s,re(ie.element)),this.appendColumnTitle(s,re(ie.contrastRatio)),this.appendColumnTitle(s,re(ie.minimumAA)),this.appendColumnTitle(s,re(ie.minimumAAA)),this.appendColumnTitle(s,re(ie.textSize)),this.appendColumnTitle(s,re(ie.textWeight)),this.affectedResources.appendChild(s);let t=0;for(const s of e)t++,await this.#se(s);this.updateAffectedResourceCount(t)}}const ie={element:"Element",contrastRatio:"Contrast ratio",minimumAA:"Minimum AA ratio",minimumAAA:"Minimum AAA ratio",textSize:"Text size",textWeight:"Text weight"},ne=i.i18n.registerUIStrings("panels/issues/AffectedElementsWithLowContrastView.ts",ie),re=i.i18n.getLocalizedString.bind(void 0,ne),ae={nResources:"{n, plural, =1 {# resource} other {# resources}}",limitExceeded:"Limit exceeded",resolutionStatus:"Resolution Status",frameUrl:"Frame URL",removed:"Removed",warned:"Warned",cpuPeakLimit:"CPU peak limit",cpuTotalLimit:"CPU total limit",networkLimit:"Network limit"},oe=i.i18n.registerUIStrings("panels/issues/AffectedHeavyAdView.ts",ae),de=i.i18n.getLocalizedString.bind(void 0,oe);class le extends q{#te(e){const s=document.createElement("tr");this.appendColumnTitle(s,de(ae.limitExceeded)),this.appendColumnTitle(s,de(ae.resolutionStatus)),this.appendColumnTitle(s,de(ae.frameUrl)),this.affectedResources.appendChild(s);let t=0;for(const s of e)this.#ie(s.details()),t++;this.updateAffectedResourceCount(t)}getResourceNameWithCount(e){return de(ae.nResources,{n:e})}#ne(e){switch(e){case"HeavyAdBlocked":return de(ae.removed);case"HeavyAdWarning":return de(ae.warned)}return""}#re(e){switch(e){case"CpuPeakLimit":return de(ae.cpuPeakLimit);case"CpuTotalLimit":return de(ae.cpuTotalLimit);case"NetworkTotalLimit":return de(ae.networkLimit)}return""}#ie(e){const s=document.createElement("tr");s.classList.add("affected-resource-heavy-ad");const t=document.createElement("td");t.classList.add("affected-resource-heavy-ad-info"),t.textContent=this.#re(e.reason),s.appendChild(t);const i=document.createElement("td");i.classList.add("affected-resource-heavy-ad-info"),i.textContent=this.#ne(e.resolution),s.appendChild(i);const n=e.frame.frameId,r=this.createFrameCell(n,this.issue.getCategory());s.appendChild(r),this.affectedResources.appendChild(s)}update(){this.clear(),this.#te(this.issue.getHeavyAdIssues())}}const ue={nAllowedSites:"{n, plural, =1 {1 website allowed to access cookies} other {# websites allowed to access cookies}}"},ce=i.i18n.registerUIStrings("panels/issues/AffectedMetadataAllowedSitesView.ts",ue),pe=i.i18n.getLocalizedString.bind(void 0,ce);class he extends q{getResourceNameWithCount(e){return pe(ue.nAllowedSites,{n:e})}update(){this.clear();const e=this.issue.getMetadataAllowedSites();let s=0;for(const t of e){const e=document.createElement("tr");e.classList.add("affected-resource-directive"),this.appendIssueDetailCell(e,t),this.affectedResources.appendChild(e),s++}this.updateAffectedResourceCount(s)}}const ge={nViolations:"{n, plural, =1 {# violation} other {# violations}}",warning:"warning",blocked:"blocked",instantiation:"Instantiation",aSharedarraybufferWas:"A `SharedArrayBuffer` was instantiated in a context that is not cross-origin isolated",transfer:"Transfer",sharedarraybufferWasTransferedTo:"`SharedArrayBuffer` was transfered to a context that is not cross-origin isolated",sourceLocation:"Source Location",trigger:"Trigger",status:"Status"},fe=i.i18n.registerUIStrings("panels/issues/AffectedSharedArrayBufferIssueDetailsView.ts",ge),me=i.i18n.getLocalizedString.bind(void 0,fe);class Ce extends q{getResourceNameWithCount(e){return me(ge.nViolations,{n:e})}#K(e,s){const t=document.createElement("td");s?(t.classList.add("affected-resource-report-only-status"),t.textContent=me(ge.warning)):(t.classList.add("affected-resource-blocked-status"),t.textContent=me(ge.blocked)),e.appendChild(t)}#ae(e,s){const t=document.createElement("td");switch(s){case"CreationIssue":t.textContent=me(ge.instantiation),t.title=me(ge.aSharedarraybufferWas);break;case"TransferIssue":t.textContent=me(ge.transfer),t.title=me(ge.sharedarraybufferWasTransferedTo)}e.appendChild(t)}#H(e){const s=document.createElement("tr");this.appendColumnTitle(s,me(ge.sourceLocation)),this.appendColumnTitle(s,me(ge.trigger)),this.appendColumnTitle(s,me(ge.status)),this.affectedResources.appendChild(s);let t=0;for(const s of e)t++,this.#N(s);this.updateAffectedResourceCount(t)}#N(e){const t=document.createElement("tr");t.classList.add("affected-resource-directive");const i=e.details(),n=s.Issue.toZeroBasedLocation(i.sourceCodeLocation);this.appendSourceLocation(t,n,e.model()?.getTargetIfNotDisposed()),this.#ae(t,i.type),this.#K(t,i.isWarning),this.affectedResources.appendChild(t)}update(){this.clear(),this.#H(this.issue.getSharedArrayBufferIssues())}}const Ie={nSources:"{n, plural, =1 {# source} other {# sources}}"},we=i.i18n.registerUIStrings("panels/issues/AffectedSourcesView.ts",Ie),ye=i.i18n.getLocalizedString.bind(void 0,we);class Re extends q{#oe(e){let s=0;for(const t of e)this.#de(t),s++;this.updateAffectedResourceCount(s)}getResourceNameWithCount(e){return ye(Ie.nSources,{n:e})}#de({url:e,lineNumber:s,columnNumber:t}){const i=document.createElement("td"),n={columnNumber:t,lineNumber:s,tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0},a=f.Linkifier.Linkifier.linkifyURL(e,n);a.setAttribute("jslog",`${r.link().track({click:!0}).context("source-location")}`),i.appendChild(a);const o=document.createElement("tr");o.classList.add("affected-resource-source"),o.appendChild(i),this.affectedResources.appendChild(o)}update(){this.clear(),this.#oe(this.issue.sources())}}const ke={nTrackingSites:"{n, plural, =1 {1 potentially tracking website} other {# potentially tracking websites}}"},ve=i.i18n.registerUIStrings("panels/issues/AffectedTrackingSitesView.ts",ke),be=i.i18n.getLocalizedString.bind(void 0,ve);class Ae extends q{getResourceNameWithCount(e){return be(ke.nTrackingSites,{n:e})}update(){this.clear();const e=this.issue.getBounceTrackingSites();let s=0;for(const t of e){const e=document.createElement("tr");e.classList.add("affected-resource-directive"),this.appendIssueDetailCell(e,t),this.affectedResources.appendChild(e),s++}this.updateAffectedResourceCount(s)}}const Se={nViolations:"{n, plural, =1 {# violation} other {# violations}}",element:"Element",invalidHeaderValue:"Invalid Header Value",request:"Request",untrustworthyOrigin:"Untrustworthy origin"},xe=i.i18n.registerUIStrings("panels/issues/AttributionReportingIssueDetailsView.ts",Se),Te=i.i18n.getLocalizedString.bind(void 0,xe);class Ee extends q{getResourceNameWithCount(e){return Te(Se.nViolations,{n:e})}update(){this.clear();const e=this.issue.getAttributionReportingIssues();e.size>0?this.#H(e.values().next().value.code(),e):this.updateAffectedResourceCount(0)}#H(e,s){const t=document.createElement("tr");switch(e){case"AttributionReportingIssue::InvalidRegisterSourceHeader":case"AttributionReportingIssue::InvalidRegisterTriggerHeader":case"AttributionReportingIssue::InvalidRegisterOsSourceHeader":case"AttributionReportingIssue::InvalidRegisterOsTriggerHeader":case"AttributionReportingIssue::OsSourceIgnored":case"AttributionReportingIssue::OsTriggerIgnored":case"AttributionReportingIssue::SourceIgnored":case"AttributionReportingIssue::TriggerIgnored":this.appendColumnTitle(t,Te(Se.request)),this.appendColumnTitle(t,Te(Se.invalidHeaderValue));break;case"AttributionReportingIssue::InsecureContext":case"AttributionReportingIssue::UntrustworthyReportingOrigin":this.appendColumnTitle(t,Te(Se.element)),this.appendColumnTitle(t,Te(Se.request)),this.appendColumnTitle(t,Te(Se.untrustworthyOrigin));break;case"AttributionReportingIssue::PermissionPolicyDisabled":this.appendColumnTitle(t,Te(Se.element)),this.appendColumnTitle(t,Te(Se.request));break;case"AttributionReportingIssue::SourceAndTriggerHeaders":case"AttributionReportingIssue::WebAndOsHeaders":this.appendColumnTitle(t,Te(Se.request));break;case"AttributionReportingIssue::NavigationRegistrationWithoutTransientUserActivation":this.appendColumnTitle(t,Te(Se.element))}this.affectedResources.appendChild(t);let i=0;for(const t of s)i++,this.#N(e,t);this.updateAffectedResourceCount(i)}async#N(e,s){const t=document.createElement("tr");t.classList.add("affected-resource-directive");const i=s.issueDetails;switch(e){case"AttributionReportingIssue::InvalidRegisterSourceHeader":case"AttributionReportingIssue::InvalidRegisterTriggerHeader":case"AttributionReportingIssue::InvalidRegisterOsSourceHeader":case"AttributionReportingIssue::InvalidRegisterOsTriggerHeader":case"AttributionReportingIssue::OsSourceIgnored":case"AttributionReportingIssue::OsTriggerIgnored":case"AttributionReportingIssue::SourceIgnored":case"AttributionReportingIssue::TriggerIgnored":this.#le(t,i.request),this.appendIssueDetailCell(t,i.invalidParameter||"");break;case"AttributionReportingIssue::InsecureContext":case"AttributionReportingIssue::UntrustworthyReportingOrigin":await this.#ue(t,s),this.#le(t,i.request),this.appendIssueDetailCell(t,i.invalidParameter||"");break;case"AttributionReportingIssue::PermissionPolicyDisabled":await this.#ue(t,s),this.#le(t,i.request);break;case"AttributionReportingIssue::SourceAndTriggerHeaders":case"AttributionReportingIssue::WebAndOsHeaders":this.#le(t,i.request);break;case"AttributionReportingIssue::NavigationRegistrationWithoutTransientUserActivation":await this.#ue(t,s)}this.affectedResources.appendChild(t)}async#ue(e,s){const t=s.issueDetails;if(void 0!==t.violatingNodeId){const i=s.model()?.target()||null;e.appendChild(await this.createElementCell({backendNodeId:t.violatingNodeId,target:i,nodeName:"Attribution source element"},s.getCategory()))}else this.appendIssueDetailCell(e,"")}#le(e,t){if(!t)return void this.appendIssueDetailCell(e,"");const i={additionalOnClickAction(){l.userMetrics.issuesPanelResourceOpened(s.Issue.IssueCategory.AttributionReporting,"Request")}};e.appendChild(this.createRequestCell(t,i))}}const Le={nRequests:"{n, plural, =1 {# request} other {# requests}}",warning:"warning",blocked:"blocked",status:"Status",request:"Request",resourceAddressSpace:"Resource Address",initiatorAddressSpace:"Initiator Address",secure:"secure",insecure:"insecure",initiatorContext:"Initiator Context",preflightRequestIfProblematic:"Preflight Request (if problematic)",preflightRequest:"Preflight Request",header:"Header",problem:"Problem",invalidValue:"Invalid Value (if available)",problemMissingHeader:"Missing Header",problemMultipleValues:"Multiple Values",problemInvalidValue:"Invalid Value",preflightDisallowedRedirect:"Response to preflight was a redirect",preflightInvalidStatus:"HTTP status of preflight request didn't indicate success",allowedOrigin:"Allowed Origin (from header)",allowCredentialsValueFromHeader:"`Access-Control-Allow-Credentials` Header Value",disallowedRequestMethod:"Disallowed Request Method",disallowedRequestHeader:"Disallowed Request Header",sourceLocation:"Source Location",unsupportedScheme:"Unsupported Scheme",failedRequest:"Failed Request"},Me=i.i18n.registerUIStrings("panels/issues/CorsIssueDetailsView.ts",Le),Pe=i.i18n.getLocalizedString.bind(void 0,Me);class De extends q{constructor(e,s){super(e,s),this.affectedResourcesCountElement.classList.add("cors-issue-affected-resource-label")}#K(e,s){const t=document.createElement("td");s?(t.classList.add("affected-resource-report-only-status"),t.textContent=Pe(Le.warning)):(t.classList.add("affected-resource-blocked-status"),t.textContent=Pe(Le.blocked)),e.appendChild(t)}getResourceNameWithCount(e){return Pe(Le.nRequests,{n:e})}#H(e,t){const i=document.createElement("tr");switch(this.appendColumnTitle(i,Pe(Le.request)),this.appendColumnTitle(i,Pe(Le.status)),e){case s.CorsIssue.IssueCode.InvalidHeaderValues:this.appendColumnTitle(i,Pe(Le.preflightRequestIfProblematic)),this.appendColumnTitle(i,Pe(Le.header)),this.appendColumnTitle(i,Pe(Le.problem)),this.appendColumnTitle(i,Pe(Le.invalidValue));break;case s.CorsIssue.IssueCode.WildcardOriginNotAllowed:this.appendColumnTitle(i,Pe(Le.preflightRequestIfProblematic));break;case s.CorsIssue.IssueCode.PreflightResponseInvalid:this.appendColumnTitle(i,Pe(Le.preflightRequest)),this.appendColumnTitle(i,Pe(Le.problem));break;case s.CorsIssue.IssueCode.OriginMismatch:this.appendColumnTitle(i,Pe(Le.preflightRequestIfProblematic)),this.appendColumnTitle(i,Pe(Le.initiatorContext)),this.appendColumnTitle(i,Pe(Le.allowedOrigin));break;case s.CorsIssue.IssueCode.AllowCredentialsRequired:this.appendColumnTitle(i,Pe(Le.preflightRequestIfProblematic)),this.appendColumnTitle(i,Pe(Le.allowCredentialsValueFromHeader));break;case s.CorsIssue.IssueCode.InsecurePrivateNetwork:this.appendColumnTitle(i,Pe(Le.resourceAddressSpace)),this.appendColumnTitle(i,Pe(Le.initiatorAddressSpace)),this.appendColumnTitle(i,Pe(Le.initiatorContext));break;case s.CorsIssue.IssueCode.PreflightAllowPrivateNetworkError:this.appendColumnTitle(i,Pe(Le.preflightRequest)),this.appendColumnTitle(i,Pe(Le.invalidValue)),this.appendColumnTitle(i,Pe(Le.initiatorAddressSpace)),this.appendColumnTitle(i,Pe(Le.initiatorContext));break;case s.CorsIssue.IssueCode.PreflightMissingPrivateNetworkAccessId:case s.CorsIssue.IssueCode.PreflightMissingPrivateNetworkAccessName:this.appendColumnTitle(i,Pe(Le.preflightRequest)),this.appendColumnTitle(i,Pe(Le.invalidValue)),this.appendColumnTitle(i,Pe(Le.resourceAddressSpace)),this.appendColumnTitle(i,Pe(Le.initiatorAddressSpace)),this.appendColumnTitle(i,Pe(Le.initiatorContext));break;case s.CorsIssue.IssueCode.MethodDisallowedByPreflightResponse:this.appendColumnTitle(i,Pe(Le.preflightRequest)),this.appendColumnTitle(i,Pe(Le.disallowedRequestMethod));break;case s.CorsIssue.IssueCode.HeaderDisallowedByPreflightResponse:this.appendColumnTitle(i,Pe(Le.preflightRequest)),this.appendColumnTitle(i,Pe(Le.disallowedRequestHeader));break;case s.CorsIssue.IssueCode.RedirectContainsCredentials:break;case s.CorsIssue.IssueCode.DisallowedByMode:this.appendColumnTitle(i,Pe(Le.initiatorContext)),this.appendColumnTitle(i,Pe(Le.sourceLocation));break;case s.CorsIssue.IssueCode.CorsDisabledScheme:this.appendColumnTitle(i,Pe(Le.initiatorContext)),this.appendColumnTitle(i,Pe(Le.sourceLocation)),this.appendColumnTitle(i,Pe(Le.unsupportedScheme));break;case s.CorsIssue.IssueCode.NoCorsRedirectModeNotFollow:this.appendColumnTitle(i,Pe(Le.sourceLocation));break;default:m.assertUnhandled(e)}this.affectedResources.appendChild(i);let n=0;for(const s of t)n++,this.#N(e,s);this.updateAffectedResourceCount(n)}#ce(e,s){void 0!==s?this.appendIssueDetailCell(e,Pe(s?Le.secure:Le.insecure)):this.appendIssueDetailCell(e,"")}static getHeaderFromError(e){switch(e){case"InvalidAllowHeadersPreflightResponse":return"Access-Control-Allow-Headers";case"InvalidAllowMethodsPreflightResponse":case"MethodDisallowedByPreflightResponse":return"Access-Control-Allow-Methods";case"PreflightMissingAllowOriginHeader":case"PreflightMultipleAllowOriginValues":case"PreflightInvalidAllowOriginValue":case"MissingAllowOriginHeader":case"MultipleAllowOriginValues":case"InvalidAllowOriginValue":case"WildcardOriginNotAllowed":case"PreflightWildcardOriginNotAllowed":case"AllowOriginMismatch":case"PreflightAllowOriginMismatch":return"Access-Control-Allow-Origin";case"InvalidAllowCredentials":case"PreflightInvalidAllowCredentials":return"Access-Control-Allow-Credentials";case"PreflightMissingAllowPrivateNetwork":case"PreflightInvalidAllowPrivateNetwork":return"Access-Control-Allow-Private-Network";case"RedirectContainsCredentials":case"PreflightDisallowedRedirect":return"Location";case"PreflightInvalidStatus":return"Status-Code";case"PreflightMissingPrivateNetworkAccessId":return"Private-Network-Access-Id";case"PreflightMissingPrivateNetworkAccessName":return"Private-Network-Access-Name"}return""}static getProblemFromError(e){switch(e.corsError){case"InvalidAllowHeadersPreflightResponse":case"InvalidAllowMethodsPreflightResponse":case"PreflightInvalidAllowOriginValue":case"InvalidAllowOriginValue":return Pe(Le.problemInvalidValue);case"PreflightMultipleAllowOriginValues":case"MultipleAllowOriginValues":return Pe(Le.problemMultipleValues);case"MissingAllowOriginHeader":case"PreflightMissingAllowOriginHeader":return Pe(Le.problemMissingHeader);case"PreflightInvalidStatus":return Pe(Le.preflightInvalidStatus);case"PreflightDisallowedRedirect":return Pe(Le.preflightDisallowedRedirect);case"InvalidResponse":return Pe(Le.failedRequest)}throw new Error("Invalid Argument")}#N(e,t){const i=document.createElement("tr");i.classList.add("affected-resource-directive");const n=t.details(),r=n.corsErrorStatus,a=n.corsErrorStatus.corsError,o={section:u.UIRequestLocation.UIHeaderSection.Response,name:De.getHeaderFromError(a)},d={additionalOnClickAction(){l.userMetrics.issuesPanelResourceOpened(s.Issue.IssueCategory.Cors,"Request")}};switch(e){case s.CorsIssue.IssueCode.InvalidHeaderValues:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),a.includes("Preflight")?i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})):this.appendIssueDetailCell(i,""),this.appendIssueDetailCell(i,De.getHeaderFromError(a),"code-example"),this.appendIssueDetailCell(i,De.getProblemFromError(n.corsErrorStatus)),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case s.CorsIssue.IssueCode.WildcardOriginNotAllowed:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),a.includes("Preflight")?i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})):this.appendIssueDetailCell(i,"");break;case s.CorsIssue.IssueCode.PreflightResponseInvalid:{i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning);const e="PreflightInvalidStatus"===a?{section:u.UIRequestLocation.UIHeaderSection.General,name:"Status-Code"}:o;i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:e})),this.appendIssueDetailCell(i,De.getProblemFromError(n.corsErrorStatus));break}case s.CorsIssue.IssueCode.OriginMismatch:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),a.includes("Preflight")?i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})):this.appendIssueDetailCell(i,""),this.appendIssueDetailCell(i,n.initiatorOrigin??"","code-example"),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case s.CorsIssue.IssueCode.AllowCredentialsRequired:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),a.includes("Preflight")?i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})):this.appendIssueDetailCell(i,""),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case s.CorsIssue.IssueCode.InsecurePrivateNetwork:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),this.appendIssueDetailCell(i,n.resourceIPAddressSpace??""),this.appendIssueDetailCell(i,n.clientSecurityState?.initiatorIPAddressSpace??""),this.#ce(i,n.clientSecurityState?.initiatorIsSecureContext);break;case s.CorsIssue.IssueCode.PreflightAllowPrivateNetworkError:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example"),this.appendIssueDetailCell(i,n.clientSecurityState?.initiatorIPAddressSpace??""),this.#ce(i,n.clientSecurityState?.initiatorIsSecureContext);break;case s.CorsIssue.IssueCode.MethodDisallowedByPreflightResponse:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case s.CorsIssue.IssueCode.HeaderDisallowedByPreflightResponse:i.appendChild(this.createRequestCell(n.request,{...d,highlightHeader:{section:u.UIRequestLocation.UIHeaderSection.Request,name:r.failedParameter}})),this.#K(i,n.isWarning),i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:{section:u.UIRequestLocation.UIHeaderSection.Response,name:"Access-Control-Allow-Headers"}})),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter,"code-example");break;case s.CorsIssue.IssueCode.RedirectContainsCredentials:i.appendChild(this.createRequestCell(n.request,{...d,highlightHeader:{section:u.UIRequestLocation.UIHeaderSection.Response,name:De.getHeaderFromError(a)}})),this.#K(i,n.isWarning);break;case s.CorsIssue.IssueCode.DisallowedByMode:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),this.appendIssueDetailCell(i,n.initiatorOrigin??"","code-example"),this.appendSourceLocation(i,n.location,t.model()?.getTargetIfNotDisposed());break;case s.CorsIssue.IssueCode.CorsDisabledScheme:i.appendChild(this.createRequestCell(n.request,{...d,highlightHeader:{section:u.UIRequestLocation.UIHeaderSection.Response,name:De.getHeaderFromError(a)}})),this.#K(i,n.isWarning),this.appendIssueDetailCell(i,n.initiatorOrigin??"","code-example"),this.appendSourceLocation(i,n.location,t.model()?.getTargetIfNotDisposed()),this.appendIssueDetailCell(i,n.corsErrorStatus.failedParameter??"","code-example");break;case s.CorsIssue.IssueCode.NoCorsRedirectModeNotFollow:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),this.appendSourceLocation(i,n.location,t.model()?.getTargetIfNotDisposed());break;case s.CorsIssue.IssueCode.PreflightMissingPrivateNetworkAccessId:case s.CorsIssue.IssueCode.PreflightMissingPrivateNetworkAccessName:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),i.appendChild(this.createRequestCell(n.request,{...d,linkToPreflight:!0,highlightHeader:o})),this.appendIssueDetailCell(i,De.getHeaderFromError(a)),this.appendIssueDetailCell(i,n.resourceIPAddressSpace??""),this.appendIssueDetailCell(i,n.clientSecurityState?.initiatorIPAddressSpace??""),this.#ce(i,n.clientSecurityState?.initiatorIsSecureContext);break;default:i.appendChild(this.createRequestCell(n.request,d)),this.#K(i,n.isWarning),m.assertUnhandled(e)}this.affectedResources.appendChild(i)}update(){this.clear();const e=this.issue.getCorsIssues();e.size>0?this.#H(e.values().next().value.code(),e):this.updateAffectedResourceCount(0)}}const qe={nResources:"{n, plural, =1 {# resource} other {# resources}}",frameId:"Frame",violatingNode:"Violating node"},Oe=i.i18n.registerUIStrings("panels/issues/GenericIssueDetailsView.ts",qe),Ue=i.i18n.getLocalizedString.bind(void 0,Oe);class Ve extends q{getResourceNameWithCount(e){return Ue(qe.nResources,{n:e})}#H(e){const s=document.createElement("tr");e.values().next().value.details().frameId&&this.appendColumnTitle(s,Ue(qe.frameId)),this.affectedResources.appendChild(s);let t=0;for(const s of e){(s.details().frameId||s.details().violatingNodeId)&&(t++,this.#N(s))}this.updateAffectedResourceCount(t)}async#N(e){const s=document.createElement("tr");s.classList.add("affected-resource-directive");const t=e.details();if(t.frameId&&s.appendChild(this.createFrameCell(t.frameId,e.getCategory())),t.violatingNodeId){const i=e.model()?.target()||null;s.appendChild(await this.createElementCell({backendNodeId:t.violatingNodeId,nodeName:this.violatingNodeIdName(t.errorType),target:i},e.getCategory()))}this.affectedResources.appendChild(s)}violatingNodeIdName(e){return"FormLabelForNameError"===e?i.i18n.lockedString("Label"):Ue(qe.violatingNode)}update(){this.clear();const e=this.issue.getGenericIssues();e.size>0?this.#H(e):this.updateAffectedResourceCount(0)}}const He={name:"Name",blocked:"blocked",nRequests:"{n, plural, =1 {# request} other {# requests}}",nResources:"{n, plural, =1 {# resource} other {# resources}}",restrictionStatus:"Restriction Status",warned:"Warned",affectedResources:"Affected Resources",learnMoreS:"Learn more: {PH1}",automaticallyUpgraded:"automatically upgraded",hideIssuesLikeThis:"Hide issues like this",unhideIssuesLikeThis:"Unhide issues like this"},Ne=i.i18n.registerUIStrings("panels/issues/IssueView.ts",He),Fe=i.i18n.getLocalizedString.bind(void 0,Ne);class Be extends q{#pe(e){let s=0;for(const t of e){const e=document.createElement("tr");e.classList.add("affected-resource-request");const i=this.issue.getCategory(),n=Ke.get(i)||u.UIRequestLocation.UIRequestTabs.HeadersComponent;e.appendChild(this.createRequestCell(t,{networkTab:n,additionalOnClickAction(){l.userMetrics.issuesPanelResourceOpened(i,"Request")}})),this.affectedResources.appendChild(e),s++}this.updateAffectedResourceCount(s)}getResourceNameWithCount(e){return Fe(He.nRequests,{n:e})}update(){this.clear();for(const e of this.issue.getBlockedByResponseDetails())return void this.updateAffectedResourceCount(0);this.issue.getCategory()!==s.Issue.IssueCategory.MixedContent?this.#pe(this.issue.requests()):this.updateAffectedResourceCount(0)}}const Ke=new Map([[s.Issue.IssueCategory.Cookie,u.UIRequestLocation.UIRequestTabs.Cookies],[s.Issue.IssueCategory.CrossOriginEmbedderPolicy,u.UIRequestLocation.UIRequestTabs.HeadersComponent],[s.Issue.IssueCategory.MixedContent,u.UIRequestLocation.UIRequestTabs.HeadersComponent]]);class ze extends q{#he(e){const s=document.createElement("tr");this.appendColumnTitle(s,Fe(He.name)),this.appendColumnTitle(s,Fe(He.restrictionStatus)),this.affectedResources.appendChild(s);let t=0;for(const s of e){const e=s.getDetails();this.appendAffectedMixedContent(e),t++}this.updateAffectedResourceCount(t)}getResourceNameWithCount(e){return Fe(He.nResources,{n:e})}appendAffectedMixedContent(e){const t=document.createElement("tr");if(t.classList.add("affected-resource-mixed-content"),e.request){const i=Ke.get(this.issue.getCategory())||u.UIRequestLocation.UIRequestTabs.HeadersComponent;t.appendChild(this.createRequestCell(e.request,{networkTab:i,additionalOnClickAction(){l.userMetrics.issuesPanelResourceOpened(s.Issue.IssueCategory.MixedContent,"Request")}}))}else{const s=(i=e.insecureURL,(/[^/]+$/.exec(i)||/[^/]+\/$/.exec(i)||[""])[0]);this.appendIssueDetailCell(t,s,"affected-resource-mixed-content-info").title=e.insecureURL}var i;this.appendIssueDetailCell(t,ze.translateStatus(e.resolutionStatus),"affected-resource-mixed-content-info"),this.affectedResources.appendChild(t)}static translateStatus(e){switch(e){case"MixedContentBlocked":return Fe(He.blocked);case"MixedContentAutomaticallyUpgraded":return Fe(He.automaticallyUpgraded);case"MixedContentWarning":return Fe(He.warned)}}update(){this.clear(),this.#he(this.issue.getMixedContentIssues())}}class We extends t.TreeOutline.TreeElement{#ge;#fe;toggleOnClick;affectedResources;#me;#w;#Ce=null;#Ie;#we;#ye=!0;#Re;#ke=!1;constructor(s,t){super(),this.#ge=s,this.#fe=t,this.#we=new e.Throttler.Throttler(250),this.toggleOnClick=!0,this.listItemElement.classList.add("issue"),this.childrenListElement.classList.add("body"),this.childrenListElement.classList.add(We.getBodyCSSClass(this.#ge.getKind())),this.affectedResources=this.#ve(),this.#me=[new K(this,this.#ge),new Z(this,this.#ge),new Be(this,this.#ge),new ze(this,this.#ge),new Re(this,this.#ge),new le(this,this.#ge),new $(this,this.#ge),new H(this,this.#ge),new Ce(this,this.#ge),new te(this,this.#ge),new De(this,this.#ge),new Ve(this,this.#ge),new se(this,this.#ge),new Ee(this,this.#ge),new z(this,this.#ge),new Ae(this,this.#ge),new he(this,this.#ge)],this.#Re=new d.HideIssuesMenu.HideIssuesMenu,this.#w=null,this.#Ie=!1}setIssue(e){this.#ge!==e&&(this.#ye=!0),this.#ge=e,this.#me.forEach((s=>s.setIssue(e)))}static getBodyCSSClass(e){switch(e){case s.Issue.IssueKind.BreakingChange:return"issue-kind-breaking-change";case s.Issue.IssueKind.PageError:return"issue-kind-page-error";case s.Issue.IssueKind.Improvement:return"issue-kind-improvement"}}getIssueTitle(){return this.#fe.title}onattach(){this.#ke?this.update():this.createContent()}createContent(){this.#E(),this.#be(),this.appendChild(this.affectedResources);const e=[];for(const s of this.#me)this.appendAffectedResource(s),s.update(),s.isEmpty()||e.push(s);this.#Ae(e),this.#Se(),this.updateAffectedResourceVisibility(),this.#ke=!0}appendAffectedResource(e){this.affectedResources.appendChild(e)}#Ae(e){for(let s=0;s<e.length;s++){const i=e[s].listItemElement;t.ARIAUtils.setPositionInSet(i,s+1),t.ARIAUtils.setSetSize(i,e.length)}}#E(){const e=document.createElement("div");e.classList.add("header"),this.#Ce=new o.Icon.Icon,this.#Ce.classList.add("leading-issue-icon"),this.#w=document.createElement("span");const s=new a.Adorner.Adorner;s.data={name:"countWrapper",content:this.#w},s.classList.add("aggregated-issues-count"),e.appendChild(this.#Ce),e.appendChild(s);const t=document.createElement("div");t.classList.add("title"),t.textContent=this.#fe.title,e.appendChild(t),this.#Re&&e.appendChild(this.#Re),this.#xe(),this.listItemElement.appendChild(e)}onexpand(){const e=this.#ge.getCategory();if(e===s.Issue.IssueCategory.Cookie){const e=s.CookieIssue.CookieIssue.getSubCategory(this.#ge.code());l.userMetrics.issuesPanelIssueExpanded(e)}else l.userMetrics.issuesPanelIssueExpanded(e);if(this.#ye&&this.#Z(),!this.#Ie){this.#Ie=!0;for(const e of this.#me)e.expandIfOneResource()}}#xe(){if(this.#Ce){const e=this.#ge.getKind();this.#Ce.data=n.IssueCounter.getIssueKindIconData(e),this.#Ce.title=s.Issue.getIssueKindDescription(e)}if(this.#w&&(this.#w.textContent=`${this.#ge.getAggregatedIssuesCount()}`),this.listItemElement.classList.toggle("hidden-issue",this.#ge.isHidden()),this.#Re){const e={menuItemLabel:this.#ge.isHidden()?Fe(He.unhideIssuesLikeThis):Fe(He.hideIssuesLikeThis),menuItemAction:()=>{const e=s.IssuesManager.getHideIssueByCodeSetting(),t=e.get();t[this.#ge.code()]=this.#ge.isHidden()?"Unhidden":"Hidden",e.set(t)}};this.#Re.data=e}}updateAffectedResourceVisibility(){const e=this.#me.every((e=>e.isEmpty()));this.affectedResources.hidden=e}#ve(){const e=new t.TreeOutline.TreeElement;return e.setCollapsible(!1),e.setExpandable(!0),e.expand(),e.selectable=!1,e.listItemElement.classList.add("affected-resources-label"),e.listItemElement.textContent=Fe(He.affectedResources),e.childrenListElement.classList.add("affected-resources"),t.ARIAUtils.setPositionInSet(e.listItemElement,2),t.ARIAUtils.setSetSize(e.listItemElement,0===this.#fe.links.length?2:3),e}#be(){const e=new t.TreeOutline.TreeElement;e.setCollapsible(!1),e.selectable=!1;const s=new c.MarkdownView.MarkdownView;s.data={tokens:this.#fe.markdown},e.listItemElement.appendChild(s),t.ARIAUtils.setPositionInSet(e.listItemElement,1),t.ARIAUtils.setSetSize(e.listItemElement,0===this.#fe.links.length?2:3),this.appendChild(e)}#Se(){if(0===this.#fe.links.length)return;const e=new t.TreeOutline.TreeElement;e.setCollapsible(!1),e.listItemElement.classList.add("link-wrapper"),t.ARIAUtils.setPositionInSet(e.listItemElement,3),t.ARIAUtils.setSetSize(e.listItemElement,3);const s=e.listItemElement.createChild("ul","link-list");for(const e of this.#fe.links){const i=t.Fragment.html`<x-link class="link devtools-link" tabindex="0" href=${e.link}>${Fe(He.learnMoreS,{PH1:e.linkTitle})}</x-link>`;i.setAttribute("jslog",`${r.link().track({click:!0}).context("learn-more")}`);const n=new o.Icon.Icon;n.data={iconName:"open-externally",color:"var(--icon-link)",width:"16px",height:"16px"},n.classList.add("link-icon"),i.prepend(n),i.addEventListener("x-link-invoke",(()=>{l.userMetrics.issuesPanelResourceOpened(this.#ge.getCategory(),"LearnMore")}));s.createChild("li").appendChild(i)}this.appendChild(e)}#Z(){this.expanded&&(this.#me.forEach((e=>e.update())),this.updateAffectedResourceVisibility()),this.#ye=!this.expanded,this.#xe()}update(){this.#we.schedule((async()=>this.#Z()))}clear(){this.#me.forEach((e=>e.clear()))}getIssueKind(){return this.#ge.getKind()}isForHiddenIssue(){return this.#ge.isHidden()}toggle(e){e||void 0===e&&!this.expanded?this.expand():this.collapse()}}var je=Object.freeze({__proto__:null,IssueView:We});const _e={crossOriginEmbedderPolicy:"Cross Origin Embedder Policy",mixedContent:"Mixed Content",samesiteCookie:"SameSite Cookie",heavyAds:"Heavy Ads",contentSecurityPolicy:"Content Security Policy",other:"Other",lowTextContrast:"Low Text Contrast",cors:"Cross Origin Resource Sharing",groupDisplayedIssuesUnder:"Group displayed issues under associated categories",groupByCategory:"Group by category",groupDisplayedIssuesUnderKind:"Group displayed issues as Page errors, Breaking changes and Improvements",groupByKind:"Group by kind",includeCookieIssuesCausedBy:"Include cookie Issues caused by third-party sites",includeThirdpartyCookieIssues:"Include third-party cookie issues",onlyThirdpartyCookieIssues:"Only third-party cookie issues detected so far",noIssuesDetectedSoFar:"No issues detected so far",attributionReporting:"Attribution Reporting `API`",quirksMode:"Quirks Mode",generic:"Generic"},$e=i.i18n.registerUIStrings("panels/issues/IssuesPane.ts",_e),Qe=i.i18n.getLocalizedString.bind(void 0,$e);class Ge extends t.TreeOutline.TreeElement{#Te;constructor(e){super(),this.#Te=e,this.toggleOnClick=!0,this.listItemElement.classList.add("issue-category"),this.childrenListElement.classList.add("issue-category-body")}getCategoryName(){switch(this.#Te){case s.Issue.IssueCategory.CrossOriginEmbedderPolicy:return Qe(_e.crossOriginEmbedderPolicy);case s.Issue.IssueCategory.MixedContent:return Qe(_e.mixedContent);case s.Issue.IssueCategory.Cookie:return Qe(_e.samesiteCookie);case s.Issue.IssueCategory.HeavyAd:return Qe(_e.heavyAds);case s.Issue.IssueCategory.ContentSecurityPolicy:return Qe(_e.contentSecurityPolicy);case s.Issue.IssueCategory.LowTextContrast:return Qe(_e.lowTextContrast);case s.Issue.IssueCategory.Cors:return Qe(_e.cors);case s.Issue.IssueCategory.AttributionReporting:return Qe(_e.attributionReporting);case s.Issue.IssueCategory.QuirksMode:return Qe(_e.quirksMode);case s.Issue.IssueCategory.Generic:return Qe(_e.generic);case s.Issue.IssueCategory.Other:return Qe(_e.other)}}onattach(){this.#E()}#E(){const e=document.createElement("div");e.classList.add("header");const s=document.createElement("div");s.classList.add("title"),s.textContent=this.getCategoryName(),e.appendChild(s),this.listItemElement.appendChild(e)}}function Je(){return e.Settings.Settings.instance().createSetting("groupIssuesByCategory",!1)}class Ze extends t.Widget.VBox{#Ee;#Le;#Me;#Pe;#De;#qe;#Oe;#Ue;#Ve;#He=Promise.resolve();constructor(){super(!0),this.element.setAttribute("jslog",`${r.panel().context("issues")}`),this.contentElement.classList.add("issues-pane"),this.#Ee=new Map,this.#Me=new Map,this.#Le=new Map,this.#Pe=null,this.#Ne(),this.#De=new t.TreeOutline.TreeOutlineInShadow,this.#De.setShowSelectionOnKeyboardFocus(!0),this.#De.contentElement.classList.add("issues"),this.contentElement.appendChild(this.#De.element),this.#qe=new v,this.#De.appendChild(this.#qe),this.#Oe=document.createElement("div"),this.#Oe.classList.add("issues-pane-no-issues"),this.contentElement.appendChild(this.#Oe),this.#Ue=s.IssuesManager.IssuesManager.instance(),this.#Ve=new I(this.#Ue),this.#Ve.addEventListener("AggregatedIssueUpdated",this.#Fe,this),this.#Ve.addEventListener("FullUpdateRequired",this.#Be,this),this.#qe.hidden=0===this.#Ue.numberOfHiddenIssues(),this.#Be(),this.#Ue.addEventListener("IssuesCountUpdated",this.#Ke,this)}elementsToRestoreScrollPositionsFor(){return[this.#De.element]}#Ne(){const e=this.contentElement.createChild("div","issues-toolbar-container");new t.Toolbar.Toolbar("issues-toolbar-left",e);const i=new t.Toolbar.Toolbar("issues-toolbar-right",e),r=Je(),a=new t.Toolbar.ToolbarSettingCheckbox(r,Qe(_e.groupDisplayedIssuesUnder),Qe(_e.groupByCategory));a.setVisible(!1),i.appendToolbarItem(a),r.addChangeListener((()=>{this.#ze(!0)}));const o=x(),d=new t.Toolbar.ToolbarSettingCheckbox(o,Qe(_e.groupDisplayedIssuesUnderKind),Qe(_e.groupByKind));i.appendToolbarItem(d),o.addChangeListener((()=>{this.#ze(!0)})),d.setVisible(!0);const l=s.Issue.getShowThirdPartyIssuesSetting();this.#Pe=new t.Toolbar.ToolbarSettingCheckbox(l,Qe(_e.includeCookieIssuesCausedBy),Qe(_e.includeThirdpartyCookieIssues)),i.appendToolbarItem(this.#Pe),this.setDefaultFocusedElement(this.#Pe.inputElement),i.appendSeparator();const u=new n.IssueCounter.IssueCounter;u.data={tooltipCallback:()=>{const e=n.IssueCounter.getIssueCountsEnumeration(s.IssuesManager.IssuesManager.instance(),!1);u.title=e},displayMode:"ShowAlways",issuesManager:s.IssuesManager.IssuesManager.instance()},u.id="console-issues-counter";const c=new t.Toolbar.ToolbarItem(u);return i.appendToolbarItem(c),{toolbarContainer:e}}#Fe(e){this.#We(e.data)}#We(e){this.#He=this.#He.then((()=>this.#je(e)))}async#je(e){let i=this.#Le.get(e.aggregationKey());if(i){i.setIssue(e);const s=this.#_e(e);i.parent===s||s instanceof t.TreeOutline.TreeOutline&&i.parent===s.rootElement()||(i.parent?.removeChild(i),this.appendIssueViewToParent(i,s))}else{const t=e.getDescription();if(!t)return void console.warn("Could not find description for issue code:",e.code());const n=await s.MarkdownIssueDescription.createIssueDescriptionFromMarkdown(t);i=new We(e,n),this.#Le.set(e.aggregationKey(),i);const r=this.#_e(e);this.appendIssueViewToParent(i,r)}i.update(),this.#Ke()}appendIssueViewToParent(e,s){s.appendChild(e,((e,s)=>e instanceof v?1:s instanceof v?-1:e instanceof We&&s instanceof We?e.getIssueTitle().localeCompare(s.getIssueTitle()):(console.error("The issues tree should only contain IssueView objects as direct children"),0))),s instanceof t.TreeOutline.TreeElement&&this.#$e(s)}#$e(e){const s=e.childrenListNode.children;let i=0;for(let e=0;e<s.length;e++){const n=s[e];n.classList.contains("issue")&&(t.ARIAUtils.setPositionInSet(n,++i),t.ARIAUtils.setSetSize(n,s.length/2))}}#_e(e){if(e.isHidden())return this.#qe;if(x().get()){const t=e.getKind(),i=this.#Me.get(t);if(i)return i;const n=new T(t);return this.#De.appendChild(n,((e,t)=>e instanceof T&&t instanceof T?function(e,t){return e.getKind()===t.getKind()?0:e.getKind()===s.Issue.IssueKind.PageError||e.getKind()===s.Issue.IssueKind.BreakingChange&&t.getKind()===s.Issue.IssueKind.Improvement?-1:1}(e,t):0)),this.#Me.set(t,n),n}if(Je().get()){const s=e.getCategory(),t=this.#Ee.get(s);if(t)return t;const i=new Ge(s);return this.#De.appendChild(i,((e,s)=>e instanceof Ge&&s instanceof Ge?e.getCategoryName().localeCompare(s.getCategoryName()):0)),this.#Ee.set(s,i),i}return this.#De}#Qe(e,s){for(const[t,i]of Array.from(e.entries()))s?.has(t)||(i.parent&&i.parent.removeChild(i),e.delete(t))}#Be(){this.#ze(!1)}#ze(e){if(this.#Qe(this.#Ee,e?void 0:this.#Ve.aggregatedIssueCategories()),this.#Qe(this.#Me,e?void 0:this.#Ve.aggregatedIssueKinds()),this.#Qe(this.#Le,e?void 0:this.#Ve.aggregatedIssueCodes()),this.#Ve)for(const e of this.#Ve.aggregatedIssues())this.#We(e);this.#Ke()}#Ge(){for(const e of this.#Me.values()){const s=this.#Ue.numberOfIssues(e.getKind());e.update(s)}}#Ke(){this.#Je(this.#Ue.numberOfIssues(),this.#Ue.numberOfHiddenIssues()),x().get()&&this.#Ge()}#Je(e,s){if(e>0||s>0){this.#qe.hidden=0===s,this.#qe.update(s),this.#De.element.hidden=!1,this.#Oe.style.display="none";const e=this.#De.firstChild();e&&(e.select(!0),this.setDefaultFocusedElement(e.listItemElement))}else{this.#De.element.hidden=!0,this.#Pe&&this.setDefaultFocusedElement(this.#Pe.inputElement);const e=this.#Ue.numberOfAllStoredIssues()>0;this.#Oe.textContent=Qe(e?_e.onlyThirdpartyCookieIssues:_e.noIssuesDetectedSoFar),this.#Oe.style.display="flex"}}async reveal(e){await this.#He;const s=this.#Ve.keyForIssue(e),t=this.#Le.get(s);if(t){if(t.isForHiddenIssue()&&(this.#qe.expand(),this.#qe.reveal()),x().get()&&!t.isForHiddenIssue()){const e=this.#Me.get(t.getIssueKind());e?.expand(),e?.reveal()}t.expand(),t.reveal(),t.select(!1,!0)}}wasShown(){super.wasShown(),this.#De.registerCSSFiles([L]),this.registerCSSFiles([E])}}var Xe=Object.freeze({__proto__:null,getGroupIssuesByCategorySetting:Je,IssuesPane:Ze});var Ye=Object.freeze({__proto__:null,IssueRevealer:class{async reveal(e){await t.ViewManager.ViewManager.instance().showView("issues-pane");const s=t.ViewManager.ViewManager.instance().view("issues-pane");if(s){const t=await s.widget();if(!(t instanceof Ze))throw new Error("Expected issues pane to be an instance of IssuesPane");await t.reveal(e)}}}});export{w as IssueAggregator,Ye as IssueRevealer,je as IssueView,Xe as IssuesPane};
